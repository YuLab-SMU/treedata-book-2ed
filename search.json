[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Data Integration, Manipulation and Visualization of Phylogenetic Trees",
    "section": "",
    "text": "Preface\nNote: This book has been published by Chapman & Hall/CRC. The online version of this book is free to read here (thanks to Chapman & Hall/CRC), and licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.\nI am so excited to have this book published. The book is meant as a guide for data integration, manipulation and visualization of phylogenetic trees using a suite of R packages, tidytree, treeio, ggtree and ggtreeExtra. Hence, if you are starting to read this book, we assume you have a working knowledge of how to use R and ggplot2.\nThe development of the ggtree package started during my PhD study at the University of Hong Kong. I joined the State Key Laboratory of Emerging Infectious Diseases (SKLEID) under the supervision of Yi Guan and Tommy Lam. I was asked to provide assistance to modify the newick tree string to incorporate some additional information, such as amino acid substitutions, in the internal node labels of the phylogeny for visualization. I wrote an R script to do it and soon realized that most phylogenetic tree visualization software can only display one type of data through node labels. Basically, we cannot display two data variables at the same time for comparative analysis. In order to produce tree graphs displaying different types of branch/node associated information, such as bootstrap values and substitutions, people mostly relied on post-processing image software. This situation motivates me to develop ggtree. First of all, I think a good user interface must fully support the ggplot2 syntax, which allows us to draw graphs by superimposing layers. In this way, simple graphs are simple, and complex graphs are just a combination of simple layers, which are easy to generate.\nAfter several years of development, ggtree has evolved into a package suite, including tidytree for manipulating tree with data using the tidy interface; treeio for importing and exporting tree with richly annotated data; ggtree for tree visualization and annotation and ggtreeExtra for presenting data with a phylogeny side-by-side for a rectangular layout or in outer rings for a circular layout. The ggtree is a general tool that supports different types of tree and tree-like structures and can be applied to different disciplines to help researchers presenting and interpreting data in the evolutionary or hierarchical context.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Data Integration, Manipulation and Visualization of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "index.html#structure-of-the-book",
    "href": "index.html#structure-of-the-book",
    "title": "Data Integration, Manipulation and Visualization of Phylogenetic Trees",
    "section": "Structure of the book",
    "text": "Structure of the book\n\nPart I (Tree data input, output and manipulation) describes treeio package for tree data input and output, and tidytree package for tree data manipulation.\nPart II (Tree data visualization and annotation) introduces tree visualization and annotation using the grammar of graphic syntax implemented in the ggtree package. It emphasizes presenting tree-associated data on the tree.\nPart III (ggtree extensions) introduces ggtreeExtra for presenting data on circular layout trees and other extensions including MicrobiotaProcess and tanggle etc.\nPart IV (Miscellaneous topics) describes utilities provided by the ggtree package suite and presents a set of reproducible examples.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Data Integration, Manipulation and Visualization of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "index.html#acknowledgments",
    "href": "index.html#acknowledgments",
    "title": "Data Integration, Manipulation and Visualization of Phylogenetic Trees",
    "section": "Acknowledgments",
    "text": "Acknowledgments\nMany people have contributed to this book with spelling and grammar corrections. I’d particularly like to thank Shuangbin Xu, Lin Li and Xiao Luo for their detailed technical reviews of the book, and Tiao You for designing the front cover of the book.\nMany others have contributed during the development of the ggtree package suite. I would like to thank Hadley Wickham, for creating the ggplot2 package that ggtree relies on; Tommy Tsan-Yuk Lam and Yi Guan for being great advisors and supporting the development of ggtree during my PhD; Richard Ree for inviting me to catalysis meeting on phylogenetic tree visualization; William Pearson for inviting me to publish a protocol paper of ggtree in the Current Procotols in Bioinformatics journal; Shuangbin Xu, Yonghe Xia, Justin Silverman, Bradley Jones, Watal M. Iwasaki, Ruizhu Huang, Casey Dunn, Tyler Bradley, Konstantinos Geles, Zebulun Arendsee and many others who have contributed source code or given me feedback; and last, but not least, the members of the ggtree mailing list1, for providing many challenging problems that have helped improve the ggtree package suite.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Data Integration, Manipulation and Visualization of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "index.html#footnotes",
    "href": "index.html#footnotes",
    "title": "Data Integration, Manipulation and Visualization of Phylogenetic Trees",
    "section": "",
    "text": "https://groups.google.com/forum/#!forum/bioc-ggtree↩︎",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Data Integration, Manipulation and Visualization of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "00_author.html",
    "href": "00_author.html",
    "title": "About the Author",
    "section": "",
    "text": "Guangchuang Yu (https://yulab-smu.top) is a professor of Bioinformatics and director of the Department of Bioinformatics at Southern Medical University. He earned his Ph.D. from the School of Public Health, The University of Hong Kong. As an active R user, he has authored several R packages, such as r CRANpkg(\"aplot\"), r CRANpkg(\"badger\"), r Biocpkg(\"ChIPseeker\"), r Biocpkg(\"clusterProfiler\"), r Biocpkg(\"DOSE\"), r CRANpkg(\"emojifont\"), r Biocpkg(\"enrichplot\"), r CRANpkg(\"ggbreak\"), r CRANpkg(\"ggfun\"), r CRANpkg(\"ggimage\"), r CRANpkg(\"ggplotify\"), r Biocpkg(\"ggtree\"), r Biocpkg(\"GOSemSim\"), r CRANpkg(\"hexSticker\"), r CRANpkg(\"meme\"), r Biocpkg(\"meshes\"), r CRANpkg(\"nCov2019\"), r CRANpkg(\"plotbb\"), r Biocpkg(\"ReactomePA\"), r CRANpkg(\"scatterpie\"), r CRANpkg(\"seqmagick\"), r Biocpkg(\"seqcombo\"), r CRANpkg(\"shadowtext\"), r CRANpkg(\"tidytree\") and r Biocpkg(\"treeio\"). He has supervised post-graduate students to develop a few other packages, including r Biocpkg(\"ggmsa\"), r Biocpkg(\"ggtreeExtra\"), r Biocpkg(\"MicrobiomeProfiler\") and r Biocpkg(\"MicrobiotaProcess\").\nHis research group aims to generate new insights into human health and disease through the development of new software tools and novel analysis of biomedical data. The software package developed by his research group helps biologists analyze data and reveal biological clues hidden in the data.\nHe has published several journal articles, including 5 highly cited papers (Yu et al., 2012, 2017; Yu, Wang, Yan, et al., 2015; Yu, Wang, & He, 2015; Yu & He, 2016). The articles have been cited more than 10,000 times. The ggtree (Yu et al., 2017) paper was selected as a feature article to celebrate the 10th anniversary of the launch of Methods in Ecology and Evolution1. He was one of the 2020 Highly Cited Chinese Researchers (Elsevier-Scopus) in Biomedical Engineering.",
    "crumbs": [
      "About the Author"
    ]
  },
  {
    "objectID": "00_author.html#footnotes",
    "href": "00_author.html#footnotes",
    "title": "About the Author",
    "section": "",
    "text": "10th Anniversary Volume 8: Phylogenetic tree visualization with multivariate data: https://methodsblog.com/2020/11/19/ggtree-tree-visualization/↩︎",
    "crumbs": [
      "About the Author"
    ]
  },
  {
    "objectID": "01_treeio_importing_tree.html",
    "href": "01_treeio_importing_tree.html",
    "title": "(PART*) Part I: Tree data input, output, and manipulation",
    "section": "",
    "text": "Importing Tree with Data",
    "crumbs": [
      "(PART\\*) Part I: Tree data input, output, and manipulation"
    ]
  },
  {
    "objectID": "01_treeio_importing_tree.html#pc",
    "href": "01_treeio_importing_tree.html#pc",
    "title": "(PART*) Part I: Tree data input, output, and manipulation",
    "section": "Overview of Phylogenetic Tree Construction",
    "text": "Overview of Phylogenetic Tree Construction\nPhylogenetic trees are used to describe genealogical relationships among a group of organisms, which can be constructed based on the genetic sequences of the organisms. A rooted phylogenetic tree represents a model of evolutionary history depicted by ancestor-descendant relationships between tree nodes and clustering of ‘sister’ or ‘cousin’ organisms at a different level of relatedness, as illustrated in Figure @ref(fig:phylogeny). In infectious disease research, phylogenetic trees are usually built from the pathogens’ gene or genome sequences to show which pathogen sample is genetically closer to another sample, providing insights into the underlying unobserved epidemiologic linkage and the potential source of an outbreak.\n(ref:phylogenyscap) Components of a phylogenetic tree.\n(ref:phylogenycap) Components of a phylogenetic tree. External nodes (green circles), also called ‘tips’, represent actual organisms sampled and sequenced (e.g., viruses in infectious disease research). They are the ‘taxa’ in the terminology of evolutionary biology. The internal nodes (blue circles) represent hypothetical ancestors for the tips. The root (red circle) is the common ancestor of all species in the tree. The horizontal lines are branches and represent evolutionary changes (gray number) measured in a unit of time or genetic divergence. The bar at the bottom provides the scale of these branch lengths.\n\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the ggtree package.\n  Please report the issue at &lt;https://github.com/YuLab-SMU/ggtree/issues&gt;.\n\n\n\n\n\n(ref:phylogenycap)\n\n\n\n\nA phylogenetic tree can be constructed from genetic sequences using distance-based methods or character-based methods. Distance-based methods, including the unweighted pair group method with arithmetic means (UPGMA) and the Neighbor-joining (NJ), are based on the matrix of pairwise genetic distances calculated between sequences. The character-based methods, including maximum parsimony (MP) (Fitch, 1971), maximum likelihood (ML) (Felsenstein, 1981), and Bayesian Markov Chain Monte Carlo (BMCMC) method (Rannala & Yang, 1996), are based on a mathematical model that describes the evolution of genetic characters and searches for the best phylogenetic tree according to their optimality criteria.\nThe MP method assumes that the evolutionary change is rare and minimizes the amount of character-state changes (e.g., number of DNA substitutions). The criterion is similar to Occam’s razor, that the simplest hypothesis that can explain the data is the best hypothesis. Unweighted parsimony assumes mutations across different characters (nucleotides or amino acids) are equally likely, while the weighted method assumes the unequal likelihood of mutations (e.g., the third codon position is more liable than other codon positions; and the transition mutations have a higher frequency than transversion). The concept of the MP method is straightforward and intuitive, which is a probable reason for its popularity amongst biologists who care more about the research question rather than the computational details of the analysis. However, this method has several disadvantages, in particular, the tree inference can be biased by the well-known systematic error called long-branch attraction (LBA) that incorrectly infer distantly related lineages as closely related (Felsenstein, 1978). This is because the MP method poorly takes into consideration of many sequence evolution factors (e.g., reversals and convergence) that are hardly observable from the existing genetic data.\nThe maximum likelihood (ML) method and Bayesian Markov Chain Monte Carlo (BMCMC) method are the two most commonly used methods in phylogenetic tree construction and are most often used in scientific publications. ML and BMCMC methods require a substitution model of sequence evolution. Different sequence data have different substitution models to formulate the evolutionary process of DNA, codon and amino acid. There are several models for nucleotide substitution, including JC69, K2P, F81, HKY, and GTR (Arenas, 2015). These models can be used in conjunction with the rate variation across sites (denoted as +\\(\\Gamma\\))) (Yang, 1994) and the proportion of invariable sites (denoted as +I) (Shoemaker & Fitch, 1989). Previous research (Lemmon & Moriarty, 2004) had suggested that misspecification of substitution model might bias phylogenetic inference. Procedural testing for the best-fit substitution model is recommended.\nThe optimal criterion of the ML method is to find the tree that maximizes the likelihood given the sequence data. The procedure of the ML method is simple: calculating the likelihood of a tree and optimizing its topology and branches (and the substitution model parameters, if not fixed) until the best tree is found. Heuristic search, such as those implemented in PhyML and RAxML, is often used to find the best tree based on the likelihood criterion. The Bayesian method finds the tree that maximizes posterior probability by sampling trees through MCMC based on the given substitution model. One of the advantages of BMCMC is that parameter variance and tree topological uncertainty, included by the posterior clade probability, can be naturally and conveniently obtained from the sampling trees in the MCMC process. Moreover, the influence of topological uncertainty on other parameter estimates is also naturally integrated into the BMCMC phylogenetic framework.\nIn a simple phylogenetic tree, data associated with the tree branches/nodes could be the branch lengths (indicating genetic or time divergence) and lineage supports such as bootstrap values estimated from bootstrapping procedure or posterior clade probability summarized from the sampled trees in the BMCMC analysis.",
    "crumbs": [
      "(PART\\*) Part I: Tree data input, output, and manipulation"
    ]
  },
  {
    "objectID": "01_treeio_importing_tree.html#format",
    "href": "01_treeio_importing_tree.html#format",
    "title": "(PART*) Part I: Tree data input, output, and manipulation",
    "section": "Phylogenetic Tree Formats",
    "text": "Phylogenetic Tree Formats\nThere are several file formats designed to store phylogenetic trees and the data associated with the nodes and branches. The three commonly used formats are Newick1, NEXUS (Maddison et al., 1997), and Phylip (Felsenstein, 1989). Some formats (e.g., NHX) are extended from the Newick format. Newick and NEXUS formats are supported as input by most of the software in evolutionary biology, while some of the software tools output newer standard files (e.g., BEAST and MrBayes) by introducing new rules/data blocks for storing evolutionary inferences. In the other cases (e.g., PAML and r8s), output log files are only recognized by their own single software.\n\nNewick tree format\nThe Newick tree format is the standard for representing trees in computer-readable form.\n(ref:randomTreescap) A sample tree for demonstrating Newick text to encode tree structure.\n(ref:randomTreecap) A sample tree for demonstrating Newick text to encode tree structure. Tips were aligned to the right-hand side and branch lengths were labeled on the middle of each branch.\n\n\n\n\n\n(ref:randomTreecap)\n\n\n\n\nThe rooted tree shown in Figure @ref(fig:randomTree) can be represented by the following sequence of characters as a Newick tree text.\n\n\n((t2:0.04,t1:0.34):0.89,(t5:0.37,(t4:0.03,t3:0.67):0.9):0.59); \n\n\nThe tree text ends with a semicolon. Internal nodes are represented by a pair of matched parentheses. Between the parentheses are descendant nodes of that node. For instance (t2:0.04,t1:0.34) represents the parent node of t2 and t1 that are the immediate descendants. Sibling nodes are separated by a comma and tips are represented by their names. A branch length (from the parent node to child node) is represented by a real number after the child node and is preceded by a colon. Singular data (e.g., bootstrap values) associated with internal nodes or branches may be encoded as node labels and represented by the simple text/numbers before the colon.\nNewick tree format was developed by Meacham in 1984 for the Phylogeny Inference Package or PHYLIP (Retief, 2000) package. Newick format is now the most widely used tree format and used by PHYLIP, PAUP* (Wilgenbusch & Swofford, 2003), TREE-PUZZLE (Schmidt et al., 2002), MrBayes, and many other applications. Phylip tree format contains Phylip multiple sequence alignment (MSA) with a corresponding Newick tree text that was built based on the MSA sequences in the same file.\n\n\nNEXUS tree format\nThe NEXUS format (Maddison et al., 1997) incorporates Newick tree text with related information organized into separated units known as blocks. A NEXUS block has the following structure:\n#NEXUS\n...\nBEGIN characters;\n...\nEND;\nFor example, the above example tree can be saved as the following NEXUS format:\n\n\n#NEXUS\n[R-package APE, Sat Jan 10 10:15:53 2026]\n\nBEGIN TAXA;\n    DIMENSIONS NTAX = 5;\n    TAXLABELS\n        t2\n        t1\n        t5\n        t4\n        t3\n    ;\nEND;\nBEGIN TREES;\n    TRANSLATE\n        1   t2,\n        2   t1,\n        3   t5,\n        4   t4,\n        5   t3\n    ;\n    TREE * UNTITLED = [&R]\n((1:0.04,2:0.34):0.89,(3:0.37,(4:0.03,5:0.67):0.9):0.59);\nEND;\n\n\nComments can be placed using square brackets. Some blocks can be recognized by most of the programs including TAXA (contains information of taxa), DATA (contains data matrix, e.g., sequence alignment), and TREE (contains a phylogenetic tree, i.e., Newick tree text). Notably, blocks can be very diverse and some of them are only recognized by one particular program. For example NEXUS file exported by PAUP* has a paup block that contains PAUP* commands, whereas FigTree exports the NEXUS file with a figtree block that contains visualization settings. NEXUS organizes different types of data into different blocks, whereas programs that support reading NEXUS can parse some blocks they recognized and ignore those they could not. This is a good mechanism to allow different programs to use the same format without crashing when unsupported types of data are present. Notably, most of the programs only support parsing TAXA, DATA, and TREE blocks; therefore, a program/platform that could generically read all kinds of data blocks from the NEXUS would be useful for phylogenetic data integration.\nThe DATA block is widely used to store sequence alignment. For this purpose, the user can store tree and sequence data in Phylip format which are essentially Phylip multiple sequence alignment and Newick tree text, respectively. It is used in PHYLIP.\n\n\n\nNew Hampshire eXtended format\n\nNewick, NEXUS, and phylip are mainly designed to store phylogenetic trees and basic singular data associated with internal nodes or branches. In addition to the singular data annotation at branches and nodes (mentioned above), New Hampshire eXtended (NHX) format, which is based on Newick (also called New Hampshire), was developed to introduce tags to associate multiple data fields with the tree nodes (both internal nodes and tips). Tags are placed after branch length and must be wrapped between [&&NHX and ] which makes it possible to be compatible with NEXUS format as it defined characters between [ and ] as comments. NHX is also the output format of PHYLDOG (Boussau et al., 2013) and RevBayes (Höhna et al., 2016). A Tree Viewer (ATV) (Zmasek & Eddy, 2001) is a java tool that supports displaying annotation data stored in NHX format, but this package is no longer maintained.\nHere is a sample tree from NHX definition document2:\n\n\n(((ADH2:0.1[&&NHX:S=human], ADH1:0.11[&&NHX:S=human]):0.05\n[&&NHX:S=primates:D=Y:B=100],ADHY:0.1[&&NHX:S=nematode],\nADHX:0.12[&&NHX:S=insect]):0.1[&&NHX:S=metazoa:D=N],(ADH4:0.09\n[&&NHX:S=yeast],ADH3:0.13[&&NHX:S=yeast],ADH2:0.12[&&NHX:S=yeast],\nADH1:0.11[&&NHX:S=yeast]):0.1[&&NHX:S=Fungi])[&&NHX:D=N];\n\n\n\n\nJplace format\nTo store the Next Generation Sequencing (NGS) short reads mapped onto a phylogenetic tree (for metagenomic classification), Matsen (Matsen et al., 2012) proposed jplace format for such phylogenetic placements. Jplace format is based on JSON and contains four keys: tree, fields, placements, metadata, and version. The tree value contains tree text extended from Newick tree format by putting the edge label in brackets (if available) after branch length and putting the edge number in curly braces after the edge label. The fields value contains header information of placement data. The value of placements is a list of pqueries. Each pquery contains two keys: p for placements and n for name or nm for names with multiplicity. The value of p is a list of placement for pqueries.\nHere is a jplace sample file:\n{\n    \"tree\": \"(((((((A:4{1},B:4{2}):6{3},C:5{4}):8{5},D:6{6}):\n    3{7},E:21{8}):10{9},((F:4{10},G:12{11}):14{12},H:8{13}):\n    13{14}):13{15},((I:5{16},J:2{17}):30{18},(K:11{19},\n    L:11{20}):2{21}):17{22}):4{23},M:56{24});\",\n    \"placements\": [\n    {\"p\":[24, -61371.300778, 0.333344, 0.000003, 0.003887], \n     \"n\":[\"AA\"]\n    },\n    {\"p\":[[1, -61312.210786, 0.333335, 0.000001, 0.000003],\n          [2, -61322.210823, 0.333322, 0.000003, 0.000003],\n          [3, -61352.210823, 0.333322, 0.000961, 0.000003]],\n     \"n\":[\"BB\"]\n    },\n    {\"p\":[[8, -61312.229128, 0.200011, 0.000001, 0.000003],\n          [9, -61322.229179, 0.200000, 0.000003, 0.000003],\n          [10, -61342.229223, 0.199992, 0.000003, 0.000003]], \n    \"n\":[\"CC\"]\n    }\n    ],\n    \"metadata\": {\"info\": \"a jplace sample file\"},\n    \"version\" : 2,\n    \"fields\": [\"edge_num\", \"likelihood\", \"like_weight_ratio\", \n    \"distal_length\", \"pendant_length\"\n    ]\n}\nJplace is the output format of PPLACER (Matsen et al., 2010) and Evolutionary Placement Algorithm (EPA) (Berger et al., 2011). But these two programs do not contain tools to visualize placement results. PPLACER provides placeviz to convert jplace file to phyloXML or Newick formats which can be visualized by Archaeopteryx.\n\n\nSoftware outputs\nRAxML (Stamatakis, 2014) can output Newick format by storing the bootstrap values as internal node labels. Another way that RAxML supports is to place bootstrap value inside square brackets and after branch length. This could not be supported by most of the software that supports Newick format where square brackets will be ignored.\nBEAST (Bouckaert et al., 2014) output is based on NEXUS, and it also introduces square brackets in the tree block to store evolutionary evidence inferred by BEAST. Inside brackets, curly braces may also be incorporated if feature values have a length of more than 1 (e.g., Highest Probability Density (HPD) or range of substitution rate). These brackets are placed between node and branch length (i.e., after label if exists and before the colon). The bracket is not defined in Newick format and is a reserved character for NEXUS comment. So this information will be ignored for standard NEXUS parsers.\nHere is a sample TREE block of the BEAST output:\n\n\nTREE * TREE1 = [&R] (((11[&length=9.47]:9.39,14[&length=6.47]:6.39)\n[&length=25.72]:25.44,4[&length=9.14]:8.82)[&length=3.01]:3.1,\n(12[&length=0.62]:0.57,(10[&length=1.6]:1.56,(7[&length=5.21]:5.19,\n((((2[&length=3.3]:3.26,(1[&length=1.34]:1.32,(6[&length=0.85]:0.83,\n13[&length=0.85]:0.83)[&length=2.5]:2.49)[&length=0.97]:0.94)\n[&length=0.5]:0.5,9[&length=1.76]:1.76)[&length=2.41]:2.36,\n8[&length=2.19]:2.11)[&length=0.27]:0.24,(3[&length=3.33]:3.31,\n(15[&length=5.29]:5.27,5[&length=3.29]:3.27)[&length=1.04]:1.04)\n[&length=1.98]:2.04)[&length=2.83]:2.84)[&length=5.39]:5.37)\n[&length=2.02]:2)[&length=4.35]:4.36)[&length=0];\n\n\nBEAST output can contain many different evolutionary inferences, depending on the analysis models defined in BEAUTi for running. For example in molecular clock analysis, it contains rate, length, height, posterior and corresponding HPD and range for uncertainty estimation. Rate is the estimated evolutionary rate of the branch. Length is the length of the branch in years. Height is the time from node to root, while posterior is the Bayesian clade credibility value. The above example is the output tree of a molecular clock analysis and should contain these inferences. To save space, only the length estimation was shown above. Besides, Molecular Evolutionary Genetics Analysis (MEGA) (Kumar et al., 2016) also supports exporting trees in BEAST compatible Nexus format (see session 1.3.2).\nMrBayes (Huelsenbeck & Ronquist, 2001) is a program that uses the Markov Chain Monte Carlo method to sample from the posterior probability distributions. Its output file annotates nodes and branches separately by two sets of square brackets. For example below, posterior clade probabilities for the node and branch length estimates for the branch:\n\n\n  tree con_all_compat = [&U] (8[&prob=1.0]:2.94e-1[&length_mean=2.9e-1],\n10[&prob=1.0]:2.25e-1[&length_mean=2.2e-1],((((1[&prob=1.0]:1.43e-1\n[&length_mean=1.4e-1],2[&prob=1.0]:1.92e-1[&length_mean=1.9e-1])[&prob=1.0]:\n1.24e-1[&length_mean=1.2e-1],9[&prob=1.0]:2.27e-1[&length_mean=2.2e-1])\n[&prob=1.0]:1.72e-1[&length_mean=1.7e-1],12[&prob=1.0]:5.11e-1\n[&length_mean=5.1e-1])[&prob=1.0]:1.76e-1[&length_mean=1.7e-1],\n(((3[&prob=1.0]:5.46e-2[&length_mean=5.4e-2],(6[&prob=1.0]:1.03e-2\n[&length_mean=1.0e-2],7[&prob=1.0]:7.13e-3[&length_mean=7.2e-3])[&prob=1.0]:\n6.93e-2[&length_mean=6.9e-2])[&prob=1.0]:6.03e-2[&length_mean=6.0e-2],\n(4[&prob=1.0]:6.27e-2[&length_mean=6.2e-2],5[&prob=1.0]:6.31e-2\n[&length_mean=6.3e-2])[&prob=1.0]:6.07e-2[&length_mean=6.0e-2])[&prob=1.0]:,\n1.80e-1[&length_mean=1.8e-1]11[&prob=1.0]:2.37e-1[&length_mean=2.3e-1])\n[&prob=1.0]:4.05e-1[&length_mean=4.0e-1])[&prob=1.0]:1.16e+000\n[&length_mean=1.162699558201079e+000])[&prob=1.0][&length_mean=0];\n\n\nTo save space, most of the inferences were removed and only contains prob for clade probability and length_mean for mean value of branch length. The full version of this file also contains prob_stddev, prob_range, prob(percent), prob+-sd for probability inferences and length_median, length_95%_HPD for every branch.\nThe BEAST and MrBayes outputs are expected to be parsed without inferences (dropped as comments) by software that supports NEXUS. FigTree supports parsing BEAST, and MrBayes outputs with inferences that can be used to display or annotate on the tree. But from there, extracting these data for further analysis is still challenging.\nHyPhy (Pond et al., 2005) could do a number of phylogenetic analyses, including ancestral sequence reconstruction. For ancestral sequence reconstruction, these sequences and the Newick tree text are stored in NEXUS format as the major analysis output. It did not completely follow the NEXUS definition and only put the ancestral node labels in TAXA instead of the external node label. The MATRIX block contains sequence alignment of ancestral nodes which cannot be referred back to the tree stored in the TREES block since it does not contain node labels. Here is the sample output (to save space, only the first 72bp of alignment are shown):\n\n\n#NEXUS\n\n[\nGenerated by HYPHY 2.0020110620beta(MP) for MacOS(Universal Binary) \n    on Tue Dec 23 13:52:34 2014\n\n]\n\nBEGIN TAXA;\n    DIMENSIONS NTAX = 13;\n    TAXLABELS\n        'Node1' 'Node2' 'Node3' 'Node4' 'Node5' 'Node12' 'Node13' 'Node15'\n            'Node18' 'Node20' 'Node22' 'Node24' 'Node26' ;\nEND;\n\nBEGIN CHARACTERS;\n    DIMENSIONS NCHAR = 2148;\n    FORMAT\n        DATATYPE = DNA\n\n        GAP=-\n        MISSING=?\n        NOLABELS\n    ;\n\nMATRIX\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATTGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAATGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\n ATGGAAGACTTTGTGCGACAGTGCTTCAATCCAATGATCGTCGAGCTTGCGGAAAAGGCAATGAAAGAATAT\nEND;\n\nBEGIN TREES;\n    TREE tree = (K,N,(D,(L,(J,(G,((C,(E,O)),(H,(I,(B,(A,(F,M)))))))))));\nEND;\n\n\nThere are other applications that output rich information text that also contains phylogenetic trees with associated data. For example r8s (Sanderson, 2003) output three trees in its log file, namely TREE, RATE, and PHYLO for branches scaled by time, substitution rate, and absolute substitutions, respectively.\nPhylogenetic Analysis by Maximum Likelihood (PAML) (Yang, 2007) is a package of programs for phylogenetic analyses of DNA or protein sequences. Two main programs, BASEML and CODEML, implement a variety of models. BASEML estimates tree topology, branch lengths, and substitution parameters using a number of nucleotide substitution models available, including JC69, K80, F81, F84, HKY85, T92, TN93, and GTR. CODEML estimates synonymous and non-synonymous substitution rates, likelihood ratio test of positive selection under codon substitution models (Goldman & Yang, 1994).\nBASEML outputs mlb file that contains input sequence (taxa) alignment and a phylogenetic tree with branch length as well as substitution model and other parameters estimated. The supplementary result file, rst, contains sequence alignment (with ancestral sequence if it performs reconstruction of ancestral sequences) and Naive Empirical Bayes (NBE) probabilities that each site in the alignment evolved. CODEML outputs mlc file that contains tree structure and estimation of synonymous and non-synonymous substitution rates. CODEML also outputs a supplementary result file, rst, that is similar to BASEML except that site is defined as a codon instead of a nucleotide. Parsing these files can be tedious and would oftentimes need a number of post-processing steps and require expertise in programming (e.g., with Python3 or Perl4).\nIntroducing square brackets is quite common for storing extra information, including RAxML to store bootstrap value, NHX format for annotation, jplace for edge label, and BEAST for evolutionary estimation, etc. But the positions to place square brackets are not consistent in different software and the contents employ different rules for storing associated data, these properties make it difficult to parse associated data. For most of the software, they will just ignore square brackets and only parse the tree structure if the file is compatible. Some of them contain invalid characters (e.g., curly braces in tree field of jplace format), and even the tree structure can’t be parsed by standard parsers.\nIt is difficult to extract useful phylogeny/taxon-related information from the different analysis outputs produced by various evolutionary inference software, for displaying on the same phylogenetic tree and for further analysis. FigTree supports BEAST output, but not for most of the other software outputs that contain evolutionary inferences or associated data. For those output-rich text files (e.g., r8s, PAML, etc.), the tree structure cannot be parsed by any tree viewing software and users need expertise to manually extract the phylogenetic tree and other useful result data from the output file. However, such manual operation is slow and error-prone.\n\nIt was not easy to retrieve phylogenetic trees with evolutionary data from different analysis outputs of commonly used software in the field. Some of them (e.g., PAML output and jplace file) without software or programming library to support parsing the file, while others (e.g., BEAST and MrBayes output) can be parsed without evolutionary inferences as they are stored in square brackets that will be omitted as a comment by most of the software. Although FigTree support visualizing evolutionary statistics inferred by BEAST and MrBayes, extracting these data for further analysis is not supported. Different software packages implement different algorithms for different analyses (e.g., PAML for dN/dS, HyPhy for ancestral sequences, and BEAST for skyline analysis). Therefore, in encountering the genomic sequence data, there is a desired need to efficiently and flexibly integrate different analysis inference results for comprehensive understanding, comparison, and further analysis. This motivated us to develop the programming library to parse the phylogenetic trees and data from various sources.",
    "crumbs": [
      "(PART\\*) Part I: Tree data input, output, and manipulation"
    ]
  },
  {
    "objectID": "01_treeio_importing_tree.html#getting-tree-data-with-treeio",
    "href": "01_treeio_importing_tree.html#getting-tree-data-with-treeio",
    "title": "(PART*) Part I: Tree data input, output, and manipulation",
    "section": "Getting Tree Data with treeio",
    "text": "Getting Tree Data with treeio\nPhylogenetic trees are commonly used to present evolutionary relationships of species. Information associated with taxon species/strains may be further analyzed in the context of the evolutionary history depicted by the phylogenetic tree. For example, the host information of the influenza virus strains in the tree could be studied to understand the host range of a virus lineage. Moreover, such meta-data (e.g., isolation host, time, location, etc.) directly associated with taxon strains are also often subjected to further evolutionary or comparative phylogenetic models and analyses, to infer their dynamics associated with the evolutionary or transmission processes of the virus. All these meta-data or other phenotypic or experimental data are stored either as the annotation data associated with the nodes or branches and are often produced in inconsistent format by different analysis programs.\nGetting trees into R is still limited. Newick and Nexus can be imported by several packages, including ape, phylobase. NeXML format can be parsed by RNeXML. However, analysis results from widely used software packages in this field are not well supported. SIMMAP output can be parsed by phyext2 and phytools. Although PHYLOCH can import BEAST and MrBayes output, only internal node attributes were parsed and tip attributes were ignored5. Many other software outputs are mainly required programming expertise to import the tree with associated data. Linking external data, including experimental and clinical data, to phylogeny is another obstacle for evolution biologists.\nTo fill the gap that most of the tree formats or software outputs cannot be parsed within the same software/platform, an R package treeio (Wang et al., 2020) was developed for parsing various tree file formats and outputs from common evolutionary analysis software. The treeio package is developed with the R programming language (R Core Team, 2016). Not only the tree structure can be parsed, but also the associated data and evolutionary inferences, including NHX annotation, clock rate inferences (from BEAST or r8s (Sanderson, 2003) programs), synonymous and non-synonymous substitutions (from CODEML), and ancestral sequence construction (from HyPhy, BASEML or CODEML), etc.. Currently, treeio is able to read the following file formats: Newick, Nexus, New Hampshire eXtended format (NHX), jplace and Phylip as well as the data outputs from the following analysis programs: ASTRAL, BEAST, EPA, HyPhy, MEGA, MrBayes, PAML, PHYLDOG, PPLACER, r8s, RAxML and RevBayes, etc. This is made possible with the several parser functions developed in treeio (Table @ref(tab:treeio-function)) (Wang et al., 2020).\n\n\n\nParser functions defined in treeio\n\n\nParser function\nDescription\n\n\n\n\nread.astral\nparsing output of ASTRAL\n\n\nread.beast\nparsing output of BEAST\n\n\nread.codeml\nparsing output of CodeML (rst and mlc files)\n\n\nread.codeml_mlc\nparsing mlc file (output of CodeML)\n\n\nread.fasta\nparsing FASTA format sequence file\n\n\nread.hyphy\nparsing output of HYPHY\n\n\nread.hyphy.seq\nparsing ancestral sequences from HYPHY output\n\n\nread.iqtree\nparsing IQ-Tree Newick string, with the ability to parse SH-aLRT and UFBoot support values\n\n\nread.jplace\nparsing jplace file including the output of EPA and pplacer\n\n\nread.jtree\nparsing [jtree](#write-jtree) format\n\n\nread.mega\nparsing MEGA Nexus output\n\n\nread.mega_tabular\nparsing MEGA tabular output\n\n\nread.mrbayes\nparsing output of MrBayes\n\n\nread.newick\nparsing Newick string, with the ability to parse node label as support values\n\n\nread.nexus\nparsing standard NEXUS file (re-exported from ape)\n\n\nread.nhx\nparsing NHX file including the output of PHYLDOG and RevBayes\n\n\nread.paml_rst\nparsing rst file (output of BaseML or CodeML)\n\n\nread.phylip\nparsing phylip file (phylip alignment + Newick string)\n\n\nread.phylip.seq\nparsing multiple sequence alignment from phylip file\n\n\nread.phylip.tree\nparsing newick string from phylip file\n\n\nread.phyloxml\nparsing phyloXML file\n\n\nread.r8s\nparsing output of r8s\n\n\nread.raxml\nparsing output of RAxML\n\n\nread.tree\nparsing newick string (re-exported from ape)\n\n\n\n\n\nThe treeio package defines base classes and functions for phylogenetic tree input and output. It is an infrastructure that enables evolutionary evidence inferred by commonly used software packages to be used in R. For instance, dN/dS values or ancestral sequences inferred by CODEML (Yang, 2007), clade support values (posterior) inferred by BEAST (Bouckaert et al., 2014) and short read placement by EPA (Berger et al., 2011) and PPLACER (Matsen et al., 2010). These pieces of evolutionary evidence can be further analyzed in R and used to annotate a phylogenetic tree using ggtree (Yu et al., 2017). The growth of analysis tools and models introduces a challenge to integrate different varieties of data and analysis results from different sources for an integral analysis on the same phylogenetic tree background. The treeio package (Wang et al., 2020) provides a merge_tree function to allow combining tree data obtained from different sources. In addition, treeio also enables external data to be linked to a phylogenetic tree structure.\nAfter parsing, storage of the tree structure with associated data is made through an S4 class, treedata, defined in the tidytree package. These parsed data are mapped to the tree branches and nodes inside treedata object, so that they can be efficiently used to visually annotate the tree using ggtree (Yu et al., 2017) and ggtreeExtra (Xu et al., 2021). A programmable platform for phylogenetic data parsing, integration, and annotations as such makes us more easily to identify the evolutionary dynamics and correlation patterns (Figure @ref(fig:treeioDiagram)) (Wang et al., 2020).\n(ref:treeioDiagramscap) Overview of the treeio package and its relations with tidytree and ggtree.\n(ref:treeioDiagramcap) Overview of the treeio package and its relations with tidytree and ggtree. Treeio supports parsing a tree with data from a number of file formats and software outputs. A treedata object stores a phylogenetic tree with node/branch-associated data. Treeio provides several functions to manipulate a tree with data. Users can convert the treedata object into a tidy data frame (each row represents a node in the tree and each column represents a variable) and process the tree with data using the tidy interface implemented in tidytree. The tree can be extracted from the treedata object and exported to a Newick and NEXUS file or can be exported with associated data into a single file (either in the BEAST NEXUS or jtree format). Associated data stored in the treedata object can be used to annotate the tree using ggtree. In addition, ggtree supports a number of tree objects, including phyloseq for microbiome data and obkData for outbreak data. The phylo, multiPhylo (ape package), phylo4, phylo4d (phylobase package), phylog (ade4 package), phyloseq (phyloseq package), and obkData (OutbreakTools package) are tree objects defined by the R community to store tree with or without domain-specific data. All these tree objects as well as hierarchical clustering results (e.g., hclust and dendrogram objects) are supported by ggtree.\n\n\n\n\n\n(ref:treeioDiagramcap)\n\n\n\n\n\nOverview of treeio\nThe treeio package (Wang et al., 2020) defined S4 classes for storing phylogenetic trees with diverse types of associated data or covariates from different sources including analysis outputs from different software packages. It also defined corresponding parser functions for parsing phylogenetic trees with annotation data and stored them as data objects in R for further manipulation or analysis (see Table @ref(tab:treeio-function)). Several accessor functions were defined to facilitate accessing the tree annotation data, including get.fields for obtaining annotation features available in the tree object, get.placements for obtaining the phylogenetic placement results (i.e., the output of PPLACER, EPA, etc.), get.subs for obtaining the genetic substitutions from parent node to child node, and get.tipseq for getting the tip sequences.\nThe S3 class, phylo, which was defined in ape (Paradis et al., 2004) package, is widely used in R community and many packages. As treeio uses S4 class, to enable those available R packages to analyze the tree imported by treeio, treeio provides as.phylo function to convert treeio-generated tree object to phylo object that only contains tree structure without annotation data. In the other way, treeio also provides as.treedata function to convert phylo object with evolutionary analysis result (e.g., bootstrap values calculated by ape or ancestral states inferred by phangorn (Schliep, 2011) etc.) to be stored as a treedata S4 object, making it easy to map the data to the tree structure and to be visualized using ggtree (Yu et al., 2017).\n\nTo allow integration of different kinds of data in a phylogenetic tree, treeio (Wang et al., 2020) provides merge_tree function (details in section 2.2.1) for combining evolutionary statistics/evidence imported from different sources including those common tree files and outputs from analysis programs (Table @ref(tab:treeio-function)). There is other information, such as sampling location, taxonomy information, experimental result, and evolutionary traits, etc. that are stored in separate files with the user-defined format. In treeio, we could read in these data from the users’ files using standard R IO functions, and attach them to the tree object by the full_join methods defined in tidytree and treeio packages (see also the %&lt;+% operator defined in ggtree). After attaching, the data will become the attributes associated with nodes or branches, which can be compared with other data incorporated or can be visually displayed on the tree (Yu et al., 2018).\nTo facilitate storing complex data associated with the phylogenetic tree, treeio implemented write.beast and write.jtree functions to export a treedata object into a single file (see Chapter 3).\n\n\n\nFunction demonstration\n\nParsing BEAST output\n\nfile &lt;- system.file(\"extdata/BEAST\", \"beast_mcc.tree\", package=\"treeio\")\nbeast &lt;- read.beast(file)\nbeast\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/BEAST/beast_mcc.tree'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 14 internal nodes.\n\nTip labels:\n  A_1995, B_1996, C_1995, D_1987, E_1996, F_1997, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'height', 'height_0.95_HPD', 'height_median', 'height_range', 'length',\n'length_0.95_HPD', 'length_median', 'length_range', 'posterior', 'rate',\n'rate_0.95_HPD', 'rate_median', 'rate_range'.\n\n\nSince % is not a valid character in names, all the feature names that contain x% will convert to 0.x. For example, length_95%_HPD will be changed to length_0.95_HPD.\nNot only tree structure but also all the features inferred by BEAST will be stored in the S4 object. These features can be used for tree annotation (Figure @ref(fig:beast)).\n\n\nParsing MEGA output\nMolecular Evolutionary Genetics Analysis (MEGA) software (Kumar et al., 2016) supports exporting trees in three distinct formats: Newick, tabular, and Nexus. The Newick file can be parsed using the read.tree or read.newick functions. MEGA Nexus file is similar to BEAST Nexus and treeio (Wang et al., 2020) provides read.mega function to parse the tree.\n\nfile &lt;- system.file(\"extdata/MEGA7\", \"mtCDNA_timetree.nex\", \n                    package = \"treeio\")\nread.mega(file)\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/MEGA7/mtCDNA_timetree.nex'.\n\n...@ phylo:\n\nPhylogenetic tree with 7 tips and 6 internal nodes.\n\nTip labels:\n  homo_sapiens, chimpanzee, bonobo, gorilla, orangutan, sumatran, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'branch_length', 'data_coverage', 'rate', 'reltime', 'reltime_0.95_CI',\n'reltime_stderr'.\n\n\nThe tabular output contains tree and associated information (divergence time in this example) in a tabular flat text file. The read.mega_tabular function can parse the tree with data simultaneously.\n\nfile &lt;- system.file(\"extdata/MEGA7\", \"mtCDNA_timetree_tabular.txt\", \n                    package = \"treeio\")\nread.mega_tabular(file) \n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/MEGA7/mtCDNA_timetree_tabular.txt'.\n\n...@ phylo:\n\nPhylogenetic tree with 7 tips and 6 internal nodes.\n\nTip labels:\n  chimpanzee, orangutan, bonobo, homo sapiens, gorilla, sumatran, ...\nNode labels:\n  , , , demoLabel2, , \n\nRooted; no branch length.\n\nwith the following features available:\n  'RelTime', 'CI_Lower', 'CI_Upper', 'Rate', 'Data Coverage'.\n\n\n\n\nParsing MrBayes output\nAlthough the Nexus file generated by MrBayes is different from the output of BEAST, they are similar. The treeio package provides the read.mrbayes() which internally calls read.beast() to parse MrBayes outputs.\n\nfile &lt;- system.file(\"extdata/MrBayes\", \"Gq_nxs.tre\", package=\"treeio\")\nread.mrbayes(file)\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/MrBayes/Gq_nxs.tre'.\n\n...@ phylo:\n\nPhylogenetic tree with 12 tips and 10 internal nodes.\n\nTip labels:\n  B_h, B_s, G_d, G_k, G_q, G_s, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  'length_0.95HPD', 'length_mean', 'length_median', 'prob', 'prob_range',\n'prob_stddev', 'prob_percent', 'prob+-sd'.\n\n\n\n\nParsing PAML output\nPhylogenetic Analysis by Maximum Likelihood (PAML) is a package of tools for phylogenetic analyses of DNA and protein sequences using maximum likelihood. Tree search algorithms are implemented in BASEML and CODEML. The read.paml_rst() function provided in treeio can parse rst file from BASEML and CODEML. The only difference is the space in the sequences. For BASEML, every ten bases are separated by one space, while for CODEML, every three bases (triplet) are separated by one space.\n\nbrstfile &lt;- system.file(\"extdata/PAML_Baseml\", \"rst\", package=\"treeio\")\nbrst &lt;- read.paml_rst(brstfile)\nbrst\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/PAML_Baseml/rst'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 13 internal nodes.\n\nTip labels:\n  A, B, C, D, E, F, ...\nNode labels:\n  16, 17, 18, 19, 20, 21, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  'subs', 'AA_subs'.\n\n\nSimilarly, we can parse the rst file from CODEML.\n\ncrstfile &lt;- system.file(\"extdata/PAML_Codeml\", \"rst\", package=\"treeio\")\n## type can be one of \"Marginal\" or \"Joint\"\ncrst &lt;- read.paml_rst(crstfile, type = \"Joint\")\ncrst\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/PAML_Codeml/rst'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 13 internal nodes.\n\nTip labels:\n  A, B, C, D, E, F, ...\nNode labels:\n  16, 17, 18, 19, 20, 21, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  'subs', 'AA_subs'.\n\n\nAncestral sequences inferred by BASEML or CODEML via marginal or joint ML reconstruction methods will be stored in the S4 object and mapped to tree nodes. treeio (Wang et al., 2020) will automatically determine the substitutions between the sequences at both ends of each branch. The amino acid substitution will also be determined by translating nucleotide sequences to amino acid sequences. These computed substitutions will also be stored in the S4 object for efficient tree annotation later (Figure @ref(fig:codeml)).\nCODEML infers selection pressure and estimated dN/dS, dN and dS. These pieces of information are stored in output file mlc, which can be parsed by the read.codeml_mlc() function.\n\nmlcfile &lt;- system.file(\"extdata/PAML_Codeml\", \"mlc\", package=\"treeio\")\nmlc &lt;- read.codeml_mlc(mlcfile)\nmlc\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/PAML_Codeml/mlc'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 13 internal nodes.\n\nTip labels:\n  A, B, C, D, E, F, ...\nNode labels:\n  16, 17, 18, 19, 20, 21, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  't', 'N', 'S', 'dN_vs_dS', 'dN', 'dS', 'N_x_dN', 'S_x_dS'.\n\n\nThe rst and mlc files can be parsed separately as demonstrated previously, they can also be parsed together using the read.codeml() function.\n\n## tree can be one of \"rst\" or \"mlc\" to specify\n## using tree from which file as base tree in the object\nml &lt;- read.codeml(crstfile, mlcfile, tree = \"mlc\")\nml\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/PAML_Codeml/rst',\n    '/home/runner/work/_temp/Library/treeio/extdata/PAML_Codeml/mlc'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 13 internal nodes.\n\nTip labels:\n  A, B, C, D, E, F, ...\nNode labels:\n  16, 17, 18, 19, 20, 21, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  'subs', 'AA_subs', 't', 'N', 'S', 'dN_vs_dS', 'dN', 'dS', 'N_x_dN', 'S_x_dS'.\n\n\nAll the features in both rst and mlc files are imported into a single S4 object and hence are available for further annotation and visualization. For example, we can annotate and display both dN/dS (from mlc file) and amino acid substitutions (derived from rst file) on the same phylogenetic tree (Yu et al., 2017).\n\n\nParsing HyPhy output\nHypothesis testing using Phylogenies (HyPhy) is a software package for analyzing genetic sequences. Ancestral sequences inferred by HyPhy are stored in the Nexus output file, which contains the tree topology and ancestral sequences. To parse this data file, users can use the read.hyphy.seq() function.\n\nancseq &lt;- system.file(\"extdata/HYPHY\", \"ancseq.nex\", package=\"treeio\")\nread.hyphy.seq(ancseq)\n\n13 DNA sequences in binary format stored in a list.\n\nAll sequences of same length: 2148 \n\nLabels:\nNode1\nNode2\nNode3\nNode4\nNode5\nNode12\n...\n\nBase composition:\n    a     c     g     t \n0.335 0.208 0.237 0.220 \n(Total: 27.92 kb)\n\n\nTo map the sequences on the tree, users should also provide an internal-node-labeled tree. If users want to determine substitution, they need to also provide tip sequences. In this case, substitutions will be determined automatically, just as we parse the output of CODEML.\n\nnwk &lt;- system.file(\"extdata/HYPHY\", \"labelledtree.tree\", package=\"treeio\")\ntipfas &lt;- system.file(\"extdata\", \"pa.fas\", package=\"treeio\")\nhy &lt;- read.hyphy(nwk, ancseq, tipfas)\nhy\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/HYPHY/labelledtree.tree'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 13 internal nodes.\n\nTip labels:\n  K, N, D, L, J, G, ...\nNode labels:\n  Node1, Node2, Node3, Node4, Node5, Node12, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  'subs', 'AA_subs'.\n\n\n\n\nParsing r8s output\nThe r8s package uses parametric, semi-parametric, and non-parametric methods to relax the molecular clock to allow better estimations of divergence times and evolution rates (Sanderson, 2003). It outputs three trees in a log file, namely, TREE, RATO, and PHYLO for time tree, rate tree, and absolute substitution tree, respectively.\nThe time tree is scaled by divergence time, the rate tree is scaled by substitution rate and the absolute substitution tree is scaled by the absolute number of substitutions. After parsing the file, all these three trees are stored in a multiPhylo object (Figure @ref(fig:multiPhylo)).\n\nr8s &lt;- read.r8s(system.file(\"extdata/r8s\", \"H3_r8s_output.log\", package=\"treeio\"))\nr8s\n\n3 phylogenetic trees\n\n\n\n\nParsing output of RAxML bootstrap analysis\nRAxML bootstrapping analysis outputs a Newick tree text that is not standard, as it stores bootstrap values inside square brackets after branch lengths. This file usually cannot be parsed by a traditional Newick parser, such as ape::read.tree(). The function read.raxml() can read such files and store the bootstrap as an additional feature, which can be used to display on the tree or used to color tree branches, etc.\n\nraxml_file &lt;- system.file(\"extdata/RAxML\", \n                          \"RAxML_bipartitionsBranchLabels.H3\", \n                          package=\"treeio\")\nraxml &lt;- read.raxml(raxml_file)\nraxml\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/RAxML/RAxML_bipartitionsBranchLabels.H3'.\n\n...@ phylo:\n\nPhylogenetic tree with 64 tips and 62 internal nodes.\n\nTip labels:\n  A_Hokkaido_M1_2014_H3N2_2014, A_Czech_Republic_1_2014_H3N2_2014,\nFJ532080_A_California_09_2008_H3N2_2008,\nEU199359_A_Pennsylvania_05_2007_H3N2_2007,\nEU857080_A_Hong_Kong_CUHK69904_2006_H3N2_2006,\nEU857082_A_Hong_Kong_CUHK7047_2005_H3N2_2005, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  'bootstrap'.\n\n\n\n\nParsing NHX tree\nNHX (New Hampshire eXtended) format is an extension of Newick by introducing NHX tags. NHX is commonly used in phylogenetics software, including PHYLDOG (Boussau et al., 2013), RevBayes (Höhna et al., 2014), for storing statistical inferences. The following codes imported an NHX tree with associated data inferred by PHYLDOG (Figure @ref(fig:beastFigtree)A).\n\nnhxfile &lt;- system.file(\"extdata/NHX\", \"phyldog.nhx\", package=\"treeio\")\nnhx &lt;- read.nhx(nhxfile)\nnhx\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/NHX/phyldog.nhx'.\n\n...@ phylo:\n\nPhylogenetic tree with 16 tips and 15 internal nodes.\n\nTip labels:\n  Prayidae_D27SS7@2825365, Kephyes_ovata@2606431,\nChuniphyes_multidentata@1277217, Apolemia_sp_@1353964,\nBargmannia_amoena@263997, Bargmannia_elongata@946788, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'V1', 'Ev', 'ND', 'S'.\n\n\n\n\nParsing Phylip tree\nPhylip format contains multiple sequence alignment of taxa in Phylip sequence format with corresponding Newick tree text that was built from taxon sequences. Multiple sequence alignment can be sorted based on the tree structure and displayed at the right-hand side of the tree using ggtree through the msaplot() function or in combining with the ggmsa package (see also Basic Protocol 5 of (Yu, 2020)).\n\nphyfile &lt;- system.file(\"extdata\", \"sample.phy\", package=\"treeio\")\nphylip &lt;- read.phylip(phyfile)\nphylip\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/sample.phy'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 13 internal nodes.\n\nTip labels:\n  K, N, D, L, J, G, ...\n\nUnrooted; no branch length.\n\n\n\n\nParsing EPA and pplacer output\nEPA (Berger et al., 2011) and PPLACER (Matsen et al., 2010) have a common output file format, jplace, which can be parsed by the read.jplace() function.\n\njpf &lt;- system.file(\"extdata/EPA.jplace\",  package=\"treeio\")\njp &lt;- read.jplace(jpf)\nprint(jp)\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/EPA.jplace'.\n\n...@ phylo:\n\nPhylogenetic tree with 493 tips and 492 internal nodes.\n\nTip labels:\n  CIR000447A, CIR000479, CIR000078, CIR000083, CIR000070, CIR000060, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'nplace'.\n\n\nThe number of evolutionary placement on each branch will be calculated and stored as the nplace feature, which can be mapped to line size and/or color using ggtree (Yu et al., 2017).\n\n\nParsing jtree format\nThe jtree is a JSON-based format that was defined in this treeio package (Wang et al., 2020) to support tree data interchange (see session 3.3). Phylogenetic tree with associated data can be exported to a single jtree file using the write.jtree() function. The jtree can be easily parsed using any JSON parser. The jtree format contains three keys: tree, data, and meta-data. The tree value contains tree text extended from Newick tree format by putting the edge number in curly braces after branch length. The data value contains node/branch-specific data, while the meta-data value contains additional meta information.\n\njtree_file &lt;- tempfile(fileext = '.jtree')\nwrite.jtree(beast, file = jtree_file)\nread.jtree(file = jtree_file)\n\n'treedata' S4 object that stored information\nof\n    '/tmp/RtmpuSqDt4/file1178f475ffc38.jtree'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 14 internal nodes.\n\nTip labels:\n  K_2013, N_2010, D_1987, L_1980, J_1983, G_1992, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'height', 'height_0.95_HPD', 'height_range', 'length', 'length_0.95_HPD',\n'length_median', 'length_range', 'rate', 'rate_0.95_HPD', 'rate_median',\n'rate_range', 'height_median', 'posterior'.\n\n\n\n\n\nConverting other tree-like objects to phylo or treedata objects\nTo extend the application scopes of treeio, tidytree and ggtree, treeio (Wang et al., 2020) provides several as.phylo and as.treedata methods to convert other tree-like objects, such as phylo4d and pml, to phylo or treedata object. So that users can easily map associated data to the tree structure, export a tree with/without data to a single file, manipulate and visualize a tree with/without data. These convert functions (Table @ref(tab:treeio-treedata-object)) create the possibility of using tidytree to process tree using tidy interface and ggtree to visualize tree using the grammar of graphic syntax.\n\n\n\nConversion of tree-like object to phylo or treedata object\n\n\nConvert function\nSupported object\nDescription\n\n\n\n\nas.phylo\nggtree\nconvert ggtree object to phylo object\n\n\nigraph\nconvert igraph object (only tree graph supported) to phylo object\n\n\nphylo4\nconvert phylo4 object to phylo object\n\n\npvclust\nconvert pvclust object to phylo object\n\n\ntreedata\nconvert treedata object to phylo object\n\n\nas.treedata\nggtree\nconvert ggtree object to treedata object\n\n\nphylo4\nconvert phylo4 object to treedata object\n\n\nphylo4d\nconvert phylo4d object to treedata object\n\n\npml\nconvert pml object to treedata object\n\n\npvclust\nconvert pvclust object to treedata object\n\n\n\n\n\nHere, we used pml object which was defined in the phangorn package, as an example. The pml() function computes the likelihood of a phylogenetic tree given a sequence alignment and a model and the optim.pml() function optimizes different model parameters. The output is a pml object, and it can be converted to a treedata object using as.treedata provided by treeio (Wang et al., 2020). The amino acid substitution (ancestral sequence estimated by pml) that stored in the treedata object can be visualized using ggtree as demonstrated in Figure @ref(fig:pmlTree).\n(ref:pmlTreescap) Converting pml object to treedata object.\n(ref:pmlTreecap) Converting pml object to treedata object. This allows using tidytree to process the tree data as well as using ggtree and ggtreeExtra to visualize the tree with associated data.\n\nlibrary(phangorn)\ntreefile &lt;- system.file(\"extdata\", \"pa.nwk\", package=\"treeio\")\ntre &lt;- read.tree(treefile)\ntipseqfile &lt;- system.file(\"extdata\", \"pa.fas\", package=\"treeio\")\ntipseq &lt;- read.phyDat(tipseqfile,format=\"fasta\")\nfit &lt;- pml(tre, tipseq, k=4)\nfit &lt;- optim.pml(fit, optNni=FALSE, optBf=T, optQ=T,\n                 optInv=T, optGamma=T, optEdge=TRUE,\n                 optRooted=FALSE, model = \"GTR\",\n                 control = pml.control(trace =0))\n\npmltree &lt;- as.treedata(fit)\nggtree(pmltree) + geom_text(aes(x=branch, label=AA_subs, vjust=-.5))\n\nWarning: Removed 1 row containing missing values or values outside the scale range\n(`geom_text()`).\n\n\n\n\n\n(ref:pmlTreecap)\n\n\n\n\n\n\nGetting information from treedata object\nAfter the tree was imported, users may want to extract information stored in the treedata object. treeio provides several accessor methods to extract tree structure, features/attributes that stored in the object, and their corresponding values.\nThe get.tree() or as.phylo() methods can convert the treedata object to a phylo object which is the fundamental tree object in the R community and many packages work with phylo object.\n\nbeast_file &lt;- system.file(\"examples/MCC_FluA_H3.tree\", package=\"ggtree\")\nbeast_tree &lt;- read.beast(beast_file)\n# or get.tree\nas.phylo(beast_tree)\n\n\nbeast_file &lt;- system.file(\"examples/MCC_FluA_H3.tree\", package=\"ggtree\")\nbeast_tree &lt;- read.beast(beast_file)\n# or get.tree\nprint(as.phylo(beast_tree), printlen=3)\n\n\nPhylogenetic tree with 76 tips and 75 internal nodes.\n\nTip labels:\n  A/Hokkaido/30-1-a/2013, A/New_York/334/2004, A/New_York/463/2005, ...\n\nRooted; includes branch length(s).\n\n\nThe get.fields method returns a vector of features/attributes stored in the object and associated with the phylogeny.\n\nget.fields(beast_tree)\n\n [1] \"height\"          \"height_0.95_HPD\" \"height_median\"   \"height_range\"   \n [5] \"length\"          \"length_0.95_HPD\" \"length_median\"   \"length_range\"   \n [9] \"posterior\"       \"rate\"            \"rate_0.95_HPD\"   \"rate_median\"    \n[13] \"rate_range\"     \n\n\nThe get.data method returns a tibble of all the associated data.\n\nget.data(beast_tree)\n\n# A tibble: 151 × 14\n   height height_0.95_HPD height_median height_range length length_0.95_HPD\n    &lt;dbl&gt; &lt;list&gt;                  &lt;dbl&gt; &lt;list&gt;        &lt;dbl&gt; &lt;list&gt;         \n 1   19   &lt;dbl [2]&gt;                19   &lt;dbl [2]&gt;     2.34  &lt;dbl [2]&gt;      \n 2   17   &lt;dbl [2]&gt;                17   &lt;dbl [2]&gt;     1.18  &lt;dbl [2]&gt;      \n 3   14   &lt;dbl [2]&gt;                14   &lt;dbl [2]&gt;     0.966 &lt;dbl [2]&gt;      \n 4   12   &lt;dbl [2]&gt;                12   &lt;dbl [2]&gt;     1.87  &lt;dbl [2]&gt;      \n 5    9   &lt;dbl [2]&gt;                 9   &lt;dbl [2]&gt;     2.93  &lt;dbl [2]&gt;      \n 6   10   &lt;dbl [2]&gt;                10   &lt;dbl [2]&gt;     0.827 &lt;dbl [2]&gt;      \n 7   10   &lt;dbl [2]&gt;                10   &lt;dbl [2]&gt;     0.834 &lt;dbl [2]&gt;      \n 8   10.8 &lt;dbl [2]&gt;                10.8 &lt;dbl [2]&gt;     0.233 &lt;dbl [2]&gt;      \n 9    9   &lt;dbl [2]&gt;                 9   &lt;dbl [2]&gt;     1.28  &lt;dbl [2]&gt;      \n10    9   &lt;dbl [2]&gt;                 9   &lt;dbl [2]&gt;     0.414 &lt;dbl [2]&gt;      \n# ℹ 141 more rows\n# ℹ 8 more variables: length_median &lt;dbl&gt;, length_range &lt;list&gt;,\n#   posterior &lt;dbl&gt;, rate &lt;dbl&gt;, rate_0.95_HPD &lt;list&gt;, rate_median &lt;dbl&gt;,\n#   rate_range &lt;list&gt;, node &lt;int&gt;\n\n\nIf users are only interested in a subset of the features/attributes returned by get.fields, they can extract the information from the output of get.data or directly subset the data by [ or [[.\n\nbeast_tree[, c(\"node\", \"height\")]\n\n# A tibble: 151 × 2\n    node height\n   &lt;int&gt;  &lt;dbl&gt;\n 1    10   19  \n 2     9   17  \n 3    36   14  \n 4    31   12  \n 5    29    9  \n 6    28   10  \n 7    39   10  \n 8    90   10.8\n 9    16    9  \n10     2    9  \n# ℹ 141 more rows\n\nhead(beast_tree[[\"height_median\"]])\n\nheight_median1 height_median2 height_median3 height_median4 height_median5 \n            19             17             14             12              9 \nheight_median6 \n            10",
    "crumbs": [
      "(PART\\*) Part I: Tree data input, output, and manipulation"
    ]
  },
  {
    "objectID": "01_treeio_importing_tree.html#summary1",
    "href": "01_treeio_importing_tree.html#summary1",
    "title": "(PART*) Part I: Tree data input, output, and manipulation",
    "section": "Summary",
    "text": "Summary\nSoftware tools for inferring molecular evolution (e.g., ancestral states, molecular dating and selection pressure, etc.) are proliferating, but there is no single data format that is used by all different programs and capable to store different types of phylogenetic data. Most of the software packages have their unique output formats and these formats are not compatible with each other. Parsing software outputs is challenging, which restricts the joint analysis using different tools. The treeio package (Wang et al., 2020) provides a set of functions (Table @ref(tab:treeio-function)) for parsing various types of phylogenetic data files and a set of converters (Table @ref(tab:treeio-treedata-object)) to convert tree-like objects to phylo or treedata objects. These phylogenetic data can be integrated that allow further exploration and comparison. To date, most software tools in the field of molecular evolution are isolated and often not fully compatible with each other’s input and output files. These software tools are designed to do their analysis and the outputs are often not readable in other software. No tools have been designed to unify the inference data from different analysis programs. Efficient incorporation of data from different inference methods can enhance the comparison and understanding of the study target, which may help discover new systematic patterns and generate new hypotheses.\nAs phylogenetic trees are growing in their application to identify patterns in an evolutionary context, more different disciplines are employing phylogenetic trees in their research. For example, spatial ecologists may map the geographical positions of the organisms to their phylogenetic trees to understand the biogeography of the species (Schön et al., 2015); disease epidemiologists may incorporate the pathogen sampling time and locations into the phylogenetic analysis to infer the disease transmission dynamics in spatiotemporal space (He et al., 2013); microbiologists may determine the pathogenicity of different pathogen strains and map them into their phylogenetic trees to identify the genetic determinants of the pathogenicity (Bosi et al., 2016); genomic scientists may use the phylogenetic trees to help taxonomically classify their metagenomic sequence data (Gupta & Sharma, 2015). A robust tool such as treeio to import and map different types of data into the phylogenetic tree is important to facilitate these phylogenetics-related research, or ‘phylodynamics’. Such tools could also help integrate different meta-data (time, geography, genotype, epidemiological information) and analysis results (selective pressure, evolutionary rates) at the highest level and provide a comprehensive understanding of the study organisms. In the field of influenza research, there have been such attempts of studying the phylodynamics of the influenza virus by mapping different meta-data and analysis results on the same phylogenetic tree and evolutionary timescale (Lam et al., 2015).\n\n\n\n\nArenas, M. (2015). Trends in substitution models of molecular evolution. Frontiers in Genetics, 6. https://doi.org/10.3389/fgene.2015.00319\n\n\nBerger, S. A., Krompass, D., & Stamatakis, A. (2011). Performance, Accuracy, and Web Server for Evolutionary Placement of Short Sequence Reads under Maximum Likelihood. Systematic Biology, 291–302. https://doi.org/10.1093/sysbio/syr010\n\n\nBosi, E., Monk, J. M., Aziz, R. K., Fondi, M., Nizet, V., & Palsson, B. Ø. (2016). Comparative genome-scale modelling of Staphylococcus aureus strains identifies strain-specific metabolic capabilities linked to pathogenicity. Proceedings of the National Academy of Sciences of the United States of America, 113(26), E3801–E3809. https://doi.org/10.1073/pnas.1523199113\n\n\nBouckaert, R., Heled, J., Kühnert, D., Vaughan, T., Wu, C.-H., Xie, D., Suchard, M. A., Rambaut, A., & Drummond, A. J. (2014). BEAST 2: A Software Platform for Bayesian Evolutionary Analysis. PLoS Comput Biol, 10(4), e1003537. https://doi.org/10.1371/journal.pcbi.1003537\n\n\nBoussau, B., Szöllősi, G. J., Duret, L., Gouy, M., Tannier, E., & Daubin, V. (2013). Genome-scale coestimation of species and gene trees. Genome Research, 23(2), 323–330. https://doi.org/10.1101/gr.141978.112\n\n\nFelsenstein, J. (1978). Cases in which Parsimony or Compatibility Methods will be Positively Misleading. Systematic Biology, 27(4), 401–410. https://doi.org/10.1093/sysbio/27.4.401\n\n\nFelsenstein, J. (1981). Evolutionary trees from DNA sequences: A maximum likelihood approach. Journal of Molecular Evolution, 17(6), 368–376.\n\n\nFelsenstein, J. (1989). PHYLIP - Phylogeny Inference Package (Version 3.2). Cladistics, 5, 164–166.\n\n\nFitch, W. M. (1971). Toward Defining the Course of Evolution: Minimum Change for a Specific Tree Topology. Systematic Zoology, 20(4), 406–416. https://doi.org/10.2307/2412116\n\n\nGoldman, N., & Yang, Z. (1994). A codon-based model of nucleotide substitution for protein-coding DNA sequences. Molecular Biology and Evolution, 11(5), 725–736.\n\n\nGupta, A., & Sharma, V. K. (2015). Using the taxon-specific genes for the taxonomic classification of bacterial genomes. BMC Genomics, 16(1). https://doi.org/10.1186/s12864-015-1542-0\n\n\nHe, Y.-Q., Chen, L., Xu, W.-B., Yang, H., Wang, H.-Z., Zong, W.-P., Xian, H.-X., Chen, H.-L., Yao, X.-J., Hu, Z.-L., Luo, M., Zhang, H.-L., Ma, H.-W., Cheng, J.-Q., Feng, Q.-J., & Zhao, D.-J. (2013). Emergence, Circulation, and Spatiotemporal Phylogenetic Analysis of Coxsackievirus A6- and Coxsackievirus A10-Associated Hand, Foot, and Mouth Disease Infections from 2008 to 2012 in Shenzhen, China. Journal of Clinical Microbiology, 51(11), 3560–3566. https://doi.org/10.1128/JCM.01231-13\n\n\nHöhna, S., Heath, T. A., Boussau, B., Landis, M. J., Ronquist, F., & Huelsenbeck, J. P. (2014). Probabilistic graphical model representation in phylogenetics. Systematic Biology, 63(5), 753–771. https://doi.org/10.1093/sysbio/syu039\n\n\nHöhna, S., Landis, M. J., Heath, T. A., Boussau, B., Lartillot, N., Moore, B. R., Huelsenbeck, J. P., & Ronquist, F. (2016). RevBayes: Bayesian Phylogenetic Inference Using Graphical Models and an Interactive Model-Specification Language. Systematic Biology, 65(4), 726–736. https://doi.org/10.1093/sysbio/syw021\n\n\nHuelsenbeck, J. P., & Ronquist, F. (2001). MRBAYES: Bayesian inference of phylogenetic trees. Bioinformatics (Oxford, England), 17(8), 754–755.\n\n\nKumar, S., Stecher, G., & Tamura, K. (2016). MEGA7: Molecular evolutionary genetics analysis version 7.0 for bigger datasets. Molecular Biology and Evolution, 33(7), 1870–1874. https://doi.org/10.1093/molbev/msw054\n\n\nLam, T. T.-Y., Zhou, B., Wang, J., Chai, Y., Shen, Y., Chen, X., Ma, C., Hong, W., Chen, Y., Zhang, Y., Duan, L., Chen, P., Jiang, J., Zhang, Y., Li, L., Poon, L. L. M., Webby, R. J., Smith, D. K., Leung, G. M., … Zhu, H. (2015). Dissemination, divergence and establishment of H7N9 influenza viruses in China. Nature, 522(7554), 102–105. https://doi.org/10.1038/nature14348\n\n\nLemmon, A. R., & Moriarty, E. C. (2004). The importance of proper model assumption in bayesian phylogenetics. Systematic Biology, 53(2), 265–277. https://doi.org/10.1080/10635150490423520\n\n\nMaddison, D. R., Swofford, D. L., Maddison, W. P., & Cannatella, D. (1997). Nexus: An Extensible File Format for Systematic Information. Systematic Biology, 46(4), 590–621. https://doi.org/10.1093/sysbio/46.4.590\n\n\nMatsen, F. A., Hoffman, N. G., Gallagher, A., & Stamatakis, A. (2012). A Format for Phylogenetic Placements. PLOS ONE, 7(2), e31009. https://doi.org/10.1371/journal.pone.0031009\n\n\nMatsen, F. A., Kodner, R. B., & Armbrust, E. V. (2010). Pplacer: Linear time maximum-likelihood and bayesian phylogenetic placement of sequences onto a fixed reference tree. BMC Bioinformatics, 11(1), 538. https://doi.org/10.1186/1471-2105-11-538\n\n\nParadis, E., Claude, J., & Strimmer, K. (2004). APE: Analyses of Phylogenetics and Evolution in R language. Bioinformatics, 20(2), 289–290. https://doi.org/10.1093/bioinformatics/btg412\n\n\nPond, S. L. K., Frost, S. D. W., & Muse, S. V. (2005). HyPhy: Hypothesis testing using phylogenies. Bioinformatics (Oxford, England), 21(5), 676–679. https://doi.org/10.1093/bioinformatics/bti079\n\n\nR Core Team. (2016). R: A language and environment for statistical computing. R Foundation for Statistical Computing. https://www.R-project.org/\n\n\nRannala, B., & Yang, Z. (1996). Probability distribution of molecular evolutionary trees: A new method of phylogenetic inference. Journal of Molecular Evolution, 43(3), 304–311.\n\n\nRetief, J. D. (2000). Phylogenetic analysis using PHYLIP. Methods in Molecular Biology (Clifton, N.J.), 132, 243–258.\n\n\nSanderson, M. J. (2003). r8s: Inferring absolute rates of molecular evolution and divergence times in the absence of a molecular clock. Bioinformatics, 19(2), 301–302. https://doi.org/10.1093/bioinformatics/19.2.301\n\n\nSchliep, K. P. (2011). Phangorn: Phylogenetic analysis in R. Bioinformatics, 27(4), 592–593. https://doi.org/10.1093/bioinformatics/btq706\n\n\nSchmidt, H. A., Strimmer, K., Vingron, M., & Haeseler, A. von. (2002). TREE-PUZZLE: Maximum likelihood phylogenetic analysis using quartets and parallel computing. Bioinformatics (Oxford, England), 18(3), 502–504.\n\n\nSchön, I., Shearn, R., Martens, K., Koenders, A., & Halse, S. (2015). Age and origin of Australian Bennelongia (Crustacea, Ostracoda). Hydrobiologia, 750(1), 125–146. https://doi.org/10.1007/s10750-014-2159-z\n\n\nShoemaker, J. S., & Fitch, W. M. (1989). Evidence from nuclear sequences that invariable sites should be considered when sequence divergence is calculated. Molecular Biology and Evolution, 6(3), 270–289.\n\n\nStamatakis, A. (2014). RAxML version 8: A tool for phylogenetic analysis and post-analysis of large phylogenies. Bioinformatics, 30(9), 1312–1313. https://doi.org/10.1093/bioinformatics/btu033\n\n\nWang, L.-G., Lam, T. T.-Y., Xu, S., Dai, Z., Zhou, L., Feng, T., Guo, P., Dunn, C. W., Jones, B. R., Bradley, T., Zhu, H., Guan, Y., Jiang, Y., & Yu, G. (2020). Treeio: An r package for phylogenetic tree input and output with richly annotated and associated data. Molecular Biology and Evolution, 37(2), 599–603. https://doi.org/10.1093/molbev/msz240\n\n\nWilgenbusch, J. C., & Swofford, D. (2003). Inferring evolutionary trees with PAUP*. Current Protocols in Bioinformatics, Chapter 6, Unit 6.4. https://doi.org/10.1002/0471250953.bi0604s00\n\n\nXu, S., Dai, Z., Guo, P., Fu, X., Liu, S., Zhou, L., Tang, W., Feng, T., Chen, M., Zhan, L., Wu, T., Hu, E., Jiang, Y., Bo, X., & Yu, G. (2021). ggtreeExtra: Compact Visualization of Richly Annotated Phylogenetic Data. Molecular Biology and Evolution, 38(9), 4039–4042. https://doi.org/10.1093/molbev/msab166\n\n\nYang, Z. (1994). Maximum likelihood phylogenetic estimation from DNA sequences with variable rates over sites: Approximate methods. Journal of Molecular Evolution, 39(3), 306–314.\n\n\nYang, Z. (2007). PAML 4: Phylogenetic Analysis by Maximum Likelihood. Molecular Biology and Evolution, 24(8), 1586–1591. https://doi.org/10.1093/molbev/msm088\n\n\nYu, G. (2020). Using ggtree to visualize data on tree-like structures. Current Protocols in Bioinformatics, 69(1), e96. https://doi.org/10.1002/cpbi.96\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628\n\n\nZmasek, C. M., & Eddy, S. R. (2001). ATV: Display and manipulation of annotated phylogenetic trees. Bioinformatics, 17(4), 383–384. https://doi.org/10.1093/bioinformatics/17.4.383",
    "crumbs": [
      "(PART\\*) Part I: Tree data input, output, and manipulation"
    ]
  },
  {
    "objectID": "01_treeio_importing_tree.html#footnotes",
    "href": "01_treeio_importing_tree.html#footnotes",
    "title": "(PART*) Part I: Tree data input, output, and manipulation",
    "section": "",
    "text": "http://evolution.genetics.washington.edu/phylip/newick_doc.html↩︎\nhttp://www.genetics.wustl.edu/eddy/forester/NHX.html↩︎\nhttp://biopython.org/wiki/PAML↩︎\nhttp://bioperl.org/howtos/PAML_HOWTO.html↩︎\nhttps://github.com/ropensci/software-review/issues/179#issuecomment-369164110↩︎",
    "crumbs": [
      "(PART\\*) Part I: Tree data input, output, and manipulation"
    ]
  },
  {
    "objectID": "02_tidytree.html",
    "href": "02_tidytree.html",
    "title": "2  Manipulating Tree with Data",
    "section": "",
    "text": "2.1 Manipulating Tree Data Using Tidy Interface\nAll the tree data parsed/merged by treeio (Wang et al., 2020) can be converted to a tidy data frame using the tidytree package. The tidytree package provides tidy interfaces to manipulate trees with associated data. For instance, external data can be linked to phylogeny or evolutionary data obtained from different sources can be merged using tidyverse verbs. After the tree data was processed, it can be converted back to a treedata object and exported to a single tree file, further analyzed in R or visualized using ggtree (Yu et al., 2017) and ggtreeExtra (Xu et al., 2021).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#sec-tidytree",
    "href": "02_tidytree.html#sec-tidytree",
    "title": "2  Manipulating Tree with Data",
    "section": "",
    "text": "2.1.1 The phylo object\nThe phylo class defined in the ape package (Paradis et al., 2004) is fundamental for phylogenetic analysis in R. Most of the R packages in this field rely extensively on the phylo object. The tidytree package provides as_tibble method to convert the phylo object to a tidy data frame, a tbl_tree object.\n\nlibrary(ape)\nset.seed(2017)\ntree &lt;- rtree(4)\ntree\n\n\nPhylogenetic tree with 4 tips and 3 internal nodes.\n\nTip labels:\n  t4, t1, t3, t2\n\nRooted; includes branch length(s).\n\nx &lt;- as_tibble(tree)\nx\n\n# A tbl_tree abstraction: 7 × 4\n# which can be converted to treedata or phylo \n# via as.treedata or as.phylo\n  parent  node branch.length label\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;\n1      5     1       0.435   t4   \n2      7     2       0.674   t1   \n3      7     3       0.00202 t3   \n4      6     4       0.0251  t2   \n5      5     5      NA       &lt;NA&gt; \n6      5     6       0.472   &lt;NA&gt; \n7      6     7       0.274   &lt;NA&gt; \n\n\nThe tbl_tree object can be converted back to a phylo object using the as.phylo() method.\n\nas.phylo(x)\n\n\nPhylogenetic tree with 4 tips and 3 internal nodes.\n\nTip labels:\n  t4, t1, t3, t2\n\nRooted; includes branch length(s).\n\n\nUsing tbl_tree object makes tree and data manipulation more effective and easier (see also the example in FAQ). For example, we can link evolutionary trait to phylogeny using the dplyr verbs full_join():\n\nd &lt;- tibble(label = paste0('t', 1:4),\n            trait = rnorm(4))\n\ny &lt;- full_join(x, d, by = 'label')\ny\n\n# A tbl_tree abstraction: 7 × 5\n# which can be converted to treedata or phylo \n# via as.treedata or as.phylo\n  parent  node branch.length label  trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;\n1      5     1       0.435   t4     0.943\n2      7     2       0.674   t1    -0.171\n3      7     3       0.00202 t3     0.570\n4      6     4       0.0251  t2    -0.283\n5      5     5      NA       &lt;NA&gt;  NA    \n6      5     6       0.472   &lt;NA&gt;  NA    \n7      6     7       0.274   &lt;NA&gt;  NA    \n\n\n\n\n2.1.2 The treedata object\nThe tidytree package defines treedata class to store a phylogenetic tree with associated data. After mapping external data to the tree structure, the tbl_tree object can be converted to a treedata object.\n\nas.treedata(y)\n\n'treedata' S4 object'.\n\n...@ phylo:\n\nPhylogenetic tree with 4 tips and 3 internal nodes.\n\nTip labels:\n  t4, t1, t3, t2\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'trait'.\n\n\nThe treedata class is used in the treeio package (Wang et al., 2020) to store evolutionary evidence inferred by commonly used software (BEAST, EPA, HyPhy, MrBayes, PAML, PHYLDOG, PPLACER, r8s, RAxML, and RevBayes, etc.) (see details in Chapter 1).\nThe tidytree package also provides the as_tibble() method to convert a treedata object to a tidy data frame. The phylogenetic tree structure and the evolutionary inferences were stored in the tbl_tree object, making it consistent and easier for manipulating evolutionary statistics inferred by different software as well as linking external data to the same tree structure.\n\ny %&gt;% as.treedata %&gt;% as_tibble\n\n# A tbl_tree abstraction: 7 × 5\n# which can be converted to treedata or phylo \n# via as.treedata or as.phylo\n  parent  node branch.length label  trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;\n1      5     1       0.435   t4     0.943\n2      7     2       0.674   t1    -0.171\n3      7     3       0.00202 t3     0.570\n4      6     4       0.0251  t2    -0.283\n5      5     5      NA       &lt;NA&gt;  NA    \n6      5     6       0.472   &lt;NA&gt;  NA    \n7      6     7       0.274   &lt;NA&gt;  NA    \n\n\n\n\n2.1.3 Access related nodes\nThe dplyr verbs can be applied to tbl_tree directly to manipulate tree data. In addition, tidytree provides several verbs to filter related nodes, including child(), parent(), offspring(), ancestor(), sibling() and MRCA().\nThese verbs accept a tbl_tree object and a selected node which can be node number or label.\n\nchild(y, 5)\n\n# A tibble: 2 × 5\n  parent  node branch.length label  trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;\n1      5     1         0.435 t4     0.943\n2      5     6         0.472 &lt;NA&gt;  NA    \n\nparent(y, 2)\n\n# A tibble: 1 × 5\n  parent  node branch.length label trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;\n1      6     7         0.274 &lt;NA&gt;     NA\n\noffspring(y, 5)\n\n# A tibble: 6 × 5\n  parent  node branch.length label  trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;\n1      5     1       0.435   t4     0.943\n2      7     2       0.674   t1    -0.171\n3      7     3       0.00202 t3     0.570\n4      6     4       0.0251  t2    -0.283\n5      5     6       0.472   &lt;NA&gt;  NA    \n6      6     7       0.274   &lt;NA&gt;  NA    \n\nancestor(y, 2)\n\n# A tibble: 3 × 5\n  parent  node branch.length label trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;\n1      5     5        NA     &lt;NA&gt;     NA\n2      5     6         0.472 &lt;NA&gt;     NA\n3      6     7         0.274 &lt;NA&gt;     NA\n\nsibling(y, 2)\n\n# A tibble: 1 × 5\n  parent  node branch.length label trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;\n1      7     3       0.00202 t3    0.570\n\nMRCA(y, 2, 3)\n\n# A tibble: 1 × 5\n  parent  node branch.length label trait\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;\n1      6     7         0.274 &lt;NA&gt;     NA\n\n\nAll these methods are also implemented in treeio for working with phylo and treedata objects. You can try accessing related nodes using the tree object. For instance, the following command will output child nodes of the selected internal node 5:\n\nchild(tree, 5)\n\n[1] 1 6\n\n\nBeware that the methods for tree objects output relevant node numbers, while the methods for tbl_tree object output a tibble object that contains related information.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#data-integration",
    "href": "02_tidytree.html#data-integration",
    "title": "2  Manipulating Tree with Data",
    "section": "2.2 Data Integration",
    "text": "2.2 Data Integration\n\n2.2.1 Combining tree data\nThe treeio package (Wang et al., 2020) serves as an infrastructure that enables various types of phylogenetic data inferred from common analysis programs to be imported and used in R. For instance, dN/dS or ancestral sequences estimated by CODEML, and clade support values (posterior) inferred by BEAST/MrBayes. In addition, treeio supports linking external data to phylogeny. It brings these external phylogenetic data (either from software output or external sources) to the R community and makes it available for further analysis in R. Furthermore, treeio can combine multiple phylogenetic trees into one with their node/branch-specific attribute data. Essentially, as a result, one such attribute (e.g., substitution rate) can be mapped to another attribute (e.g., dN/dS) of the same node/branch for comparison and further computations (Yu et al., 2017; Yu et al., 2018).\nA previously published dataset, seventy-six H3 hemagglutinin gene sequences of a lineage containing swine and human influenza A viruses (Liang et al., 2014), was used here to demonstrate the utilities of comparing evolutionary statistics inferred by different software. The dataset was re-analyzed by BEAST for timescale estimation and CODEML for synonymous and non-synonymous substitution estimation. In this example, we first parsed the outputs from BEAST using the read.beast() function and from CODEML using the read.codeml() function into two treedata objects. Then these two objects containing separate sets of node/branch-specific data were merged via the merge_tree() function.\n\nbeast_file &lt;- system.file(\"examples/MCC_FluA_H3.tree\", package=\"ggtree\")\nrst_file &lt;- system.file(\"examples/rst\", package=\"ggtree\")\nmlc_file &lt;- system.file(\"examples/mlc\", package=\"ggtree\")\nbeast_tree &lt;- read.beast(beast_file)\ncodeml_tree &lt;- read.codeml(rst_file, mlc_file)\n\nmerged_tree &lt;- merge_tree(beast_tree, codeml_tree)\nmerged_tree\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/ggtree/examples/MCC_FluA_H3.tree',\n    '/home/runner/work/_temp/Library/ggtree/examples/rst',\n    '/home/runner/work/_temp/Library/ggtree/examples/mlc'.\n\n...@ phylo:\n\nPhylogenetic tree with 76 tips and 75 internal nodes.\n\nTip labels:\n  A/Hokkaido/30-1-a/2013, A/New_York/334/2004, A/New_York/463/2005,\nA/New_York/452/1999, A/New_York/238/2005, A/New_York/523/1998, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'height', 'height_0.95_HPD', 'height_median', 'height_range', 'length',\n'length_0.95_HPD', 'length_median', 'length_range', 'posterior', 'rate',\n'rate_0.95_HPD', 'rate_median', 'rate_range', 'subs', 'AA_subs', 't', 'N',\n'S', 'dN_vs_dS', 'dN', 'dS', 'N_x_dN', 'S_x_dS'.\n\n\nAfter merging the beast_tree and codeml_tree objects, all node/branch-specific data imported from BEAST and CODEML output files are all available in the merged_tree object. The tree object was converted to a tidy data frame using the tidytree package and visualized as hexbin scatterplots of dN/dS, dN, and dS inferred by CODEML vs. rate (substitution rate in a unit of substitutions/site/year) inferred by BEAST on the same branches.\n\nlibrary(dplyr)\ndf &lt;- merged_tree %&gt;% \n  as_tibble() %&gt;%\n  select(dN_vs_dS, dN, dS, rate) %&gt;%\n  subset(dN_vs_dS &gt;=0 & dN_vs_dS &lt;= 1.5) %&gt;%\n  tidyr::gather(type, value, dN_vs_dS:dS)\ndf$type[df$type == 'dN_vs_dS'] &lt;- 'dN/dS'\ndf$type &lt;- factor(df$type, levels=c(\"dN/dS\", \"dN\", \"dS\"))\nggplot(df, aes(rate, value)) + geom_hex() + \n  facet_wrap(~type, scale='free_y') \n\n\n\n\nCorrelation of dN/dS, dN, and dS vs. substitution rate. After merging the BEAST and CodeML outputs, the branch-specific estimates (substitution rate, dN/dS , dN, and dS) from the two analysis programs are compared on the same branch basis. The associations of dN/dS, dN, and dS vs. rate are visualized in hexbin scatter plots.\n\n\n\n\nThe output is illustrated in Figure ?fig-correlations. We can then test the association of these node/branch-specific data using Pearson correlation, which in this case showed that dN and dS, but not dN/dS are significantly (p-values) associated with rate.\nUsing the merge_tree() function, we are able to compare analysis results using an identical model from different software packages or different models using different or identical software. It also allows users to integrate different analysis findings from different software packages. Merging tree data is not restricted to software findings, associating external data to analysis findings is also granted. The merge_tree() function is chainable and allows several tree objects to be merged into one.\n\nphylo &lt;- as.phylo(beast_tree)\nN &lt;- Nnode2(phylo)\nd &lt;- tibble(node = 1:N, fake_trait = rnorm(N), another_trait = runif(N))\nfake_tree &lt;- treedata(phylo = phylo, data = d)\ntriple_tree &lt;- merge_tree(merged_tree, fake_tree)\ntriple_tree\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/ggtree/examples/MCC_FluA_H3.tree',\n    '/home/runner/work/_temp/Library/ggtree/examples/rst',\n    '/home/runner/work/_temp/Library/ggtree/examples/mlc'.\n\n...@ phylo:\n\nPhylogenetic tree with 76 tips and 75 internal nodes.\n\nTip labels:\n  A/Hokkaido/30-1-a/2013, A/New_York/334/2004, A/New_York/463/2005,\nA/New_York/452/1999, A/New_York/238/2005, A/New_York/523/1998, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'height', 'height_0.95_HPD', 'height_median', 'height_range', 'length',\n'length_0.95_HPD', 'length_median', 'length_range', 'posterior', 'rate',\n'rate_0.95_HPD', 'rate_median', 'rate_range', 'subs', 'AA_subs', 't', 'N',\n'S', 'dN_vs_dS', 'dN', 'dS', 'N_x_dN', 'S_x_dS', 'fake_trait', 'another_trait'.\n\n\nThe triple_tree object shown above contains analysis results obtained from BEAST and CODEML, and evolutionary traits from external sources. All these pieces of information can be used to annotate the tree using ggtree (Yu et al., 2017) and ggtreeExtra (Xu et al., 2021).\n\n\n2.2.2 Linking external data to phylogeny\nIn addition to analysis findings that are associated with the tree as demonstrated above, there is a wide range of heterogeneous data, including phenotypic data, experimental data, and clinical data, etc., that need to be integrated and linked to phylogeny. For example, in the study of viral evolution, tree nodes may be associated with epidemiological information, such as location, age, and subtype. Functional annotations may need to be mapped onto gene trees for comparative genomics studies. To facilitate data integration, treeio provides full_join() methods to link external data to phylogeny and store it in either phylo or treedata object. Beware that linking external data to a phylo object will produce a treedata object to store the input phylo with associated data. The full_join methods can also be used at tidy data frame level (i.e., tbl_tree object described previously) and at ggtree level (described in Chapter 7) (Yu et al., 2018).\nThe following example calculated bootstrap values and merged those values with the tree (a phylo object) by matching their node numbers.\n\nlibrary(ape)\ndata(woodmouse)\nd &lt;- dist.dna(woodmouse)\ntr &lt;- nj(d)\nbp &lt;- boot.phylo(tr, woodmouse, function(x) nj(dist.dna(x)))\n\n\nRunning bootstraps:       100 / 100\nCalculating bootstrap values... done.\n\nbp2 &lt;- tibble(node=1:Nnode(tr) + Ntip(tr), bootstrap = bp)\nfull_join(tr, bp2, by=\"node\")\n\n'treedata' S4 object'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 13 internal nodes.\n\nTip labels:\n  No305, No304, No306, No0906S, No0908S, No0909S, ...\n\nUnrooted; includes branch length(s).\n\nwith the following features available:\n  '', 'bootstrap'.\n\n\nAnother example demonstrates merging evolutionary traits with the tree (a treedata object) by matching their tip labels.\n\nfile &lt;- system.file(\"extdata/BEAST\", \"beast_mcc.tree\", package=\"treeio\")\nbeast &lt;- read.beast(file)\nx &lt;- tibble(label = as.phylo(beast)$tip.label, trait = rnorm(Ntip(beast)))\nfull_join(beast, x, by=\"label\")\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/BEAST/beast_mcc.tree'.\n\n...@ phylo:\n\nPhylogenetic tree with 15 tips and 14 internal nodes.\n\nTip labels:\n  A_1995, B_1996, C_1995, D_1987, E_1996, F_1997, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'height', 'height_0.95_HPD', 'height_median', 'height_range', 'length',\n'length_0.95_HPD', 'length_median', 'length_range', 'posterior', 'rate',\n'rate_0.95_HPD', 'rate_median', 'rate_range', 'trait'.\n\n\nManipulating tree objects is frustrated with the fragmented functions available for working with phylo objects, not to mention linking external data to the phylogeny structure. With the treeio package (Wang et al., 2020), it is easy to combine tree data from various sources. In addition, with the tidytree package, manipulating trees is easier using the tidy data principles and consistent with tools already in wide use, including dplyr, tidyr, ggplot2, and ggtree (Yu et al., 2017).\n\n\n2.2.3 Grouping taxa\nThe groupOTU() and groupClade() methods are designed for adding taxa grouping information to the input tree object. The methods were implemented in tidytree, treeio, and ggtree respectively to support adding grouping information for the tbl_tree, phylo and treedata, and ggtree objects. This grouping information can be used directly in tree visualization (e.g., coloring a tree based on grouping information) with ggtree (Figure ?fig-groupOTU).\n\n2.2.3.1 groupClade\nThe groupClade() method accepts an internal node or a vector of internal nodes to add grouping information of selected clade/clades.\n\nnwk &lt;- '(((((((A:4,B:4):6,C:5):8,D:6):3,E:21):10,((F:4,G:12):14,H:8):13):\n        13,((I:5,J:2):30,(K:11,L:11):2):17):4,M:56);'\ntree &lt;- read.tree(text=nwk)\n\ngroupClade(as_tibble(tree), c(17, 21))\n\n# A tbl_tree abstraction: 25 × 5\n# which can be converted to treedata or phylo \n# via as.treedata or as.phylo\n   parent  node branch.length label group\n    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;\n 1     20     1             4 A     1    \n 2     20     2             4 B     1    \n 3     19     3             5 C     1    \n 4     18     4             6 D     1    \n 5     17     5            21 E     1    \n 6     22     6             4 F     2    \n 7     22     7            12 G     2    \n 8     21     8             8 H     2    \n 9     24     9             5 I     0    \n10     24    10             2 J     0    \n# ℹ 15 more rows\n\n\n\n\n2.2.3.2 groupOTU\n\nset.seed(2017)\ntr &lt;- rtree(4)\nx &lt;- as_tibble(tr)\n## the input nodes can be node ID or label\ngroupOTU(x, c('t1', 't4'), group_name = \"fake_group\")\n\n# A tbl_tree abstraction: 7 × 5\n# which can be converted to treedata or phylo \n# via as.treedata or as.phylo\n  parent  node branch.length label fake_group\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;     \n1      5     1       0.435   t4    1         \n2      7     2       0.674   t1    1         \n3      7     3       0.00202 t3    0         \n4      6     4       0.0251  t2    0         \n5      5     5      NA       &lt;NA&gt;  1         \n6      5     6       0.472   &lt;NA&gt;  1         \n7      6     7       0.274   &lt;NA&gt;  1         \n\n\nBoth groupClade() and groupOTU() work with the tbl_tree, phylo and treedata, and ggtree objects. Here is an example of using groupOTU() with a phylo tree object.\n\ngroupOTU(tr, c('t2', 't4'), group_name = \"fake_group\") %&gt;%\n  as_tibble\n\n# A tbl_tree abstraction: 7 × 5\n# which can be converted to treedata or phylo \n# via as.treedata or as.phylo\n  parent  node branch.length label fake_group\n   &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;     \n1      5     1       0.435   t4    1         \n2      7     2       0.674   t1    0         \n3      7     3       0.00202 t3    0         \n4      6     4       0.0251  t2    1         \n5      5     5      NA       &lt;NA&gt;  1         \n6      5     6       0.472   &lt;NA&gt;  1         \n7      6     7       0.274   &lt;NA&gt;  0         \n\n\nAnother example of working with the ggtree object can be found in session 6.4.\nThe groupOTU will trace back from input nodes to most recent common ancestor. In this example, nodes 1, 4, 5 and 6 are grouping together (4 (t2) -&gt; 6 -&gt; 5 and 1 (t4) -&gt; 5).\nRelated operational taxonomic units (OTUs) are grouping and they are not necessarily within a clade. They can be monophyletic (clade), polyphyletic or paraphyletic.\n\ncls &lt;- list(c1=c(\"A\", \"B\", \"C\", \"D\", \"E\"),\n            c2=c(\"F\", \"G\", \"H\"),\n            c3=c(\"L\", \"K\", \"I\", \"J\"),\n            c4=\"M\")\n\nas_tibble(tree) %&gt;% groupOTU(cls)\n\n# A tbl_tree abstraction: 25 × 5\n# which can be converted to treedata or phylo \n# via as.treedata or as.phylo\n   parent  node branch.length label group\n    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;\n 1     20     1             4 A     c1   \n 2     20     2             4 B     c1   \n 3     19     3             5 C     c1   \n 4     18     4             6 D     c1   \n 5     17     5            21 E     c1   \n 6     22     6             4 F     c2   \n 7     22     7            12 G     c2   \n 8     21     8             8 H     c2   \n 9     24     9             5 I     c3   \n10     24    10             2 J     c3   \n# ℹ 15 more rows\n\n\nIf there are conflicts when tracing back to the most recent common ancestor, users can set overlap parameter to “origin” (the first one counts), “overwrite” (default, the last one counts), or “abandon” (un-selected for grouping)1.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#sec-reroot-treeio",
    "href": "02_tidytree.html#sec-reroot-treeio",
    "title": "2  Manipulating Tree with Data",
    "section": "2.3 Rerooting tree",
    "text": "2.3 Rerooting tree\nA phylogenetic tree can be rerooted with a specified outgroup. The ape package implements a root() method to reroot a tree stored in a phylo object, while the treeio package provides the root() method for treedata object. This method is designed to re-root a phylogenetic tree with associated data concerning the specified outgroup or at the specified node based on the root() implemented in the ape package.\nWe first linked external data to a tree using left_join() and stored all the information in a treedata object, trda.\n\nlibrary(ggtree)\nlibrary(treeio)\nlibrary(tidytree)\nlibrary(TDbook)\n\n# load `tree_boots`, `df_tip_data`, and `df_inode_data` from 'TDbook'\n\ntrda &lt;- tree_boots %&gt;% \n        left_join(df_tip_data, by=c(\"label\" = \"Newick_label\")) %&gt;% \n        left_join(df_inode_data, by=c(\"label\" = \"newick_label\"))\ntrda\n\n'treedata' S4 object'.\n\n...@ phylo:\n\nPhylogenetic tree with 7 tips and 6 internal nodes.\n\nTip labels:\n  Rangifer_tarandus, Cervus_elaphus, Bos_taurus, Ovis_orientalis,\nSuricata_suricatta, Cystophora_cristata, ...\nNode labels:\n  Mammalia, Artiodactyla, Cervidae, Bovidae, Carnivora, Caniformia\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  '', 'vernacularName', 'imageURL', 'imageLicense', 'imageAuthor', 'infoURL',\n'mass_in_kg', 'trophic_habit', 'ncbi_taxid', 'rank', 'vernacularName.y',\n'infoURL.y', 'rank.y', 'bootstrap', 'posterior'.\n\n\nThen we can reroot the tree with the associated data mapping to the branches and nodes correctly as demonstrated in Figure ?fig-reroot. The figure was visualized using ggtree (see also Chapters 4 and 5).\n\n# reroot\ntrda2 &lt;- root(trda, outgroup = \"Suricata_suricatta\", edgelabel = TRUE)\n# The original tree\np1 &lt;- trda %&gt;%\n      ggtree() +\n      geom_nodelab(\n        mapping = aes(\n          x = branch,\n          label = bootstrap\n        ),\n        nudge_y = 0.36\n      ) +\n      xlim(-.1, 4.5) +\n      geom_tippoint(\n        mapping = aes(\n          shape = trophic_habit, \n          color = trophic_habit, \n          size = mass_in_kg\n        )\n      ) +\n      scale_size_continuous(range = c(3, 10)) +\n      geom_tiplab(\n        offset = .14, \n      ) +\n      geom_nodelab(\n        mapping = aes(\n          label = vernacularName.y, \n          fill = posterior\n        ),\n        geom = \"label\"\n      ) + \n      scale_fill_gradientn(colors = RColorBrewer::brewer.pal(3, \"YlGnBu\")) +\n      theme(legend.position = \"right\")  \n\n# after reroot\np2 &lt;- trda2 %&gt;%\n      ggtree() +\n      geom_nodelab(\n        mapping = aes(\n          x = branch,\n          label = bootstrap\n        ),\n        nudge_y = 0.36\n      ) +\n      xlim(-.1, 5.5) +\n      geom_tippoint(\n        mapping = aes(\n          shape = trophic_habit,\n          color = trophic_habit,\n          size = mass_in_kg\n        )\n      ) +\n      scale_size_continuous(range = c(3, 10)) +\n      geom_tiplab(\n        offset = .14,\n      ) +\n      geom_nodelab(\n        mapping = aes(\n          label = vernacularName.y,\n          fill = posterior\n        ),\n        geom = \"label\"\n      ) +\n      scale_fill_gradientn(colors = RColorBrewer::brewer.pal(3, \"YlGnBu\")) +\n      theme(legend.position = \"right\")\n\nplot_list(p1, p2, tag_levels='A', ncol=2)\n\n\n\n\nReroot a phylogenetic tree with associated data. Original tree (A) and re-rooted tree (B) with associated data mapped to the branches or nodes of the tree correctly. (A) and (B) present before and after rooting on the branch leading to the tip node ‘Suricata_suricatta’, respectively.\n\n\n\n\nThe outgroup parameter represents the specific new outgroup, it can be a node label (character) or node number. If it is a “single one” value, meaning using the node below this tip as the new root, if it has multiple values, meaning the most recent common of the values will be used as the new root. Note that, if the node labels should be treated as edge labels, the edgelabel should be set to TRUE to return the correct relationship between the node and associated data. For more details about re-root, including precautions and pitfalls, please refer to the review article (Czech et al., 2017).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#sec-rescale-treeio",
    "href": "02_tidytree.html#sec-rescale-treeio",
    "title": "2  Manipulating Tree with Data",
    "section": "2.4 Rescaling Tree Branches",
    "text": "2.4 Rescaling Tree Branches\nPhylogenetic data can be merged for joint analysis (Figure ?fig-correlations). They can be displayed on the same tree structure as a more complex annotation to help visually inspection of their evolutionary patterns. All the numerical data stored in a treedata object can be used to re-scale tree branches. For example, CodeML infers dN/dS, dN, and dS, all these statistics can be used as branch lengths (Figure ?fig-rescale). All these values can also be used to color the tree (session 4.3.4) and can be projected to a vertical dimension to create a two-dimensional tree or phenogram (session 4.2.2 and Figures ?fig-2d and ?fig-continuousColor).\n\np1 &lt;- ggtree(merged_tree) + theme_tree2()\np2 &lt;- ggtree(rescale_tree(merged_tree, 'dN')) + theme_tree2()\np3 &lt;- ggtree(rescale_tree(merged_tree, 'rate')) + theme_tree2()\n\nplot_list(p1, p2, p3, ncol=3, tag_levels='A')\n\n\n\n\nRescaling tree branches. The tree with branches scaled in time (year from the root) (A). The tree was rescaled using dN as branch lengths (B). The tree was rescaled using substitution rates (C).\n\n\n\n\nModifying branch lengths in the tree object in addtion to using the rescale_tree() function, users can directly specify a variable as branch length in ggtree() as demonstrated in session 4.3.6.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#subsetting-tree-with-data",
    "href": "02_tidytree.html#subsetting-tree-with-data",
    "title": "2  Manipulating Tree with Data",
    "section": "2.5 Subsetting Tree with Data",
    "text": "2.5 Subsetting Tree with Data\n\n2.5.1 Removing tips in a phylogenetic tree\nSometimes we want to remove selected tips from a phylogenetic tree. This is due to several reasons, including low sequence quality, errors in sequence assembly, an alignment error in part of the sequence, an error in phylogenetic inference, etc.\nLet’s say that we want to remove three tips (colored red) from the tree (Figure ?fig-removeTipA), the drop.tip() method removes specified tips and updates the tree (Figure ?fig-removeTipB). All associated data will be maintained in the updated tree.\n\nf &lt;- system.file(\"extdata/NHX\", \"phyldog.nhx\", package=\"treeio\")\nnhx &lt;- read.nhx(f)\nto_drop &lt;- c(\"Physonect_sp_@2066767\",\n            \"Lychnagalma_utricularia@2253871\",\n            \"Kephyes_ovata@2606431\")\np1 &lt;- ggtree(nhx) + geom_tiplab(aes(color = label %in% to_drop)) +\n  scale_color_manual(values=c(\"black\", \"red\")) + xlim(0, 0.8)\n\nnhx_reduced &lt;- drop.tip(nhx, to_drop)\np2 &lt;- ggtree(nhx_reduced) + geom_tiplab() + xlim(0, 0.8)  \nplot_list(p1, p2, ncol=2, tag_levels = \"A\")\n\n\n\n\nRemoving tips from a tree. Original tree with three tips (colored red) to remove (A). The updated tree removed selected tips (B).\n\n\n\n\n\n\n2.5.2 Subsetting tree by tip label\nSometimes a tree can be large and difficult to look at only the portions of interest. The tree_subset() function was created in the treeio package (Wang et al., 2020) to extract a subset of the tree portion while still maintaining the structure of the tree portion. The beast_tree in Figure ?fig-subsetTipA is slightly crowded. Obviously, we can make the figure taller to allow more space for the labels (similar to using the “Expansion” slider in FigTree) or we can make the text smaller. However, these solutions are not always applicable when you have a lot of tips (e.g., hundreds or thousands of tips). In particular, when you are only interested in the portion of the tree around a particular tip, you certainly don’t want to explore a large tree to find the certain species you are interested in.\nLet’s say you are interested in tip A/Swine/HK/168/2012 from the tree (Figure ?fig-subsetTipA) and you want to look at the immediate relatives of this tip.\nThe tree_subset() function allows you to look at the portions of the tree that are of interest. By default, the tree_subset() function will internally call the groupOTU() to assign the group specified tip from the rest of the other tips (Figure ?fig-subsetTipB). Additionally, the branch lengths and related associated data are maintained after subsetting (Figure ?fig-subsetTipC). The root of the tree is always anchored at zero for the subset tree by default and all the distances are relative to this root. If you want all the distances to be relative to the original root, you can specify the root position (by root.position parameter) to the root edge of the subset tree, which is the sum of branch lengths from the original root to the root of the subset tree (Figures ?fig-subsetTipD and E).\n\nbeast_file &lt;- system.file(\"examples/MCC_FluA_H3.tree\", package=\"ggtree\")\nbeast_tree &lt;- read.beast(beast_file)\n\np1 = ggtree(beast_tree) + \n  geom_tiplab(offset=.05) +  xlim(0, 40) + theme_tree2()\n\ntree2 = tree_subset(beast_tree, \"A/Swine/HK/168/2012\", levels_back=4)  \np2 &lt;- ggtree(tree2, aes(color=group)) +\n  scale_color_manual(values = c(\"black\", \"red\"), guide = 'none') +\n  geom_tiplab(offset=.2) +  xlim(0, 4.5) + theme_tree2() \n\np3 &lt;- p2 +   \n  geom_point(aes(fill = rate), shape = 21, size = 4) +\n  scale_fill_continuous(low = 'blue', high = 'red') +\n  xlim(0,5) + theme(legend.position = 'right')\n\np4 &lt;- ggtree(tree2, aes(color=group), \n          root.position = as.phylo(tree2)$root.edge) +\n  geom_tiplab() + xlim(18, 24) + \n  scale_color_manual(values = c(\"black\", \"red\"), guide = 'none') +\n  theme_tree2()\n\np5 &lt;- p4 + \n  geom_rootedge() + xlim(0, 50) \n\nplot_list(p1, p2, p3, p4, p5, \n        design=\"AABBCC\\nAADDEE\", tag_levels='A')\n\n\n\n\nSubsetting tree for a specific tip. Original tree (A). Subset tree (B). Subset tree with data (C). Visualize the subset tree relative to the original position, without rootedge (D) and with rootedge (E).\n\n\n\n\n\n\n2.5.3 Subsetting tree by internal node number\nIf you are interested in a certain clade, you can specify the input node as an internal node number. The tree_subset() function will take the clade as a whole and also trace it back to particular levels to look at the immediate relatives of the clade (Figures ?fig-subsetNodeA and B). We can use the tree_subset() function to zoom in selected portions and plot a whole tree with the portion of it, which is similar to the ape::zoom() function to explore a very large tree (Figures ?fig-subsetNodeC and D). Users can also use viewClade() function to restrict tree visualization at specific clade as demonstrated in session 6.1.\n\nclade &lt;- tree_subset(beast_tree, node=121, levels_back=0)\nclade2 &lt;- tree_subset(beast_tree, node=121, levels_back=2)\np1 &lt;- ggtree(clade) + geom_tiplab() + xlim(0, 5)\np2 &lt;- ggtree(clade2, aes(color=group)) + geom_tiplab() + \n  xlim(0, 9) + scale_color_manual(values=c(\"black\", \"red\"))\n\n\nlibrary(ape)\nlibrary(tidytree)\nlibrary(treeio)\n\ndata(chiroptera)\n\nnodes &lt;- grep(\"Plecotus\", chiroptera$tip.label)\nchiroptera &lt;- groupOTU(chiroptera, nodes)\n\nclade &lt;- MRCA(chiroptera, nodes)\nx &lt;- tree_subset(chiroptera, clade, levels_back = 0)\n\np3 &lt;- ggtree(chiroptera, aes(colour = group)) + \n  scale_color_manual(values=c(\"black\", \"red\")) +\n  theme(legend.position = \"none\")\np4 &lt;- ggtree(x) + geom_tiplab() + xlim(0, 6)\nplot_list(p1, p2, p3, p4, \n  ncol=2, tag_levels = 'A')\n\n\n\n\nSubsetting tree for the specific clade. Extracting a clade (A). Extracting a clade and tracing it back to look at its immediate relatives (B). Viewing a very large tree (C) and a selected portion of it (D).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#sec-ggtree-fortify",
    "href": "02_tidytree.html#sec-ggtree-fortify",
    "title": "2  Manipulating Tree with Data",
    "section": "2.6 Manipulating Tree Data for Visualization",
    "text": "2.6 Manipulating Tree Data for Visualization\nTree visualization is supported by ggtree (Yu et al., 2017). Although ggtree implemented several methods for visual exploration of trees with data, you may want to do something that is not supported directly. In this case, you need to manipulate tree data with node coordination positions that are used for visualization. This is quite easy with ggtree. Users can use the fortify() method which internally calls tidytree::as_tibble() to convert the tree to a tidy data frame and add columns of coordination positions (i.e., x, y, branch, and angle) that are used to plot the tree. You can also access the data via ggtree(tree)$data.\nHere is an example to plot two trees face-to-face that is similar to a graph produced by the ape::cophyloplot() function (Figure ?fig-cophylo).\n\nlibrary(dplyr)\nlibrary(ggtree)\n\nset.seed(1024)\nx &lt;- rtree(30)\ny &lt;- rtree(30)\np1 &lt;- ggtree(x, layout='roundrect') + \n  geom_hilight(\n         mapping=aes(subset = node %in% c(38, 48, 58, 36),\n                     node = node,\n                     fill = as.factor(node)\n                     )\n     ) +\n    labs(fill = \"clades for tree in left\" )\n\np2 &lt;- ggtree(y)\n\nd1 &lt;- p1$data\nd2 &lt;- p2$data\n\n## reverse x-axis and \n## set offset to make the tree on the right-hand side of the first tree\nd2$x &lt;- max(d2$x) - d2$x + max(d1$x) + 1\n\npp &lt;- p1 + geom_tree(data=d2, layout='ellipse') +      \n  ggnewscale::new_scale_fill() +\n  geom_hilight(\n         data = d2, \n         mapping = aes( \n            subset = node %in% c(38, 48, 58),\n            node=node,\n            fill=as.factor(node))\n  ) +\n  labs(fill = \"clades for tree in right\" ) \n\ndd &lt;- bind_rows(d1, d2) %&gt;% \n  filter(!is.na(label))\n\npp + geom_line(aes(x, y, group=label), data=dd, color='grey') +\n    geom_tiplab(geom = 'shadowtext', bg.colour = alpha('firebrick', .5)) +\n    geom_tiplab(data = d2, hjust=1, geom = 'shadowtext', \n                bg.colour = alpha('firebrick', .5))\n\n\n\n\nPlot two phylogenetic trees face-to-face. Plotting a tree using ggtree() (left-hand side) and subsequently adding another layer of a tree by geom_tree() (right-hand side). The relative positions of the plotted trees can be manually adjusted and adding layers to each of the trees (e.g., tip labels and highlighting clades) is independent.\n\n\n\n\nIt is quite easy to plot multiple trees and connect taxa in one figure; for instance, plotting trees constructed from all internal gene segments of influenza virus and connecting equivalent strains across the trees (Venkatesh et al., 2018). Figure ?fig-cophylo3 demonstrates the usage of plotting multiple trees by combining multiple layers of geom_tree().\n\nz &lt;- rtree(30)\nd2 &lt;- fortify(y)\nd3 &lt;- fortify(z)\nd2$x &lt;- d2$x + max(d1$x) + 1\nd3$x &lt;- d3$x + max(d2$x) + 1\n\ndd = bind_rows(d1, d2, d3) %&gt;% \n  filter(!is.na(label))\n\np1 + geom_tree(data = d2) + geom_tree(data = d3) + geom_tiplab(data=d3) + \n  geom_line(aes(x, y, group=label, color=node &lt; 15), data=dd, alpha=.3)\n\n\n\n\nPlot multiple phylogenetic trees side-by-side. Plotting a tree using ggtree() and subsequently adding multiple layers of trees by geom_tree().",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#sec-summary2",
    "href": "02_tidytree.html#sec-summary2",
    "title": "2  Manipulating Tree with Data",
    "section": "2.7 Summary",
    "text": "2.7 Summary\nThe treeio package allows us to import diverse phylogeny associated data into R. However, a phylogenetic tree is stored in a way to facilitate computational processing which is not human friendly and needs the expertise to manipulate and explore tree data. The tidytree package provides a tidy interface for exploring tree data, while ggtree provides a set of utilities to visualize and explore tree data using the grammar of graphics. This full suite of packages makes it easy for ordinary users to interact with tree data and allows us to integrate phylogeny associated data from different sources (e.g., experimental results or analysis findings), which creates the possibilities of integrative and comparative study. Moreover, this package suite brings phylogenetic analysis into the tidyverse and certainly takes us to the next level of processing phylogenetic data.\n\n\n\n\nCzech, L., Huerta-Cepas, J., & Stamatakis, A. (2017). A Critical Review on the Use of Support Values in Tree Viewers and Bioinformatics Toolkits. Molecular Biology and Evolution, 34(6), 1535–1542. https://doi.org/10.1093/molbev/msx055\n\n\nLiang, H., Lam, T. T.-Y., Fan, X., Chen, X., Zeng, Y., Zhou, J., Duan, L., Tse, M., Chan, C.-H., Li, L., Leung, T.-Y., Yip, C.-H., Cheung, C.-L., Zhou, B., Smith, D. K., Poon, L. L.-M., Peiris, M., Guan, Y., & Zhu, H. (2014). Expansion of genotypic diversity and establishment of 2009 H1N1 pandemic-origin internal genes in pigs in China. Journal of Virology, JVI.01327–14. https://doi.org/10.1128/JVI.01327-14\n\n\nParadis, E., Claude, J., & Strimmer, K. (2004). APE: Analyses of Phylogenetics and Evolution in R language. Bioinformatics, 20(2), 289–290. https://doi.org/10.1093/bioinformatics/btg412\n\n\nVenkatesh, D., Poen, M. J., Bestebroer, T. M., Scheuer, R. D., Vuong, O., Chkhaidze, M., Machablishvili, A., Mamuchadze, J., Ninua, L., Fedorova, N. B., Halpin, R. A., Lin, X., Ransier, A., Stockwell, T. B., Wentworth, D. E., Kriti, D., Dutta, J., Bakel, H. van, Puranik, A., … Lewis, N. S. (2018). Avian influenza viruses in wild birds: Virus evolution in a multihost ecosystem. Journal of Virology, 92(15). https://doi.org/10.1128/JVI.00433-18\n\n\nWang, L.-G., Lam, T. T.-Y., Xu, S., Dai, Z., Zhou, L., Feng, T., Guo, P., Dunn, C. W., Jones, B. R., Bradley, T., Zhu, H., Guan, Y., Jiang, Y., & Yu, G. (2020). Treeio: An r package for phylogenetic tree input and output with richly annotated and associated data. Molecular Biology and Evolution, 37(2), 599–603. https://doi.org/10.1093/molbev/msz240\n\n\nXu, S., Dai, Z., Guo, P., Fu, X., Liu, S., Zhou, L., Tang, W., Feng, T., Chen, M., Zhan, L., Wu, T., Hu, E., Jiang, Y., Bo, X., & Yu, G. (2021). ggtreeExtra: Compact Visualization of Richly Annotated Phylogenetic Data. Molecular Biology and Evolution, 38(9), 4039–4042. https://doi.org/10.1093/molbev/msab166\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "02_tidytree.html#footnotes",
    "href": "02_tidytree.html#footnotes",
    "title": "2  Manipulating Tree with Data",
    "section": "",
    "text": "https://groups.google.com/forum/#!msg/bioc-ggtree/Q4LnwoTf1DM/uqYdYB_VBAAJ↩︎",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Manipulating Tree with Data</span>"
    ]
  },
  {
    "objectID": "03_treeio_exporting_tree.html",
    "href": "03_treeio_exporting_tree.html",
    "title": "3  Exporting tree with data",
    "section": "",
    "text": "3.1 Introduction\nThe treeio package (Wang et al., 2020) supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidence. Some of the formats are just log files (e.g., PAML and r8s output), while some of the others are non-standard formats (e.g., BEAST and MrBayes output that introduce a square bracket, which was reserved to store comments in standard Nexus format, to store inferences). With treeio, we are now able to parse these files to extract phylogenetic trees and map associated data on the tree structure. Exporting tree structure is easy, users can use the as.phyo() method defined in treeio to convert a treedata object to a phylo object and then use write.tree() or write.nexus() implemented in ape package (Paradis et al., 2004) to export the tree structure as Newick text or Nexus file. This is quite useful for converting non-standard formats to a standard format and for extracting trees from software outputs, such as log files.\nHowever, exporting a tree with associated data is still challenging. These associated data can be parsed from analysis programs or obtained from external sources (e.g., phenotypic data, experimental data, and clinical data). The major obstacle here is that there is no standard format designed for storing a tree with data. NeXML (Vos et al., 2012) may be the most flexible format. However, it is currently not widely supported. Most of the analysis programs in this field rely extensively on Newick string and Nexus format. In my opinion, although BEAST Nexus format may not be the best solution, it is currently a good approach for storing heterogeneous associated data. The beauty of the format is that all the annotated elements are stored within square brackets, which are reserved for comments. In this way, existing programs that can read standard Nexus format are able to parse it by ignoring the annotated elements.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Exporting tree with data</span>"
    ]
  },
  {
    "objectID": "03_treeio_exporting_tree.html#exporting-tree-data-to-beast-nexus-format",
    "href": "03_treeio_exporting_tree.html#exporting-tree-data-to-beast-nexus-format",
    "title": "3  Exporting tree with data",
    "section": "3.2 Exporting Tree Data to BEAST Nexus Format",
    "text": "3.2 Exporting Tree Data to BEAST Nexus Format\n\n3.2.1 Exporting/converting software output\nThe treeio package (Wang et al., 2020) provides the write.beast() function to export treedata object as BEAST Nexus file (Bouckaert et al., 2014). With treeio, it is easy to convert software output to BEAST format if the output can be parsed by treeio (see Chapter 1).\nHere is an example of converting NHX file to BEAST format:\n\nnhxfile &lt;- system.file(\"extdata/NHX\", \"phyldog.nhx\", package=\"treeio\")\nnhx &lt;- read.nhx(nhxfile)\n# write.beast(nhx, file = \"phyldog.tree\")\nwrite.beast(nhx)\n\n\nx &lt;- '#NEXUS\n[R-package treeio, Thu Oct 14 11:24:19 2021]\n\nBEGIN TAXA;\n    DIMENSIONS NTAX = 16;\n    TAXLABELS\n        Prayidae_D27SS7@2825365\n        Kephyes_ovata@2606431\n        Chuniphyes_multidentata@1277217\n        Apolemia_sp_@1353964\n        Bargmannia_amoena@263997\n        Bargmannia_elongata@946788\n        Physonect_sp_@2066767\n        Stephalia_dilata@2960089\n        Frillagalma_vityazi@1155031\n        Resomia_ornicephala@3111757\n        Lychnagalma_utricularia@2253871\n        Nanomia_bijuga@717864\n        Cordagalma_sp_@1525873\n        Rhizophysa_filiformis@3073669\n        Hydra_magnipapillata@52244\n        Ectopleura_larynx@3556167\n    ;\nEND;\nBEGIN TREES;\n    TRANSLATE\n        1   Prayidae_D27SS7@2825365,\n        2   Kephyes_ovata@2606431,\n        3   Chuniphyes_multidentata@1277217,\n        4   Apolemia_sp_@1353964,\n        5   Bargmannia_amoena@263997,\n        6   Bargmannia_elongata@946788,\n        7   Physonect_sp_@2066767,\n        8   Stephalia_dilata@2960089,\n        9   Frillagalma_vityazi@1155031,\n        10  Resomia_ornicephala@3111757,\n        11  Lychnagalma_utricularia@2253871,\n        12  Nanomia_bijuga@717864,\n        13  Cordagalma_sp_@1525873,\n        14  Rhizophysa_filiformis@3073669,\n        15  Hydra_magnipapillata@52244,\n        16  Ectopleura_larynx@3556167\n    ;\n    TREE * UNTITLED = [&R] (((1[&Ev=S,ND=0,S=58]:0.0682841,(2[&Ev=S,ND=1,\nS=69]:0.0193941,3[&Ev=S,ND=2,S=70]:0.0121378)[&Ev=S,ND=3,S=60]:0.0217782)\n[&Ev=S,ND=4,S=36]:0.0607598,((4[&Ev=S,ND=9,S=31]:0.11832,(((5[&Ev=S,ND=10,\nS=37]:0.0144549,6[&Ev=S,ND=11,S=38]:0.0149723)[&Ev=S,ND=12,S=33]:0.0925388,\n7[&Ev=S,ND=13,S=61]:0.077429)[&Ev=S,ND=14,S=24]:0.0274637,(8[&Ev=S,ND=15,\nS=52]:0.0761163,((9[&Ev=S,ND=16,S=53]:0.0906068,10[&Ev=S,ND=17,S=54]:1e-06)\n[&Ev=S,ND=18,S=45]:1e-06,((11[&Ev=S,ND=19,S=65]:0.120851,12[&Ev=S,ND=20,\nS=71]:0.133939)[&Ev=S,ND=21,S=56]:1e-06,13[&Ev=S,ND=22,S=64]:0.0693814)\n[&Ev=S,ND=23,S=46]:1e-06)[&Ev=S,ND=24,S=40]:0.0333823)[&Ev=S,ND=25,S=35]:\n1e-06)[&Ev=D,ND=26,S=24]:0.0431861)[&Ev=S,ND=27,S=19]:1e-06,14[&Ev=S,ND=28,\nS=26]:0.22283)[&Ev=S,ND=29,S=17]:0.0292362)[&Ev=D,ND=8,S=17]:0.185603,\n(15[&Ev=S,ND=5,S=16]:0.0621782,16[&Ev=S,ND=6,S=15]:0.332505)[&Ev=S,ND=7,\nS=12]:0.185603)[&Ev=S,ND=30,S=9];\nEND;'\n\nwriteLines(x)\n\nNA #NEXUS\nNA [R-package treeio, Thu Oct 14 11:24:19 2021]\nNA \nNA BEGIN TAXA;\nNA  DIMENSIONS NTAX = 16;\nNA  TAXLABELS\nNA      Prayidae_D27SS7@2825365\nNA      Kephyes_ovata@2606431\nNA      Chuniphyes_multidentata@1277217\nNA      Apolemia_sp_@1353964\nNA      Bargmannia_amoena@263997\nNA      Bargmannia_elongata@946788\nNA      Physonect_sp_@2066767\nNA      Stephalia_dilata@2960089\nNA      Frillagalma_vityazi@1155031\nNA      Resomia_ornicephala@3111757\nNA      Lychnagalma_utricularia@2253871\nNA      Nanomia_bijuga@717864\nNA      Cordagalma_sp_@1525873\nNA      Rhizophysa_filiformis@3073669\nNA      Hydra_magnipapillata@52244\nNA      Ectopleura_larynx@3556167\nNA  ;\nNA END;\nNA BEGIN TREES;\nNA  TRANSLATE\nNA      1   Prayidae_D27SS7@2825365,\nNA      2   Kephyes_ovata@2606431,\nNA      3   Chuniphyes_multidentata@1277217,\nNA      4   Apolemia_sp_@1353964,\nNA      5   Bargmannia_amoena@263997,\nNA      6   Bargmannia_elongata@946788,\nNA      7   Physonect_sp_@2066767,\nNA      8   Stephalia_dilata@2960089,\nNA      9   Frillagalma_vityazi@1155031,\nNA      10  Resomia_ornicephala@3111757,\nNA      11  Lychnagalma_utricularia@2253871,\nNA      12  Nanomia_bijuga@717864,\nNA      13  Cordagalma_sp_@1525873,\nNA      14  Rhizophysa_filiformis@3073669,\nNA      15  Hydra_magnipapillata@52244,\nNA      16  Ectopleura_larynx@3556167\nNA  ;\nNA  TREE * UNTITLED = [&R] (((1[&Ev=S,ND=0,S=58]:0.0682841,(2[&Ev=S,ND=1,\nNA S=69]:0.0193941,3[&Ev=S,ND=2,S=70]:0.0121378)[&Ev=S,ND=3,S=60]:0.0217782)\nNA [&Ev=S,ND=4,S=36]:0.0607598,((4[&Ev=S,ND=9,S=31]:0.11832,(((5[&Ev=S,ND=10,\nNA S=37]:0.0144549,6[&Ev=S,ND=11,S=38]:0.0149723)[&Ev=S,ND=12,S=33]:0.0925388,\nNA 7[&Ev=S,ND=13,S=61]:0.077429)[&Ev=S,ND=14,S=24]:0.0274637,(8[&Ev=S,ND=15,\nNA S=52]:0.0761163,((9[&Ev=S,ND=16,S=53]:0.0906068,10[&Ev=S,ND=17,S=54]:1e-06)\nNA [&Ev=S,ND=18,S=45]:1e-06,((11[&Ev=S,ND=19,S=65]:0.120851,12[&Ev=S,ND=20,\nNA S=71]:0.133939)[&Ev=S,ND=21,S=56]:1e-06,13[&Ev=S,ND=22,S=64]:0.0693814)\nNA [&Ev=S,ND=23,S=46]:1e-06)[&Ev=S,ND=24,S=40]:0.0333823)[&Ev=S,ND=25,S=35]:\nNA 1e-06)[&Ev=D,ND=26,S=24]:0.0431861)[&Ev=S,ND=27,S=19]:1e-06,14[&Ev=S,ND=28,\nNA S=26]:0.22283)[&Ev=S,ND=29,S=17]:0.0292362)[&Ev=D,ND=8,S=17]:0.185603,\nNA (15[&Ev=S,ND=5,S=16]:0.0621782,16[&Ev=S,ND=6,S=15]:0.332505)[&Ev=S,ND=7,\nNA S=12]:0.185603)[&Ev=S,ND=30,S=9];\nNA END;\n\n\nAnother example of converting CODEML output to BEAST format:\n\nmlcfile &lt;- system.file(\"extdata/PAML_Codeml\", \"mlc\", package=\"treeio\")\nml &lt;- read.codeml_mlc(mlcfile)\n# write.beast(ml, file = \"codeml.tree\")\nwrite.beast(ml) # output not shown\n\n\nx &lt;- '#NEXUS\n[R-package treeio, Thu Oct 14 11:27:48 2021]\n\nBEGIN TAXA;\n    DIMENSIONS NTAX = 15;\n    TAXLABELS\n        A\n        B\n        C\n        D\n        E\n        F\n        G\n        H\n        I\n        J\n        K\n        L\n        M\n        N\n        O\n    ;\nEND;\nBEGIN TREES;\n    TRANSLATE\n        1   A,\n        2   B,\n        3   C,\n        4   D,\n        5   E,\n        6   F,\n        7   G,\n        8   H,\n        9   I,\n        10  J,\n        11  K,\n        12  L,\n        13  M,\n        14  N,\n        15  O\n    ;\n    TREE * UNTITLED = [&U] (11[&t=0.082,N=1514.9,S=633.1,dN_vs_dS=0.0224,\ndN=0.002,dS=0.0878,N_x_dN=3,S_x_dS=55.6]:0.081785,14[&t=0.062,N=1514.9,\nS=633.1,dN_vs_dS=0.0095,dN=7e-04,dS=0.0689,N_x_dN=1,S_x_dS=43.6]:0.062341,\n(4[&t=0.082,N=1514.9,S=633.1,dN_vs_dS=0.0385,dN=0.0033,dS=0.0849,N_x_dN=5,\nS_x_dS=53.8]:0.082021,(12[&t=0.006,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,\ndS=0.0062,N_x_dN=0,S_x_dS=3.9]:0.005508,(10[&t=0.014,N=1514.9,S=633.1,\ndN_vs_dS=0.0457,dN=7e-04,dS=0.0143,N_x_dN=1,S_x_dS=9]:0.013996,(7[&t=0.046,\nN=1514.9,S=633.1,dN_vs_dS=0.1621,dN=0.006,dS=0.0373,N_x_dN=9.2,S_x_dS=23.6]:\n0.045746,((3[&t=0.028,N=1514.9,S=633.1,dN_vs_dS=0.0461,dN=0.0013,dS=0.0282,\nN_x_dN=2,S_x_dS=17.9]:0.02773,(5[&t=0.031,N=1514.9,S=633.1,dN_vs_dS=0.0641,\ndN=0.002,dS=0.0305,N_x_dN=3,S_x_dS=19.3]:0.031104,15[&t=0.048,N=1514.9,\nS=633.1,dN_vs_dS=0.0538,dN=0.0026,dS=0.0485,N_x_dN=4,S_x_dS=30.7]:0.048389)\n23[&t=0.008,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.0094,N_x_dN=0,\nS_x_dS=6]:0.008328)22[&t=0.016,N=1514.9,S=633.1,dN_vs_dS=0.0395,dN=7e-04,\ndS=0.0165,N_x_dN=1,S_x_dS=10.4]:0.015959,(8[&t=0.021,N=1514.9,S=633.1,\ndN_vs_dS=0.1028,dN=0.002,dS=0.0191,N_x_dN=3,S_x_dS=12.1]:0.021007,\n(9[&t=0.015,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.0167,N_x_dN=0,\nS_x_dS=10.6]:0.014739,(2[&t=0.032,N=1514.9,S=633.1,dN_vs_dS=1e-04,\ndN=0,dS=0.0358,N_x_dN=0,S_x_dS=22.7]:0.031643,(1[&t=0.01,N=1514.9,\nS=633.1,dN_vs_dS=0.0646,dN=7e-04,dS=0.0101,N_x_dN=1,S_x_dS=6.4]:0.01034,\n(6[&t=0.007,N=1514.9,S=633.1,dN_vs_dS=0.298,dN=0.0013,dS=0.0044,N_x_dN=2,\nS_x_dS=2.8]:0.006649,13[&t=0.009,N=1514.9,S=633.1,dN_vs_dS=0.0738,dN=7e-04,\ndS=0.0088,N_x_dN=1,S_x_dS=5.6]:0.009195)28[&t=0.028,N=1514.9,S=633.1,\ndN_vs_dS=0.0453,dN=0.0013,dS=0.0289,N_x_dN=2,S_x_dS=18.3]:0.028303)27\n[&t=0.008,N=1514.9,S=633.1,dN_vs_dS=0.0863,dN=7e-04,dS=0.0076,N_x_dN=1,\nS_x_dS=4.8]:0.008072)26[&t=0.003,N=1514.9,S=633.1,dN_vs_dS=1.5591,dN=0.0013,\ndS=8e-04,N_x_dN=2,S_x_dS=0.5]:0.0035)25[&t=0.02,N=1514.9,S=633.1,\ndN_vs_dS=1e-04,dN=0,dS=0.023,N_x_dN=0,S_x_dS=14.6]:0.020359)24[&t=0.001,\nN=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=6e-04,N_x_dN=0,S_x_dS=0.4]:0.000555)\n21[&t=0.024,N=1514.9,S=633.1,dN_vs_dS=0.0549,dN=0.0013,dS=0.0237,N_x_dN=2,\nS_x_dS=15]:0.023675)20[&t=0.046,N=1514.9,S=633.1,dN_vs_dS=0.0419,dN=0.002,\ndS=0.047,N_x_dN=3,S_x_dS=29.8]:0.045745)19[&t=0.015,N=1514.9,S=633.1,\ndN_vs_dS=1e-04,dN=0,dS=0.0166,N_x_dN=0,S_x_dS=10.5]:0.014684)18[&t=0.059,\nN=1514.9,S=633.1,dN_vs_dS=0.0964,dN=0.0053,dS=0.0545,N_x_dN=8,S_x_dS=34.5]:\n0.059308)17[&t=0.232,N=1514.9,S=633.1,dN_vs_dS=0.0129,dN=0.0033,dS=0.2541,\nN_x_dN=5,S_x_dS=160.9]:0.231628)16;\nEND;'\n\nwriteLines(x)\n\nSome software tools that do not support these outputs can be supported through data conversion. For example, we can convert the NHX file to BEAST file and use NHX tags to color the tree using FigTree (Figure ?fig-beastFigtreeA) or convert CODEML output and use dN/dS, dN, or dS to color the tree in FigTree (Figure ?fig-beastFigtreeB). Before conversion, these files could not be opened in Figtree. Treeio’s conversion function makes data available to other software tools and expands the application range of these tools.\n\n\n\n\n\nVisualizing BEAST file in FigTree. Directly visualizing NHX file (A) and CodeML output (B) in FigTree is not supported. treeio can convert these files to BEAST compatible NEXUS format which can be directly opened in FigTree and visualized together with annotated data.\n\n\n\n\n\n\n3.2.2 Combining tree with external data\nUsing the utilities provided by tidytree and treeio, it is easy to link external data onto the corresponding phylogeny. The write.beast() function enables users to export the tree with external data to a single tree file.\n\nphylo &lt;- as.phylo(nhx)\n## save space for printing the tree text\nphylo$edge.length &lt;- round(phylo$edge.length, 2)\n\n## print the newick text\nwrite.tree(phylo)\n\n\nx &lt;- \"(((Prayidae_D27SS7@2825365:0.07,(Kephyes_ovata@2606431:0.02,\nChuniphyes_multidentata@1277217:0.01):0.02):0.06,((Apolemia_sp_@1353964:0.12,\n(((Bargmannia_amoena@263997:0.01,Bargmannia_elongata@946788:0.01):0.09,\nPhysonect_sp_@2066767:0.08):0.03,(Stephalia_dilata@2960089:0.08,\n((Frillagalma_vityazi@1155031:0.09,Resomia_ornicephala@3111757:0):0,\n((Lychnagalma_utricularia@2253871:0.12,Nanomia_bijuga@717864:0.13):0,\nCordagalma_sp_@1525873:0.07):0):0.03):0):0.04):0,Rhizophysa_filiformis@3073669:\n0.22):0.03):0.19,(Hydra_magnipapillata@52244:0.06,\nEctopleura_larynx@3556167:0.33):0.19);\"\n\nwriteLines(x)\n\nNA (((Prayidae_D27SS7@2825365:0.07,(Kephyes_ovata@2606431:0.02,\nNA Chuniphyes_multidentata@1277217:0.01):0.02):0.06,((Apolemia_sp_@1353964:0.12,\nNA (((Bargmannia_amoena@263997:0.01,Bargmannia_elongata@946788:0.01):0.09,\nNA Physonect_sp_@2066767:0.08):0.03,(Stephalia_dilata@2960089:0.08,\nNA ((Frillagalma_vityazi@1155031:0.09,Resomia_ornicephala@3111757:0):0,\nNA ((Lychnagalma_utricularia@2253871:0.12,Nanomia_bijuga@717864:0.13):0,\nNA Cordagalma_sp_@1525873:0.07):0):0.03):0):0.04):0,Rhizophysa_filiformis@3073669:\nNA 0.22):0.03):0.19,(Hydra_magnipapillata@52244:0.06,\nNA Ectopleura_larynx@3556167:0.33):0.19);\n\n\n\nlibrary(tidytree)\n\ntidytree v0.4.7 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nL Zhan, X Luo, W Xie, XA Zhu, Z Xie, J Lin, L Li, W Tang, R Wang, L\nDeng, Y Liao, B Liu, Y Cai, Q Wang, S Xu, G Yu. shinyTempSignal: an R\nshiny application for exploring temporal and other phylogenetic\nsignals. Journal of Genetics and Genomics 2024, 51(7):762-768. doi:\n10.1016/j.jgg.2024.02.004\n\n\n\nAttaching package: 'tidytree'\n\n\nThe following object is masked from 'package:treeio':\n\n    getNodeNum\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\nN &lt;- Nnode2(phylo)\nfake_data &lt;- tibble(node = 1:N, fake_trait = round(rnorm(N), 2), \n                    another_trait = round(runif(N), 2))\nfake_tree &lt;- full_join(phylo, fake_data, by = \"node\")\n# write.beast(fake_tree)\n\n## to save space, use a subtree\nfake_tree2 = tree_subset(fake_tree, node=27, levels_back=0)\nwrite.beast(fake_tree2)\n\n#NEXUS\n[R-package treeio, Sat Jan 10 10:16:21 2026]\n\nBEGIN TAXA;\n    DIMENSIONS NTAX = 5;\n    TAXLABELS\n        Frillagalma_vityazi@1155031\n        Resomia_ornicephala@3111757\n        Lychnagalma_utricularia@2253871\n        Nanomia_bijuga@717864\n        Cordagalma_sp_@1525873\n    ;\nEND;\nBEGIN TREES;\n    TRANSLATE\n        1   Frillagalma_vityazi@1155031,\n        2   Resomia_ornicephala@3111757,\n        3   Lychnagalma_utricularia@2253871,\n        4   Nanomia_bijuga@717864,\n        5   Cordagalma_sp_@1525873\n    ;\n    TREE * UNTITLED = [&R] ((1[&fake_trait=0.08,another_trait=0.41]:0.09,2[&fake_trait=-1.58,another_trait=0.15]:0)[&fake_trait=0.03,another_trait=0.34]:0,(5[&fake_trait=-1.43,another_trait=0.17]:0.07,(3[&fake_trait=-1.15,another_trait=0.33]:0.12,4[&fake_trait=0.73,another_trait=0.8]:0.13)[&fake_trait=-0.9,another_trait=0.38]:0)[&fake_trait=0.37,another_trait=0.54]:0):0.29;\nEND;\n\n\n\nx &lt;- \"#NEXUS\n[R-package treeio, Tue Nov 16 10:13:32 2021]\n\nBEGIN TAXA;\n    DIMENSIONS NTAX = 5;\n    TAXLABELS\n        Frillagalma_vityazi@1155031\n        Resomia_ornicephala@3111757\n        Lychnagalma_utricularia@2253871\n        Nanomia_bijuga@717864\n        Cordagalma_sp_@1525873\n    ;\nEND;\nBEGIN TREES;\n    TRANSLATE\n        1   Frillagalma_vityazi@1155031,\n        2   Resomia_ornicephala@3111757,\n        3   Lychnagalma_utricularia@2253871,\n        4   Nanomia_bijuga@717864,\n        5   Cordagalma_sp_@1525873\n    ;\n    TREE * UNTITLED = [&R] ((1[&fake_trait=-1.42,another_trait=0.17]:0.09,\n2[&fake_trait=0.19,another_trait=0.04]:0)[&fake_trait=0.85,\nanother_trait=0.56]:0,(5[&fake_trait=0.22,another_trait=0.73]:0.07,\n(3[&fake_trait=0.02,another_trait=0.29]:0.12,4[&fake_trait=-1.29,\nanother_trait=0.35]:0.13)[&fake_trait=-0.33,another_trait=0.88]:0)\n[&fake_trait=0.27,another_trait=0.94]:0):0.29;\nEND;\"\n\nwriteLines(x)\n\nNA #NEXUS\nNA [R-package treeio, Tue Nov 16 10:13:32 2021]\nNA \nNA BEGIN TAXA;\nNA  DIMENSIONS NTAX = 5;\nNA  TAXLABELS\nNA      Frillagalma_vityazi@1155031\nNA      Resomia_ornicephala@3111757\nNA      Lychnagalma_utricularia@2253871\nNA      Nanomia_bijuga@717864\nNA      Cordagalma_sp_@1525873\nNA  ;\nNA END;\nNA BEGIN TREES;\nNA  TRANSLATE\nNA      1   Frillagalma_vityazi@1155031,\nNA      2   Resomia_ornicephala@3111757,\nNA      3   Lychnagalma_utricularia@2253871,\nNA      4   Nanomia_bijuga@717864,\nNA      5   Cordagalma_sp_@1525873\nNA  ;\nNA  TREE * UNTITLED = [&R] ((1[&fake_trait=-1.42,another_trait=0.17]:0.09,\nNA 2[&fake_trait=0.19,another_trait=0.04]:0)[&fake_trait=0.85,\nNA another_trait=0.56]:0,(5[&fake_trait=0.22,another_trait=0.73]:0.07,\nNA (3[&fake_trait=0.02,another_trait=0.29]:0.12,4[&fake_trait=-1.29,\nNA another_trait=0.35]:0.13)[&fake_trait=-0.33,another_trait=0.88]:0)\nNA [&fake_trait=0.27,another_trait=0.94]:0):0.29;\nNA END;\n\n\nAfter merging, the fake_trait and another_trait stored in fake_data will be linked to the tree, phylo, and stored in the treedata object, the fake_tree. The write.beast() function exports the tree with associated data to a single BEAST format file. The associated data can be used to visualize the tree using ggtree (Figure ?fig-beast) or FigTree (Figure ?fig-beastFigtree).\n\n\n3.2.3 Merging tree data from different sources\nNot only Newick tree text can be combined with associated data, but also tree data obtained from software output can be combined with external data, as well as different tree objects can be merged (for details, see Chapter 2).\n\n## combine tree object with data\ntree_with_data &lt;- full_join(nhx, fake_data, by = \"node\")\ntree_with_data\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/treeio/extdata/NHX/phyldog.nhx'.\n\n...@ phylo:\n\nPhylogenetic tree with 16 tips and 15 internal nodes.\n\nTip labels:\n  Prayidae_D27SS7@2825365, Kephyes_ovata@2606431,\nChuniphyes_multidentata@1277217, Apolemia_sp_@1353964,\nBargmannia_amoena@263997, Bargmannia_elongata@946788, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'V1', 'Ev', 'ND', 'S', 'fake_trait', 'another_trait'.\n\n## merge two tree object\ntree2 &lt;- merge_tree(nhx, fake_tree)\nidentical(tree_with_data, tree2)\n\n[1] FALSE\n\n\nAfter merging data from different sources, the tree with the associated data can be exported into a single file.\n\noutfile &lt;- tempfile(fileext = \".tree\")\nwrite.beast(tree2, file = outfile)\n\nThe output BEAST Nexus file can be imported into R using the read.beast function and all the associated data can be used to annotate the tree using ggtree (Yu et al., 2017).\n\nread.beast(outfile)\n\n'treedata' S4 object that stored information\nof\n    '/tmp/RtmpCigIsC/file117d52ff17868.tree'.\n\n...@ phylo:\n\nPhylogenetic tree with 16 tips and 15 internal nodes.\n\nTip labels:\n  Prayidae_D27SS7@2825365, Kephyes_ovata@2606431,\nChuniphyes_multidentata@1277217, Apolemia_sp_@1353964,\nBargmannia_amoena@263997, Bargmannia_elongata@946788, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'another_trait', 'Ev', 'fake_trait', 'ND', 'S'.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Exporting tree with data</span>"
    ]
  },
  {
    "objectID": "03_treeio_exporting_tree.html#sec-write-jtree",
    "href": "03_treeio_exporting_tree.html#sec-write-jtree",
    "title": "3  Exporting tree with data",
    "section": "3.3 Exporting Tree Data to the jtree Format",
    "text": "3.3 Exporting Tree Data to the jtree Format\nThe treeio package (Wang et al., 2020) provides the write.beast() function to export treedata to BEAST Nexus file. This is quite useful to convert file format, combine tree with data and merge tree data from different sources as we demonstrated in the previous session. The treeio package also supplies the read.beast() function to parse the output file of the write.beast() function. Although with treeio, the R community has the ability to manipulate BEAST Nexus format and process tree data, there is still a lacking library/package for parsing BEAST files in other programming languages.\nJSON (JavaScript Object Notation) is a lightweight data-interchange format and is widely supported in almost all modern programming languages. To make it easy to import a tree with data in other programming languages, treeio supports exporting a tree with data in the jtree format, which is JSON-based and can be easy to parse using any language that supports JSON.\n\n# write.jtree(tree2)\n\n# to save space, use a subtree\ntree3 &lt;- tree_subset(tree2, node=24, levels_back=0) \nwrite.jtree(tree3)\n\n\n\nNA {\nNA  \"tree\": \"(Physonect_sp_@2066767:0.077429{3},(Bargmannia_amoena@263997:0.0144549\nNA {1},Bargmannia_elongata@946788:0.0149723{2}):0.0925388{5}):0.28549{4};\",\nNA  \"data\":[\nNA   {\nNA     \"edge_num\": 1,\nNA     \"Ev\": \"S\",\nNA     \"ND\": 10,\nNA     \"S\": 37,\nNA     \"fake_trait\": -0.69,\nNA     \"another_trait\": 0.42\nNA   },\nNA   {\nNA     \"edge_num\": 2,\nNA     \"Ev\": \"S\",\nNA     \"ND\": 11,\nNA     \"S\": 38,\nNA     \"fake_trait\": -0.95,\nNA     \"another_trait\": 0.38\nNA   },\nNA   {\nNA     \"edge_num\": 3,\nNA     \"Ev\": \"S\",\nNA     \"ND\": 13,\nNA     \"S\": 61,\nNA     \"fake_trait\": 0.59,\nNA     \"another_trait\": 0.65\nNA   },\nNA   {\nNA     \"edge_num\": 4,\nNA     \"Ev\": \"S\",\nNA     \"ND\": 14,\nNA     \"S\": 24,\nNA     \"fake_trait\": -0.69,\nNA     \"another_trait\": 0.06\nNA   },\nNA   {\nNA     \"edge_num\": 5,\nNA     \"Ev\": \"S\",\nNA     \"ND\": 12,\nNA     \"S\": 33,\nNA     \"fake_trait\": -0.58,\nNA     \"another_trait\": 0.4\nNA   }\nNA ],\nNA  \"metadata\": {\"info\": \"R-package treeio\", \"data\": \"Tue Nov 16 10:21:20 2021\"}\nNA }\n\n\nThe jtree format is based on JSON and can be parsed using JSON parser.\n\njtree_file &lt;- tempfile(fileext = '.jtree')\nwrite.jtree(tree3, file = jtree_file)\njsonlite::fromJSON(jtree_file)\n\n\n\nNA $tree\nNA [1] \"(Physonect_sp_@2066767:0.077429{3},(Bargmannia_amoena@263997:0.0144549{1},\nNA Bargmannia_elongata@946788:0.0149723{2}):0.0925388{5}):0.28549{4};\"\nNA \nNA $data\nNA   edge_num Ev ND  S fake_trait another_trait\nNA 1        1  S 10 37      -0.69          0.42\nNA 2        2  S 11 38      -0.95          0.38\nNA 3        3  S 13 61       0.59          0.65\nNA 4        4  S 14 24      -0.69          0.06\nNA 5        5  S 12 33      -0.58          0.40\nNA \nNA $metadata\nNA $metadata$info\nNA [1] \"R-package treeio\"\nNA \nNA $metadata$data\nNA [1] \"Tue Nov 16 10:24:34 2021\"\n\n\nThe jtree file can be directly imported as a treedata object using the read.jtree() function provided also in treeio package (see also session 1.3).\n\nread.jtree(jtree_file)\n\n'treedata' S4 object that stored information\nof\n    '/tmp/RtmpCigIsC/file117d52e3a8255.jtree'.\n\n...@ phylo:\n\nPhylogenetic tree with 3 tips and 2 internal nodes.\n\nTip labels:\n  Physonect_sp_@2066767, Bargmannia_amoena@263997, Bargmannia_elongata@946788\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'Ev', 'ND', 'S', 'fake_trait', 'another_trait'.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Exporting tree with data</span>"
    ]
  },
  {
    "objectID": "03_treeio_exporting_tree.html#sec-summary3",
    "href": "03_treeio_exporting_tree.html#sec-summary3",
    "title": "3  Exporting tree with data",
    "section": "3.4 Summary",
    "text": "3.4 Summary\nPhylogenetic tree-associated data is often stored in a separate file and needs the expertise to map the data to the tree structure. Lacking standardization to store and represent phylogeny and associated data makes it difficult for researchers to access and integrate the phylogenetic data into their studies. The treeio package provides functions to import phylogeny with associated data from several sources, including analysis findings from commonly used software and external data such as experimental data, clinical data, or meta-data. These trees and their associated data can be exported into a single file as BEAST or jtree formats, and the output file can be parsed back to R by treeio and the data is easy to access. The input and output utilities supplied by treeio package lay the foundation for phylogenetic data integration for downstream comparative study and visualization. It creates the possibility of integrating a tree with associated data from different sources and extends the applications of phylogenetic analysis in different disciplines.\n\n\n\n\nBouckaert, R., Heled, J., Kühnert, D., Vaughan, T., Wu, C.-H., Xie, D., Suchard, M. A., Rambaut, A., & Drummond, A. J. (2014). BEAST 2: A Software Platform for Bayesian Evolutionary Analysis. PLoS Comput Biol, 10(4), e1003537. https://doi.org/10.1371/journal.pcbi.1003537\n\n\nParadis, E., Claude, J., & Strimmer, K. (2004). APE: Analyses of Phylogenetics and Evolution in R language. Bioinformatics, 20(2), 289–290. https://doi.org/10.1093/bioinformatics/btg412\n\n\nVos, R. A., Balhoff, J. P., Caravas, J. A., Holder, M. T., Lapp, H., Maddison, W. P., Midford, P. E., Priyam, A., Sukumaran, J., Xia, X., & Stoltzfus, A. (2012). NeXML: Rich, extensible, and verifiable representation of comparative data and metadata. Systematic Biology, 61(4), 675–689. https://doi.org/10.1093/sysbio/sys025\n\n\nWang, L.-G., Lam, T. T.-Y., Xu, S., Dai, Z., Zhou, L., Feng, T., Guo, P., Dunn, C. W., Jones, B. R., Bradley, T., Zhu, H., Guan, Y., Jiang, Y., & Yu, G. (2020). Treeio: An r package for phylogenetic tree input and output with richly annotated and associated data. Molecular Biology and Evolution, 37(2), 599–603. https://doi.org/10.1093/molbev/msz240\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Exporting tree with data</span>"
    ]
  },
  {
    "objectID": "04_ggtree_visualization.html",
    "href": "04_ggtree_visualization.html",
    "title": "(PART*) Part II: Tree data visualization and annotation",
    "section": "",
    "text": "Phylogenetic Tree Visualization\nlibrary(\"ape\")\nlibrary(\"grid\")\nlibrary(\"ggplot2\")\nlibrary(\"cowplot\")\nlibrary(\"treeio\")\n\ntreeio v1.35.0 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nLG Wang, TTY Lam, S Xu, Z Dai, L Zhou, T Feng, P Guo, CW Dunn, BR\nJones, T Bradley, H Zhu, Y Guan, Y Jiang, G Yu. treeio: an R package\nfor phylogenetic tree input and output with richly annotated and\nassociated data. Molecular Biology and Evolution. 2020, 37(2):599-603.\ndoi: 10.1093/molbev/msz240\n\nlibrary(\"ggtree\")\n\nggtree v4.1.1.003 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nS Xu, Z Dai, P Guo, X Fu, S Liu, L Zhou, W Tang, T Feng, M Chen, L\nZhan, T Wu, E Hu, Y Jiang, X Bo, G Yu. ggtreeExtra: Compact\nvisualization of richly annotated phylogenetic data. Molecular Biology\nand Evolution. 2021, 38(9):4039-4042. doi: 10.1093/molbev/msab166\n\n\n\nAttaching package: 'ggtree'\n\n\nThe following object is masked from 'package:ape':\n\n    rotate\n\nsource(\"setup.R\")\n\n[conflicted] Will prefer ggtree::expand over any other package.\n\n\n[conflicted] Will prefer ggtree::rotate over any other package.\n[conflicted] Will prefer treeio::mask over any other package.\n[conflicted] Will prefer treeio::parent over any other package.\n[conflicted] Will prefer treeio::ancestor over any other package.\n[conflicted] Will prefer treeio::get.data over any other package.\n[conflicted] Will prefer treeio::drop.tip over any other package.\n[conflicted] Will prefer treeio::read.newick over any other package.\n[conflicted] Will prefer tidytree::MRCA over any other package.\n[conflicted] Will prefer dplyr::filter over any other package.\n[conflicted] Will prefer dplyr::rename over any other package.\n[conflicted] Will prefer dplyr::collapse over any other package.\n[conflicted] Will prefer dplyr::intersect over any other package.\n[conflicted] Will prefer dplyr::union over any other package.\n[conflicted] Will prefer dplyr::slice over any other package.\n[conflicted] Will prefer base::strsplit over any other package.\n[conflicted] Will prefer base::paste over any other package.\n[conflicted] Will prefer ggplot2::geom_errorbarh over any other package.\n[conflicted] Will prefer MicrobiotaProcess::tax_table over any other package.\n[conflicted] Will prefer BiocGenerics::as.data.frame over any other package.\n[conflicted] Will prefer base::setdiff over any other package.\n\nsource(\"software-link.R\")",
    "crumbs": [
      "(PART\\*) Part II: Tree data visualization and annotation"
    ]
  },
  {
    "objectID": "04_ggtree_visualization.html#introduction",
    "href": "04_ggtree_visualization.html#introduction",
    "title": "(PART*) Part II: Tree data visualization and annotation",
    "section": "Introduction",
    "text": "Introduction\nThere are many software packages and web tools that are designed for displaying phylogenetic trees, such as TreeView (Page, 2002), FigTree, TreeDyn (Chevenet et al., 2006), Dendroscope (Huson & Scornavacca, 2012), EvolView (He et al., 2016), and iTOL (Letunic & Bork, 2007), etc. Only a few of them, such as FigTree, TreeDyn and iTOL, allow users to annotate the trees with colored branches, highlighted clades with tree features. However, their pre-defined annotating functions are usually limited to some specific phylogenetic data. As phylogenetic trees are becoming more widely used in multidisciplinary studies, there is an increasing need to incorporate various types of phylogenetic covariates and other associated data from different sources into the trees for visualizations and further analyses. For instance, the influenza virus has a wide host range, diverse and dynamic genotypes, and characteristic transmission behaviors that are mostly associated with the virus’s evolution and essentially among themselves. Therefore, in addition to standalone applications that focus on each of the specific analysis and data types, researchers studying molecular evolution need a robust and programmable platform that allows the high levels of integration and visualization of many of these different aspects of data (raw or from other primary analyses) over the phylogenetic trees to identify their associations and patterns.\nTo fill this gap, we developed ggtree (Yu et al., 2017), a package for the R programming language (R Core Team, 2016) released under the Bioconductor project (Gentleman et al., 2004). The ggtree is built to work with treedata objects (see Chapters 1 and 9), and display tree graphics with the ggplot2 package (Wickham, 2016) that was based on the grammar of graphics (Wilkinson et al., 2005).\nThe R language is increasingly used in phylogenetics. However, a comprehensive package, designed for viewing and annotating phylogenetic trees, particularly with complex data integration, is not yet available. Most of the R packages in phylogenetics focus on specific statistical analyses rather than viewing and annotating the trees with more generalized phylogeny-associated data. Some packages, including ape (Paradis et al., 2004) and phytools (Revell, 2012), which are capable of displaying and annotating trees, are developed using the base graphics system of R. In particular, ape is one of the fundamental packages for phylogenetic analysis and data processing. However, the base graphics system is relatively difficult to extend and limits the complexity of the tree figure to be displayed. OutbreakTools (Jombart et al., 2014) and phyloseq (McMurdie & Holmes, 2013) extended ggplot2 to plot phylogenetic trees. The ggplot2 system of graphics allows rapid customization and exploration of design solutions. However, these packages were designed for epidemiology and microbiome data respectively and did not aim to provide a general solution for tree visualization and annotation. The ggtree package also inherits versatile properties of ggplot2, and more importantly allows constructing complex tree figures by freely combining multiple layers of annotations (see also Chapter 5) using the tree associated data imported from different sources (see detailed in Chapter 1 and (Wang et al., 2020)).",
    "crumbs": [
      "(PART\\*) Part II: Tree data visualization and annotation"
    ]
  },
  {
    "objectID": "04_ggtree_visualization.html#visualizing-phylogenetic-tree-with-ggtree",
    "href": "04_ggtree_visualization.html#visualizing-phylogenetic-tree-with-ggtree",
    "title": "(PART*) Part II: Tree data visualization and annotation",
    "section": "Visualizing Phylogenetic Tree with ggtree",
    "text": "Visualizing Phylogenetic Tree with ggtree\nThe ggtree package (Yu et al., 2017) is designed for annotating phylogenetic trees with their associated data of different types and from various sources. These data could come from users or analysis programs and might include evolutionary rates, ancestral sequences, etc. that are associated with the taxa from real samples, or with the internal nodes representing hypothetic ancestor strain/species, or with the tree branches indicating evolutionary time courses (Wang et al., 2020). For instance, the data could be the geographic positions of the sampled avian influenza viruses (informed by the survey locations) and the ancestral nodes (by phylogeographic inference) in the viral gene tree (Lam et al., 2012).\nThe ggtree supports ggplot2’s graphical language, which allows a high level of customization, is intuitive and flexible. Notably, ggplot2 itself does not provide low-level geometric objects or other support for tree-like structures, and hence ggtree is a useful extension in that regard. Even though the other two phylogenetics-related R packages, OutbreakTools, and phyloseq, are developed based on ggplot2, the most valuable part of the ggplot2 syntax - adding layers of annotations - is not supported in these packages. For example, if we have plotted a tree without taxa labels, OutbreakTools and phyloseq provide no easy way for general R users, who have little knowledge about the infrastructures of these packages, to add a layer of taxa labels. The ggtree extends ggplot2 to support tree objects by implementing a geometric layer, geom_tree(), to support visualizing tree structure. In ggtree, viewing a phylogenetic tree is relatively easy, via the command ggplot(tree_object) + geom_tree() + theme_tree() or ggtree(tree_object) for short. Layers of annotations can be added one-by-one via the + operator. To facilitate tree visualization, ggtree provides several geometric layers, including geom_treescale() for adding legend of tree branch scale (genetic distance, divergence time, etc.), geom_range() for displaying uncertainty of branch lengths (confidence interval or range, etc.), geom_tiplab() for adding taxa label, geom_tippoint() and geom_nodepoint() for adding symbols of tips and internal nodes, geom_hilight() for highlighting clades with rectangle, and geom_cladelab() for annotating selected clades with bar and text label, etc.. A full list of geometric layers provided by ggtree is summarized in Table ?tbl-geoms.\nTo view a phylogenetic tree, we first need to parse the tree file into R. The treeio package is able to parse diverse annotation data from different software outputs into S4 phylogenetic data objects (see also Chapter 1). The ggtree package mainly utilizes these S4 objects to display and annotate the tree. Other R packages defined S3/S4 classes to store phylogenetic trees with domain-specific associated data, including phylo4 and phylo4d defined in the phylobase package, obkdata defined in the OutbreakTools package, and phyloseq defined in the phyloseq package, etc. All these tree objects are also supported in ggtree and their specific annotation data can be used to annotate the tree directly in ggtree (see also Chapter 9). Such compatibility of ggtree facilitates the integration of data and analysis results. In addition, ggtree also supports other tree-like structures, including dendrogram and tree graphs.\n\nBasic Tree Visualization\nThe ggtree package extends ggplot2 (Wickham, 2016) package to support viewing a phylogenetic tree. It implements geom_tree() layer for displaying a phylogenetic tree, as shown below in Figure ?fig-basicvizA.\n\nlibrary(\"treeio\")\nlibrary(\"ggtree\")\n\nnwk &lt;- system.file(\"extdata\", \"sample.nwk\", package=\"treeio\")\ntree &lt;- read.tree(nwk)\n\nggplot(tree, aes(x, y)) + geom_tree() + theme_tree()\n\nThe function, ggtree(), was implemented as a shortcut to visualize a tree, and it works exactly the same as shown above.\nThe ggtree package takes all the advantages of ggplot2. For example, we can change the color, size, and type of the lines as we do with ggplot2 (Figure ?fig-basicvizB).\n\nggtree(tree, color=\"firebrick\", size=2, linetype=\"dotted\")\n\nBy default, the tree is viewed in ladderize form, user can set the parameter ladderize = FALSE to disable it (Figure ?fig-basicvizC, see also FAQ A.5).\n\nggtree(tree, ladderize=FALSE)\n\nThe branch.length is used to scale the edge, user can set the parameter branch.length = \"none\" to only view the tree topology (cladogram, Figure ?fig-basicvizD) or other numerical variables to scale the tree (e.g., dN/dS, see also in Chapter 5).\n\nggtree(tree, branch.length=\"none\")\n\n\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the ggtree package.\n  Please report the issue at &lt;https://github.com/YuLab-SMU/ggtree/issues&gt;.\n\n\n\n\n\nBasic tree visualization. Default ggtree output with ladderized effect (A), non-variable setting (e.g., color, size, line type) (B), non-ladderized tree (C), cladogram that only displays tree topology without branch length information (D).\n\n\n\n\n\n\nLayouts of a phylogenetic tree\nViewing phylogenetic with ggtree is quite simple, just pass the tree object to the ggtree() function. We have developed several types of layouts for tree presentation (Figure ?fig-layout), including rectangular (by default), roundrect (rounded rectangular), ellipse, slanted, circular, fan, unrooted (equal angle and daylight methods), time-scaled, and two-dimensional layouts.\nHere are examples of visualizing a tree with different layouts:\n\nlibrary(ggtree)\nset.seed(2017-02-16)\ntree &lt;- rtree(50)\nggtree(tree)\n\n\n\n\n\n\n\nggtree(tree, layout=\"roundrect\")\n\n\n\n\n\n\n\nggtree(tree, layout=\"slanted\")\n\n\n\n\n\n\n\nggtree(tree, layout=\"ellipse\")\n\n\n\n\n\n\n\nggtree(tree, layout=\"circular\")\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\nggtree(tree, layout=\"fan\", open.angle=120)\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\nggtree(tree, layout=\"equal_angle\")\n\n\n\n\n\n\n\nggtree(tree, layout=\"daylight\")\n\nAverage angle change [1] 0.12473570813738\nAverage angle change [2] 0.0378727344045303\n\n\n\n\n\n\n\n\nggtree(tree, branch.length='none')\n\n\n\n\n\n\n\nggtree(tree, layout=\"ellipse\", branch.length=\"none\")\n\n\n\n\n\n\n\nggtree(tree, branch.length='none', layout='circular')\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\nggtree(tree, layout=\"daylight\", branch.length = 'none')\n\nAverage angle change [1] 0.100250933841619\nAverage angle change [2] 0.029681180299634\n\n\n\n\n\n\n\n\n\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nTree layouts. Phylogram: rectangular layout (A), rounded rectangular layout (B), slanted layout (C), ellipse layout (D), circular layout (E), and fan layout (F). Unrooted: equal-angle method (G) and daylight method (H). Cladogram: rectangular layout (I), ellipse (J), circular layout (K), and unrooted layout (L). Slanted and fan layouts for cladogram are also supported.\n\n\n\n\nOther possible layouts that can be drawn by modifying scales/coordination (Figure ?fig-layout2).\n\n\nggtree(tree) + scale_x_reverse()\n\n\n\n\n\n\n\nggtree(tree) + coord_flip()\n\n\n\n\n\n\n\nggtree(tree) + layout_dendrogram()\n\n\n\n\n\n\n\nggplotify::as.ggplot(ggtree(tree), angle=-30, scale=.9)\n\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\nWarning in grid.Call.graphics(C_setviewport, vp, TRUE): cannot clip to rotated\nviewport\n\n\n\n\n\n\n\n\nggtree(tree, layout='slanted') + coord_flip()\n\n\n\n\n\n\n\nggtree(tree, layout='slanted', branch.length='none') + layout_dendrogram()\n\n\n\n\n\n\n\nggtree(tree, layout='circular') + xlim(-10, NA)\n\nWarning: Unknown or uninitialised column: `subgroup`.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\nggtree(tree) + layout_inward_circular()\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\nggtree(tree) + layout_inward_circular(xlim=15)\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDerived Tree layouts. right-to-left rectangular layout (A), bottom-up rectangular layout (B), top-down rectangular layout (Dendrogram) (C), rotated rectangular layout (D), bottom-up slanted layout (E), top-down slanted layout (Cladogram) (F), circular layout (G), circular inward layout (H and I).\n\n\n\n\nPhylogram. Layouts of rectangular, roundrect, slanted, ellipse, circular, and fan are supported to visualize phylogram (by default, with branch length scaled) as demonstrated in Figures ?fig-layoutA-F.\nUnrooted layout. Unrooted (also called ‘radial’) layout is supported by equal-angle and daylight algorithms; users can specify unrooted layout algorithm by passing “equal_angle” or “daylight” to layout parameter to visualize the tree. The equal-angle method was proposed by Christopher Meacham in PLOTREE, which was incorporated in PHYLIP (Retief, 2000). This method starts from the root of the tree and allocates arcs of angle to each subtree proportional to the number of tips in it. It iterates from root to tips and subdivides the angle allocated to a subtree into angles for its dependent subtrees. This method is fast and was implemented in many software packages. As shown in Figure ?fig-layoutG, the equal angle method has a drawback that tips tend to be clustered together, which will leave many spaces unused. The daylight method starts from an initial tree built by equal angle and iteratively improves it by successively going to each interior node and swinging subtrees so that the arcs of “daylight” are equal (Figure ?fig-layoutH). This method was firstly implemented in PAUP* (Wilgenbusch & Swofford, 2003).\nCladogram. To visualize a cladogram that is without branch length scaling and only displays the tree structure, branch.length is set to “none” and it works for all types of layouts (Figures ?fig-layoutI-L).\nTimescaled layout. For a timescaled tree, the most recent sampling date must be specified via the mrsd parameter, and ggtree() will scale the tree by sampling (tip) and divergence (internal node) time, and a timescale axis will be displayed under the tree by default. Users can use the deeptime package to add geologic timescale (e.g., periods and eras) to a ggtree() plot.\n\nbeast_file &lt;- system.file(\"examples/MCC_FluA_H3.tree\", \n                          package=\"ggtree\")\nbeast_tree &lt;- read.beast(beast_file)\nggtree(beast_tree, mrsd=\"2013-01-01\") + theme_tree2()\n\n\n\n\nTimescaled layout. The x-axis is the timescale (in units of the year). The divergence time in this example was inferred by r pkg_beast using the molecular clock model.\n\n\n\n\nTwo-dimensional tree layout. A two-dimensional tree is a projection of the phylogenetic tree in a space defined by the associated phenotype (numerical or categorical trait, on the y-axis) and tree branch scale (e.g., evolutionary distance, divergent time, on the x-axis). The phenotype can be a measure of certain biological characteristics of the taxa and hypothetical ancestors in the tree. This layout is useful to track the virus phenotypes or other behaviors (y-axis) changing with the virus evolution (x-axis). In fact, the analysis of phenotypes or genotypes over evolutionary time have been widely used for study of influenza virus evolution (Neher et al., 2016), though such analysis diagrams are not tree-like, i.e., no connection between data points, unlike our two-dimensional tree layout that connects data points with the corresponding tree branches. Therefore, this new layout we provided will make such data analysis easier and more scalable for large sequence datasets.\nIn this example, we used the previous timescaled tree of H3 human and swine influenza viruses (Figure ?fig-timescaled; data published in (Liang et al., 2014)) and scaled the y-axis based on the predicted N-linked glycosylation sites (NLG) for each of the taxon and ancestral sequences of hemagglutinin proteins. The NLG sites were predicted using the NetNGlyc 1.0 Server. To scale the y-axis, the parameter yscale in the ggtree() function is set to a numerical or categorical variable. If yscale is a categorical variable as in this example, users should specify how the categories are to be mapped to numerical values via the yscale_mapping variables.\n\nNAG_file &lt;- system.file(\"examples/NAG_inHA1.txt\", package=\"ggtree\")\n\nNAG.df &lt;- read.table(NAG_file, sep=\"\\t\", header=FALSE, \n                     stringsAsFactors = FALSE)\nNAG &lt;- NAG.df[,2]\nnames(NAG) &lt;- NAG.df[,1]\n\n## separate the tree by host species\ntip &lt;- as.phylo(beast_tree)$tip.label\nbeast_tree &lt;- groupOTU(beast_tree, tip[grep(\"Swine\", tip)], \n                       group_name = \"host\")\n\np &lt;- ggtree(beast_tree, aes(color=host), mrsd=\"2013-01-01\", \n            yscale = \"label\", yscale_mapping = NAG) + \n  theme_classic() + theme(legend.position='none') +\n  scale_color_manual(values=c(\"blue\", \"red\"), \n                     labels=c(\"human\", \"swine\")) +\n  ylab(\"Number of predicted N-linked glycosylation sites\")\n\n## (optional) add more annotations to help interpretation\np + geom_nodepoint(color=\"grey\", size=3, alpha=.8) +\n  geom_rootpoint(color=\"black\", size=3) +\n  geom_tippoint(size=3, alpha=.5) + \n  annotate(\"point\", 1992, 5.6, size=3, color=\"black\") +\n  annotate(\"point\", 1992, 5.4, size=3, color=\"grey\") +\n  annotate(\"point\", 1991.6, 5.2, size=3, color=\"blue\") +\n  annotate(\"point\", 1992, 5.2, size=3, color=\"red\") + \n  annotate(\"text\", 1992.3, 5.6, hjust=0, size=4, label=\"Root node\") +\n  annotate(\"text\", 1992.3, 5.4, hjust=0, size=4, \n           label=\"Internal nodes\") +\n  annotate(\"text\", 1992.3, 5.2, hjust=0, size=4,\n           label=\"Tip nodes (blue: human; red: swine)\")\n\n\n\n\nTwo-dimensional tree layout. The trunk and other branches are highlighted in red (for swine) and blue (for humans). The x-axis is scaled to the branch length (in units of year) of the timescaled tree. The y-axis is scaled to the node attribute variable, in this case, the number of predicted N-linked glycosylation sites (NLG) on the hemagglutinin protein. Colored circles indicate the different types of tree nodes. Note that nodes assigned the same x- (temporal) and y- (NLG) coordinates are superimposed in this representation and appear as one node, which is shaded based on the colors of all the nodes at that point.\n\n\n\n\nAs shown in Figure ?fig-2d, a two-dimensional tree is good at visualizing the change of phenotype over the evolution in the phylogenetic tree. In this example, it is shown that the H3 gene of the human influenza A virus maintained a high level of N-linked glycosylation sites (n=8 to 9) over the last two decades and dropped significantly to 5 or 6 in a separate viral lineage transmitted to swine populations and established there. It was indeed hypothesized that the human influenza virus with a high level of glycosylation on the viral hemagglutinin protein provides a better shielding effect to protect the antigenic sites from exposure to the herd immunity, and thus has a selective advantage in human populations that maintain a high level of herd immunity against the circulating human influenza virus strains. For the viral lineage that newly jumped across the species barrier and transmitted to the swine population, the shielding effect of the high-level surface glycan oppositely imposes selective disadvantage because the receptor-binding domain may also be shielded which greatly affects the viral fitness of the lineage that newly adapted to a new host species. Another example of a two-dimensional tree can be found in Figure ?fig-phenogram.",
    "crumbs": [
      "(PART\\*) Part II: Tree data visualization and annotation"
    ]
  },
  {
    "objectID": "04_ggtree_visualization.html#displaying-tree-components",
    "href": "04_ggtree_visualization.html#displaying-tree-components",
    "title": "(PART*) Part II: Tree data visualization and annotation",
    "section": "Displaying Tree Components",
    "text": "Displaying Tree Components\n\nDisplaying treescale (evolution distance)\nTo show treescale, the user can use geom_treescale() layer (Figures ?fig-treescaleA-C).\n\nggtree(tree) + geom_treescale()\n\ngeom_treescale() supports the following parameters:\n\nx and y for treescale position\nwidth for the length of the treescale\nfontsize for the size of the text\nlinesize for the size of the line\noffset for relative position of the line and the text\ncolor for color of the treescale\n\n\nggtree(tree) + geom_treescale(x=0, y=45, width=1, color='red')\n\n\n\n\n\n\n\nggtree(tree) + geom_treescale(fontsize=6, linesize=2, offset=1)\n\n\n\n\n\n\n\n\nWe can also use theme_tree2() to display the treescale by adding x axis (Figure ?fig-treescaleD).\n\nggtree(tree) + theme_tree2()\n\n\n\n\n\n\nDisplay treescale. geom_treescale() automatically add a scale bar for evolutionary distance (A). Users can modify the color, width, and position of the scale (B) as well as the size of the scale bar and text and their relative position (C). Another possible solution is to enable the x-axis which is useful for the timescaled tree (D).\n\n\n\n\nTreescale is not restricted to evolution distance, treeio can rescale the tree with other numerical variables (details described in session 2.4), and ggtree allows users to specify a numerical variable to serve as branch length for visualization (details described in session 4.3).\n\n\nDisplaying nodes/tips\nShowing all the internal nodes and tips in the tree can be done by adding a layer of points using geom_nodepoint(), geom_tippoint(), or geom_point() (Figure ?fig-nodeTip).\n\nggtree(tree) + \n    geom_point(aes(shape=isTip, color=isTip), size=3)\n\np &lt;- ggtree(tree) + \n    geom_nodepoint(color=\"#b5e521\", alpha=1/4, size=10) \np + geom_tippoint(color=\"#FDAC4F\", shape=8, size=3)\n\n\n\n\n\n\nDisplay external and internal nodes. geom_point() automatically add symbolic points of all nodes (A). geom_nodepoint() adds symbolic points for internal nodes and geom_tippoint() adds symbolic points for external nodes (B).\n\n\n\n\n\n\nDisplaying labels\nUsers can use geom_text() or geom_label() to display the node (if available) and tip labels simultaneously or geom_tiplab() to only display tip labels (Figure ?fig-tiplabA).\n\np + geom_tiplab(size=3, color=\"purple\")\n\nThe geom_tiplab() layer not only supports using text or label geom to display labels, but it also supports image geom to label tip with image files (see Chapter 7). A corresponding geom, geom_nodelab() is also provided for displaying node labels.\nFor circular and unrooted layouts, ggtree supports rotating node labels according to the angles of the branches (Figure ?fig-tiplabB).\n\nggtree(tree, layout=\"circular\") + geom_tiplab(aes(angle=angle), color='blue')\n\nFor long tip labels, the label may be truncated. There are several ways to solve this issue (see FAQ: Tip label truncated). Another solution to solve this issue is to display tip labels as y-axis labels (Figure ?fig-tiplabC). However, it only works for rectangular and dendrogram layouts and users need to use theme() to adjust tip labels in this case.\n\nggtree(tree) + geom_tiplab(as_ylab=TRUE, color='firebrick')\n\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\n\n\n\nDisplay tip labels. geom_tiplab() supports displaying tip labels (A). For the circular, fan, or unrooted tree layouts, the labels can be rotated to fit the angle of the branches (B). For dendrogram/rectangular layout, tip labels can be displayed as y-axis labels (C).\n\n\n\n\nBy default, the positions to display text are based on the node positions; we can change them to be based on the middle of the branch/edge (by setting aes(x = branch)), which is very useful when annotating transition from the parent node to the child node.\n\n\nDisplaying root-edge\nThe ggtree() doesn’t plot the root-edge by default. Users can use geom_rootedge() to automatically display the root-edge (Figure ?fig-rootedgeA). If there is no root edge information, geom_rootedge() will display nothing by default (Figure ?fig-rootedgeB). Users can set the root-edge to the tree (Figure ?fig-rootedgeC) or specify rootedge in geom_rootedge() (Figure ?fig-rootedgeD). A long root length is useful to increase readability of the circular tree (see also FAQ: Enlarge center space).\n\n## with root-edge = 1\ntree1 &lt;- read.tree(text='((A:1,B:2):3,C:2):1;')\nggtree(tree1) + geom_tiplab() + geom_rootedge()\n\n\n\n\n\n\n\n## without root-edge\ntree2 &lt;- read.tree(text='((A:1,B:2):3,C:2);')\nggtree(tree2) + geom_tiplab() + geom_rootedge()\n\n\n\n\n\n\n\n## setting root-edge\ntree2$root.edge &lt;- 2\nggtree(tree2) + geom_tiplab() + geom_rootedge()\n\n\n\n\n\n\n\n## specify the length of root edge for just plotting\n## this will ignore tree$root.edge\nggtree(tree2) + geom_tiplab() + geom_rootedge(rootedge = 3)\n\n\n\n\n\n\n\n\n\n\n\n\n\nDisplay root-edge. geom_rootedge() supports displaying root-edge if the root edge was presented (A). It shows nothing if there is no root-edge (B). In this case, users can manually set the root edge for the tree (C) or just specify the length of the root for plotting (D).\n\n\n\n\n\n\nColor tree\nIn ggtree (Yu et al., 2018), coloring phylogenetic tree is easy, by using aes(color=VAR) to map the color of the tree based on a specific variable (both numerical and categorical variables are supported, see Figure ?fig-colortree).\n\nggtree(beast_tree, aes(color=rate)) +\n    scale_color_continuous(low='darkgreen', high='red') +\n    theme(legend.position=\"right\")\n\n\n\n\nColor tree by continuous or discrete feature. Edges are colored by values associated with the child nodes.\n\n\n\n\nUsers can use any feature (if available), including clade posterior and dN/dS, etc., to scale the color of the tree. If the feature is a continuous numerical value, ggtree provides a continuous parameter to support plotting continuous state transition in edges. Here, we use an example1 to demonstrate this functionality (Figure ?fig-continuousColorA). If you want to add a thin black border in tree branches, you can place a tree with black and slightly thicker branches below your tree to emulate edge outlines as demonstrated in Figure ?fig-continuousColorB.\n\nlibrary(ggtree)\nlibrary(treeio)\nlibrary(tidytree)\nlibrary(ggplot2)\nlibrary(TDbook)\n## ref: http://www.phytools.org/eqg2015/asr.html\n##\n## load `tree_anole` and `df_svl` from 'TDbook'\nsvl &lt;- as.matrix(df_svl)[,1]\nfit &lt;- phytools::fastAnc(tree_anole, svl, vars=TRUE, CI=TRUE)\n\ntd &lt;- data.frame(node = nodeid(tree_anole, names(svl)),\n               trait = svl)\nnd &lt;- data.frame(node = names(fit$ace), trait = fit$ace)\n\nd &lt;- rbind(td, nd)\nd$node &lt;- as.numeric(d$node)\ntree &lt;- full_join(tree_anole, d, by = 'node')\n\np1 &lt;- ggtree(tree, aes(color=trait), layout = 'circular', \n        ladderize = FALSE, continuous = 'colour', size=2) +\n    scale_color_gradientn(colours=c(\"red\", 'orange', 'green', 'cyan', 'blue')) +\n    geom_tiplab(hjust = -.1) + \n    xlim(0, 1.2) + \n    theme(legend.position = c(.05, .85)) \n\np2 &lt;- ggtree(tree, layout='circular', ladderize = FALSE, size=2.8) + \n    geom_tree(aes(color=trait), continuous = 'colour', size=2) +  \n    scale_color_gradientn(colours=c(\"red\", 'orange', 'green', 'cyan', 'blue')) +\n    geom_tiplab(aes(color=trait), hjust = -.1) + \n    xlim(0, 1.2) + \n    theme(legend.position = c(.05, .85)) \n\nplot_list(p1, p2, ncol=2, tag_levels=\"A\")    \n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nContinuous state transition in edges. Edges are colored by the values from ancestral trait to offspring.\n\n\n\n\nBesides, we can use a two-dimensional tree (as demonstrated in Figure ?fig-2d) to visualize phenotype on the vertical dimension to create the phenogram Figure ?fig-phenogram. We can use the ggrepel package to repel tip labels to avoid overlapping as demonstrated in Figure ?fig-repelTip.\n\nggtree(tree, aes(color=trait), continuous = 'colour', yscale = \"trait\") + \n    scale_color_viridis_c() + theme_minimal()\n\n\n\n\nPhenogram. Projecting the tree into a space defined by time (or genetic distance) on the horizontal axis and phenotype on the vertical dimension.\n\n\n\n\n\n\nRescale tree\nMost of the phylogenetic trees are scaled by evolutionary distance (substitution/site). In ggtree, users can rescale a phylogenetic tree by any numerical variable inferred by evolutionary analysis (e.g., dN/dS).\nThis example displays a time tree (Figure ?fig-rescaleTreeA) and the branches were rescaled by substitution rate inferred by BEAST (Figure ?fig-rescaleTreeB).\n\nlibrary(\"treeio\")\nbeast_file &lt;- system.file(\"examples/MCC_FluA_H3.tree\", package=\"ggtree\")\nbeast_tree &lt;- read.beast(beast_file)\nbeast_tree\n\n'treedata' S4 object that stored information\nof\n    '/home/runner/work/_temp/Library/ggtree/examples/MCC_FluA_H3.tree'.\n\n...@ phylo:\n\nPhylogenetic tree with 76 tips and 75 internal nodes.\n\nTip labels:\n  A/Hokkaido/30-1-a/2013, A/New_York/334/2004, A/New_York/463/2005,\nA/New_York/452/1999, A/New_York/238/2005, A/New_York/523/1998, ...\n\nRooted; includes branch length(s).\n\nwith the following features available:\n  'height', 'height_0.95_HPD', 'height_median', 'height_range', 'length',\n'length_0.95_HPD', 'length_median', 'length_range', 'posterior', 'rate',\n'rate_0.95_HPD', 'rate_median', 'rate_range'.\n\n# The associated data tibble abstraction: 151 × 16\n# The 'node', 'label' and 'isTip' are from the phylo tree.\n    node label    isTip height height_0.95_HPD height_median height_range length\n   &lt;int&gt; &lt;chr&gt;    &lt;lgl&gt;  &lt;dbl&gt; &lt;list&gt;                  &lt;dbl&gt; &lt;list&gt;        &lt;dbl&gt;\n 1     1 A/Hokka… TRUE       0 &lt;lgl [1]&gt;                  NA &lt;lgl [1]&gt;     1.75 \n 2     2 A/New_Y… TRUE       9 &lt;dbl [2]&gt;                   9 &lt;dbl [2]&gt;     0.414\n 3     3 A/New_Y… TRUE       8 &lt;dbl [2]&gt;                   8 &lt;dbl [2]&gt;     1.22 \n 4     4 A/New_Y… TRUE      14 &lt;dbl [2]&gt;                  14 &lt;dbl [2]&gt;     1.48 \n 5     5 A/New_Y… TRUE       8 &lt;dbl [2]&gt;                   8 &lt;dbl [2]&gt;     0.835\n 6     6 A/New_Y… TRUE      15 &lt;dbl [2]&gt;                  15 &lt;dbl [2]&gt;     1.03 \n 7     7 A/New_Y… TRUE      13 &lt;dbl [2]&gt;                  13 &lt;dbl [2]&gt;     0.937\n 8     8 A/New_Y… TRUE      17 &lt;dbl [2]&gt;                  17 &lt;dbl [2]&gt;     2.06 \n 9     9 A/New_Y… TRUE      17 &lt;dbl [2]&gt;                  17 &lt;dbl [2]&gt;     1.18 \n10    10 A/New_Y… TRUE      19 &lt;dbl [2]&gt;                  19 &lt;dbl [2]&gt;     2.34 \n# ℹ 141 more rows\n# ℹ 8 more variables: length_0.95_HPD &lt;list&gt;, length_median &lt;dbl&gt;,\n#   length_range &lt;list&gt;, posterior &lt;dbl&gt;, rate &lt;dbl&gt;, rate_0.95_HPD &lt;list&gt;,\n#   rate_median &lt;dbl&gt;, rate_range &lt;list&gt;\n\np1 &lt;- ggtree(beast_tree, mrsd='2013-01-01') + theme_tree2() +\n    labs(caption=\"Divergence time\")\np2 &lt;- ggtree(beast_tree, branch.length='rate') + theme_tree2() +\n    labs(caption=\"Substitution rate\")\n\nThe following example draws a tree inferred by CodeML (Figure ?fig-rescaleTreeC), and the branches can be rescaled by using dN/dS values (Figure ?fig-rescaleTreeD).\n\nmlcfile &lt;- system.file(\"extdata/PAML_Codeml\", \"mlc\", package=\"treeio\")\nmlc_tree &lt;- read.codeml_mlc(mlcfile)\np3 &lt;- ggtree(mlc_tree) + theme_tree2() +\n    labs(caption=\"nucleotide substitutions per codon\")\np4 &lt;- ggtree(mlc_tree, branch.length='dN_vs_dS') + theme_tree2() +\n    labs(caption=\"dN/dS tree\")\n\n\n\n\n\n\nRescale tree branches. A time-scaled tree inferred by BEAST (A) and its branches were rescaled by substitution rate (B). A tree was inferred by CodeML (C) and the branches were rescaled by dN/dS values (D).\n\n\n\n\nThis provides a very convenient way to allow us to explore the relationship between tree associated data and tree structure through visualization. In addition to specifying branch.length in tree visualization, users can change branch length stored in tree object by using rescale_tree() function provided by the treeio package (Wang et al., 2020), and the following command will display a tree that is identical to Figure ?fig-rescaleTreeB. The rescale_tree() function was documented in session 2.4.\n\nbeast_tree2 &lt;- rescale_tree(beast_tree, branch.length='rate')\nggtree(beast_tree2) + theme_tree2()\n\n\n\nModify components of a theme\nThe theme_tree() defined a totally blank canvas, while theme_tree2() adds phylogenetic distance (via x-axis). These two themes all accept a parameter of bgcolor that defined the background color. Users can use any theme components to the theme_tree() or theme_tree2() functions to modify them (Figure ?fig-theme).\n\nset.seed(2019)\nx &lt;- rtree(30)\nggtree(x, color=\"#0808E5\", size=1) + theme_tree(\"#FEE4E9\")\n\n\n\n\n\n\n\nggtree(x, color=\"orange\", size=1) + theme_tree('grey30')\n\n\n\n\n\n\n\n\n\n\n\n\n\nThree themes. All ggplot2 theme components can be modified, and all the ggplot2 themes can be applied to ggtree() output.\n\n\n\n\nUsers can also use an image file as the tree background, see example in Appendix B.",
    "crumbs": [
      "(PART\\*) Part II: Tree data visualization and annotation"
    ]
  },
  {
    "objectID": "04_ggtree_visualization.html#visualize-a-list-of-trees",
    "href": "04_ggtree_visualization.html#visualize-a-list-of-trees",
    "title": "(PART*) Part II: Tree data visualization and annotation",
    "section": "Visualize a List of Trees",
    "text": "Visualize a List of Trees\nThe ggtree supports multiPhylo and treedataList objects and a list of trees can be viewed simultaneously. The trees will visualize one on top of another and can be plotted in different panels through facet_wrap() or facet_grid() functions (Figure ?fig-multiPhylo).\n\n## trees &lt;- lapply(c(10, 20, 40), rtree)\n## class(trees) &lt;- \"multiPhylo\"\n## ggtree(trees) + facet_wrap(~.id, scale=\"free\") + geom_tiplab()\n\nf &lt;- system.file(\"extdata/r8s\", \"H3_r8s_output.log\", package=\"treeio\")\nr8s &lt;- read.r8s(f)\nggtree(r8s) + facet_wrap( ~.id, scale=\"free\") + theme_tree2()\n\n\n\n\nVisualizing multiPhylo object. The ggtree() function supports visualizing multiple trees stored in the multiPhylo or treedataList objects.\n\n\n\n\nOne hundred bootstrap trees can also be viewed simultaneously (Figure ?fig-bp100). This allows researchers to explore a large set of phylogenetic trees to find consensus and distinct trees. The consensus tree can be summarized via a density tree (Figure ?fig-densiTree).\n\nbtrees &lt;- read.tree(system.file(\"extdata/RAxML\", \n                                \"RAxML_bootstrap.H3\", \n                                package=\"treeio\")\n                    )\nggtree(btrees) + facet_wrap(~.id, ncol=10)\n\n\n\n\nVisualizing one hundred bootstrap trees simultaneously.\n\n\n\n\n\nAnnotate one tree with values from different variables\nTo annotate one tree (the same tree) with the values from different variables, one can plot them separately and use patchwork or aplot to combine them side-by-side.\nAnother solution is to utilize the ability to plot a list of trees by ggtree, and then add annotation layers for the selected variable at a specific panel via the subset aesthetic mapping supported by ggtree or using the td_filter() as demonstrated in Figure ?fig-onetreefacet. The .id is the conserved variable that is internally used to store the IDs of different trees.\n\nset.seed(2020)\nx &lt;- rtree(30)\nd &lt;- data.frame(label=x$tip.label, var1=abs(rnorm(30)), var2=abs(rnorm(30)))\ntree &lt;- full_join(x, d, by='label')\ntrs &lt;- list(TREE1 = tree, TREE2 = tree)\nclass(trs) &lt;- 'treedataList'\nggtree(trs) + facet_wrap(~.id) + \n  geom_tippoint(aes(colour=var1), data=td_filter(.id == \"TREE1\")) + \n  scale_colour_gradient(low='blue', high='red') +  \n  ggnewscale::new_scale_colour()  + \n  geom_tippoint(aes(colour=var2), data=td_filter(.id == \"TREE2\")) + \n  scale_colour_viridis_c()\n\n\n\n\nAnnotate one tree with values from different variables. Using subset aesthetic mapping (as in TREE1 panel) or td_filter() (as in TREE2 panel) to filter variables to be displayed on the specific panel.\n\n\n\n\n\n\nDensiTree\nAnother way to view the bootstrap trees is to merge them to form a density tree using ggdensitree() function (Figure ?fig-densiTree). This will help us identify consensus and differences among a large set of trees. The trees will be stacked on top of each other and the structures of the trees will be rotated to ensure the consistency of the tip order. The tip order is determined by the tip.order parameter and by default (tip.order = 'mode') the tips are ordered by the most commonly seen topology. The user can pass in a character vector to specify the tip order, or pass in an integer, N, to order the tips by the order of the tips in the Nth tree. Passing mds to tip.order will order the tips based on MDS (Multidimensional Scaling) of the path length between the tips, or passing mds_dist will order the tips based on MDS of the distance between the tips.\n\nggdensitree(btrees, alpha=.3, colour='steelblue') + \n    geom_tiplab(size=3) + hexpand(.35)\n\nWarning in FUN(X[[i]], ...): Arguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\nArguments in `...` must be used.\n✖ Problematic arguments:\n• alpha = 0.3\n• colour = \"steelblue\"\nℹ Did you misspell an argument name?\n\n\n\n\n\nDensiTree. Trees are stacked on top of each other and the structures of the trees are rotated to ensure the consistency of the tip order.",
    "crumbs": [
      "(PART\\*) Part II: Tree data visualization and annotation"
    ]
  },
  {
    "objectID": "04_ggtree_visualization.html#sec-summary4",
    "href": "04_ggtree_visualization.html#sec-summary4",
    "title": "(PART*) Part II: Tree data visualization and annotation",
    "section": "Summary",
    "text": "Summary\nVisualizing phylogenetic trees with ggtree is easy by using a single command ggtree(tree). The ggtree package provides several geometric layers to display tree components such as tip labels, symbolic points for both external and internal nodes, root-edge, etc. Associated data can be used to rescale branch lengths, color the tree, and be displayed on the tree. All these can be done by the ggplot2 grammar of graphic syntax, which makes it very easy to overlay layers and customize the tree graph (via ggplot2 themes and scales). The ggtree package also provides several layers that are specifically designed for tree annotation which will be introduced in Chapter 5. The ggtree package makes the presentation of trees and associated data extremely easy. Simple graphs are easy to generate, while complex graphs are simply superimposed layers and are also easy to generate.\n\n\n\n\nChevenet, F., Brun, C., Bañuls, A.-L., Jacq, B., & Christen, R. (2006). TreeDyn: Towards dynamic graphics and annotations for analyses of trees. BMC Bioinformatics, 7, 439. https://doi.org/10.1186/1471-2105-7-439\n\n\nGentleman, R. C., Carey, V. J., Bates, D. M., Bolstad, B., Dettling, M., Dudoit, S., Ellis, B., Gautier, L., Ge, Y., Gentry, J., Hornik, K., Hothorn, T., Huber, W., Iacus, S., Irizarry, R., Leisch, F., Li, C., Maechler, M., Rossini, A. J., … Zhang, J. (2004). Bioconductor: Open software development for computational biology and bioinformatics. Genome Biology, 5(10), R80. https://doi.org/10.1186/gb-2004-5-10-r80\n\n\nHe, Z., Zhang, H., Gao, S., Lercher, M. J., Chen, W.-H., & Hu, S. (2016). Evolview v2: An online visualization and management tool for customized and annotated phylogenetic trees. Nucleic Acids Research, 44(W1), W236–241. https://doi.org/10.1093/nar/gkw370\n\n\nHuson, D. H., & Scornavacca, C. (2012). Dendroscope 3: An interactive tool for rooted phylogenetic trees and networks. Systematic Biology, 61(6), 1061–1067. https://doi.org/10.1093/sysbio/sys062\n\n\nJombart, T., Aanensen, D. M., Baguelin, M., Birrell, P., Cauchemez, S., Camacho, A., Colijn, C., Collins, C., Cori, A., Didelot, X., Fraser, C., Frost, S., Hens, N., Hugues, J., Höhle, M., Opatowski, L., Rambaut, A., Ratmann, O., Soubeyrand, S., … Ferguson, N. (2014). OutbreakTools: A new platform for disease outbreak analysis using the R software. Epidemics, 7, 28–34. https://doi.org/10.1016/j.epidem.2014.04.003\n\n\nLam, T. T.-Y., Hon, C.-C., Lemey, P., Pybus, O. G., Shi, M., Tun, H. M., Li, J., Jiang, J., Holmes, E. C., & Leung, F. C.-C. (2012). Phylodynamics of H5N1 avian influenza virus in Indonesia. Molecular Ecology, 21(12), 3062–3077. https://doi.org/10.1111/j.1365-294X.2012.05577.x\n\n\nLetunic, I., & Bork, P. (2007). Interactive Tree Of Life (iTOL): An online tool for phylogenetic tree display and annotation. Bioinformatics, 23(1), 127–128. https://doi.org/10.1093/bioinformatics/btl529\n\n\nLiang, H., Lam, T. T.-Y., Fan, X., Chen, X., Zeng, Y., Zhou, J., Duan, L., Tse, M., Chan, C.-H., Li, L., Leung, T.-Y., Yip, C.-H., Cheung, C.-L., Zhou, B., Smith, D. K., Poon, L. L.-M., Peiris, M., Guan, Y., & Zhu, H. (2014). Expansion of genotypic diversity and establishment of 2009 H1N1 pandemic-origin internal genes in pigs in China. Journal of Virology, JVI.01327–14. https://doi.org/10.1128/JVI.01327-14\n\n\nMcMurdie, P. J., & Holmes, S. (2013). Phyloseq: An R package for reproducible interactive analysis and graphics of microbiome census data. PloS One, 8(4), e61217. https://doi.org/10.1371/journal.pone.0061217\n\n\nNeher, R. A., Bedford, T., Daniels, R. S., Russell, C. A., & Shraiman, B. I. (2016). Prediction, dynamics, and visualization of antigenic phenotypes of seasonal influenza viruses. Proceedings of the National Academy of Sciences, 113(12), E1701–E1709. https://doi.org/10.1073/pnas.1525578113\n\n\nPage, R. D. M. (2002). Visualizing phylogenetic trees using TreeView. Current Protocols in Bioinformatics, Chapter 6, Unit 6.2. https://doi.org/10.1002/0471250953.bi0602s01\n\n\nParadis, E., Claude, J., & Strimmer, K. (2004). APE: Analyses of Phylogenetics and Evolution in R language. Bioinformatics, 20(2), 289–290. https://doi.org/10.1093/bioinformatics/btg412\n\n\nR Core Team. (2016). R: A language and environment for statistical computing. R Foundation for Statistical Computing. https://www.R-project.org/\n\n\nRetief, J. D. (2000). Phylogenetic analysis using PHYLIP. Methods in Molecular Biology (Clifton, N.J.), 132, 243–258.\n\n\nRevell, L. J. (2012). Phytools: An R package for phylogenetic comparative biology (and other things). Methods in Ecology and Evolution, 3(2), 217–223. https://doi.org/10.1111/j.2041-210X.2011.00169.x\n\n\nWang, L.-G., Lam, T. T.-Y., Xu, S., Dai, Z., Zhou, L., Feng, T., Guo, P., Dunn, C. W., Jones, B. R., Bradley, T., Zhu, H., Guan, Y., Jiang, Y., & Yu, G. (2020). Treeio: An r package for phylogenetic tree input and output with richly annotated and associated data. Molecular Biology and Evolution, 37(2), 599–603. https://doi.org/10.1093/molbev/msz240\n\n\nWickham, H. (2016). ggplot2: Elegant graphics for data analysis. Springer. http://ggplot2.org\n\n\nWilgenbusch, J. C., & Swofford, D. (2003). Inferring evolutionary trees with PAUP*. Current Protocols in Bioinformatics, Chapter 6, Unit 6.4. https://doi.org/10.1002/0471250953.bi0604s00\n\n\nWilkinson, L., Wills, D., Rope, D., Norton, A., & Dubbs, R. (2005). The Grammar of Graphics (2nd edition). Springer.\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "(PART\\*) Part II: Tree data visualization and annotation"
    ]
  },
  {
    "objectID": "04_ggtree_visualization.html#footnotes",
    "href": "04_ggtree_visualization.html#footnotes",
    "title": "(PART*) Part II: Tree data visualization and annotation",
    "section": "",
    "text": "http://www.phytools.org/eqg2015/asr.html↩︎",
    "crumbs": [
      "(PART\\*) Part II: Tree data visualization and annotation"
    ]
  },
  {
    "objectID": "05_ggtree_annotation.html",
    "href": "05_ggtree_annotation.html",
    "title": "4  Phylogenetic Tree Annotation",
    "section": "",
    "text": "4.1 Visualizing and Annotating Tree Using Grammar of Graphics\nThe ggtree (Yu et al., 2017) is designed for a more general-purpose or a specific type of tree visualization and annotation. It supports the grammar of graphics implemented in ggplot2 and users can freely visualize/annotate a tree by combining several annotation layers.\nlibrary(ggtree)\ntreetext &lt;- \"(((ADH2:0.1[&&NHX:S=human], ADH1:0.11[&&NHX:S=human]):\n  0.05 [&&NHX:S=primates:D=Y:B=100],ADHY:\n  0.1[&&NHX:S=nematode],ADHX:0.12 [&&NHX:S=insect]):\n  0.1[&&NHX:S=metazoa:D=N],(ADH4:0.09[&&NHX:S=yeast],\n  ADH3:0.13[&&NHX:S=yeast], ADH2:0.12[&&NHX:S=yeast],\n  ADH1:0.11[&&NHX:S=yeast]):0.1[&&NHX:S=Fungi])[&&NHX:D=N];\"\ntree &lt;- read.nhx(textConnection(treetext))\np = ggtree(tree) + geom_tiplab() + \n  geom_label(aes(x=branch, label=S), fill='lightgreen') + \n  geom_label(aes(label=D), fill='steelblue') + \n  geom_text(aes(label=B), hjust=-.5)\np &lt;- p + xlim(NA, 0.28)\nlibrary(ggtree)\ntreetext = \"(((ADH2:0.1[&&NHX:S=human], ADH1:0.11[&&NHX:S=human]):\n0.05 [&&NHX:S=primates:D=Y:B=100],ADHY:\n0.1[&&NHX:S=nematode],ADHX:0.12 [&&NHX:S=insect]):\n0.1[&&NHX:S=metazoa:D=N],(ADH4:0.09[&&NHX:S=yeast],\nADH3:0.13[&&NHX:S=yeast], ADH2:0.12[&&NHX:S=yeast],\nADH1:0.11[&&NHX:S=yeast]):0.1[&&NHX:S=Fungi])[&&NHX:D=N];\"\ntree &lt;- read.nhx(textConnection(treetext))\nggtree(tree) + geom_tiplab() + \n  geom_label(aes(x=branch, label=S), fill='lightgreen') + \n  geom_label(aes(label=D), fill='steelblue') + \n  geom_text(aes(label=B), hjust=-.5)\nAnnotating tree using the grammar of graphics. The NHX tree was annotated using the grammar of graphic syntax by combining different layers using the + operator. Species information was labeled in the middle of the branches. Duplication events were shown on the most recent common ancestor and clade bootstrap values were displayed near to it.\nHere, as an example, we visualized the tree with several layers to display annotation stored in NHX tags, including a layer of geom_tiplab() to display tip labels (gene name in this case), a layer using geom_label() to show species information (S tag) colored by light green, a layer of duplication event information (D tag) colored by steelblue and another layer using geom_text() to show bootstrap value (B tag).\nLayers defined in ggplot2 can be applied to ggtree directly as demonstrated in Figure ?fig-ggtreeNHX of using geom_label() and geom_text(). But ggplot2 does not provide graphic layers that are specifically designed for phylogenetic tree annotation. For instance, layers for tip labels, tree branch scale legend, highlight, or labeling clade are all unavailable. To make tree annotation more flexible, several layers have been implemented in ggtree (Table ?tbl-geoms), enabling different ways of annotation on various parts/components of a phylogenetic tree.\nGeom layers defined in ggtree.\n\n\nLayer\nDescription\n\n\n\n\ngeom_balance\nHighlights the two direct descendant clades of an internal node\n\n\ngeom_cladelab\nAnnotates a clade with bar and text label (or image)\n\n\ngeom_facet\nPlots associated data in a specific panel (facet) and aligns the plot with the tree\n\n\ngeom_hilight\nHighlights selected clade with rectangular or round shape\n\n\ngeom_inset\nAdds insets (subplots) to tree nodes\n\n\ngeom_label2\nThe modified version of geom_label, with subset aesthetic supported\n\n\ngeom_nodepoint\nAnnotates internal nodes with symbolic points\n\n\ngeom_point2\nThe modified version of geom_point, with subset aesthetic supported\n\n\ngeom_range\nBar layer to present uncertainty of evolutionary inference\n\n\ngeom_rootpoint\nAnnotates root node with symbolic point\n\n\ngeom_rootedge\nAdds root-edge to a tree\n\n\ngeom_segment2\nThe modified version of geom_segment, with subset aesthetic supported\n\n\ngeom_strip\nAnnotates associated taxa with bar and (optional) text label\n\n\ngeom_taxalink\nLinks related taxa\n\n\ngeom_text2\nThe modified version of geom_text, with subset aesthetic supported\n\n\ngeom_tiplab\nThe layer of tip labels\n\n\ngeom_tippoint\nAnnotates external nodes with symbolic points\n\n\ngeom_tree\nTree structure layer, with multiple layouts supported\n\n\ngeom_treescale\nTree branch scale legend",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Phylogenetic Tree Annotation</span>"
    ]
  },
  {
    "objectID": "05_ggtree_annotation.html#layers-for-tree-annotation",
    "href": "05_ggtree_annotation.html#layers-for-tree-annotation",
    "title": "4  Phylogenetic Tree Annotation",
    "section": "4.2 Layers for Tree Annotation",
    "text": "4.2 Layers for Tree Annotation\n\n4.2.1 Colored strips\nThe ggtree (Yu et al., 2017) implements geom_cladelab() layer to annotate a selected clade with a bar indicating the clade with a corresponding label.\nThe geom_cladelab() layer accepts a selected internal node number and labels the corresponding clade automatically (Figure ?fig-cladelabelA). To get the internal node number, please refer to Chapter 2.\n\nset.seed(2015-12-21)\ntree &lt;- rtree(30)\np &lt;- ggtree(tree) + xlim(NA, 8)\n\np + geom_cladelab(node=45, label=\"test label\") +\n    geom_cladelab(node=34, label=\"another clade\")\n\n\n\n\n\n\n\n\nUsers can set the parameter, align = TRUE, to align the clade label, offset, to adjust the position and color to set the color of the bar and label text, etc. (Figure ?fig-cladelabelB).\n\np + geom_cladelab(node=45, label=\"test label\", align=TRUE,  \n                  offset = .2, textcolor='red', barcolor='red') +\n    geom_cladelab(node=34, label=\"another clade\", align=TRUE, \n                  offset = .2, textcolor='blue', barcolor='blue')\n\n\n\n\n\n\n\n\nUsers can change the angle of the clade label text and relative position from text to bar via the parameter offset.text. The size of the bar and text can be changed via the parameters barsize and fontsize, respectively (Figure ?fig-cladelabelC).\n\np + geom_cladelab(node=45, label=\"test label\", align=TRUE, angle=270, \n            hjust='center', offset.text=.5, barsize=1.5, fontsize=8) +\n    geom_cladelab(node=34, label=\"another clade\", align=TRUE, angle=45)\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the ggtree package.\n  Please report the issue at &lt;https://github.com/YuLab-SMU/ggtree/issues&gt;.\n\n\n\n\n\n\n\n\n\nUsers can also use geom_label() to label the text and can set the background color by fill parameter (Figure ?fig-cladelabelD).\n\np + geom_cladelab(node=34, label=\"another clade\", align=TRUE, \n                  geom='label', fill='lightblue')\n\nWarning in (function (mapping = NULL, data = NULL, ..., stat = \"identity\", :\nIgnoring unknown parameters: `label.size`\n\n\n\n\n\n\n\n\n\n\n\nWarning in (function (mapping = NULL, data = NULL, ..., stat = \"identity\", :\nIgnoring unknown parameters: `label.size`\n\n\n\n\n\nLabeling clades. Default (A); aligning and coloring clade bar and text (B); changing size and angle (C) and using geom_label() with background color in the text (D).\n\n\n\n\nIn addition, geom_cladelab() allows users to use the image or phylopic to annotate the clades, and supports using aesthetic mapping to automatically annotate the clade with bar and text label or image (e.g., mapping variable to color the clade labels) (Figure ?fig-cladelabaes).\n\ndat &lt;- data.frame(node = c(45, 34), \n            name = c(\"test label\", \"another clade\"))\n# The node and label is required when geom=\"text\" \n## or geom=\"label\" or geom=\"shadowtext\".\np1 &lt;- p + geom_cladelab(data = dat, \n        mapping = aes(node = node, label = name, color = name), \n        fontsize = 3)\n\ndt &lt;- data.frame(node = c(45, 34), \n                 image = c(\"7fb9bea8-e758-4986-afb2-95a2c3bf983d\", \n                          \"0174801d-15a6-4668-bfe0-4c421fbe51e8\"), \n                 name = c(\"specie A\", \"specie B\"))\n\n# when geom=\"phylopic\" or geom=\"image\", the image of aes is required.\np2 &lt;- p + geom_cladelab(data = dt, \n                mapping = aes(node = node, label = name, image = image), \n                geom = \"phylopic\", imagecolor = \"black\", \n                offset=1, offset.text=0.5)\n\n# The color or size of image also can be mapped.\np3 &lt;- p + geom_cladelab(data = dt, \n              mapping = aes(node = node, label = name, \n                          image = image, color = name), \n              geom = \"phylopic\", offset = 1, offset.text=0.5)\n\n\n\n\n\n\nLabeling clades using aesthetic mapping. The geom_cladelab() layer allows users to use aesthetic mapping to annotate the clades (A); it supports using images or phylopic to annotate clades (B); mapping variable to change color or size of the text or image is also supported (C).\n\n\n\n\nThe geom_cladelab() layer also supports unrooted tree layouts (Figure ?fig-striplabelA).\n\nggtree(tree, layout=\"daylight\") + \n  geom_cladelab(node=35, label=\"test label\", angle=0, \n                  fontsize=8, offset=.5, vjust=.5)  + \n  geom_cladelab(node=55, label='another clade', \n                  angle=-95, hjust=.5, fontsize=8)\n\nThe geom_cladelab() is designed for labeling Monophyletic (Clade) while there are related taxa that do not form a clade. In ggtree, we provide another layer, geom_strip(), to add a strip/bar to indicate the association with an optional label for Polyphyletic or Paraphyletic (Figure ?fig-striplabelB).\n\np + geom_tiplab() + \n  geom_strip('t10', 't30', barsize=2, color='red', \n            label=\"associated taxa\", offset.text=.1) + \n  geom_strip('t1', 't18', barsize=2, color='blue', \n            label = \"another label\", offset.text=.1)\n\n\n\n\n\n\n\n\n\n\n\n\n\nLabeling associated taxa. The geom_cladelab() is designed for labeling Monophyletic and supports unrooted layouts (A). The geom_strip() is designed for labeling all types of associated taxa, including Monophyletic, Polyphyletic, and Paraphyletic (B).\n\n\n\n\n\n\n4.2.2 Highlight clades\nThe ggtree implements the geom_hilight() layer, which accepts an internal node number and adds a layer of a rectangle to highlight the selected clade (Figure ?fig-hilight)1.\n\nnwk &lt;- system.file(\"extdata\", \"sample.nwk\", package=\"treeio\")\ntree &lt;- read.tree(nwk)\nggtree(tree) + \n    geom_hilight(node=21, fill=\"steelblue\", alpha=.6) +\n    geom_hilight(node=17, fill=\"darkgreen\", alpha=.6) \n\n\n\n\n\n\n\nggtree(tree, layout=\"circular\") + \n    geom_hilight(node=21, fill=\"steelblue\", alpha=.6) +\n    geom_hilight(node=23, fill=\"darkgreen\", alpha=.6)\n\n\n\n\n\n\n\n\nThe geom_hilight layer also supports highlighting clades for unrooted layout trees with round (‘encircle’) or rectangular (‘rect’) shape (Figure ?fig-hilightC).\n\n## type can be 'encircle' or 'rect'\npg + geom_hilight(node=55, linetype = 3) + \n  geom_hilight(node=35, fill='darkgreen', type=\"rect\")\n\n\n\n\n\n\n\n\nAnother way to highlight selected clades is by setting the clades with different colors and/or line types as demonstrated in Figure ?fig-scaleClade.\nIn addition to geom_hilight(), ggtree also implements geom_balance() which is designed to highlight neighboring subclades of a given internal node (Figure ?fig-hilightD).\n\nggtree(tree) +\n  geom_balance(node=16, fill='steelblue', color='white', alpha=0.6, extend=1) +\n  geom_balance(node=19, fill='darkgreen', color='white', alpha=0.6, extend=1) \n\nThe geom_hilight() layer supports using aesthetic mapping to automatically highlight clades as demonstrated in Figures ?fig-hilightE-F. For plot in Cartesian coordinates (e.g., rectangular layout), the rectangle can be rounded (Figure ?fig-hilightE) or filled with gradient colors (Figure ?fig-hilightF).\n\n## using external data\nd &lt;- data.frame(node=c(17, 21), type=c(\"A\", \"B\"))\nggtree(tree) + geom_hilight(data=d, aes(node=node, fill=type),\n                            type = \"roundrect\")\n\n\n\n\n\n\n\n## using data stored in the tree object\nx &lt;- read.nhx(system.file(\"extdata/NHX/ADH.nhx\", package=\"treeio\"))\nggtree(x) + geom_hilight(mapping=aes(subset = node %in% c(10, 12), \n                                    fill = S),\n                        type = \"gradient\", gradient.direction = 'rt',\n                        alpha = .8) +\n  scale_fill_manual(values=c(\"steelblue\", \"darkgreen\"))\n\n\n\n\n\n\n\n\n\n\n\n\n\nHighlight selected clades. Rectangular layout (A), circular/fan (B), and unrooted layouts. Highlight neighboring subclades simultaneously (D). Highlight selected clades using associated data (E and F).\n\n\n\n\n\n\n4.2.3 Taxa connection\nSome evolutionary events (e.g., reassortment, horizontal gene transfer) cannot be modeled by a simple tree. The ggtree provides the geom_taxalink() layer that allows drawing straight or curved lines between any of two nodes in the tree, allowing it to represent evolutionary events by connecting taxa. It works with rectangular (Figure ?fig-taxalinkA), circular (Figure ?fig-taxalinkB), and inward circular (Figure ?fig-taxalinkC) layouts. The geom_taxalink() is not only useful for presenting evolutionary events, but it can also be used to combine evolutionary trees to present relationships or interactions between species (Xu et al., 2021).\nThe geom_taxalink() layout supports aesthetic mapping, which requires a data.frame that stores association information with/without meta-data as input (Figure ?fig-taxalinkD).\n\np1 &lt;- ggtree(tree) + geom_tiplab() + geom_taxalink(taxa1='A', taxa2='E') + \n  geom_taxalink(taxa1='F', taxa2='K', color='red', linetype = 'dashed',\n    arrow=arrow(length=unit(0.02, \"npc\")))\n\np2 &lt;- ggtree(tree, layout=\"circular\") + \n      geom_taxalink(taxa1='A', taxa2='E', color=\"grey\", alpha=0.5, \n                offset=0.05, arrow=arrow(length=unit(0.01, \"npc\"))) + \n      geom_taxalink(taxa1='F', taxa2='K', color='red', \n                linetype = 'dashed', alpha=0.5, offset=0.05,\n                arrow=arrow(length=unit(0.01, \"npc\"))) +\n      geom_taxalink(taxa1=\"L\", taxa2=\"M\", color=\"blue\", alpha=0.5, \n                offset=0.05, hratio=0.8, \n                arrow=arrow(length=unit(0.01, \"npc\"))) + \n      geom_tiplab()\n\n# when the tree was created using reverse x, \n# we can set outward to FALSE, which will generate the inward curve lines.\np3 &lt;- ggtree(tree, layout=\"inward_circular\", xlim=150) +\n      geom_taxalink(taxa1='A', taxa2='E', color=\"grey\", alpha=0.5, \n                    offset=-0.2, outward=FALSE,\n                    arrow=arrow(length=unit(0.01, \"npc\"))) +\n      geom_taxalink(taxa1='F', taxa2='K', color='red', linetype = 'dashed', \n                    alpha=0.5, offset=-0.2, outward=FALSE,\n                    arrow=arrow(length=unit(0.01, \"npc\"))) +\n      geom_taxalink(taxa1=\"L\", taxa2=\"M\", color=\"blue\", alpha=0.5, \n                    offset=-0.2, outward=FALSE,\n                    arrow=arrow(length=unit(0.01, \"npc\"))) +\n      geom_tiplab(hjust=1) \n\ndat &lt;- data.frame(from=c(\"A\", \"F\", \"L\"), \n                  to=c(\"E\", \"K\", \"M\"), \n                  h=c(1, 1, 0.1), \n                  type=c(\"t1\", \"t2\", \"t3\"), \n                  s=c(2, 1, 2))\np4 &lt;- ggtree(tree, layout=\"inward_circular\", xlim=c(150, 0)) +\n          geom_taxalink(data=dat, \n                         mapping=aes(taxa1=from, \n                                     taxa2=to, \n                                     color=type, \n                                     size=s), \n                         ncp=10,\n                         offset=0.15) + \n          geom_tiplab(hjust=1) +\n          scale_size_continuous(range=c(1,3))\nplot_list(p1, p2, p3, p4, ncol=2, tag_levels='A')\n\n\n\n\nLinking related taxa. This can be used to indicate evolutionary events or relationships between species. Rectangular layout (A), circular layout (B), and inward circular layout (C and D). It supports aesthetic mapping to map variables to set line sizes and colors (D).\n\n\n\n\n\n\n4.2.4 Uncertainty of evolutionary inference\nThe geom_range() layer supports displaying interval (highest posterior density, confidence interval, range) as horizontal bars on tree nodes. The center of the interval will anchor to the corresponding node. The center by default is the mean value of the interval (Figure ?fig-geomRangeA). We can set the center to the estimated mean or median value (Figure ?fig-geomRangeB), or the observed value. As the tree branch and the interval may not be on the same scale, ggtree provides scale_x_range to add a second x-axis for the range (Figure ?fig-geomRangeC). Note that x-axis is disabled by the default theme, and we need to enable it if we want to display it (e.g., using theme_tree2()).\n\nfile &lt;- system.file(\"extdata/MEGA7\", \"mtCDNA_timetree.nex\", package = \"treeio\")\nx &lt;- read.mega(file)\np1 &lt;- ggtree(x) + geom_range('reltime_0.95_CI', color='red', size=3, alpha=.3)\np2 &lt;- ggtree(x) + geom_range('reltime_0.95_CI', color='red', size=3, \n                              alpha=.3, center='reltime')  \np3 &lt;- p2 + scale_x_range() + theme_tree2()\n\n\n\n\n\n\nDisplaying uncertainty of evolutionary inference. The center (mean value of the range (A) or estimated value (B)) is anchored to the tree nodes. A second x-axis was used for range scaling (C).",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Phylogenetic Tree Annotation</span>"
    ]
  },
  {
    "objectID": "05_ggtree_annotation.html#tree-annotation-with-output-from-evolution-software",
    "href": "05_ggtree_annotation.html#tree-annotation-with-output-from-evolution-software",
    "title": "4  Phylogenetic Tree Annotation",
    "section": "4.3 Tree Annotation with Output from Evolution Software",
    "text": "4.3 Tree Annotation with Output from Evolution Software\n\n4.3.1 Tree annotation using data from evolutionary analysis software\nChapter 1 introduced using treeio package (Wang et al., 2020) to parse different tree formats and commonly used software outputs to obtain phylogeny-associated data. These imported data, as S4 objects, can be visualized directly using ggtree. Figure ?fig-ggtreeNHX demonstrates a tree annotated using the information (species classification, duplication event, and bootstrap value) stored in the NHX file. PHYLDOG and pkg_revbayes output NHX files that can be parsed by treeio and visualized by ggtree with annotation using their inference data.\nFurthermore, the evolutionary data from the inference of BEAST, MrBayes, and RevBayes, dN/dS values inferred by CODEML, ancestral sequences inferred by HyPhy, CODEML, or BASEML and short read placement by EPA and PPLACER can be used to annotate the tree directly.\n\nfile &lt;- system.file(\"extdata/BEAST\", \"beast_mcc.tree\", package=\"treeio\")\nbeast &lt;- read.beast(file)\nggtree(beast, aes(color=rate))  +\n    geom_range(range='length_0.95_HPD', color='red', alpha=.6, size=2) +\n    geom_nodelab(aes(x=branch, label=round(posterior, 2)), vjust=-.5, size=3) +\n    scale_color_continuous(low=\"darkgreen\", high=\"red\") +\n    theme(legend.position=c(.1, .8))\n\n\n\n\nAnnotating r pkg_beast tree with length_95%_HPD and posterior. Branch length credible intervals (95% HPD) were displayed as red horizontal bars and clade posterior values were shown on the middle of branches.\n\n\n\n\nIn Figure ?fig-beast, the tree was visualized and annotated with posterior &gt;0.9 and demonstrated length uncertainty (95% Highest Posterior Density (HPD) interval).\nAncestral sequences inferred by HyPhy can be parsed using treeio, whereas the substitutions along each tree branch were automatically computed and stored inside the phylogenetic tree object (i.e., S4 object). The ggtree package can utilize this information stored in the object to annotate the tree, as demonstrated in Figure ?fig-hyphy.\n\nnwk &lt;- system.file(\"extdata/HYPHY\", \"labelledtree.tree\", \n                   package=\"treeio\")\nancseq &lt;- system.file(\"extdata/HYPHY\", \"ancseq.nex\", \n                      package=\"treeio\")\ntipfas &lt;- system.file(\"extdata\", \"pa.fas\", package=\"treeio\")\nhy &lt;- read.hyphy(nwk, ancseq, tipfas)\nggtree(hy) + \n  geom_text(aes(x=branch, label=AA_subs), size=2, \n            vjust=-.3, color=\"firebrick\")\n\n\n\n\nAnnotating tree with amino acid substitution determined by ancestral sequences inferred by r pkg_hyphy. Amino acid substitutions were displayed in the middle of branches.\n\n\n\n\nPAML’s BASEML and CODEML can also be used to infer ancestral sequences, whereas CODEML can infer selection pressure. After parsing this information using treeio, ggtree can integrate this information into the same tree structure and be used for annotation as illustrated in Figure ?fig-codeml.\n\nrstfile &lt;- system.file(\"extdata/PAML_Codeml\", \"rst\", \n                       package=\"treeio\")\nmlcfile &lt;- system.file(\"extdata/PAML_Codeml\", \"mlc\", \n                       package=\"treeio\")\nml &lt;- read.codeml(rstfile, mlcfile)\nggtree(ml, aes(color=dN_vs_dS), branch.length='dN_vs_dS') + \n  scale_color_continuous(name='dN/dS', limits=c(0, 1.5),\n                         oob=scales::squish,\n                         low='darkgreen', high='red') +\n  geom_text(aes(x=branch, label=AA_subs), \n            vjust=-.5, color='steelblue', size=2) +\n  theme_tree2(legend.position=c(.9, .3))\n\n\n\n\nAnnotating tree with amino acid substitution and dN/dS inferred by r pkg_codeml. Branches were rescaled and colored by dN/dS values, and amino acid substitutions were displayed on the middle of branches.\n\n\n\n\nNot only all the tree data parsed by treeio can be used to visualize and annotate the phylogenetic tree using ggtree, but also other trees and tree-like objects defined in the R community are supported. The ggtree plays a unique role in the R ecosystem to facilitate phylogenetic analysis, and it can be easily integrated into other packages and pipelines. For more details of working with other tree-like structures, please refer to Chapter 9. In addition to direct support of tree objects, ggtree also allows users to plot a tree with different types of external data (see also Chapter 7 and (Yu et al., 2018)).",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Phylogenetic Tree Annotation</span>"
    ]
  },
  {
    "objectID": "05_ggtree_annotation.html#sec-summary5",
    "href": "05_ggtree_annotation.html#sec-summary5",
    "title": "4  Phylogenetic Tree Annotation",
    "section": "4.4 Summary",
    "text": "4.4 Summary\nThe ggtree package implements the grammar of graphics for annotating phylogenetic trees. Users can use the ggplot2 syntax to combine different annotation layers to produce complex tree annotation. If you are familiar with ggplot2, tree annotation with a high level of customization can be intuitive and flexible using ggtree. The ggtree can collect information in the treedata object or link external data to the structure of the tree. This will enable us to use the phylogenetic tree for data integration analysis and comparative studies, and will greatly expand the application of the phylogenetic tree in different fields.\n\n\n\n\nWang, L.-G., Lam, T. T.-Y., Xu, S., Dai, Z., Zhou, L., Feng, T., Guo, P., Dunn, C. W., Jones, B. R., Bradley, T., Zhu, H., Guan, Y., Jiang, Y., & Yu, G. (2020). Treeio: An r package for phylogenetic tree input and output with richly annotated and associated data. Molecular Biology and Evolution, 37(2), 599–603. https://doi.org/10.1093/molbev/msz240\n\n\nXu, S., Dai, Z., Guo, P., Fu, X., Liu, S., Zhou, L., Tang, W., Feng, T., Chen, M., Zhan, L., Wu, T., Hu, E., Jiang, Y., Bo, X., & Yu, G. (2021). ggtreeExtra: Compact Visualization of Richly Annotated Phylogenetic Data. Molecular Biology and Evolution, 38(9), 4039–4042. https://doi.org/10.1093/molbev/msab166\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Phylogenetic Tree Annotation</span>"
    ]
  },
  {
    "objectID": "05_ggtree_annotation.html#footnotes",
    "href": "05_ggtree_annotation.html#footnotes",
    "title": "4  Phylogenetic Tree Annotation",
    "section": "",
    "text": "If you want to plot the tree above the highlighting area, visit FAQ for details.↩︎",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Phylogenetic Tree Annotation</span>"
    ]
  },
  {
    "objectID": "06_ggtree_manipulation.html",
    "href": "06_ggtree_manipulation.html",
    "title": "5  Visual Exploration of Phylogenetic Trees",
    "section": "",
    "text": "5.1 Viewing Selected Clade\nThe ggtree (Yu et al., 2017) supports many ways of manipulating the tree visually, including viewing selected clade to explore large tree (Figure ?fig-viewClade), taxa clustering (Figure ?fig-groupOTU), rotating clade or tree (Figure ?fig-rfCladeB and ?fig-rotateTree), zoom out or collapsing clades (Figure ?fig-collapseExpandA and ?fig-scaleClade), etc.. Details of the tree manipulation functions are summarized in Table ?tbl-treeman.\nA clade is a monophyletic group that contains a single ancestor and all of its descendants. We can visualize a specifically selected clade via the viewClade() function as demonstrated in Figure ?fig-viewCladeB. Another solution is to extract the selected clade as a new tree object as described in session 2.5. These functions are developed to help users explore a large tree.\nlibrary(ggtree)\nnwk &lt;- system.file(\"extdata\", \"sample.nwk\", package=\"treeio\")\ntree &lt;- read.tree(nwk)\np &lt;- ggtree(tree) + geom_tiplab()\nviewClade(p, MRCA(p, \"I\", \"L\"))\n\n\n\n\nViewing a selected clade of a tree. An example tree used to demonstrate how r Biocpkg(\"ggtree\") supports exploring or manipulating phylogenetic tree visually (A). The r Biocpkg(\"ggtree\") supports visualizing selected clade (B). A clade can be selected by specifying a node number or determined by the most recent common ancestor of selected tips.\nViewing a selected clade of a tree. An example tree used to demonstrate how r Biocpkg(\"ggtree\") supports exploring or manipulating phylogenetic tree visually (A). The r Biocpkg(\"ggtree\") supports visualizing selected clade (B). A clade can be selected by specifying a node number or determined by the most recent common ancestor of selected tips.\nSome of the functions, e.g., viewClade(), work with clade and accept a parameter of an internal node number. To get the internal node number, users can use the MRCA() function (as in Figure ?fig-viewClade) by providing two taxa names. The function will return the node number of input taxa’s most recent common ancestor (MRCA). It works with a tree and graphic (i.e., the ggtree() output) object. The tidytree package also provides an MRCA() method to extract information from the MRCA node (see details in session 2.1.3).",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Visual Exploration of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "06_ggtree_manipulation.html#sec-scale-clade",
    "href": "06_ggtree_manipulation.html#sec-scale-clade",
    "title": "5  Visual Exploration of Phylogenetic Trees",
    "section": "5.2 Scaling Selected Clade",
    "text": "5.2 Scaling Selected Clade\nThe ggtree provides another option to zoom out (or compress) selected clades via the scaleClade() function. In this way, we retain the topology and branch lengths of compressed clades. This helps to save the space to highlight those clades of primary interest in the study.\n\ntree2 &lt;- groupClade(tree, c(17, 21))\np &lt;- ggtree(tree2, aes(color=group)) + theme(legend.position='none') +\n  scale_color_manual(values=c(\"black\", \"firebrick\", \"steelblue\"))\nscaleClade(p, node=17, scale=.1) \n\n\n\n\nScaling selected clade. Clades can be zoomed in (if scale &gt; 1) to highlight or zoomed out to save space.\n\n\n\n\nIf users want to emphasize important clades, they can use the scaleClade() function by passing a numeric value larger than 1 to the scale parameter. Then the selected clade will be zoomed in. Users can also use the groupClade() function to assign selected clades with different clade IDs which can be used to color these clades with different colors as shown in Figure ?fig-scaleClade.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Visual Exploration of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "06_ggtree_manipulation.html#collapsing-and-expanding-clade",
    "href": "06_ggtree_manipulation.html#collapsing-and-expanding-clade",
    "title": "5  Visual Exploration of Phylogenetic Trees",
    "section": "5.3 Collapsing and Expanding Clade",
    "text": "5.3 Collapsing and Expanding Clade\nIt is a common practice to prune or collapse clades so that certain aspects of a tree can be emphasized. The ggtree supports collapsing selected clades using the collapse() function as shown in Figure ?fig-collapseExpandA.\n\np2 &lt;- p %&gt;% collapse(node=21) + \n  geom_point2(aes(subset=(node==21)), shape=21, size=5, fill='green')\np2 &lt;- collapse(p2, node=23) + \n  geom_point2(aes(subset=(node==23)), shape=23, size=5, fill='red')\nprint(p2)\nexpand(p2, node=23) %&gt;% expand(node=21)\n\n\n\n\n\n\nCollapsing selected clades and expanding collapsed clades. Clades can be selected to collapse (A) and the collapsed clades can be expanded back (B) if necessary as r Biocpkg(\"ggtree\") stored all information of species relationships. Green and red symbols were displayed on the tree to indicate the collapsed clades.\n\n\n\n\nHere two clades were collapsed and labeled by the green circle and red square symbolic points. Collapsing is a common strategy to collapse clades that are too large for displaying in full or are not the primary interest of the study. In ggtree, we can expand (i.e., uncollapse) the collapsed branches back with the expand() function to show details of species relationships as demonstrated in Figure ?fig-collapseExpandB.\nTriangles are often used to represent the collapsed clade and ggtree also supports it. The collapse() function provides a “mode” parameter, which by default is “none” and the selected clade was collapsed as a “tip”. Users can specify the mode to “max” that uses the farthest tip (Figure ?fig-collapseModeA), “min” that uses the closest tip (Figure ?fig-collapseModeB), and “mixed” that uses both (Figure ?fig-collapseModeC).\np2 &lt;- p + geom_tiplab()\nnode &lt;- 21\ncollapse(p2, node, 'max') %&gt;% expand(node)\ncollapse(p2, node, 'min') %&gt;% expand(node)\ncollapse(p2, node, 'mixed') %&gt;% expand(node)\nWe can pass additional parameters to set the color and transparency of the triangles (Figure ?fig-collapseModeD).\ncollapse(p, 21, 'mixed', fill='steelblue', alpha=.4) %&gt;% \n  collapse(23, 'mixed', fill='firebrick', color='blue')\nWe can combine scaleClade with collapse to zoom in/out of the triangles (Figure ?fig-collapseModeE).\nscaleClade(p, 23, .2) %&gt;% collapse(23, 'min', fill=\"darkgreen\")  \n\n\n\n\n\nCollapse clade as a triangle. ‘max’ takes the position of most distant tip (A). ‘min’ takes the position of closest tip (B). ‘mixed’ takes the positions of both closest and distant tips (C), which looks more like the shape of the clade. Set color, fill, and alpha of the triangles (D). Combine with scaleClade to zoom out the triangle to save space (E).",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Visual Exploration of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "06_ggtree_manipulation.html#sec-group-taxa-vis",
    "href": "06_ggtree_manipulation.html#sec-group-taxa-vis",
    "title": "5  Visual Exploration of Phylogenetic Trees",
    "section": "5.4 Grouping Taxa",
    "text": "5.4 Grouping Taxa\nThe groupClade() function assigns the branches and nodes under different clades into different groups. It accepts an internal node or a vector of internal nodes to cluster clade/clades.\nSimilarly, the groupOTU() function assigns branches and nodes to different groups based on user-specified groups of operational taxonomic units (OTUs) that are not necessarily within a clade but can be monophyletic (clade), polyphyletic or paraphyletic. It accepts a vector of OTUs (taxa name) or a list of OTUs and will trace back from OTUs to their most recent common ancestor (MRCA) and cluster them together as demonstrated in Figure ?fig-groupOTU.\nA phylogenetic tree can be annotated by mapping different line types, sizes, colors, or shapes of the branches or nodes that have been assigned to different groups.\n\ndata(iris)\nrn &lt;- paste0(iris[,5], \"_\", 1:150)\nrownames(iris) &lt;- rn\nd_iris &lt;- dist(iris[,-5], method=\"man\")\n\ntree_iris &lt;- ape::bionj(d_iris)\ngrp &lt;- list(setosa     = rn[1:50],\n            versicolor = rn[51:100],\n            virginica  = rn[101:150])\n\np_iris &lt;- ggtree(tree_iris, layout = 'circular', branch.length='none')\ngroupOTU(p_iris, grp, 'Species') + aes(color=Species) +\n  theme(legend.position=\"right\")\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nGrouping OTUs. OTU clustering based on their relationships. Selected OTUs and their ancestors up to the MRCA will be clustered together.\n\n\n\n\nWe can group taxa at the tree level. The following code will produce an identical figure of Figure ?fig-groupOTU (see more details described in session 2.2.3).\ntree_iris &lt;- groupOTU(tree_iris, grp, \"Species\")\nggtree(tree_iris, aes(color=Species), layout = 'circular', \n        branch.length = 'none') + \n  theme(legend.position=\"right\")",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Visual Exploration of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "06_ggtree_manipulation.html#exploring-tree-structure",
    "href": "06_ggtree_manipulation.html#exploring-tree-structure",
    "title": "5  Visual Exploration of Phylogenetic Trees",
    "section": "5.5 Exploring Tree Structure",
    "text": "5.5 Exploring Tree Structure\nTo facilitate exploring the tree structure, ggtree supports rotating selected clade by 180 degrees using the rotate() function (Figure ?fig-rfCladeB). Position of immediate descendant clades of the internal node can be exchanged via flip() function (Figure ?fig-rfCladeC).\n\np1 &lt;- p + geom_point2(aes(subset=node==16), color='darkgreen', size=5)\np2 &lt;- rotate(p1, 16)\nflip(p2, 17, 21)\n\n\n\n\n\n\nExploring tree structure. A clade (indicated by a dark green circle) in a tree (A) can be rotated by 180° (B) and the positions of its immediate descendant clades (colored by blue and red) can be exchanged (C).\n\n\n\n\nMost of the tree manipulation functions are working on clades, while ggtree also provides functions to manipulate a tree, including open_tree() to transform a tree in either rectangular or circular layout to the fan layout, and rotate_tree() function to rotate a tree for specific angle in both circular or fan layouts, as demonstrated in Figures ?fig-openTree and ?fig-rotateTree.\n\np3 &lt;- open_tree(p, 180) + geom_tiplab()\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\nprint(p3)\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\n\n\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nTransforming a tree to fan layout. A tree can be transformed to a fan layout by open_tree with a specific angle.\n\n\n\n\n\nrotate_tree(p3, 180)\n\nCoordinate system already present.\nℹ Adding new coordinate system, which will replace the existing one.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\n\n\n\nCoordinate system already present.\nℹ Adding new coordinate system, which will replace the existing one.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nRotating tree. A circular/fan layout tree can be rotated by any specific angle.\n\n\n\n\nThe following example rotates four selected clades (Figure ?fig-rotategif). It is easy to traverse all the internal nodes and rotate them one-by-one.\n\n\nset.seed(2016-05-29)\nx &lt;- rtree(50)\np &lt;- ggtree(x) + geom_tiplab()\n\n## nn &lt;- unique(reorder(x, 'postorder')$edge[,1]) \n## to traverse all the internal nodes\n\nnn &lt;- sample(unique(reorder(x, 'postorder')$edge[,1]), 4)\n\npp &lt;- lapply(nn, function(n) {\n    p &lt;- rotate(p, n)\n    p + geom_point2(aes(subset=(node == n)), color='red', size=3)\n})\n\nplot_list(gglist=pp, tag_levels='A', nrow=1)\n\n\n\n\nRotate selected clades. Four clades were randomly selected to rotate (indicated by the red symbol).\n\n\n\n\n\nFigure ?fig-fangif demonstrates the usage of open_tree() with different open angles.\n\nset.seed(123)\ntr &lt;- rtree(50)\np &lt;- ggtree(tr, layout='circular') \nangles &lt;- seq(0, 270, length.out=6)\n\npp &lt;- lapply(angles, function(angle) {\n  open_tree(p, angle=angle) + ggtitle(paste(\"open angle:\", angle))\n})\n\nplot_list(gglist=pp, tag_levels='A', nrow=2)\n\n\nset.seed(123)\ntr &lt;- rtree(50)\np &lt;- ggtree(tr, layout='circular') \nangles &lt;- seq(0, 270, length.out=6)\n\npp &lt;- lapply(angles, function(angle) {\n  open_tree(p, angle=angle) + ggtitle(paste(\"open angle:\", angle))\n})\n\ng &lt;- plot_list(gglist=pp, tag_levels='A', nrow=2)\nggplotify::as.ggplot(g, vjust=-.1,scale=1.1)\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nOpen tree with different angles.\n\n\n\n\nFigure ?fig-rotatetreegif illustrates a rotating tree with different angles.\n\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nRotate tree with different angles.\n\n\n\n\nInteractive tree manipulation is also possible via the identify() method (see details described in Chapter 12).",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Visual Exploration of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "06_ggtree_manipulation.html#sec-summary6",
    "href": "06_ggtree_manipulation.html#sec-summary6",
    "title": "5  Visual Exploration of Phylogenetic Trees",
    "section": "5.6 Summary",
    "text": "5.6 Summary\nA good visualization tool can not only help users to present the data, but it should also be able to help users to explore the data. Data exploration can allow users to better understand the data and also help discover hidden patterns. The ggtree provides a set of functions to allow visually manipulating phylogenetic trees and exploring tree structures with associated data. Exploring data in the evolutionary context may help discover new systematic patterns and generate new hypotheses.\n\n\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Visual Exploration of Phylogenetic Trees</span>"
    ]
  },
  {
    "objectID": "07_ggtree_tree_with_data.html",
    "href": "07_ggtree_tree_with_data.html",
    "title": "6  Plotting tree with data",
    "section": "",
    "text": "6.1 Mapping Data to The tree Structure\nIntegrating user data to annotate a phylogenetic tree can be done at different levels. The treeio package (Wang et al., 2020) implements full_join() methods to combine tree data to phylogenetic tree object. The tidytree package supports linking tree data to phylogeny using tidyverse verbs (see also Chapter 2). The ggtree package (Yu et al., 2018) supports mapping external data to phylogeny for visualization and annotation on the fly. Although the feature of linking external data is overlapping among these packages, they have different application scopes. For example, in addition to the treedata object, ggtree also supports several other tree objects (see Chapter 9), including phylo4d, phyloseq, and obkData that were designed to contain domain-specific data. The design of these objects did not consider supporting linking external data to the object (it can not be done at the tree object level). We can visualize trees from these objects using ggtree and link external data at the visualization level (Yu et al., 2018).\nThe ggtree package provides two general methods for mapping and visualizing associated external data on phylogenies. Method 1 allows external data to be mapped on the tree structure and used as visual characteristics in the tree and data visualization. Method 2 plots the data with the tree side-by-side using different geometric functions after reordering the data based on the tree structure. These two methods integrate data with phylogeny for further exploration and comparison in the evolutionary biology context. The ggtreeExtra provides a better implementation of the Method 2 proposed in ggtree (see also Chapter 10) and works with both rectangular and circular layouts (Xu et al., 2021).\nIn ggtree, we implemented an operator, %&lt;+%, to attach annotation data to a ggtree graphic object. Any data that contains a column of “node” or the first column of taxa labels can be integrated using the %&lt;+% operator. Multiple datasets can be attached progressively. When the data are attached, all the information stored in the data serves as numerical/categorical node attributes and can be directly used to visualize the tree by scaling the attributes as different colors or line sizes, labeling the tree using the original values of the attributes or parsing them as math expression, emoji or silhouette image. The following example uses the %&lt;+% operator to integrate taxon (df_tip_data) and internal node (df_inode_data) information and map the data to different colors or shapes of symbolic points and labels (Figure ?fig-attacher). The tip data contains imageURL that links to online figures of the species, which can be parsed and used as tip labels in ggtree (see Chapter 8).\nlibrary(ggimage)\nlibrary(ggtree)\nlibrary(TDbook)\n\n# load `tree_boots`, `df_tip_data`, and `df_inode_data` from 'TDbook'\np &lt;- ggtree(tree_boots) %&lt;+% df_tip_data + xlim(-.1, 4)\np2 &lt;- p + geom_tiplab(offset = .6, hjust = .5) +\n    geom_tippoint(aes(shape = trophic_habit, color = trophic_habit, \n                size = mass_in_kg)) + \n    theme(legend.position = \"right\") + \n    scale_size_continuous(range = c(3, 10))\n\np2 %&lt;+% df_inode_data + \n    geom_label(aes(label = vernacularName.y, fill = posterior)) + \n    scale_fill_gradientn(colors = RColorBrewer::brewer.pal(3, \"YlGnBu\"))\n\n\n\n\nExample of attaching multiple datasets. External datasets including tip data (e.g., trophic habit and body weight) and node data (e.g., clade posterior and vernacular name) were attached to the ggtree graphic via the %&lt;+% operator and the data was used to annotate the tree.\nAlthough the data integrated by the %&lt;+% operator in ggtree is for tree visualization, the data attached to the ggtree graphic object can be converted to treedata object that contains the tree and the attached data (see session 7.5).",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Plotting tree with data</span>"
    ]
  },
  {
    "objectID": "07_ggtree_tree_with_data.html#sec-facet_plot",
    "href": "07_ggtree_tree_with_data.html#sec-facet_plot",
    "title": "6  Plotting tree with data",
    "section": "6.2 Aligning Graph to the Tree Based on the Tree Structure",
    "text": "6.2 Aligning Graph to the Tree Based on the Tree Structure\nFor associating phylogenetic tree with different types of plot produced by user’s data, ggtree provides geom_facet() layer and facet_plot() function which accept an input data.frame and a geom layer to draw the input data. The data will be displayed in an additional panel of the plot. The geom_facet() (or facet_plot) is a general solution for linking the graphic layer to a tree. The function internally re-orders the input data based on the tree structure and visualizes the data at the specific panel by the geometric layer. Users are free to visualize several panels to plot different types of data as demonstrated in Figure ?fig-phyloseq and to use different geometric layers to plot the same dataset (Figure ?fig-jv2017) or different datasets on the same panel.\nThe geom_facet() is designed to work with most of the geom layers defined in ggplot2 and other ggplot2-based packages. A list of the geometric layers that work seamlessly with geom_facet() and facet_plot() can be found in Table ?tbl-facet-geom. As the ggplot2 community keeps expanding and more geom layers will be implemented in either ggplot2 or other extensions, geom_facet() and facet_plot() will gain more power to present data in the future. Note that different geom layers can be combined to present data on the same panel and the combinations of different geom layers create the possibility to present more complex data with phylogeny (see also Figures ?fig-jv2017 and ?fig-gggenes). Users can progressively add multiple panels to present and compare different datasets in the evolutionary context (Figure ?fig-plottree). Detailed descriptions can be found in the supplemental file of (Yu et al., 2018).\n\nlibrary(ggtree)\nlibrary(TDbook)\n\n## load `tree_nwk`, `df_info`, `df_alleles`, and `df_bar_data` from 'TDbook'\ntree &lt;- tree_nwk\nsnps &lt;- df_alleles\nsnps_strainCols &lt;- snps[1,] \nsnps&lt;-snps[-1,] # drop strain names\ncolnames(snps) &lt;- snps_strainCols\n\ngapChar &lt;- \"?\"\nsnp &lt;- t(snps)\nlsnp &lt;- apply(snp, 1, function(x) {\n        x != snp[1,] & x != gapChar & snp[1,] != gapChar\n    })\nlsnp &lt;- as.data.frame(lsnp)\nlsnp$pos &lt;- as.numeric(rownames(lsnp))\nlsnp &lt;- tidyr::gather(lsnp, name, value, -pos)\nsnp_data &lt;- lsnp[lsnp$value, c(\"name\", \"pos\")]\n\n## visualize the tree \np &lt;- ggtree(tree) \n\n## attach the sampling information data set \n## and add symbols colored by location\np &lt;- p %&lt;+% df_info + geom_tippoint(aes(color=location))\n\n## visualize SNP and Trait data using dot and bar charts,\n## and align them based on tree structure\np + geom_facet(panel = \"SNP\", data = snp_data, geom = geom_point, \n               mapping=aes(x = pos, color = location), shape = '|') +\n    geom_facet(panel = \"Trait\", data = df_bar_data, geom = geom_col, \n                aes(x = dummy_bar_value, color = location, \n                fill = location), orientation = 'y', width = .6) +\n    theme_tree2(legend.position=c(.05, .85))\n\n\n\n\nExample of plotting SNP and trait data. The ‘location’ information was attached to the tree and used to color tip symbols (Tree panel), and other datasets. SNP and Trait data were visualized as dot chart (SNP panel) and bar chart (Trait panel).\n\n\n\n\nCompanion functions to adjust panel widths and rename panel names are described in session 12.1. Removing the panel name is also possible and an example was presented in Figure ?fig-gggenes. We can also use aplot or patchwork to create composite plots as described in session 7.5.\nThe geom_facet() (or facet_plot()) internally used ggplot2::facet_grid() and only works with Cartesian coordinate system. To align the graph to the tree for the polar system (e.g., for circular or fan layouts), we developed another Bioconductor package, ggtreeExtra. The ggtreeExtra package provides the geom_fruit() layer that works similar to geom_facet() (details described in Chapter 10). The geom_fruit() is a better implementation of the Method 2 proposed in (Yu et al., 2018).",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Plotting tree with data</span>"
    ]
  },
  {
    "objectID": "07_ggtree_tree_with_data.html#sec-gheatmap",
    "href": "07_ggtree_tree_with_data.html#sec-gheatmap",
    "title": "6  Plotting tree with data",
    "section": "6.3 Visualize a Tree with an Associated Matrix",
    "text": "6.3 Visualize a Tree with an Associated Matrix\nThe gheatmap() function is designed to visualize the phylogenetic tree with a heatmap of an associated matrix (either numerical or categorical). The geom_facet() layer is a general solution for plotting data with the tree, including heatmap. The gheatmap() function is specifically designed for plotting heatmap with a tree and provides a shortcut for handling column labels and color palettes. Another difference is that geom_facet() only supports rectangular and slanted tree layouts, while gheatmap() supports rectangular, slanted, and circular (Figure ?fig-mgheatmap) layouts.\nIn the following example, we visualized a tree of H3 influenza viruses with their associated genotypes (Figure ?fig-gheatmapA).\n\nbeast_file &lt;- system.file(\"examples/MCC_FluA_H3.tree\", package=\"ggtree\")\nbeast_tree &lt;- read.beast(beast_file)\n\ngenotype_file &lt;- system.file(\"examples/Genotype.txt\", package=\"ggtree\")\ngenotype &lt;- read.table(genotype_file, sep=\"\\t\", stringsAsFactor=F)\ncolnames(genotype) &lt;- sub(\"\\\\.$\", \"\", colnames(genotype))\np &lt;- ggtree(beast_tree, mrsd=\"2013-01-01\") + \n    geom_treescale(x=2008, y=1, offset=2) + \n    geom_tiplab(size=2)\ngheatmap(p, genotype, offset=5, width=0.5, font.size=3, \n        colnames_angle=-45, hjust=0) +\n    scale_fill_manual(breaks=c(\"HuH3N2\", \"pdm\", \"trig\"), \n        values=c(\"steelblue\", \"firebrick\", \"darkgreen\"), name=\"genotype\")\n\nThe width parameter is to control the width of the heatmap. It supports another parameter offset for controlling the distance between the tree and the heatmap, such as allocating space for tip labels.\nFor a timescaled tree, as in this example, it’s more common to use x-axis by using theme_tree2. But with this solution, the heatmap is just another layer and will change the x-axis. To overcome this issue, we implemented scale_x_ggtree() to set the x-axis more reasonably (Figure ?fig-gheatmapB).\n\np &lt;- ggtree(beast_tree, mrsd=\"2013-01-01\") + \n    geom_tiplab(size=2, align=TRUE, linesize=.5) + \n    theme_tree2()\ngheatmap(p, genotype, offset=8, width=0.6, \n        colnames=FALSE, legend_title=\"genotype\") +\n    scale_x_ggtree() + \n    scale_y_continuous(expand=c(0, 0.3))\n\n\n\n\n\n\nExample of plotting matrix with gheatmap(). A H3 influenza tree with a genotype table visualized as a heatmap (A). Tips were aligned and with a tailored x-axis for divergence times (tree) and genomic segments (heatmap) (B).\n\n\n\n\n\n6.3.1 Visualize a tree with multiple associated matrices\nOf course, we can use multiple gheatmap() function calls to align several associated matrices with the tree. However, ggplot2 doesn’t allow us to use multiple fill scales1.\nTo solve this issue, we can use the ggnewscale package to create new fill scales. Here is an example of using ggnewscale with gheatmap().\n\nnwk &lt;- system.file(\"extdata\", \"sample.nwk\", package=\"treeio\")\n\ntree &lt;- read.tree(nwk)\ncirc &lt;- ggtree(tree, layout = \"circular\")\n\ndf &lt;- data.frame(first=c(\"a\", \"b\", \"a\", \"c\", \"d\", \"d\", \"a\", \n                        \"b\", \"e\", \"e\", \"f\", \"c\", \"f\"),\n                 second= c(\"z\", \"z\", \"z\", \"z\", \"y\", \"y\", \n                        \"y\", \"y\", \"x\", \"x\", \"x\", \"a\", \"a\"))\nrownames(df) &lt;- tree$tip.label\n\ndf2 &lt;- as.data.frame(matrix(rnorm(39), ncol=3))\nrownames(df2) &lt;- tree$tip.label\ncolnames(df2) &lt;- LETTERS[1:3]\n\n\np1 &lt;- gheatmap(circ, df, offset=.8, width=.2,\n               colnames_angle=95, colnames_offset_y = .25) +\n    scale_fill_viridis_d(option=\"D\", name=\"discrete\\nvalue\")\n\n\nlibrary(ggnewscale)\np2 &lt;- p1 + new_scale_fill()\ngheatmap(p2, df2, offset=15, width=.3,\n         colnames_angle=90, colnames_offset_y = .25) +\n    scale_fill_viridis_c(option=\"A\", name=\"continuous\\nvalue\")\n\n\n\n\nExample of plotting multiple matrix with gheatmap(). A data frame (with ‘first’ and ‘second’ columns) was visualized as a discrete heatmap and another data frame (with ‘A’, ‘B’ and ‘C’ columns) was visualized as a continuous heatmap with corresponding discrete and continuous palette of colors (Figure ?fig-mgheatmap).",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Plotting tree with data</span>"
    ]
  },
  {
    "objectID": "07_ggtree_tree_with_data.html#sec-msaplot",
    "href": "07_ggtree_tree_with_data.html#sec-msaplot",
    "title": "6  Plotting tree with data",
    "section": "6.4 Visualize a Tree with Multiple Sequence Alignments",
    "text": "6.4 Visualize a Tree with Multiple Sequence Alignments\nThe msaplot() accepts a tree (output of ggtree()) and a fasta file, then it can visualize the tree with sequence alignment. We can specify the width (relative to the tree) of the alignment and adjust the relative position by offset, which is similar to the gheatmap() function (Figure ?fig-msaplotA).\n\nlibrary(TDbook)\n\n# load `tree_seq_nwk` and `AA_sequence` from 'TDbook'\np &lt;- ggtree(tree_seq_nwk) + geom_tiplab(size=3)\nmsaplot(p, AA_sequence, offset=3, width=2)\n\n\n\n\n\n\n\n\nA specific slice of the alignment can also be displayed by specifying the window parameter (Figure ?fig-msaplotB)..\n\np &lt;- ggtree(tree_seq_nwk, layout='circular') + \n    geom_tiplab(offset=4, align=TRUE) + xlim(NA, 12)\nmsaplot(p, AA_sequence, window=c(120, 200))\n\n\n\n\n\n\nExample of plotting multiple sequence alignments with a tree. Whole MSA sequences were visualized with a tree in rectangular layout (A). Circular layout with a slice of alignment window (B).\n\n\n\n\nTo better support visualizing multiple sequence alignments with a tree and other associated data, we developed the ggmsa package with the ability to label the sequences and color the sequences with different color schemes (Yu, 2020). The ggmsa() output is compatible with geom_facet() and ggtreeExtra::geom_fruit() and can be used to visualize a tree, multiple sequence alignments, and different types of associated data to explore their underlying linkages/associations.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Plotting tree with data</span>"
    ]
  },
  {
    "objectID": "07_ggtree_tree_with_data.html#sec-composite_plot",
    "href": "07_ggtree_tree_with_data.html#sec-composite_plot",
    "title": "6  Plotting tree with data",
    "section": "6.5 Composite Plots",
    "text": "6.5 Composite Plots\nIn addition to aligning graphs to a tree using geom_facet() or ggtreeExtra::geom_fruit() and special cases using the gheatmap() and msaplot() functions, users can use cowplot, patchwork, gtable2 or other packages to create composite plots. However, extra efforts need to be done to make sure all the plots are aligned properly. The ggtree::get_taxa_name() function is quite useful for users to re-order their data based on the tree structure. To remove this obstacle, we created an R package aplot that can re-order the internal data of a ggplot object and create composite plots that align properly with a tree.\nIn the following example, we have a tree with two associated datasets.\n\nlibrary(ggplot2)\nlibrary(ggtree)\n\nset.seed(2019-10-31)\ntr &lt;- rtree(10)\n\nd1 &lt;- data.frame(\n    # only some labels match\n    label = c(tr$tip.label[sample(5, 5)], \"A\"),\n    value = sample(1:6, 6))\n\nd2 &lt;- data.frame(\n    label = rep(tr$tip.label, 5),\n    category = rep(LETTERS[1:5], each=10),\n    value = rnorm(50, 0, 3)) \n\ng &lt;- ggtree(tr) + geom_tiplab(align=TRUE) + hexpand(.01)\n\np1 &lt;- ggplot(d1, aes(label, value)) + geom_col(aes(fill=label)) + \n    geom_text(aes(label=label, y= value+.1)) +\n    coord_flip() + theme_tree2() + theme(legend.position='none')\n \np2 &lt;- ggplot(d2, aes(x=category, y=label)) + \n    geom_tile(aes(fill=value)) + scale_fill_viridis_c() + \n    theme_minimal() + xlab(NULL) + ylab(NULL)\n\n\n\nIf we align them using cowplot, the composite plots are not aligned properly as we anticipated (Figure ?fig-compositeA).\ncowplot::plot_grid(g, p2, p1, ncol=3) \nUsing aplot, it will do all the dirty work for us and all the subplots are aligned properly as demonstrated in Figure ?fig-compositeB.\nlibrary(aplot)\np2 %&gt;% insert_left(g) %&gt;% insert_right(p1, width=.5) \n\n\n\n\n\nExample of aligning tree with data side-by-side to create composite plot. r CRANpkg(\"cowplot\")`` just places the subplots together (A), whiler CRANpkg(“aplot”)` does extra work to make sure that tree-associated subplots are properly ordered according to the tree structure (B). Note: The ‘A’ category in the bar plot that is not matched with the tree was removed.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Plotting tree with data</span>"
    ]
  },
  {
    "objectID": "07_ggtree_tree_with_data.html#sec-summary7",
    "href": "07_ggtree_tree_with_data.html#sec-summary7",
    "title": "6  Plotting tree with data",
    "section": "6.6 Summary",
    "text": "6.6 Summary\nAlthough there are many software packages that support visualizing phylogenetic trees, plotting a tree with data is often missing or with only limited support. Some of the packages define S4 classes to store phylogenetic tree with domain-specific data, such as OutbreakTools (Jombart et al., 2014) defined obkData for storing tree with epidemiology data and phyloseq (McMurdie & Holmes, 2013) defines phyloseq for storing tree with microbiome data. These packages are capable of presenting some of the data stored in the object on the tree. However, not all the associated data are supported. For example, species abundance stored in the phyloseq object is not supported to be visualized using the phyloseq package. These packages did not provide any utilities to integrate external data for tree visualization. None of these packages support visualizing external data and aligning the plot to a tree based on the tree structure.\nThe ggtree package provides two general solutions for integrating data. Method 1, the %&lt;+% operator, can integrate external and internal node data and map the data as a visual characteristic to visualize the tree and other datasets used in geom_facet() or ggtreeExtra::geom_fruit(). Method 2, the geom_facet layer or ggtreeExtra::geom_fruit(), has no restriction of input data as long as there is a geom function available to plot the data (e.g., species abundance displayed by geom_density_ridges as demonstrated in Figure ?fig-phyloseq). Users are free to combine different panels and combine different geom layers in the same panel (Figure ?fig-jv2017).\n\nThe ggtree package has many unique features that cannot be found in other implementations (Yu et al., 2018):\n\nIntegrating node/edge data to the tree can be mapped to visual characteristics of the tree or other datasets (Figure ?fig-attacher).\nCapable of parsing expressions (math symbols or text formatting), emoji, and image files (Chapter 8).\nNo pre-definition of input data types or how the data should be plotted in geom_facet() (Table ?tbl-facet-geom).\nCombining different geom functions to visualize associated data is supported (Figure ?fig-jv2017).\nVisualizing different datasets on the same panel is supported.\nData integrated by %&lt;+% can be used in geom_facet() layer.\nAble to add further annotations to specific layers.\nModular design by separating tree visualization, data integration (Method 1), and graph alignment (Method 2).\n\nModular design is a unique feature for ggtree to stand out from other packages. The tree can be visualized with data stored in the tree object or external data linked by the %&lt;+% operator, and fully annotated with multiple layers of annotations (Figures ?fig-attacher and ?fig-jv2017), before passing it to geom_facet() layer. The geom_facet() layer can be called progressively to add multiple panels or multiple layers on the same panels (Figure ?fig-jv2017). This creates the possibility of plotting a full annotated tree with complex data panels that contain multiple graphic layers.\nThe ggtree package fits the R ecosystem and extends the abilities to integrate and present data with trees to existing phylogenetic packages. As demonstrated in Figure ?fig-phyloseq, we can plot species abundance distributions with the phyloseq object. This cannot be easily done without ggtree. With ggtree, we are able to attach additional data to tree objects using the %&lt;+% operator and align graphs to a tree using the geom_facet() layer. Integrating ggtree into existing workflows will extend the abilities and broaden the applications to present phylogeny-associated data, especially for comparative studies.\n\n\n\n\nJombart, T., Aanensen, D. M., Baguelin, M., Birrell, P., Cauchemez, S., Camacho, A., Colijn, C., Collins, C., Cori, A., Didelot, X., Fraser, C., Frost, S., Hens, N., Hugues, J., Höhle, M., Opatowski, L., Rambaut, A., Ratmann, O., Soubeyrand, S., … Ferguson, N. (2014). OutbreakTools: A new platform for disease outbreak analysis using the R software. Epidemics, 7, 28–34. https://doi.org/10.1016/j.epidem.2014.04.003\n\n\nMcMurdie, P. J., & Holmes, S. (2013). Phyloseq: An R package for reproducible interactive analysis and graphics of microbiome census data. PloS One, 8(4), e61217. https://doi.org/10.1371/journal.pone.0061217\n\n\nWang, L.-G., Lam, T. T.-Y., Xu, S., Dai, Z., Zhou, L., Feng, T., Guo, P., Dunn, C. W., Jones, B. R., Bradley, T., Zhu, H., Guan, Y., Jiang, Y., & Yu, G. (2020). Treeio: An r package for phylogenetic tree input and output with richly annotated and associated data. Molecular Biology and Evolution, 37(2), 599–603. https://doi.org/10.1093/molbev/msz240\n\n\nXu, S., Dai, Z., Guo, P., Fu, X., Liu, S., Zhou, L., Tang, W., Feng, T., Chen, M., Zhan, L., Wu, T., Hu, E., Jiang, Y., Bo, X., & Yu, G. (2021). ggtreeExtra: Compact Visualization of Richly Annotated Phylogenetic Data. Molecular Biology and Evolution, 38(9), 4039–4042. https://doi.org/10.1093/molbev/msab166\n\n\nYu, G. (2020). Using ggtree to visualize data on tree-like structures. Current Protocols in Bioinformatics, 69(1), e96. https://doi.org/10.1002/cpbi.96\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Plotting tree with data</span>"
    ]
  },
  {
    "objectID": "07_ggtree_tree_with_data.html#footnotes",
    "href": "07_ggtree_tree_with_data.html#footnotes",
    "title": "6  Plotting tree with data",
    "section": "",
    "text": "See also discussion in https://github.com/GuangchuangYu/ggtree/issues/78 and https://groups.google.com/d/msg/bioc-ggtree/VQqbF79NAWU/IjIvpQOBGwAJ↩︎\nhttps://github.com/YuLab-SMU/ggtree/issues/313↩︎",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Plotting tree with data</span>"
    ]
  },
  {
    "objectID": "08_ggtree_with_silhouette.html",
    "href": "08_ggtree_with_silhouette.html",
    "title": "7  Annotating Tree with Silhouette Images and Sub-plots",
    "section": "",
    "text": "7.1 Annotating Tree with Images\nWe usually use text to label taxa, i.e. displaying taxa names. If the text is the image file name (either local or remote), ggtree can read the image and display the actual image as the label of the taxa (Figure ?fig-frogimage). The geom_tiplab() and geom_nodelab() are capable to render silhouette images with supports from in-house developed package, ggimage.\nOnline tools such as iTOL (Letunic & Bork, 2007) and EvolView (He et al., 2016) support displaying subplots on a phylogenetic tree. However, only bar and pie charts are supported by these tools. Users may want to visualize node-associated data with other visualization methods, such as violin plot (Grubaugh et al., 2017), venn diagram (Lott et al., 2015), sequence logo, etc., and display them on the tree. In ggtree, all kinds of subplots are supported, as we can export all subplots to image files and use them to label corresponding nodes on the tree.\nlibrary(ggimage)\nlibrary(ggtree)\n\nnwk &lt;- paste0(\"((((bufonidae, dendrobatidae), ceratophryidae),\",\n          \"(centrolenidae, leptodactylidae)), hylidae);\")\n\nimgdir &lt;- system.file(\"extdata/frogs\", package = \"TDbook\")\n\nx = read.tree(text = nwk)\nggtree(x) + xlim(NA, 7) + ylim(NA, 6.2) +\n    geom_tiplab(aes(image=paste0(imgdir, '/', label, '.jpg')), \n                geom=\"image\", offset=2, align=2, size=.2)  + \n    geom_tiplab(geom='label', offset=1, hjust=.5) + \n    geom_image(x=.8, y=5.5, image=paste0(imgdir, \"/frog.jpg\"), size=.2)\n\n\n\n\nLabelling taxa with images. Users need to specify geom = \"image\" and map the image file names onto the image aesthetics.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Annotating Tree with Silhouette Images and Sub-plots</span>"
    ]
  },
  {
    "objectID": "08_ggtree_with_silhouette.html#sec-phylopic",
    "href": "08_ggtree_with_silhouette.html#sec-phylopic",
    "title": "7  Annotating Tree with Silhouette Images and Sub-plots",
    "section": "7.2 Annotating Tree with Phylopic",
    "text": "7.2 Annotating Tree with Phylopic\nPhylopic contains more than 3200 silhouettes and covers almost all life forms. The ggtree package supports using phylopic1 to annotate the tree by setting geom=\"phylopic\" and mapping phylopic UID to the image aesthetics. The ggimage package supports querying phylopic UID from the scientific name, which is very handy for annotating tree with phylopic. In the following example, tip labels were used to query phylopic UID, and phylopic images were used to label the tree as another layer of tip labels. Most importantly, we can color or resize the images using numerical/categorical variables, and here the values of body mass were used to encode the color of the images (Figure ?fig-phylopic).\n\n\nlibrary(ggtree)\nnewick &lt;- paste0(\"((Pongo_abelii,(Gorilla_gorilla_gorilla,(Pan_paniscus,\",\n          \"Pan_troglodytes)Pan,Homo_sapiens)Homininae)Hominidae,\",\n          \"Nomascus_leucogenys)Hominoidea;\")\n\ntree &lt;- read.tree(text=newick)\n\nd &lt;- ggimage::phylopic_uid(tree$tip.label)\nd$body_mass &lt;- c(52, 114, 47, 45, 58, 6)\n\np &lt;- ggtree(tree) %&lt;+% d + \n  geom_tiplab(aes(image=uid, colour=body_mass), geom=\"phylopic\", offset=2.5) +\n  geom_tiplab(aes(label=label), offset = .2) + xlim(NA, 7) +\n  scale_color_viridis_c()\n\n\n\n\n\n\n\nLabelling taxa with phylopic images. The r Biocpkg(\"ggtree\") will automatically download phylopic figures by querying provided UID. The figures can be colored using numerical or categorical values.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Annotating Tree with Silhouette Images and Sub-plots</span>"
    ]
  },
  {
    "objectID": "08_ggtree_with_silhouette.html#sec-subplots",
    "href": "08_ggtree_with_silhouette.html#sec-subplots",
    "title": "7  Annotating Tree with Silhouette Images and Sub-plots",
    "section": "7.3 Annotating Tree with Sub-plots",
    "text": "7.3 Annotating Tree with Sub-plots\nThe ggtree package provides a layer, geom_inset(), for adding subplots to a phylogenetic tree. The input is a named list of ggplot graphic objects (can be any kind of chart). These objects should be named by node numbers. Users can also use ggplotify to convert plots generated by other functions (even implemented by base graphics) to ggplot objects, which can then be used in the geom_inset() layer. To facilitate adding bar and pie charts (e.g., summarized stats of results from ancestral reconstruction) to the phylogenetic tree, ggtree provides the nodepie() and nodebar() functions to create a list of pie or bar charts.\n\n7.3.1 Annotate with bar charts\nThis example uses ape::ace() function to estimate ancestral character states. The likelihoods of the stats were visualized as stacked bar charts which were overlayed onto internal nodes of the tree using the geom_inset() layer (Figure ?fig-pieInsetA).\n\nlibrary(phytools)\ndata(anoletree)\nx &lt;- getStates(anoletree,\"tips\")\ntree &lt;- anoletree\n\ncols &lt;- setNames(palette()[1:length(unique(x))],sort(unique(x)))\nfitER &lt;- ape::ace(x,tree,model=\"ER\",type=\"discrete\")\nancstats &lt;- as.data.frame(fitER$lik.anc)\nancstats$node &lt;- 1:tree$Nnode+Ntip(tree)\n\n## cols parameter indicate which columns store stats\nbars &lt;- nodebar(ancstats, cols=1:6)\nbars &lt;- lapply(bars, function(g) g+scale_fill_manual(values = cols))\n\ntree2 &lt;- full_join(tree, data.frame(label = names(x), stat = x ), by = 'label')\np &lt;- ggtree(tree2) + geom_tiplab() +\n    geom_tippoint(aes(color = stat)) + \n    scale_color_manual(values = cols) +\n    theme(legend.position = \"right\") + \n    xlim(NA, 8)\np1 &lt;- p + geom_inset(bars, width = .08, height = .05, x = \"branch\") \n\nThe x position can be one of ‘node’ or ‘branch’ and can be adjusted by the parameters, hjust and vjust, for horizontal and vertical adjustment, respectively. The width and height parameters restrict the size of the inset plots.\n\n\n7.3.2 Annotate with pie charts\nSimilarly, users can use the nodepie() function to generate a list of pie charts and place these charts to annotate corresponding nodes (Figure ?fig-pieInsetB). Both nodebar() and nodepie() accept a parameter of alpha to allow transparency.\n\npies &lt;- nodepie(ancstats, cols = 1:6)\npies &lt;- lapply(pies, function(g) g+scale_fill_manual(values = cols))\np2 &lt;- p + geom_inset(pies, width = .1, height = .1) \n\nplot_list(p1, p2, guides='collect', tag_levels='A')\n\n\n\n\nAnnotate internal nodes with bar or pie charts. Using bar charts (A) or pie charts (B) to display summary statistics of internal nodes.\n\n\n\n\n\n\n7.3.3 Annotate with mixed types of charts\nThe geom_inset() layer accepts a list of ‘ggplot’ graphic objects and these input objects are not restricted to pie or bar charts. They can be any kind of charts or hybrid of these charts. The geom_inset() is not only useful to display ancestral stats, but also applicable to visualize different types of data that are associated with selected nodes in the tree. Here, we use a mixture of pie and bar charts to annotate the tree as an example (Figure ?fig-barpieInset).\n\npies_and_bars &lt;- pies\ni &lt;- sample(length(pies), 20)\npies_and_bars[i] &lt;- bars[i]\np + geom_inset(pies_and_bars, width=.08, height=.05)\n\n\n\n\nAnnotate internal nodes with different types of subplots.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Annotating Tree with Silhouette Images and Sub-plots</span>"
    ]
  },
  {
    "objectID": "08_ggtree_with_silhouette.html#sec-phylomoji",
    "href": "08_ggtree_with_silhouette.html#sec-phylomoji",
    "title": "7  Annotating Tree with Silhouette Images and Sub-plots",
    "section": "7.4 Have Fun with Phylomoji",
    "text": "7.4 Have Fun with Phylomoji\nPhylomoji is a phylogenetic tree of emoji. It is fun2 and very useful for education of the evolution concept. The ggtree supports producing phylomoji since 20153. Here, we will use ggtree to recreate the following phylomoji figure4 (Figure ?fig-phylomoji1):\n\n\nlibrary(ggplot2)\nlibrary(ggtree)\n\ntt = '((snail,mushroom),(((sunflower,evergreen_tree),leaves),green_salad));'\ntree = read.tree(text = tt)\nd &lt;- data.frame(label = c('snail','mushroom', 'sunflower',\n                          'evergreen_tree','leaves', 'green_salad'),\n                group = c('animal', 'fungi', 'flowering plant',\n                          'conifers', 'ferns', 'mosses'))\n\np &lt;- ggtree(tree, linetype = \"dashed\", size=1, color='firebrick') %&lt;+% d + \n  xlim(0, 4.5) + ylim(0.5, 6.5) +\n  geom_tiplab(parse=\"emoji\", size=15, vjust=.25) +\n  geom_tiplab(aes(label = group), geom=\"label\", x=3.5, hjust=1)\n\n\n\n\n\n\nParsing label as emoji. Text (e.g., node or tip labels) can be parsed as emoji.\n\n\n\n\nNote that the output may depend on what emoji fonts are installed in your system5.\nWith ggtree, it is easy to generate phylomoji. The emoji is treated as text, like ‘abc’. We can use emojis to label taxa, clade, color and rotate emoji with any given color and angle. This functionality is internally supported by the emojifont package.\n\n7.4.1 Emoji in circular/fan layout tree\nIt also works with circular and fan layouts as demonstrated in Figure ?fig-emojifan.\n\np &lt;- ggtree(tree, layout = \"circular\", size=1) +  \n  geom_tiplab(parse=\"emoji\", size=10, vjust=.25)\nprint(p)\n\n## fan layout  \np2 &lt;- open_tree(p, angle=200) \nprint(p2)\n\np2 %&gt;% rotate_tree(-90)\n\n\n\n\n\n\nPhylomoji in cirular and fan layouts.\n\n\n\n\nAnother example using ggtree and emojifont to produce phylogeny of plant emojis can be found in a scientific article (Escudero & Wendel, 2020).\n\n\n7.4.2 Emoji to label clades\nParsing clade labels as emojis is also supported in the geom_cladelab() layer. For example, in a phylogenetic tree of influenza viruses, we can use emojis to label clades to represent host species similar to Figure ?fig-emojiclade.\n\nset.seed(123)\ntr &lt;- rtree(30)\n\ndat &lt;- data.frame(\n           node = c(41, 53, 48),\n           name = c(\"chicken\", \"duck\", \"family\")\n       )\n\np &lt;- ggtree(tr) + \n     xlim(NA, 5.2) +\n     geom_cladelab(\n         data = dat,\n         mapping = aes(\n             node = node, \n             label = name, \n             color = name\n         ),\n         parse = \"emoji\",\n         fontsize = 12,\n         align = TRUE,\n         show.legend = FALSE\n     ) +\n     scale_color_manual(\n         values = c(\n             chicken=\"firebrick\", \n             duck=\"steelblue\", \n             family = \"darkkhaki\"\n         )\n     )\np\n\n\n\n\nEmoji to label clades.\n\n\n\n\n\n\n7.4.3 Apple Color Emoji\nAlthough R’s graphical devices don’t support AppleColorEmoji font on MacOS, it’s still possible to use it. We can export the plot to a svg file and render it in Safari (Figure ?fig-applemoji).\nlibrary(ggtree)\ntree_text &lt;- paste0(\"(((((cow, (whale, dolphin)), (pig2, boar)),\",\n                    \"camel), fish), seedling);\")\nx &lt;- read.tree(text=tree_text)\nlibrary(ggimage)\np &lt;-  ggtree(x, size=2) + geom_tiplab(size=20, parse='emoji') +\n    xlim(NA, 7) + ylim(NA, 8.5) \n\nsvglite::svglite(\"emoji.svg\", width = 10, height = 7)\nprint(p)\ndev.off()\n\n# or use `grid.export()` \n# ps = gridSVG::grid.export(\"emoji.svg\", addClass=T)\n\n\n\n\n\nUse Apple Color Emoji in ggtree. The tip labels were parsed as emojis using AppleColorEmoji font in Safari.\n\n\n\n\n\n\n7.4.4 Phylomoji in ASCII art\nProducing phylomoji as an ASCII art is also possible. Users can refer to Appendix D for details.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Annotating Tree with Silhouette Images and Sub-plots</span>"
    ]
  },
  {
    "objectID": "08_ggtree_with_silhouette.html#sec-summary8",
    "href": "08_ggtree_with_silhouette.html#sec-summary8",
    "title": "7  Annotating Tree with Silhouette Images and Sub-plots",
    "section": "7.5 Summary",
    "text": "7.5 Summary\nThe ggtree supports parsing labels, including tip labels, internal node labels, and clade labels, as images, math expression, and emoji, in case the labels can be parsed as image file names, plotmath expression, or emoji names, respectively. It can be fun, but it’s also very useful for scientific research. The use of images on phylogenetic trees can help to present species-related characteristics, including morphological, anatomical, and even macromolecular structures. Moreover, ggtree supports summarizing statistical inferences (e.g., biogeographic range reconstruction and posterior distribution) or associated data of the nodes as subplots to be displayed on a phylogenetic tree.\n\n\n\n\nEscudero, M., & Wendel, J. F. (2020). The grand sweep of chromosomal evolution in angiosperms. New Phytologist, 228(3), 805–808. https://doi.org/10.1111/nph.16802\n\n\nGrubaugh, N. D., Ladner, J. T., Kraemer, M. U. G., Dudas, G., Tan, A. L., Gangavarapu, K., Wiley, M. R., White, S., Thézé, J., Magnani, D. M., Prieto, K., Reyes, D., Bingham, A. M., Paul, L. M., Robles-Sikisaka, R., Oliveira, G., Pronty, D., Barcellona, C. M., Metsky, H. C., … Andersen, K. G. (2017). Genomic epidemiology reveals multiple introductions of zika virus into the united states. Nature, 546(7658), 401–405. https://doi.org/10.1038/nature22400\n\n\nHe, Z., Zhang, H., Gao, S., Lercher, M. J., Chen, W.-H., & Hu, S. (2016). Evolview v2: An online visualization and management tool for customized and annotated phylogenetic trees. Nucleic Acids Research, 44(W1), W236–241. https://doi.org/10.1093/nar/gkw370\n\n\nLetunic, I., & Bork, P. (2007). Interactive Tree Of Life (iTOL): An online tool for phylogenetic tree display and annotation. Bioinformatics, 23(1), 127–128. https://doi.org/10.1093/bioinformatics/btl529\n\n\nLott, S. C., Voß, B., Hess, W. R., & Steglich, C. (2015). CoVennTree: A new method for the comparative analysis of large datasets. Frontiers in Genetics, 6, 43. https://doi.org/10.3389/fgene.2015.00043",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Annotating Tree with Silhouette Images and Sub-plots</span>"
    ]
  },
  {
    "objectID": "08_ggtree_with_silhouette.html#footnotes",
    "href": "08_ggtree_with_silhouette.html#footnotes",
    "title": "7  Annotating Tree with Silhouette Images and Sub-plots",
    "section": "",
    "text": "https://twitter.com/guangchuangyu/status/593443854541434882↩︎\nhttps://twitter.com/hashtag/phylomoji?src=hash↩︎\nhttps://twitter.com/guangchuangyu/status/662095056610811904 and https://twitter.com/guangchuangyu/status/667337429704011777↩︎\nhttps://twitter.com/OxyMLZ/status/1055586178651451392↩︎\nGoogle Noto emoji fonts was installed in my system↩︎",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Annotating Tree with Silhouette Images and Sub-plots</span>"
    ]
  },
  {
    "objectID": "09_ggtree_tree_objects.html",
    "href": "09_ggtree_tree_objects.html",
    "title": "8  ggtree for Other Tree-like Objects",
    "section": "",
    "text": "8.1 ggtree for Phylogenetic Tree Objects\nThe treeio packages (Wang et al., 2020) allow parsing evolutionary inferences from several software outputs and linking external data to the tree structure. It serves as an infrastructure to bring evolutionary data to the R community. The ggtree package (Yu et al., 2017) works seamlessly with treeio to visualize tree-associated data to annotate the tree. The ggtree package is a general tool for tree visualization and annotation and it fits the ecosystem of R packages. Most of the S3/S4 tree objects defined by other R packages are also supported by ggtree, including phylo (session 4.2), multiPhylo (session 4.4), phylo4, phylo4d, phyloseq, and obkData. With ggtree, we are able to generate more complex tree graphs which is not possible or easy to do with other packages. For example, the visualization of the phyloseq object in Figure ?fig-phyloseq is not supported by the phyloseq package. The ggtree package also extends the possibility of linking external data to these tree objects (Yu et al., 2018).",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>ggtree for Other Tree-like Objects</span>"
    ]
  },
  {
    "objectID": "09_ggtree_tree_objects.html#ggtree-for-phylogenetic-tree-objects",
    "href": "09_ggtree_tree_objects.html#ggtree-for-phylogenetic-tree-objects",
    "title": "8  ggtree for Other Tree-like Objects",
    "section": "",
    "text": "8.1.1 The phylo4 and phylo4d objects\nThe phylo4 and phylo4d are defined in the phylobase package. The phylo4 object is an S4 version of phylo, while phylo4d extends phylo4 with a data frame that contains trait data. The phylobase package provides a plot() method, which is internally called the treePlot() function, to display the tree with the data. However, there are some restrictions of the plot() method, it can only plot numeric values for tree-associated data as bubbles and cannot generate figure legend. Phylobase doesn’t implement a visualization method to display categorical values. Using associated data as visual characteristics such as color, size, and shape, is also not supported. Although it is possible to color the tree using associated data, it requires users to extract the data and map them to the color vector manually followed by passing the color vector to the plot method. This is tedious and error-prone since the order of the color vector needs to be consistent with the edge list stored in the object.\nThe ggtree package supports phylo4d object and all the associated data stored in the phylo4d object can be used directly to annotate the tree (Figure ?fig-fp4d).\n\nlibrary(phylobase)\ndata(geospiza_raw)\ng1 &lt;- as(geospiza_raw$tree, \"phylo4\")\ng2 &lt;- phylo4d(g1, geospiza_raw$data, missing.data=\"warn\")\n\nd1 &lt;- data.frame(x = seq(1.1, 2, length.out = 5),\n                lab = names(geospiza_raw$data))\n\np1 &lt;- ggtree(g2) + geom_tippoint(aes(size = wingL), x = d1$x[1], shape = 1) + \n    geom_tippoint(aes(size = tarsusL), x = d1$x[2], shape = 1) + \n    geom_tippoint(aes(size = culmenL), x = d1$x[3], shape = 1) + \n    geom_tippoint(aes(size = beakD),   x = d1$x[4], shape = 1) + \n    geom_tippoint(aes(size = gonysW),  x = d1$x[5], shape = 1) + \n    scale_size_continuous(range = c(3,12), name=\"\") + \n    geom_text(aes(x = x, y = 0, label = lab), data = d1, angle = 45) +\n    geom_tiplab(offset = 1.3) + xlim(0, 3) +\n    theme(legend.position = c(.1, .75)) + vexpand(.05, -1) \n\n## users can use `as.treedata(g2)` to convert `g2` to a `treedata` object\n## and use `get_tree_data()` function to extract the associated data \n\np2 &lt;- gheatmap(ggtree(g1), data=geospiza_raw$data, colnames_angle=45) + \n  geom_tiplab(offset=1) + hexpand(.2) + vexpand(.05, -1) + \n  theme(legend.position = c(.1, .75))\n\naplot::plot_list(p1, p2, ncol=2, tag_levels='A')    \n\n\n\n\nVisualizing phylo4d data using ggtree. Reproduce the output of the plot() method provided in the r CRANpkg(\"phylobase\") package (A). Visualize the trait data as a heatmap which is not supported in the r CRANpkg(\"phylobase\") package (B).\n\n\n\n\n\n\n8.1.2 The phylog object\nThe phylog is defined in the ade4 package. The package is designed for analyzing ecological data and provides newick2phylog(), hclust2phylog(), and taxo2phylog() functions to create phylogeny from Newick string, hierarchical clustering result, or a taxonomy (see also the MicrobiotaProcess package described in Chapter 11). The phylog object is also supported by ggtree as demonstrated in Figure ?fig-phylog.\n\nlibrary(ade4)\ndata(taxo.eg)\ntax &lt;- as.taxo(taxo.eg[[1]])\nnames(tax) &lt;- c(\"genus\", \"family\", \"order\")\nprint(tax)\n\n      genus family order\nesp3     g1   fam1  ORD1\nesp1     g1   fam1  ORD1\nesp2     g1   fam1  ORD1\nesp4     g1   fam1  ORD1\nesp5     g1   fam1  ORD1\nesp6     g1   fam1  ORD1\nesp7     g1   fam1  ORD1\nesp8     g2   fam2  ORD2\nesp9     g3   fam2  ORD2\nesp10    g4   fam3  ORD2\nesp11    g5   fam3  ORD2\nesp12    g6   fam4  ORD2\nesp13    g7   fam4  ORD2\nesp14    g8   fam5  ORD2\nesp15    g8   fam5  ORD2\n\ntax.phy &lt;- taxo2phylog(as.taxo(taxo.eg[[1]]))\nprint(tax.phy)\n\nPhylogenetic tree with 15 leaves and 16 nodes\n$class: phylog\n$call: taxo2phylog(taxo = as.taxo(taxo.eg[[1]]))\n$tre: ((((esp3,esp1,esp2,esp4,e...15)l1g8)l2fam5)l3ORD2)Root; \n\n        class   length content                                     \n$leaves numeric 15     length of the first preceeding adjacent edge\n$nodes  numeric 16     length of the first preceeding adjacent edge\n$parts  list    16     subsets of descendant nodes                 \n$paths  list    31     path from root to node or leave             \n$droot  numeric 31     distance to root                            \n\nggtree(tax.phy) + geom_tiplab() + \n  geom_nodelab(geom='label') + hexpand(.05)\n\nWarning in (function (mapping = NULL, data = NULL, ..., stat = \"identity\", :\nIgnoring unknown parameters: `label.size`\n\n\n\n\n\nVisualizing a phylog tree object.\n\n\n\n\n\n\n8.1.3 The phyloseq object\nThe phyloseq class defined in the phyloseq package was designed for storing microbiome data, including a phylogenetic tree, associated sample data, and taxonomy assignment. It can import data from popular pipelines, such as QIIME (Kuczynski et al., 2011), mothur (Schloss et al., 2009), dada2 (Callahan et al., 2016) and PyroTagger (Kunin & Hugenholtz, 2010), etc. The ggtree supports visualizing the phylogenetic tree stored in the phyloseq object and related data can be used to annotate the tree as demonstrated in Figures ?fig-reproducephyloseq and ?fig-phyloseq.\n\nlibrary(phyloseq)\nlibrary(scales)\n\ndata(GlobalPatterns)\nGP &lt;- prune_taxa(taxa_sums(GlobalPatterns) &gt; 0, GlobalPatterns)\nGP.chl &lt;- subset_taxa(GP, Phylum==\"Chlamydiae\")\n\nggtree(GP.chl) + \n  geom_nodelab(aes(label=label), hjust=-.05, size=3.5) +\n\n  geom_point(aes(x=x+hjust, color=SampleType, shape=Family, \n                size=Abundance), na.rm=TRUE) +\n  geom_tiplab(aes(label=Genus), hjust=-.35) +                \n  scale_size_continuous(trans=log_trans(5)) +\n  theme(legend.position=\"right\") + hexpand(.4)\n\n\n\n\nVisualizing a phyloseq tree object. This example mimics the output of the plot_tree() function provided in the r Biocpkg(\"phyloseq\") package.\n\n\n\n\nFigure ?fig-reproducephyloseq reproduces the output of the phyloseq::plot_tree() function. Users of phyloseq will find ggtree useful for visualizing microbiome data and for further annotation since ggtree supports high-level annotation using the grammar of graphics and can add tree data layers that are not available in phyloseq.\n\nlibrary(ggridges)\n\ndata(\"GlobalPatterns\")\nGP &lt;- GlobalPatterns\nGP &lt;- prune_taxa(taxa_sums(GP) &gt; 600, GP)\nsample_data(GP)$human &lt;- get_variable(GP, \"SampleType\") %in% \n  c(\"Feces\", \"Skin\") \n\nmergedGP &lt;- merge_samples(GP, \"SampleType\")\nmergedGP &lt;- rarefy_even_depth(mergedGP,rngseed=394582)\nmergedGP &lt;- tax_glom(mergedGP,\"Order\") \n\nmelt_simple &lt;- psmelt(mergedGP) %&gt;% \n  filter(Abundance &lt; 120) %&gt;% \n  select(OTU, val=Abundance)\n\nggtree(mergedGP) + \n  geom_tippoint(aes(color=Phylum), size=1.5) +\n  geom_facet(mapping = aes(x=val,group=label, \n                           fill=Phylum),\n            data = melt_simple, \n            geom = geom_density_ridges,\n            panel=\"Abundance\",  \n            color='grey80', lwd=.3) +\n  guides(color = guide_legend(ncol=1))          \n\n\n\n\nPhylogenetic tree with OTU abundance densities. Tips were colored by Phylum, and the corresponding abundances across different samples were visualized as density ridgelines and sorted according to the tree structure.\n\n\n\n\nThis example uses microbiome data provided in the phyloseq package and density ridgeline is employed to visualize species abundance data. The geom_facet() layer automatically re-arranges the abundance data according to the tree structure, visualizes the data using the specified geom function, i.e., geom_density_ridges(), and aligns the density curves with the tree as demonstrated in Figure ?fig-phyloseq. Note that data stored in the phyloseq object is visible to ggtree() and can be used directly in tree visualization (Phylum was used to color tips and density ridgelines in this example). The source code of this example was firstly published in the supplemental file of (Yu et al., 2018).\n\n\n8.1.4 The obkData object\nThe okbData is defined in the OutbreakTools package to store incidence-based outbreak data, including meta data of sampling and information of infected individuals such as age and onset of symptoms. The ggtree supports the obkData object and the information can be used to annotate the tree as shown in Figure ?fig-outbreaktools.\n#| label: outbreaktools\n#| fig.width: 6.3\n#| fig.height: 7\n#| fig.cap: \"(ref:outbreaktoolscap)\"\n#| fig.scap: \"(ref:outbreaktoolsscap)\"\n#| message: FALSE\n#| out.extra: ''\n#| eval: FALSE\nlibrary(OutbreakTools)\ndata(FluH1N1pdm2009)\nattach(FluH1N1pdm2009)\n\nx &lt;- new(\"obkData\", \n         individuals = individuals, \n         dna = dna,\n         dna.individualID = samples$individualID, \n         dna.date = samples$date,\n         trees = FluH1N1pdm2009$trees)\nggtree(x, mrsd=\"2009-09-30\", as.Date=TRUE, right=TRUE) +\n    geom_tippoint(aes(color=location), size=3, alpha=.75) +\n    scale_color_brewer(\"location\", palette=\"Spectral\") +\n    theme_tree2(legend.position='right')",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>ggtree for Other Tree-like Objects</span>"
    ]
  },
  {
    "objectID": "09_ggtree_tree_objects.html#sec-dendrogram",
    "href": "09_ggtree_tree_objects.html#sec-dendrogram",
    "title": "8  ggtree for Other Tree-like Objects",
    "section": "8.2 ggtree for Dendrograms",
    "text": "8.2 ggtree for Dendrograms\nA dendrogram is a tree diagram to display hierarchical clustering and classification/regression trees. In R, we can calculate a hierarchical clustering using the function hclust().\n\nhc &lt;- hclust(dist(mtcars))\nhc\n\n\nCall:\nhclust(d = dist(mtcars))\n\nCluster method   : complete \nDistance         : euclidean \nNumber of objects: 32 \n\n\nThe hclust object describes the tree produced by the clustering process. It can be converted to dendrogram object, which stores the tree as deeply-nested lists.\n\nden &lt;- as.dendrogram(hc)\nden\n\n'dendrogram' with 2 branches and 32 members total, at height 425.3447 \n\n\nThe ggtree package supports most of the hierarchical clustering objects defined in the R community, including hclust and dendrogram as well as agnes, diana, and twins that are defined in the cluster package, and the pvclust object defined in the pvclust package (Table ?tbl-tree-objects). Users can use ggtree(object) to display its tree structure, and use other layers and utilities to customize the graph and of course, add annotations to the tree.\nThe ggtree provides layout_dendrogram() to layout the tree top-down, and theme_dendrogram() to display tree height (similar to theme_tree2() for phylogenetic tree) as demonstrated in Figure ?fig-ggtreehclust (see also the example in (Yu, 2020)).\n\nMRCA = ggtree:::MRCA.ggtree\n\n\nclus &lt;- cutree(hc, 4)\ng &lt;- split(names(clus), clus)\n\np &lt;- ggtree(hc, linetype='dashed')\nclades &lt;- sapply(g, function(n) MRCA(p, n))\n\np &lt;- groupClade(p, clades, group_name='subtree') + aes(color=subtree)\n\nd &lt;- data.frame(label = names(clus), \n                  cyl = mtcars[names(clus), \"cyl\"])\n\np %&lt;+% d + \n  layout_dendrogram() + \n  geom_tippoint(aes(fill=factor(cyl), x=x+.5), \n                size=5, shape=21, color='black') + \n  geom_tiplab(aes(label=cyl), size=3, hjust=.5, color='black') +\n  geom_tiplab(angle=90, hjust=1, offset=-10, show.legend=FALSE) + \n  scale_color_brewer(palette='Set1', breaks=1:4) +\n  theme_dendrogram(plot.margin=margin(6,6,80,6)) +\n  theme(legend.position=c(.9, .6))\n\n\n\n\nVisualizing dendrogram. Use cutree() to split the tree into several groups and groupClade() to assign this grouping information. The tree was displayed in the classic top-down layout with branches colored by the grouping information and the tips were colored and labeled by the number of cylinders.\n\n\n\n\n\nMRCA = tidytree::MRCA",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>ggtree for Other Tree-like Objects</span>"
    ]
  },
  {
    "objectID": "09_ggtree_tree_objects.html#sec-igraph",
    "href": "09_ggtree_tree_objects.html#sec-igraph",
    "title": "8  ggtree for Other Tree-like Objects",
    "section": "8.3 ggtree for Tree Graph",
    "text": "8.3 ggtree for Tree Graph\nThe tree graph (as an igraph object) can be converted to a phylo object using as.phylo() method provided in the treeio package (Table ?tbl-tree-objects). The ggtree supports directly visualizing tree graph as demonstrated in Figure ?fig-treeGraph. Note that currently not all igraph objects can be supported by ggtree. Currently, it can only be supported when it is a tree graph.\n\nlibrary(igraph)\ng &lt;- graph.tree(40, 3)\n\nWarning: `graph.tree()` was deprecated in igraph 2.1.0.\nℹ Please use `make_tree()` instead.\n\narrow_size &lt;- unit(rep(c(0, 3), times = c(27, 13)), \"mm\")\nggtree(g, layout='slanted', arrow = arrow(length=arrow_size)) + \n  geom_point(size=5, color='steelblue', alpha=.6) + \n  geom_tiplab(hjust=.5,vjust=2) + layout_dendrogram()\n\n\n\n\nVisualizing a tree graph. The lines with arrows indicate the relationship between the parent node and the child node. All nodes were indicated by steelblue circle points.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>ggtree for Other Tree-like Objects</span>"
    ]
  },
  {
    "objectID": "09_ggtree_tree_objects.html#ggtree-for-other-tree-like-structures",
    "href": "09_ggtree_tree_objects.html#ggtree-for-other-tree-like-structures",
    "title": "8  ggtree for Other Tree-like Objects",
    "section": "8.4 ggtree for Other Tree-like Structures",
    "text": "8.4 ggtree for Other Tree-like Structures\nThe ggtree package can be used to visualize any data in a hierarchical structure. Here, we use the GNI (Gross National Income) numbers in 2014 as an example. After preparing an edge list, that is a matrix or data frame that contains two columns indicating the relationship of parent and child nodes, we can use the as.phylo() method provided by the treeio package to convert the edge list to a phylo object. Then it can be visualized using ggtree with associated data. In this example, the population was used to scale the size of circle points for each country (Figure ?fig-gni2014).\n\nlibrary(treeio)\nlibrary(ggplot2)\nlibrary(ggtree)\n\ndata(\"GNI2014\", package=\"treemap\")\nn &lt;- GNI2014[, c(3,1)]\nn[,1] &lt;- as.character(n[,1])\nn[,1] &lt;- gsub(\"\\\\s\\\\(.*\\\\)\", \"\", n[,1])\n\nw &lt;- cbind(\"World\", as.character(unique(n[,1])))\n\ncolnames(w) &lt;- colnames(n)\nedgelist &lt;- rbind(n, w)\n\ny &lt;- as.phylo(edgelist)\nggtree(y, layout='circular') %&lt;+% GNI2014 + \n    aes(color=continent) + geom_tippoint(aes(size=population), alpha=.6) + \n    geom_tiplab(aes(label=country), offset=.05, size=3) +\n    xlim(NA, 3)\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nVisualizing data in any hierarchical structure. Hierarchical data represented as nodes connected by edges can be converted to a phylo object and visualized by r Biocpkg(\"ggtree\") to explore their relationships or other properties that are associated with the relationships.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>ggtree for Other Tree-like Objects</span>"
    ]
  },
  {
    "objectID": "09_ggtree_tree_objects.html#sec-summary9",
    "href": "09_ggtree_tree_objects.html#sec-summary9",
    "title": "8  ggtree for Other Tree-like Objects",
    "section": "8.5 Summary",
    "text": "8.5 Summary\nThe ggtree supports various tree objects defined in the R language and extension packages, which makes it very easy to integrate ggtree into existing pipelines. Moreover, ggtree allows external data integration and exploration of these data on the tree, which will greatly promote the data visualization and result in interpretation in the downstream analysis of existing pipelines. Most importantly, the support for converting edge list to a tree object enables more tree-like structures to be incorporated into the framework of treeio and ggtree. This will enable more tree-like structures and related heterogeneous data in different disciplines to be integrated and visualized through treeio and ggtree, which facilitates integrated analysis and comparative analysis to discover more systematic patterns and insights.\n\n\n\n\nCallahan, B. J., McMurdie, P. J., Rosen, M. J., Han, A. W., Johnson, A. J. A., & Holmes, S. P. (2016). DADA2: High-resolution sample inference from Illumina amplicon data. Nature Methods, 13(7), 581–583. https://doi.org/10.1038/nmeth.3869\n\n\nKuczynski, J., Stombaugh, J., Walters, W. A., González, A., Caporaso, J. G., & Knight, R. (2011). Using QIIME to analyze 16S rRNA gene sequences from Microbial Communities. Current Protocols in Bioinformatics / Editoral Board, Andreas D. Baxevanis ... [Et Al.], CHAPTER, Unit10.7. https://doi.org/10.1002/0471250953.bi1007s36\n\n\nKunin, V., & Hugenholtz, P. (2010). PyroTagger : A fast , accurate pipeline for analysis of rRNA amplicon pyrosequence data. The Open Journal, 1–8. http://www.theopenjournal.org/toj_articles/1\n\n\nSchloss, P. D., Westcott, S. L., Ryabin, T., Hall, J. R., Hartmann, M., Hollister, E. B., Lesniewski, R. A., Oakley, B. B., Parks, D. H., Robinson, C. J., Sahl, J. W., Stres, B., Thallinger, G. G., Van Horn, D. J., & Weber, C. F. (2009). Introducing mothur: Open-source, platform-independent, community-supported software for describing and comparing microbial communities. Applied and Environmental Microbiology, 75(23), 7537–7541. https://doi.org/10.1128/AEM.01541-09\n\n\nWang, L.-G., Lam, T. T.-Y., Xu, S., Dai, Z., Zhou, L., Feng, T., Guo, P., Dunn, C. W., Jones, B. R., Bradley, T., Zhu, H., Guan, Y., Jiang, Y., & Yu, G. (2020). Treeio: An r package for phylogenetic tree input and output with richly annotated and associated data. Molecular Biology and Evolution, 37(2), 599–603. https://doi.org/10.1093/molbev/msz240\n\n\nYu, G. (2020). Using ggtree to visualize data on tree-like structures. Current Protocols in Bioinformatics, 69(1), e96. https://doi.org/10.1002/cpbi.96\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>ggtree for Other Tree-like Objects</span>"
    ]
  },
  {
    "objectID": "10_ggtree_exts.html",
    "href": "10_ggtree_exts.html",
    "title": "(PART*) Part III: ggtree extensions",
    "section": "",
    "text": "ggtreeExtra for Presenting Data on a Circular Layout\nlibrary(\"yulab.utils\")\nsource(\"setup.R\")\n\n[conflicted] Will prefer ggtree::expand over any other package.\n[conflicted] Will prefer ggtree::rotate over any other package.\n[conflicted] Will prefer treeio::mask over any other package.\n[conflicted] Will prefer treeio::parent over any other package.\n[conflicted] Will prefer treeio::ancestor over any other package.\n[conflicted] Will prefer treeio::get.data over any other package.\n[conflicted] Will prefer treeio::drop.tip over any other package.\n[conflicted] Will prefer treeio::read.newick over any other package.\n[conflicted] Will prefer tidytree::MRCA over any other package.\n[conflicted] Will prefer dplyr::filter over any other package.\n[conflicted] Will prefer dplyr::rename over any other package.\n[conflicted] Will prefer dplyr::collapse over any other package.\n[conflicted] Will prefer dplyr::intersect over any other package.\n[conflicted] Will prefer dplyr::union over any other package.\n[conflicted] Will prefer dplyr::slice over any other package.\n[conflicted] Will prefer base::strsplit over any other package.\n[conflicted] Will prefer base::paste over any other package.\n[conflicted] Will prefer ggplot2::geom_errorbarh over any other package.\n[conflicted] Will prefer MicrobiotaProcess::tax_table over any other package.\n[conflicted] Will prefer BiocGenerics::as.data.frame over any other package.\n[conflicted] Will prefer base::setdiff over any other package.",
    "crumbs": [
      "(PART\\*) Part III: ggtree extensions"
    ]
  },
  {
    "objectID": "10_ggtree_exts.html#introduction",
    "href": "10_ggtree_exts.html#introduction",
    "title": "(PART*) Part III: ggtree extensions",
    "section": "Introduction",
    "text": "Introduction\nThe ggtree package (Yu et al., 2017) provides programmable visualization and annotation of phylogenetic trees and other tree-like structures. It supports visualizing tree data in multiple layers or with the tree side-by-side (see also Chapter 7 and (Yu et al., 2018)). Although ggtree supports many layouts, the geom_facet() layer only works with rectangular, roundrect, ellipse, and slanted layouts to present tree data on different panels. There is no direct support in ggtree to present data on the outer rings of a tree in circular, fan, and radial layouts. To solve this issue, we developed the ggtreeExtra package, which allows users to align associated graph layers in outer rings of circular layout tree. In addition, it also works with a rectangular tree layout (Figure ?fig-HMPplot2).",
    "crumbs": [
      "(PART\\*) Part III: ggtree extensions"
    ]
  },
  {
    "objectID": "10_ggtree_exts.html#sec-geom-fruit1",
    "href": "10_ggtree_exts.html#sec-geom-fruit1",
    "title": "(PART*) Part III: ggtree extensions",
    "section": "Aligning Graphs to the Tree Based on a Tree Structure",
    "text": "Aligning Graphs to the Tree Based on a Tree Structure\nThe ggtreeExtra package provides a layer function, geom_fruit(), to align graphs with the tree side-by-side. Similar to the geom_facet() layout described in Chapter 7, geom_fruit() internally re-orders the input data based on the tree structure and visualizes the data using a specified geometric layer function with user-provided aesthetic mapping and non-variable setting. The graph will be displayed on the outer ring of the tree.\nThe geom_fruit() is designed to work with most geom layers defined in ggplot2 and its extensions. The position of the graph (i.e., on the outer ring) is controlled by the position parameter, which accepts a Position object. The default value of the position parameter is ‘auto’ and the geom_fruit() layer will guess and determine (hopefully) a suitable position for the specified geometric layer. That means using position_stackx() for geom_bar(), position_dodgex() for geom_violin() and geom_boxplot(), and position_identityx() for others (e.g., geom_point(), geom_tile(), etc.). A geometric layer that has a position parameter should be compatible with geom_fruit(), as it allows using position functions defined in the ggtreeExtra package to adjust output layer positions. Besides, the geom_fruit() layer allows setting axis and background grid lines for the current layer using the axis.params and grid.params parameters, respectively.\nThe following example uses microbiome data provided in the phyloseq package and a boxplot is employed to visualize species abundance data. The geom_fruit() layer automatically rearranges the abundance data according to the circular tree structure and visualizes the data using the specific geom function (i.e., geom_boxplot()). Visualizing this dataset using geom_density_ridges() with geom_facet() can be found in figure 1 of (Yu et al., 2018).\n\nlibrary(ggtreeExtra)\nlibrary(ggtree)\nlibrary(phyloseq)\nlibrary(dplyr)\n\ndata(\"GlobalPatterns\")\nGP &lt;- GlobalPatterns\nGP &lt;- prune_taxa(taxa_sums(GP) &gt; 600, GP)\nsample_data(GP)$human &lt;- get_variable(GP, \"SampleType\") %in%\n                              c(\"Feces\", \"Skin\")\nmergedGP &lt;- merge_samples(GP, \"SampleType\")\nmergedGP &lt;- rarefy_even_depth(mergedGP,rngseed=394582)\nmergedGP &lt;- tax_glom(mergedGP,\"Order\")\n\nmelt_simple &lt;- psmelt(mergedGP) %&gt;%\n               filter(Abundance &lt; 120) %&gt;%\n               select(OTU, val=Abundance)\n\np &lt;- ggtree(mergedGP, layout=\"fan\", open.angle=10) + \n     geom_tippoint(mapping=aes(color=Phylum), \n                   size=1.5,\n                   show.legend=FALSE)\np &lt;- rotate_tree(p, -90)\n\np &lt;- p +\n     geom_fruit(\n         data=melt_simple,\n         geom=geom_boxplot,\n         mapping = aes(\n                     y=OTU,\n                     x=val,\n                     fill=Phylum,\n                   ),\n         size=.2,\n         outlier.size=0.5,\n         outlier.stroke=0.08,\n         outlier.shape=21,\n         axis.params=list(\n                         axis       = \"x\",\n                         text.size  = 1.8,\n                         hjust      = 1,\n                         vjust      = 0.5,\n                         nbreak     = 3,\n                     ),\n         grid.params=list()\n     ) \n     \np &lt;- p +\n     scale_fill_discrete(\n         name=\"Phyla\",\n         guide=guide_legend(keywidth=0.8, keyheight=0.8, ncol=1)\n     ) +\n     theme(\n         legend.title=element_text(size=9), \n         legend.text=element_text(size=7) \n     )\np\n\n\n\n\nPhylogenetic tree with OTU abundance distribution. Species abundance distribution was aligned to the tree and visualized as boxplots. The Phylum information was used to color symbolic points on the tree and also species abundance distributions.",
    "crumbs": [
      "(PART\\*) Part III: ggtree extensions"
    ]
  },
  {
    "objectID": "10_ggtree_exts.html#sec-geom-fruit2",
    "href": "10_ggtree_exts.html#sec-geom-fruit2",
    "title": "(PART*) Part III: ggtree extensions",
    "section": "Aligning Multiple Graphs to the Tree for Multi-dimensional Data",
    "text": "Aligning Multiple Graphs to the Tree for Multi-dimensional Data\nWe are able to add multiple geom_fruit() layers to a tree and the circular layout is indeed more compact and efficient for multi-dimensional data. This example reproduces figure 2 of (Morgan et al., 2013). The data is provided by GraPhlAn (Asnicar et al., 2015), which contained the relative abundance of the microbiome at different body sites. This example demonstrates the ability to add multiple layers (heat map and bar plot) to present different types of data (Figure ?fig-HMPplot).\n\nlibrary(ggtreeExtra)\nlibrary(ggtree)\nlibrary(treeio)\nlibrary(tidytree)\nlibrary(ggstar)\nlibrary(ggplot2)\nlibrary(ggnewscale)\nlibrary(TDbook)\n\n# load data from TDbook, including tree_hmptree, \n# df_tippoint (the abundance and types of microbes),\n# df_ring_heatmap (the abundance of microbes at different body sites),\n# and df_barplot_attr (the abundance of microbes of greatest prevalence)\ntree &lt;- tree_hmptree\ndat1 &lt;- df_tippoint\ndat2 &lt;- df_ring_heatmap\ndat3 &lt;- df_barplot_attr\n\n# adjust the order\ndat2$Sites &lt;- factor(dat2$Sites, \n                    levels=c(\"Stool (prevalence)\", \"Cheek (prevalence)\",\n                             \"Plaque (prevalence)\",\"Tongue (prevalence)\",\n                             \"Nose (prevalence)\", \"Vagina (prevalence)\",\n                             \"Skin (prevalence)\"))\ndat3$Sites &lt;- factor(dat3$Sites, \n                    levels=c(\"Stool (prevalence)\", \"Cheek (prevalence)\",\n                             \"Plaque (prevalence)\", \"Tongue (prevalence)\",\n                             \"Nose (prevalence)\", \"Vagina (prevalence)\",\n                             \"Skin (prevalence)\"))\n# extract the clade label information. Because some nodes of tree are\n# annotated to genera, which can be displayed with high light using ggtree.\nnodeids &lt;- nodeid(tree, tree$node.label[nchar(tree$node.label)&gt;4])\nnodedf &lt;- data.frame(node=nodeids)\nnodelab &lt;- gsub(\"[\\\\.0-9]\", \"\", tree$node.label[nchar(tree$node.label)&gt;4])\n# The layers of clade and hightlight\nposlist &lt;- c(1.6, 1.4, 1.6, 0.8, 0.1, 0.25, 1.6, 1.6, 1.2, 0.4,\n             1.2, 1.8, 0.3, 0.8, 0.4, 0.3, 0.4, 0.4, 0.4, 0.6,\n             0.3, 0.4, 0.3)\nlabdf &lt;- data.frame(node=nodeids, label=nodelab, pos=poslist)\n\n# The circular layout tree.\np &lt;- ggtree(tree, layout=\"fan\", size=0.15, open.angle=5) +\n     geom_hilight(data=nodedf, mapping=aes(node=node),\n                  extendto=6.8, alpha=0.3, fill=\"grey\", color=\"grey50\",\n                  size=0.05) +\n     geom_cladelab(data=labdf, \n                   mapping=aes(node=node, \n                               label=label,\n                               offset.text=pos),\n                   hjust=0.5,\n                   angle=\"auto\",\n                   barsize=NA,\n                   horizontal=FALSE, \n                   fontsize=1.4,\n                   fontface=\"italic\"\n                   )\n\np &lt;- p %&lt;+% dat1 + geom_star(\n                        mapping=aes(fill=Phylum, starshape=Type, size=Size),\n                        position=\"identity\",starstroke=0.1) +\n        scale_fill_manual(values=c(\"#FFC125\",\"#87CEFA\",\"#7B68EE\",\"#808080\",\n                                \"#800080\", \"#9ACD32\",\"#D15FEE\",\"#FFC0CB\",\n                                \"#EE6A50\",\"#8DEEEE\", \"#006400\",\"#800000\",\n                                \"#B0171F\",\"#191970\"),\n                           guide=guide_legend(keywidth = 0.5, \n                                        keyheight = 0.5, order=1,\n                                        override.aes=list(starshape=15)),\n                           na.translate=FALSE)+\n        scale_starshape_manual(values=c(15, 1),\n                           guide=guide_legend(keywidth = 0.5, \n                                        keyheight = 0.5, order=2),\n                           na.translate=FALSE)+\n        scale_size_continuous(range = c(1, 2.5),\n                           guide = guide_legend(keywidth = 0.5, \n                                        keyheight = 0.5, order=3,\n                                        override.aes=list(starshape=15)))\n                                                    \np &lt;- p + new_scale_fill() +\n         geom_fruit(data=dat2, geom=geom_tile,\n                  mapping=aes(y=ID, x=Sites, alpha=Abundance, fill=Sites),\n                  color = \"grey50\", offset = 0.04,size = 0.02)+\n         scale_alpha_continuous(range=c(0, 1),\n                             guide=guide_legend(keywidth = 0.3, \n                                             keyheight = 0.3, order=5)) +\n         geom_fruit(data=dat3, geom=geom_bar,\n                    mapping=aes(y=ID, x=HigherAbundance, fill=Sites),\n                    pwidth=0.38, \n                    orientation=\"y\", \n                    stat=\"identity\",\n         ) +\n         scale_fill_manual(values=c(\"#0000FF\",\"#FFA500\",\"#FF0000\",\n                                \"#800000\", \"#006400\",\"#800080\",\"#696969\"),\n                           guide=guide_legend(keywidth = 0.3, \n                                        keyheight = 0.3, order=4))+\n         geom_treescale(fontsize=2, linesize=0.3, x=4.9, y=0.1) +\n         theme(legend.position=c(0.93, 0.5),\n               legend.background=element_rect(fill=NA),\n               legend.title=element_text(size=6.5),\n               legend.text=element_text(size=4.5),\n               legend.spacing.y = unit(0.02, \"cm\"),\n             )\np\n\n\n\n\nPresenting microbiome data (abundance and location) on a phylogenetic tree. The tree was annotated with symbolic points, highlighted clades, and clade labels. Two geom_fruit() layers were used to visualize location and abundance information.\n\n\n\n\nThe shape of the tip points indicates the types of microbes (commensal microbes or potential pathogens). The transparency of the heatmap indicates the abundance of the microbes, and the colors of the heatmap indicate different sites of the human body. The bar plot indicates the relative abundance of the most prevalent species at the body sites. The node labels contain taxonomy information in this example, and the information was used to highlight and label corresponding clades using geom_hilight() and geom_cladelab(), respectively.\nThe geom_fruit() layer supports rectangular layout. Users can either add a geom_fruit() layer to a rectangular tree (e.g., ggtree(tree_object) + geom_fruit(...)) or use layout_rectangular() to transform a circular layout tree to a rectangular layout tree as demonstrated in Figure ?fig-HMPplot2.\n\np + layout_rectangular() + \n    theme(legend.position=c(.05, .7))\n\n\n\n\nIllustration of using geom_fruit() in rectangular tree layout. The figure was produced by transforming Figure ?fig-HMPplot using the rectangular layout. Transforming a rectangular layout tree to a circular layout tree is also supported.",
    "crumbs": [
      "(PART\\*) Part III: ggtree extensions"
    ]
  },
  {
    "objectID": "10_ggtree_exts.html#examples-for-population-genetics",
    "href": "10_ggtree_exts.html#examples-for-population-genetics",
    "title": "(PART*) Part III: ggtree extensions",
    "section": "Examples for Population Genetics",
    "text": "Examples for Population Genetics\nThe ggtree (Yu et al., 2017) and ggtreeExtra packages are designed as general tools and can be applied to many research fields, such as infectious disease epidemiology, metagenome, population genetics, evolutionary biology, and ecology. We have introduced examples for metagenome research (Figure ?fig-psbox and Figure ?fig-HMPplot). In this session, we present examples for population genetics by reproducing figure 4 of (Chow et al., 2020) and figure 1 of (Wong et al., 2015).\n\nlibrary(ggtree)\nlibrary(ggtreeExtra)\nlibrary(ggplot2)\nlibrary(ggnewscale)\nlibrary(reshape2)\nlibrary(dplyr)\nlibrary(tidytree)\nlibrary(ggstar)\nlibrary(TDbook)\n\n# load tr and dat from the TDbook package \ndat &lt;- df_Candidaauris_data\ntr &lt;- tree_Candidaauris\n\ncountries &lt;- c(\"Canada\", \"United States\",\n               \"Colombia\", \"Panama\",\n               \"Venezuela\", \"France\",\n               \"Germany\", \"Spain\",\n               \"UK\", \"India\",\n               \"Israel\", \"Pakistan\",\n               \"Saudi Arabia\", \"United Arab Emirates\",\n               \"Kenya\", \"South Africa\",\n               \"Japan\", \"South Korea\",\n               \"Australia\")\n# For the tip points\ndat1 &lt;- dat %&gt;% select(c(\"ID\", \"COUNTRY\", \"COUNTRY__colour\"))\ndat1$COUNTRY &lt;- factor(dat1$COUNTRY, levels=countries)\nCOUNTRYcolors &lt;- dat1[match(countries,dat$COUNTRY),\"COUNTRY__colour\"]\n\n# For the heatmap layer\ndat2 &lt;- dat %&gt;% select(c(\"ID\", \"FCZ\", \"AMB\", \"MCF\"))\ndat2 &lt;- melt(dat2,id=\"ID\", variable.name=\"Antifungal\", value.name=\"type\")\ndat2$type &lt;- paste(dat2$Antifungal, dat2$type)\ndat2$type[grepl(\"Not_\", dat2$type)] = \"Susceptible\"\ndat2$Antifungal &lt;- factor(dat2$Antifungal, levels=c(\"FCZ\", \"AMB\", \"MCF\"))\ndat2$type &lt;- factor(dat2$type,\n                    levels=c(\"FCZ Resistant\",\n                            \"AMB Resistant\",\n                            \"MCF Resistant\",\n                            \"Susceptible\"))\n\n# For the points layer\ndat3 &lt;- dat %&gt;% select(c(\"ID\", \"ERG11\", \"FKS1\")) %&gt;%\n        melt(id=\"ID\", variable.name=\"point\", value.name=\"mutation\")\ndat3$mutation &lt;- paste(dat3$point, dat3$mutation)\ndat3$mutation[grepl(\"WT\", dat3$mutation)] &lt;- NA\ndat3$mutation &lt;- factor(dat3$mutation, \n                        levels=c(\"ERG11 Y132F\", \"ERG11 K143R\",\n                                 \"ERG11 F126L\", \"FKS1 S639Y/P/F\"))\n\n# For the clade group\ndat4 &lt;- dat %&gt;% select(c(\"ID\", \"CLADE\"))\ndat4 &lt;- aggregate(.~CLADE, dat4, FUN=paste, collapse=\",\")\nclades &lt;- lapply(dat4$ID, function(x){unlist(strsplit(x,split=\",\"))})\nnames(clades) &lt;- dat4$CLADE\n\ntr &lt;- groupOTU(tr, clades, \"Clade\")\nClade &lt;- NULL\np &lt;- ggtree(tr=tr, layout=\"fan\", open.angle=15, size=0.2, aes(colour=Clade)) +\n     scale_colour_manual(\n         values=c(\"black\",\"#69B920\",\"#9C2E88\",\"#F74B00\",\"#60C3DB\"),\n         labels=c(\"\",\"I\", \"II\", \"III\", \"IV\"),\n         guide=guide_legend(keywidth=0.5,\n                            keyheight=0.5,\n                            order=1,\n                            override.aes=list(linetype=c(\"0\"=NA,\n                                                         \"Clade1\"=1,\n                                                         \"Clade2\"=1,\n                                                         \"Clade3\"=1,\n                                                         \"Clade4\"=1\n                                                        )\n                                             )\n                           )\n     ) + \n     new_scale_colour()\n\np1 &lt;- p %&lt;+% dat1 +\n     geom_tippoint(aes(colour=COUNTRY),\n                   alpha=0) +\n     geom_tiplab(aes(colour=COUNTRY),\n                   align=TRUE,\n                   linetype=3,\n                   size=1,\n                   linesize=0.2,\n                   show.legend=FALSE\n                   ) +\n     scale_colour_manual(\n         name=\"Country labels\",\n         values=COUNTRYcolors,\n         guide=guide_legend(keywidth=0.5,\n                            keyheight=0.5,\n                            order=2,\n                            override.aes=list(size=2,alpha=1))\n     )\n\np2 &lt;- p1 +\n      geom_fruit(\n          data=dat2,\n          geom=geom_tile,\n          mapping=aes(x=Antifungal, y=ID, fill=type),\n          width=0.1,\n          color=\"white\",\n          pwidth=0.1,\n          offset=0.15\n      ) +\n      scale_fill_manual(\n           name=\"Antifungal susceptibility\",\n           values=c(\"#595959\", \"#B30000\", \"#020099\", \"#E6E6E6\"),\n           na.translate=FALSE,\n           guide=guide_legend(keywidth=0.5,\n                              keyheight=0.5,\n                              order=3\n                             )\n      ) +\n      new_scale_fill()\n\np3 &lt;- p2 +\n      geom_fruit(\n          data=dat3,\n          geom=geom_star,\n          mapping=aes(x=mutation, y=ID, fill=mutation, starshape=point),\n          size=1,\n          starstroke=0,\n          pwidth=0.1,\n          inherit.aes = FALSE,\n          grid.params=list(\n                          linetype=3,\n                          size=0.2\n                      )\n\n      ) +\n      scale_fill_manual(\n          name=\"Point mutations\",\n          values=c(\"#329901\", \"#0600FF\", \"#FF0100\", \"#9900CC\"),\n          guide=guide_legend(keywidth=0.5, keyheight=0.5, order=4,\n                             override.aes=list(\n                                    starshape=c(\"ERG11 Y132F\"=15,\n                                                \"ERG11 K143R\"=15,\n                                                \"ERG11 F126L\"=15,\n                                                \"FKS1 S639Y/P/F\"=1),\n                                    size=2)\n                            ),\n          na.translate=FALSE,\n      ) +\n      scale_starshape_manual(\n          values=c(15, 1),\n          guide=\"none\"\n      ) +\n      theme(\n          legend.background=element_rect(fill=NA),\n          legend.title=element_text(size=7), \n          legend.text=element_text(size=5.5),\n          legend.spacing.y = unit(0.02, \"cm\")\n      )\np3\n\n\n\n\nAntifungal susceptibility and point mutations in drug targets in Candida Auris .\n\n\n\n\nIn this example, Figure ?fig-Caurisplot shows the phylogenetic tree annotated with different colors to display different clades. The external heatmaps present the susceptibility to fluconazole (FCZ), amphotericin B (AMB), and micafungin (MCF). The external points display the point mutations in lanosterol 14-alpha-demethylase ERG11 (Y132F, K143R, and F126L) and beta-1,3-D-glucan synthase FKS1 (S639Y/P/F) associated with resistance (Chow et al., 2020).\n\nlibrary(ggtreeExtra)\nlibrary(ggtree)\nlibrary(ggplot2)\nlibrary(ggnewscale)\nlibrary(treeio)\nlibrary(tidytree)\nlibrary(dplyr)\nlibrary(ggstar)\nlibrary(TDbook)\n\n# load tree_NJIDqgsS and df_NJIDqgsS from TDbook\ntr &lt;- tree_NJIDqgsS\nmetada &lt;- df_NJIDqgsS\nmetadata &lt;- metada %&gt;%\n            select(c(\"id\", \"country\", \"country__colour\", \n                    \"year\", \"year__colour\", \"haplotype\"))\nmetadata$haplotype[nchar(metadata$haplotype) == 0] &lt;- NA\n\ncountrycolors &lt;- metada %&gt;%\n                 select(c(\"country\", \"country__colour\")) %&gt;%\n                 distinct()\n\nyearcolors &lt;- metada %&gt;%\n              select(c(\"year\", \"year__colour\")) %&gt;%\n              distinct()\nyearcolors &lt;- yearcolors[order(yearcolors$year, decreasing=TRUE),]\n\nmetadata$country &lt;- factor(metadata$country, levels=countrycolors$country)\nmetadata$year &lt;- factor(metadata$year, levels=yearcolors$year)\n\np &lt;- ggtree(tr, layout=\"fan\", open.angle=15, size=0.1)\n\np &lt;- p %&lt;+% metadata\n\np1 &lt;-p +\n     geom_tippoint(\n         mapping=aes(colour=country),\n         size=1.5,\n         stroke=0,\n         alpha=0.4\n     ) +\n     scale_colour_manual(\n         name=\"Country\",\n         values=countrycolors$country__colour,\n         guide=guide_legend(keywidth=0.3,\n                            keyheight=0.3,\n                            ncol=2,\n                            override.aes=list(size=2,alpha=1),\n                            order=1)\n     ) +\n     theme(\n         legend.title=element_text(size=5),\n         legend.text=element_text(size=4),\n         legend.spacing.y = unit(0.02, \"cm\")\n     )\n\np2 &lt;-p1 +\n     geom_fruit(\n         geom=geom_star,\n         mapping=aes(fill=haplotype),\n         starshape=26,\n         color=NA,\n         size=2,\n         starstroke=0,\n         offset=0,\n     ) +\n     scale_fill_manual(\n         name=\"Haplotype\",\n         values=c(\"red\"),\n         guide=guide_legend(\n                   keywidth=0.3,\n                   keyheight=0.3,\n                   order=3\n               ),\n         na.translate=FALSE\n     )\n\np3 &lt;-p2 +\n     new_scale_fill() +\n     geom_fruit(\n         geom=geom_tile,\n         mapping=aes(fill=year),\n         width=0.002,\n         offset=0.1\n     ) +\n     scale_fill_manual(\n         name=\"Year\",\n         values=yearcolors$year__colour,\n         guide=guide_legend(keywidth=0.3, keyheight=0.3, ncol=2, order=2)\n     ) +\n     theme(\n           legend.title=element_text(size=6), \n           legend.text=element_text(size=4.5),\n           legend.spacing.y = unit(0.02, \"cm\")\n           )\np3\n\n\n\n\nPopulation structure of the 1,832 S. Typhi isolates.\n\n\n\n\nFigure ?fig-Styphiplot is a rooted maximum-likelihood tree of S. Typhi inferred from 22,145 SNPs (Wong et al., 2015), the colors of the tip points represent the geographical origin of the isolates, and the red symbolic points indicate the haplotype of H58 lineage. The color of the external heatmap indicates the years of isolation (Wong et al., 2015).",
    "crumbs": [
      "(PART\\*) Part III: ggtree extensions"
    ]
  },
  {
    "objectID": "10_ggtree_exts.html#sec-summary10",
    "href": "10_ggtree_exts.html#sec-summary10",
    "title": "(PART*) Part III: ggtree extensions",
    "section": "Summary",
    "text": "Summary\n\nCompared to geom_facet(), geom_fruit() layer provided in ggtreeExtra is a better implementation of Method 2 proposed by (Yu et al., 2018). The geom_facet() and geom_fruit() have the same design philosophy and have a similar user interface. They rely on other geometric layers to visualize the tree-associated data. These dependent layers are provided by ggplot2 and its extension packages, including ggtree. As more and more layers are implemented by the ggplot2 community, the types of data and graphics that geom_facet() and geom_fruit() can present will also increase.\n\n\n\n\nAsnicar, F., Weingart, G., Tickle, T. L., Huttenhower, C., & Segata, N. (2015). Compact graphical representation of phylogenetic data and metadata with GraPhlAn. PeerJ, 3, e1029. https://doi.org/10.7717/peerj.1029\n\n\nChow, N. A., Muñoz, J. F., Gade, L., Berkow, E. L., Li, X., Welsh, R. M., Forsberg, K., Lockhart, S. R., Adam, R., Alanio, A., Alastruey-Izquierdo, A., Althawadi, S., Araúz, A. B., Ben-Ami, R., Bharat, A., Calvo, B., Desnos-Ollivier, M., Escandón, P., Gardam, D., … Cuomo, C. A. (2020). Tracing the evolutionary history and global expansion of candida auris using population genomic analyses. mBio, 11(2). https://doi.org/10.1128/mBio.03364-19\n\n\nMorgan, X. C., Segata, N., & Huttenhower, C. (2013). Biodiversity and functional genomics in the human microbiome. Trends in Genetics, 29(1), 51–58. https://doi.org/10.1016/J.TIG.2012.09.005\n\n\nWong, V. K., Baker, S., Pickard, D. J., Parkhill, J., Page, A. J., Feasey, N. A., Kingsley, R. A., Thomson, N. R., Keane, J. A., Weill, F.-X., Edwards, D. J., Hawkey, J., Harris, S. R., Mather, A. E., Cain, A. K., Hadfield, J., Hart, P. J., Thieu, N. T. V., Klemm, E. J., … Dougan, G. (2015). Phylogeographical analysis of the dominant multidrug-resistant H58 clade of salmonella typhi identifies inter- and intracontinental transmission events [Journal Article]. Nature Genetics, 47(6), 632–639. https://doi.org/10.1038/ng.3281\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "(PART\\*) Part III: ggtree extensions"
    ]
  },
  {
    "objectID": "11_ggtree_exts-others.html",
    "href": "11_ggtree_exts-others.html",
    "title": "9  Other ggtree Extensions",
    "section": "",
    "text": "9.1 Taxonomy Annotation Using MicrobiotaProcess\nThe ggtree package is a general package for visualizing tree structures and associated data. If you have some special requirements that are not directly provided by ggtree, you may need to use one of the extension packages built on top of ggtree. For example, the RevGadgets package for visualizing the output of the RevBayes, the sitePath package for visualizing fixation events on phylogenetic pathways, and the enrichplot package for visualizing hierarchical structure of the enriched pathways.\nThere are 42 packages in CRAN or Bioconductor that depend on or import ggtree and several packages on GitHub that extend ggtree. Here we briefly introduce some extension packages, including MicrobiotaProcess and tanggle.\nThe MicrobiotaProcess package provides a LEfSe-like algorithm (Segata et al., 2011) to discover microbiome biomarkers by comparing taxon abundance between different classes. It provides several methods to visualize the analysis result. The ggdiffclade is developed based on ggtree (Yu et al., 2017). In addition to the diff_analysis() result, it also supports a data frame that contains a hierarchical relationship (e.g., taxonomy annotation or KEGG annotation) with another data frame that contains taxa and factor information and/or pvalue. The following example demonstrates how to use data frames (i.e., analysis results) to visualize the differential taxonomy tree. More details can be found on the vignette of the MicrobiotaProcess package.\nlibrary(MicrobiotaProcess)\nlibrary(ggplot2)\nlibrary(TDbook)\n\n# load `df_difftax` and `df_difftax_info` from TDbook\ntaxa &lt;- df_alltax_info\ndt &lt;- df_difftax\n\nggdiffclade(obj=taxa,\n            nodedf=dt,\n            factorName=\"DIAGNOSIS\",\n            layout=\"radial\",\n            skpointsize=0.6,\n            cladetext=2,\n            linewd=0.2,\n            taxlevel=3,\n            # This argument is to remove the branch of unknown taxonomy.\n            reduce=TRUE) + \n     scale_fill_manual(values=c(\"#00AED7\", \"#009E73\"))+\n     guides(color = guide_legend(keywidth = 0.1, keyheight = 0.6,\n                                 order = 3,ncol=1)) +\n     theme(panel.background=element_rect(fill=NA),\n           legend.position=\"right\",\n           plot.margin=margin(0,0,0,0),\n           legend.spacing.y=unit(0.02, \"cm\"), \n           legend.title=element_text(size=7.5), \n           legend.text=element_text(size=5.5), \n           legend.box.spacing=unit(0.02,\"cm\")\n        )\n\n\n\n\nVisualize differential taxonomy clade.\nThe data frame of this example is from the analysis result of diff_analysis() using public datasets (Kostic et al., 2012). The colors represent the features enriched in the relevant class groups. The size of circle points represents the -log10(pvalue), i.e., a larger point indicates a greater significance. In Figure ?fig-CRCdiffclade, we can find that Fusobacterium sequences were enriched in carcinomas, while Firmicutes, Bacteroides, and Clostridiales were greatly reduced in tumors. These results were consistent with the original article (Kostic et al., 2012). The species of Campylobacter has been proven to be associated with colorectal cancer (Amer et al., 2017; He et al., 2019; Wu et al., 2013). We can find in Figure ?fig-CRCdiffclade that Campylobacter was enriched in tumors, while its relative abundance is lower than Fusobacterium.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Other ggtree Extensions</span>"
    ]
  },
  {
    "objectID": "11_ggtree_exts-others.html#visualizing-phylogenetic-network-using-tanggle",
    "href": "11_ggtree_exts-others.html#visualizing-phylogenetic-network-using-tanggle",
    "title": "9  Other ggtree Extensions",
    "section": "9.2 Visualizing Phylogenetic Network Using Tanggle",
    "text": "9.2 Visualizing Phylogenetic Network Using Tanggle\nThe tanggle package provides functions to display a split network. It extends the ggtree package (Yu et al., 2017) to allow the visualization of phylogenetic networks (Figure ?fig-phylonetworx).\n\nlibrary(ggplot2)\nlibrary(ggtree)\nlibrary(tanggle)\n\nfile &lt;- system.file(\"extdata/trees/woodmouse.nxs\", package = \"phangorn\")\nNnet &lt;- phangorn::read.nexus.networx(file)\n\nggsplitnet(Nnet) +\n    geom_tiplab2(aes(color=label), hjust=-.1)+\n    geom_nodepoint(color='firebrick', alpha=.4) +\n    scale_color_manual(values=rainbow(15)) +   \n    theme(legend.position=\"none\") +\n    ggexpand(.1) + ggexpand(.1, direction=-1)\n\n\n\n\nPhylogenetic network.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Other ggtree Extensions</span>"
    ]
  },
  {
    "objectID": "11_ggtree_exts-others.html#sec-summary11",
    "href": "11_ggtree_exts-others.html#sec-summary11",
    "title": "9  Other ggtree Extensions",
    "section": "9.3 Summary",
    "text": "9.3 Summary\nThe ggtree is designed to support the grammar of graphics, allowing users to quickly explore phylogenetic data through visualization. When users have special needs and ggtree does not provide them, it is highly recommended to develop extension packages to implement these missing functions. This is a good mechanism, and we also hope that ggtree users can become a ggtree community. In this way, more functions for special needs can be developed and shared among users. Everyone will benefit from it, and it’s exciting that this is happening.\n\n\n\n\nAmer, A., Galvin, S., Healy, C. M., & Moran, G. P. (2017). The microbiome of potentially malignant oral leukoplakia exhibits enrichment for fusobacterium, leptotrichia, campylobacter, and rothia species. Frontiers in Microbiology, 8, 2391. https://doi.org/10.3389/fmicb.2017.02391\n\n\nHe, Z., Gharaibeh, R. Z., Newsome, R. C., Pope, J. L., Dougherty, M. W., Tomkovich, S., Pons, B., Mirey, G., Vignard, J., Hendrixson, D. R., & Jobin, C. (2019). Campylobacter jejuni promotes colorectal tumorigenesis through the action of cytolethal distending toxin. Gut, 68(2), 289–300. https://doi.org/10.1136/gutjnl-2018-317200\n\n\nKostic, A. D., Gevers, D., Pedamallu, C. S., Michaud, M., Duke, F., Earl, A. M., Ojesina, A. I., Jung, J., Bass, A. J., Tabernero, J., et al. (2012). Genomic analysis identifies association of fusobacterium with colorectal carcinoma. Genome Research, 22(2), 292–298. https://doi.org/10.1101/gr.126573.111\n\n\nSegata, N., Izard, J., Waldron, L., Gevers, D., Miropolsky, L., Garrett, W. S., & Huttenhower, C. (2011). Metagenomic biomarker discovery and explanation. Genome Biology, 12(6), R60. https://doi.org/10.1186/gb-2011-12-6-r60\n\n\nWu, N., Yang, X., Zhang, R., Li, J., Xiao, X., Hu, Y., Chen, Y., Yang, F., Lu, N., Wang, Z., et al. (2013). Dysbiosis signature of fecal microbiota in colorectal cancer patients. Microbial Ecology, 66(2), 462–470. https://doi.org/10.1007/s00248-013-0245-9\n\n\nYu, G., Smith, D. K., Zhu, H., Guan, Y., & Lam, T. T.-Y. (2017). Ggtree: An r package for visualization and annotation of phylogenetic trees with their covariates and other associated data. Methods in Ecology and Evolution, 8(1), 28–36. https://doi.org/10.1111/2041-210X.12628",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Other ggtree Extensions</span>"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html",
    "href": "12_ggtree_utilities.html",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "",
    "text": "ggtree Utilities\nlibrary(\"yulab.utils\")\nlibrary(ggplotify)",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html#sec-facet-utils",
    "href": "12_ggtree_utilities.html#sec-facet-utils",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "Facet Utilities",
    "text": "Facet Utilities\n\nfacet_widths\nAdjusting relative widths of facet panels is a common requirement, especially for using geom_facet() to visualize a tree with associated data. However, this is not supported by the ggplot2 package. To address this issue, ggtree provides the facet_widths() function and it works with both ggtree and ggplot objects.\n\nlibrary(ggplot2)\nlibrary(ggtree)\n\nggtree v4.1.1.003 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nGuangchuang Yu. Using ggtree to visualize data on tree-like structures.\nCurrent Protocols in Bioinformatics. 2020, 69:e96. doi:10.1002/cpbi.96\n\nlibrary(reshape2)\n\nset.seed(123)\ntree &lt;- rtree(30)\n\np &lt;- ggtree(tree, branch.length = \"none\") + \n    geom_tiplab() + theme(legend.position='none')\n\na &lt;- runif(30, 0,1)\nb &lt;- 1 - a\ndf &lt;- data.frame(tree$tip.label, a, b)\ndf &lt;- melt(df, id = \"tree.tip.label\")\n\np2 &lt;- p + geom_facet(panel = 'bar', data = df, geom = geom_bar, \n                 mapping = aes(x = value, fill = as.factor(variable)), \n                 orientation = 'y', width = 0.8, stat='identity') + \n        xlim_tree(9)\n\nfacet_widths(p2, widths = c(1, 2))\n\nWarning in x[i] &lt;- value: number of items to replace is not a multiple of\nreplacement length\n\n\n\n\n\n\n\n\n\nIt also supports using a name vector to set the widths of specific panels. The following code will display an identical figure to Figure ?fig-facetWidthA.\nfacet_widths(p2, c(Tree = .5))\nThe facet_widths() function also works with other ggplot objects as demonstrated in Figure ?fig-facetWidthB.\n\np &lt;- ggplot(iris, aes(Sepal.Width, Petal.Length)) + \n  geom_point() + facet_grid(.~Species)\nfacet_widths(p, c(setosa = .5))\n\nWarning in x[i] &lt;- value: number of items to replace is not a multiple of\nreplacement length\n\n\n\n\n\n\n\n\n\n\n\nWarning in x[i] &lt;- value: number of items to replace is not a multiple of\nreplacement length\nWarning in x[i] &lt;- value: number of items to replace is not a multiple of\nreplacement length\n\n\n\n\n\nAdjust relative widths of ggplot facets. The facet_widths() function works with ggtree (A) as well as ggplot (B).\n\n\n\n\n\n\nfacet_labeller\nThe facet_labeller() function was designed to relabel selected panels (Figure ?fig-facetLab), and it currently only works with ggtree objects (i.e., geom_facet() outputs). A more versatile version that works with both ggtree and ggplot objects is implemented in the ggfun package (i.e., the facet_set() function).\n\nfacet_labeller(p2, c(Tree = \"phylogeny\", bar = \"HELLO\"))\n\n\n\n\n\n\n\n\nIf you want to combine facet_widths() with facet_labeller(), you need to call facet_labeller() to relabel the panels before using facet_widths() to set the relative widths of each panel. Otherwise, it won’t work since the output of facet_widths() is redrawn from grid object.\n\nfacet_labeller(p2, c(Tree = \"phylogeny\")) %&gt;% facet_widths(c(Tree = .4))\n\nWarning in x[i] &lt;- value: number of items to replace is not a multiple of\nreplacement length\n\n\n\n\n\n\n\n\n\n\n\nWarning in x[i] &lt;- value: number of items to replace is not a multiple of\nreplacement length\n\n\n\n\n\nRename facet labels. Rename multiple labels simultaneously (A) or only for a specific one (B) are all supported. facet_labeller() can combine with facet_widths() to rename facet label and then adjust relative widths (B).",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html#sec-geom2",
    "href": "12_ggtree_utilities.html#sec-geom2",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "Geometric Layers",
    "text": "Geometric Layers\nSubsetting is not supported in layers defined in ggplot2, while it is quite useful in phylogenetic annotation since it allows us to annotate at specific node(s) (e.g., only label bootstrap values that are larger than 75).\nIn ggtree, we provide several modified versions of layers defined in ggplot2 to support the subset aesthetic mapping, including:\n\ngeom_segment2()\ngeom_point2()\ngeom_text2()\ngeom_label2()\n\nThese layers works with both ggtree and ggplot2 (Figure ?fig-layer2).\n\nlibrary(ggplot2)\nlibrary(ggtree)\ndata(mpg)\np &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +\n   geom_point(mapping = aes(color = class)) + \n   geom_text2(aes(label=manufacturer, \n                  subset = hwy &gt; 40 | displ &gt; 6.5), \n                  nudge_y = 1) +\n   coord_cartesian(clip = \"off\") +\n   theme_light() +\n   theme(legend.position = c(.85, .75))          \n\np2 &lt;- ggtree(rtree(10)) + \n    geom_label2(aes(subset = node &lt;5, label = label))\n\nWarning in geom_label2(aes(subset = node &lt; 5, label = label)): Ignoring unknown\nparameters: `label.size`\n\nplot_list(p, p2, ncol=2, tag_levels='A')\n\n\n\n\nGeometric layers that support subsetting. These layers work with ggplot2 (A) and ggtree (B).",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html#layout-utilities",
    "href": "12_ggtree_utilities.html#layout-utilities",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "Layout Utilities",
    "text": "Layout Utilities\nIn session 4.2, we introduce several layouts supported by ggtree. The ggtree package also provides several layout functions that can transform from one to another. Note that not all layouts are supported (see Table ?tbl-layoutLayerTab and Figure ?fig-layoutLayer).\n\n\n\nLayout transformers.\n\n\n\n\n\n\nLayout\nDescription\n\n\n\n\nlayout_circular\ntransform rectangular layout to circular layout\n\n\nlayout_dendrogram\ntransform rectangular layout to dendrogram layout\n\n\nlayout_fan\ntransform rectangular/circular layout to fan layout\n\n\nlayout_rectangular\ntransform circular/fan layout to rectangular layout\n\n\nlayout_inward_circular\ntransform rectangular/circular layout to inward_circular layout\n\n\n\n\n\n\nset.seed(2019)\nx &lt;- rtree(20)\np &lt;- ggtree(x)\np + layout_dendrogram()\n\n\n\n\n\n\n\nggtree(x, layout = \"circular\") + layout_rectangular()\n\nCoordinate system already present.\nℹ Adding new coordinate system, which will replace the existing one.\n\n\n\n\n\n\n\n\np + layout_circular()\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\np + layout_fan(angle=90)\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\np + layout_inward_circular(xlim=4) + geom_tiplab(hjust=1)\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\n\n\n\n\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nLayout functions for transforming among different layouts. Default rectangular layout (A); transform rectangular to dendrogram layout (B); transform circular to rectangular layout (C); transform rectangular to circular layout (D); transform rectangular to fan layout (E); transform rectangular to inward circular layout (F).",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html#scale-utilities",
    "href": "12_ggtree_utilities.html#scale-utilities",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "Scale Utilities",
    "text": "Scale Utilities\nThe ggtree package provides several scale functions to manipulate the x-axis, including the scale_x_range() documented in session 5.2.4, xlim_tree(), xlim_expand(), ggexpand(), hexpand() and vexpand().\n\nExpand x limit for a specific facet panel\nSometimes we need to set xlim for a specific facet panel (e.g., allocate more space for long tip labels at Tree panel). However, the ggplot2::xlim() function applies to all the panels. The ggtree provides xlim_expand() to adjust xlim for user-specific facet panel. It accepts two parameters, xlim, and panel, and can adjust all individual panels as demonstrated in Figure ?fig-xlimExpandA. If you only want to adjust xlim of the Tree panel, you can use xlim_tree() as a shortcut.\n\nset.seed(2019-05-02)\nx &lt;- rtree(30)\np &lt;- ggtree(x) + geom_tiplab()\nd &lt;- data.frame(label = x$tip.label, \n                value = rnorm(30))\np2 &lt;- p + geom_facet(panel = \"Dot\", data = d, \n            geom = geom_point, mapping = aes(x = value))\np2 + xlim_tree(6) + xlim_expand(c(-10, 10), 'Dot')\n\n\n\n\n\n\n\n\nThe xlim_expand() function also works with ggplot2::facet_grid(). As demonstrated in Figure ?fig-xlimExpandB, only the xlim of virginica panel was adjusted by xlim_expand().\n\ng &lt;- ggplot(iris, aes(Sepal.Length, Sepal.Width)) + \n    geom_point() + facet_grid(. ~ Species, scales = \"free_x\") \ng + xlim_expand(c(0, 15), 'virginica')\n\n\n\n\n\n\n\n\n\n\n\n\n\nSetting xlim for user-specific facet panels. Using xlim_tree() to set the Tree panel of the ggtree output (A) and xlim_expand() to set the Dot panel of the ggtree output (A) and the Virginica panel of the ggplot output (B).\n\n\n\n\n\n\nExpand plot limit by the ratio of plot range\nThe ggplot2 package cannot automatically adjust plot limits and it is very common that long text was truncated. Users need to adjust x (y) limits manually via the xlim() (ylim()) command (see also FAQ: Tip label truncated).\nThe xlim() (ylim()) is a good solution to this issue. However, we can make it more simple, by expanding the plot panel by a ratio of the axis range without knowing what the exact value is.\nWe provide hexpand() function to expand x limit by specifying a fraction of the x range and it works for both directions (direction=1 for right-hand side and direction=-1 for left-hand side) (Figure ?fig-hexpand). Another version of vexpand() works with similar behavior for y-axis and the ggexpand() function works for both x- and y-axis (Figure ?fig-phylonetworx).\n\nx$tip.label &lt;- paste0('to make the label longer_', x$tip.label)\np1 &lt;- ggtree(x) + geom_tiplab() + hexpand(.4)\np2 &lt;- ggplot(iris, aes(Sepal.Width, Petal.Width)) + \n    geom_point() + \n    hexpand(.2, direction = -1) +\n    vexpand(.2)\n\nplot_list(p1, p2, tag_levels=\"A\", widths=c(.6, .4))\n\n\n\n\nExpanding plot limits by a fraction of the x or y range. Expand x limit at right-hand side by default (A), and expand x limit for left-hand side when direction = -1 and expand y limit at the upper side (B).",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html#tree-data-utilities",
    "href": "12_ggtree_utilities.html#tree-data-utilities",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "Tree data utilities",
    "text": "Tree data utilities\n\nFilter tree data\nThe ggtree package defined several geom layers that support subsetting tree data. However, many other geom layers that didn’t provide this feature, are defined in ggplot2 and its extensions. To allow filtering tree data with these layers, ggtree provides an accompanying function, td_filter() that returns a function that works similar to dplyr::filter() and can be passed to the data parameter in geom layers to filter ggtree plot data as demonstrated in Figure ?fig-tdFilter.\n\nlibrary(tidytree)\n\ntidytree v0.4.7 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nLG Wang, TTY Lam, S Xu, Z Dai, L Zhou, T Feng, P Guo, CW Dunn, BR\nJones, T Bradley, H Zhu, Y Guan, Y Jiang, G Yu. treeio: an R package\nfor phylogenetic tree input and output with richly annotated and\nassociated data. Molecular Biology and Evolution. 2020, 37(2):599-603.\ndoi: 10.1093/molbev/msz240\n\n\n\nAttaching package: 'tidytree'\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\nset.seed(1997)\ntree &lt;- rtree(50)\np &lt;- ggtree(tree) \nselected_nodes &lt;- offspring(p, 67)$node\np + geom_text(aes(label=label), \n            data=td_filter(isTip & \n                        node %in% selected_nodes), \n            hjust=0) +\n    geom_nodepoint(aes(subset = node ==67), \n                    size=5, color='blue')\n\n\n\n\nFiltering ggtree plot data in geom layers. Only selected tips (offspring of the node indicated by the blue circle point) were labeled.\n\n\n\n\n\n\nFlatten list-column tree data\nThe ggtree plot data is a tidy data frame where each row represents a unique node. If multiple values are associated with a node, the data can be stored as nested data (i.e., in a list-column).\n\nset.seed(1997)\ntr &lt;- rtree(5)\nd &lt;- data.frame(id=rep(tr$tip.label,2), \n                value=abs(rnorm(10, 6, 2)), \n                group=c(rep(\"A\", 5),rep(\"B\",5)))\n\nrequire(tidyr)\n\nLoading required package: tidyr\n\n\n\nAttaching package: 'tidyr'\n\n\nThe following object is masked from 'package:reshape2':\n\n    smiths\n\n\nThe following object is masked from 'package:ggtree':\n\n    expand\n\nd2  &lt;- nest(d, value =value, group=group)\n## d2 is a nested data\nd2\n\n# A tibble: 5 × 3\n  id    value            group           \n  &lt;chr&gt; &lt;list&gt;           &lt;list&gt;          \n1 t2    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;\n2 t1    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;\n3 t5    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;\n4 t4    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;\n5 t3    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;\n\n\nNested data is supported by the operator, %&lt;+%, and can be mapped to the tree structure. If a geom layer can’t directly support visualizing nested data, we need to flatten the data before applying the geom layer to display it. The ggtree package provides a function, td_unnest(), which returns a function that works similar to tidyr::unnest() and can be used to flatten ggtree plot data as demonstrated in Figure ?fig-tdUnnestA.\nAll tree data utilities provide a .f parameter to pass a function to pre-operate the data. This creates the possibility to combine different tree data utilities as demonstrated in Figure ?fig-tdUnnestB.\n\np &lt;- ggtree(tr) %&lt;+% d2\np2 &lt;- p + \n    geom_point(aes(x, y, size= value, colour=group), \n            data = td_unnest(c(value, group)), alpha=.4) +\n    scale_size(range=c(3,10), limits=c(3, 10))\n\np3 &lt;- p + \n    geom_point(aes(x, y, size= value, colour=group), \n            data = td_unnest(c(value, group), \n                        .f = td_filter(isTip & node==4)), \n            alpha=.4) +\n    scale_size(range=c(3,10), limits=c(3, 10))\n\nplot_list(p2, p3, tag_levels = 'A')\n\n\n\n\nFlattening ggtree plot data. List-columns can be flattened by td_unnest() and two circle points were displayed on each tip simultaneously (A). Different tree data utilities can be combined to work together, e.g., filter data by td_filter(), and then flatten it by td_unnest()) (B).",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html#tree-utilities",
    "href": "12_ggtree_utilities.html#tree-utilities",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "Tree Utilities",
    "text": "Tree Utilities\n\nExtract tip order\nTo create composite plots, users need to re-order their data manually before creating tree-associated graphs. The order of their data should be consistent with the tip order presented in the ggtree() plot. For this purpose, we provide the get_taxa_name() function to extract an ordered vector of tips based on the tree structure plotted by ggtree().\n\nset.seed(123)\ntree &lt;- rtree(10)\np &lt;- ggtree(tree) + geom_tiplab() + \n    geom_hilight(node = 12, extendto = 2.5)\n\nx &lt;- paste(\"Taxa order:\", \n        paste0(get_taxa_name(p), collapse=', '))\np + labs(title=x)\n\n\n\n\nAn example tree for demonstrating get_taxa_name() function.\n\n\n\n\nThe get_taxa_name() function will return a vector of ordered tip labels according to the tree structure displayed in Figure ?fig-tiporder.\n\nget_taxa_name(p)\n\n [1] \"t9\"  \"t8\"  \"t3\"  \"t2\"  \"t7\"  \"t10\" \"t1\"  \"t5\"  \"t6\"  \"t4\" \n\n\nIf users specify a node, the get_taxa_name() will extract the tip order of the selected clade (i.e., highlighted region in Figure ?fig-tiporder).\n\nget_taxa_name(p, node = 12)\n\n[1] \"t5\" \"t6\" \"t4\"\n\n\n\n\nPadding taxa labels\nThe label_pad() function adds padding characters (default is ·) to taxa labels.\n\nset.seed(2015-12-21)\ntree &lt;- rtree(5)\ntree$tip.label[2] &lt;- \"long string for test\"\n\nd &lt;- data.frame(label = tree$tip.label, \n                newlabel = label_pad(tree$tip.label),\n                newlabel2 = label_pad(tree$tip.label, pad = \" \"))\nprint(d)\n\n                 label             newlabel            newlabel2\n1                   t1 ··················t1                   t1\n2 long string for test long string for test long string for test\n3                   t2 ··················t2                   t2\n4                   t4 ··················t4                   t4\n5                   t3 ··················t3                   t3\n\n\nThis feature is useful if we want to align tip labels to the end as demonstrated in Figure ?fig-labelpad. Note that in this case, monospace font should be used to ensure the lengths of the labels displayed in the plot are the same.\n\np &lt;- ggtree(tree) %&lt;+% d + xlim(NA, 5)\np1 &lt;- p + geom_tiplab(aes(label=newlabel), \n                    align=TRUE, family='mono',\n                    linetype = \"dotted\", linesize = .7) \np2 &lt;- p + geom_tiplab(aes(label=newlabel2), \n                    align=TRUE, family='mono',\n                    linetype = NULL, offset=-.5) + xlim(NA, 5)\n\nScale for x is already present.\nAdding another scale for x, which will replace the existing scale.\n\nplot_list(p1, p2, ncol=2, tag_levels = \"A\")                            \n\n\n\n\nAlign tip label to the end. With a dotted line (A) and without a dotted line (B).",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "12_ggtree_utilities.html#sec-identify",
    "href": "12_ggtree_utilities.html#sec-identify",
    "title": "(PART*) Part IV: Miscellaneous topics",
    "section": "Interactive ggtree Annotation",
    "text": "Interactive ggtree Annotation\n\nlink = ifelse (knitr::is_latex_output(), \"https://twitter.com/drandersgs/status/965996335882059776\", \"#plotly\")\n\nplotly_ggtree_link &lt;- paste0(\"an [interactive phylogenetic tree](\", link, \")\")\n\nThe ggtree package supports interactive tree annotation or manipulation by implementing an identify() method. Users can click on a node to highlight a clade, to label or rotate it, etc. Users can also use the plotly package to convert a ggtree object to a plotly object to quickly create\n\n\nan [interactive phylogenetic tree](#plotly).\n\n\n\n\n\n\n\nInteractive phylogenetic tree using identify() method. Highlighting, labelling and rotating clades are all supported.\n\n\n\n\nVideo of using identify() to interactively manipulate a phylogenetic tree can be found on Youtube and Youku:\n\nHighlighting clades: Youtube and Youku.\nLabelling clades: Youtube and Youku.\nRotating clades: Youtube and Youku.",
    "crumbs": [
      "(PART\\*) Part IV: Miscellaneous topics"
    ]
  },
  {
    "objectID": "13_ggtree_gallery.html",
    "href": "13_ggtree_gallery.html",
    "title": "10  Gallery of Reproducible Examples",
    "section": "",
    "text": "10.1 Visualizing pairwise nucleotide sequence distance with a phylogenetic tree\nlibrary(\"yulab.utils\")\nThis example reproduces figure 1 of (Chen et al., 2017). It extracts accession numbers from tip labels of the HPV58 tree and calculates pairwise nucleotide sequence distances. The distance matrix is visualized as dot and line plots. This example demonstrates the ability to add multiple layers to a specific panel. As illustrated in Figure ?fig-jv2017, the geom_facet() function displays sequence distances as a dot plot and then adds a layer of line plot to the same panel, i.e., sequence distance. In addition, the tree in geom_facet() can be fully annotated with multiple layers (clade labels, bootstrap support values, etc.). The source code is modified from the supplemental file of (Yu et al., 2018).\nlibrary(TDbook)\nlibrary(tibble)\nlibrary(tidyr)\nlibrary(Biostrings)\n\nLoading required package: BiocGenerics\n\n\n\nAttaching package: 'BiocGenerics'\n\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, aperm, append, as.data.frame, basename, cbind,\n    colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,\n    get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,\n    match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,\n    Position, rank, rbind, Reduce, rownames, sapply, saveRDS, setdiff,\n    table, tapply, union, unique, unsplit, which.max, which.min\n\n\nLoading required package: S4Vectors\n\n\nLoading required package: stats4\n\n\n\nAttaching package: 'S4Vectors'\n\n\nThe following object is masked from 'package:tidyr':\n\n    expand\n\n\nThe following object is masked from 'package:utils':\n\n    findMatches\n\n\nThe following objects are masked from 'package:base':\n\n    expand.grid, I, unname\n\n\nLoading required package: IRanges\n\n\nLoading required package: XVector\n\n\nLoading required package: GenomeInfoDb\n\n\n\nAttaching package: 'Biostrings'\n\n\nThe following object is masked from 'package:base':\n\n    strsplit\n\nlibrary(treeio)\n\ntreeio v1.35.0 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nLG Wang, TTY Lam, S Xu, Z Dai, L Zhou, T Feng, P Guo, CW Dunn, BR\nJones, T Bradley, H Zhu, Y Guan, Y Jiang, G Yu. treeio: an R package\nfor phylogenetic tree input and output with richly annotated and\nassociated data. Molecular Biology and Evolution. 2020, 37(2):599-603.\ndoi: 10.1093/molbev/msz240\n\n\n\nAttaching package: 'treeio'\n\n\nThe following object is masked from 'package:Biostrings':\n\n    mask\n\nlibrary(ggplot2)\nlibrary(ggtree)\n\nggtree v4.1.1.003 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nS Xu, Z Dai, P Guo, X Fu, S Liu, L Zhou, W Tang, T Feng, M Chen, L\nZhan, T Wu, E Hu, Y Jiang, X Bo, G Yu. ggtreeExtra: Compact\nvisualization of richly annotated phylogenetic data. Molecular Biology\nand Evolution. 2021, 38(9):4039-4042. doi: 10.1093/molbev/msab166\n\n\n\nAttaching package: 'ggtree'\n\n\nThe following object is masked from 'package:Biostrings':\n\n    collapse\n\n\nThe following object is masked from 'package:IRanges':\n\n    collapse\n\n\nThe following object is masked from 'package:S4Vectors':\n\n    expand\n\n\nThe following object is masked from 'package:tidyr':\n\n    expand\n\n# loaded from TDbook package\ntree &lt;- tree_HPV58\n\nclade &lt;- c(A3 = 92, A1 = 94, A2 = 108, B1 = 156, \n            B2 = 159, C = 163, D1 = 173, D2 = 176)\ntree &lt;- groupClade(tree, clade)\ncols &lt;- c(A1 = \"#EC762F\", A2 = \"#CA6629\", A3 = \"#894418\", B1 = \"#0923FA\", \n         B2 = \"#020D87\", C = \"#000000\", D1 = \"#9ACD32\",D2 = \"#08630A\")\n\n## visualize the tree with tip labels and tree scale\np &lt;- ggtree(tree, aes(color = group), ladderize = FALSE) %&gt;% \n    rotate(rootnode(tree)) + \n    geom_tiplab(aes(label = paste0(\"italic('\", label, \"')\")), \n                parse = TRUE, size = 2.5) +\n    geom_treescale(x = 0, y = 1, width = 0.002) + \n    scale_color_manual(values = c(cols, \"black\"), \n                na.value = \"black\", name = \"Lineage\",\n                breaks = c(\"A1\", \"A2\", \"A3\", \"B1\", \"B2\", \"C\", \"D1\", \"D2\")) +\n    guides(color = guide_legend(override.aes = list(size = 5, shape = 15))) +\n    theme_tree2(legend.position = c(.1, .88))\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the ggtree package.\n  Please report the issue at &lt;https://github.com/YuLab-SMU/ggtree/issues&gt;.\n\n## Optional\n## add labels for monophyletic (A, C and D) and paraphyletic (B) groups \ndat &lt;- tibble(node = c(94, 108, 131, 92, 156, 159, 163, 173, 176,172),\n              name = c(\"A1\", \"A2\", \"A3\", \"A\", \"B1\", \n                        \"B2\", \"C\", \"D1\", \"D2\", \"D\"),\n              offset = c(0.003, 0.003, 0.003, 0.00315, 0.003, \n                        0.003, 0.0031, 0.003, 0.003, 0.00315),\n              offset.text = c(-.001, -.001, -.001, 0.0002, -.001, \n                        -.001, 0.0002, -.001, -.001, 0.0002),\n              barsize = c(1.2, 1.2, 1.2, 2, 1.2, 1.2, 3.2, 1.2, 1.2, 2),\n              extend = list(c(0, 0.5), 0.5, c(0.5, 0), 0, c(0, 0.5), \n                        c(0.5, 0), 0, c(0, 0.5), c(0.5, 0), 0)\n            ) %&gt;% \n       dplyr::group_split(barsize)\n\np &lt;- p +\n     geom_cladelab(\n         data = dat[[1]],\n         mapping = aes(\n             node = node,\n             label = name,\n             color = group,\n             offset = offset,\n             offset.text = offset.text,\n             extend = extend\n         ),\n         barsize = 1.2,\n         fontface = 3,\n         align = TRUE\n     ) +\n     geom_cladelab(\n         data = dat[[2]],\n         mapping = aes(\n             node = node,\n             label = name,\n             offset = offset,\n             offset.text =offset.text,\n             extend = extend\n         ),\n         barcolor = \"darkgrey\",\n         textcolor = \"darkgrey\",\n         barsize = 2,\n         fontsize = 5,\n         fontface = 3,\n         align = TRUE\n     ) +\n     geom_cladelab(\n         data = dat[[3]],\n         mapping = aes(\n             node = node,\n             label = name,\n             offset = offset,\n             offset.text = offset.text,\n             extend = extend\n         ),\n         barcolor = \"darkgrey\",\n         textcolor = \"darkgrey\",\n         barsize = 3.2,\n         fontsize = 5,\n         fontface = 3,\n         align = TRUE\n     ) +\n     geom_strip(65, 71, \"italic(B)\", color = \"darkgrey\", \n                offset = 0.00315, align = TRUE, offset.text = 0.0002, \n                barsize = 2, fontsize = 5, parse = TRUE)\n\n## Optional\n## display support values\np &lt;- p + geom_nodelab(aes(subset = (node == 92), label = \"*\"), \n                    color = \"black\", nudge_x = -.001, nudge_y = 1) +\n    geom_nodelab(aes(subset = (node == 155), label = \"*\"), \n                    color = \"black\", nudge_x = -.0003, nudge_y = -1) +\n    geom_nodelab(aes(subset = (node == 158), label = \"95/92/1.00\"), \n                    color = \"black\", nudge_x = -0.0001, \n                    nudge_y = -1, hjust = 1) +\n    geom_nodelab(aes(subset = (node == 162), label = \"98/97/1.00\"), \n                    color = \"black\", nudge_x = -0.0001, \n                    nudge_y = -1, hjust = 1) +\n    geom_nodelab(aes(subset = (node == 172), label = \"*\"), \n                    color = \"black\", nudge_x = -.0003, nudge_y = -1)\n## extract accession numbers from tip labels\ntl &lt;- tree$tip.label\nacc &lt;- sub(\"\\\\w+\\\\|\", \"\", tl)\nnames(tl) &lt;- acc\n\n## read sequences from GenBank directly into R\n## and convert the object to DNAStringSet\ntipseq &lt;- ape::read.GenBank(acc) %&gt;% as.character %&gt;% \n    lapply(., paste0, collapse = \"\") %&gt;% unlist %&gt;% \n    DNAStringSet\n## align the sequences using muscle\ntipseq_aln &lt;- muscle::muscle(tipseq)\n\n\nMUSCLE v3.8.31 by Robert C. Edgar\n\nhttp://www.drive5.com/muscle\nThis software is donated to the public domain.\nPlease cite: Edgar, R.C. Nucleic Acids Res 32(5), 1792-97.\n\nfile1193d10bd1df0 90 seqs, max length 7863, avg  length 7826\n1322 MB(8%)00:00:00                Iter   1    0.02%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   12.23%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   24.44%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   36.65%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   48.86%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   61.07%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   73.28%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   85.49%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1   97.70%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1  100.00%  K-mer dist pass 1\n1322 MB(8%)00:00:00                Iter   1    0.02%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   12.23%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   24.44%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   36.65%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   48.86%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   61.07%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   73.28%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   85.49%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1   97.70%  K-mer dist pass 2\n1322 MB(8%)00:00:00                Iter   1  100.00%  K-mer dist pass 2\n1331 MB(8%)00:00:00                Iter   1    1.12%  Align node       \n1404 MB(9%)00:00:01                Iter   1    2.25%  Align node\n1415 MB(9%)00:00:02                Iter   1    3.37%  Align node\n1418 MB(9%)00:00:02                Iter   1    4.49%  Align node\n1425 MB(9%)00:00:03                Iter   1    5.62%  Align node\n1431 MB(9%)00:00:04                Iter   1    6.74%  Align node\n1438 MB(9%)00:00:05                Iter   1    7.87%  Align node\n1445 MB(9%)00:00:05                Iter   1    8.99%  Align node\n1457 MB(9%)00:00:06                Iter   1   10.11%  Align node\n1463 MB(9%)00:00:07                Iter   1   11.24%  Align node\n1466 MB(9%)00:00:07                Iter   1   12.36%  Align node\n1468 MB(9%)00:00:08                Iter   1   13.48%  Align node\n1470 MB(9%)00:00:09                Iter   1   14.61%  Align node\n1473 MB(9%)00:00:10                Iter   1   15.73%  Align node\n1475 MB(9%)00:00:10                Iter   1   16.85%  Align node\n1477 MB(9%)00:00:11                Iter   1   17.98%  Align node\n1480 MB(9%)00:00:12                Iter   1   19.10%  Align node\n1482 MB(9%)00:00:12                Iter   1   20.22%  Align node\n1485 MB(9%)00:00:13                Iter   1   21.35%  Align node\n1487 MB(9%)00:00:14                Iter   1   22.47%  Align node\n1489 MB(9%)00:00:15                Iter   1   23.60%  Align node\n1492 MB(9%)00:00:15                Iter   1   24.72%  Align node\n1494 MB(9%)00:00:16                Iter   1   25.84%  Align node\n1505 MB(9%)00:00:17                Iter   1   26.97%  Align node\n1519 MB(9%)00:00:18                Iter   1   28.09%  Align node\n1521 MB(9%)00:00:18                Iter   1   29.21%  Align node\n1530 MB(9%)00:00:19                Iter   1   30.34%  Align node\n1533 MB(9%)00:00:20                Iter   1   31.46%  Align node\n1535 MB(9%)00:00:20                Iter   1   32.58%  Align node\n1537 MB(9%)00:00:21                Iter   1   33.71%  Align node\n1540 MB(9%)00:00:22                Iter   1   34.83%  Align node\n1542 MB(9%)00:00:23                Iter   1   35.96%  Align node\n1545 MB(9%)00:00:23                Iter   1   37.08%  Align node\n1560 MB(10%)00:00:24                Iter   1   38.20%  Align node\n1565 MB(10%)00:00:25                Iter   1   39.33%  Align node\n1572 MB(10%)00:00:25                Iter   1   40.45%  Align node\n1581 MB(10%)00:00:26                Iter   1   41.57%  Align node\n1586 MB(10%)00:00:27                Iter   1   42.70%  Align node\n1588 MB(10%)00:00:28                Iter   1   43.82%  Align node\n1590 MB(10%)00:00:28                Iter   1   44.94%  Align node\n1593 MB(10%)00:00:29                Iter   1   46.07%  Align node\n1595 MB(10%)00:00:30                Iter   1   47.19%  Align node\n1597 MB(10%)00:00:31                Iter   1   48.31%  Align node\n1600 MB(10%)00:00:31                Iter   1   49.44%  Align node\n1602 MB(10%)00:00:32                Iter   1   50.56%  Align node\n1604 MB(10%)00:00:33                Iter   1   51.69%  Align node\n1607 MB(10%)00:00:33                Iter   1   52.81%  Align node\n1614 MB(10%)00:00:34                Iter   1   53.93%  Align node\n1632 MB(10%)00:00:35                Iter   1   55.06%  Align node\n1634 MB(10%)00:00:36                Iter   1   56.18%  Align node\n1636 MB(10%)00:00:36                Iter   1   57.30%  Align node\n1639 MB(10%)00:00:37                Iter   1   58.43%  Align node\n1641 MB(10%)00:00:38                Iter   1   59.55%  Align node\n1644 MB(10%)00:00:39                Iter   1   60.67%  Align node\n1659 MB(10%)00:00:39                Iter   1   61.80%  Align node\n1662 MB(10%)00:00:40                Iter   1   62.92%  Align node\n1664 MB(10%)00:00:41                Iter   1   64.04%  Align node\n1666 MB(10%)00:00:41                Iter   1   65.17%  Align node\n1669 MB(10%)00:00:42                Iter   1   66.29%  Align node\n1671 MB(10%)00:00:43                Iter   1   67.42%  Align node\n1674 MB(10%)00:00:44                Iter   1   68.54%  Align node\n1676 MB(10%)00:00:44                Iter   1   69.66%  Align node\n1678 MB(10%)00:00:45                Iter   1   70.79%  Align node\n1692 MB(10%)00:00:46                Iter   1   71.91%  Align node\n1694 MB(10%)00:00:47                Iter   1   73.03%  Align node\n1697 MB(10%)00:00:47                Iter   1   74.16%  Align node\n1699 MB(10%)00:00:48                Iter   1   75.28%  Align node\n1710 MB(10%)00:00:49                Iter   1   76.40%  Align node\n1713 MB(10%)00:00:49                Iter   1   77.53%  Align node\n1715 MB(10%)00:00:50                Iter   1   78.65%  Align node\n1717 MB(10%)00:00:51                Iter   1   79.78%  Align node\n1726 MB(11%)00:00:52                Iter   1   80.90%  Align node\n1729 MB(11%)00:00:52                Iter   1   82.02%  Align node\n1738 MB(11%)00:00:53                Iter   1   83.15%  Align node\n1749 MB(11%)00:00:54                Iter   1   84.27%  Align node\n1752 MB(11%)00:00:54                Iter   1   85.39%  Align node\n1754 MB(11%)00:00:55                Iter   1   86.52%  Align node\n1756 MB(11%)00:00:56                Iter   1   87.64%  Align node\n1759 MB(11%)00:00:57                Iter   1   88.76%  Align node\n1761 MB(11%)00:00:57                Iter   1   89.89%  Align node\n1770 MB(11%)00:00:58                Iter   1   91.01%  Align node\n1772 MB(11%)00:00:59                Iter   1   92.13%  Align node\n1779 MB(11%)00:01:00                Iter   1   93.26%  Align node\n1786 MB(11%)00:01:00                Iter   1   94.38%  Align node\n1789 MB(11%)00:01:01                Iter   1   95.51%  Align node\n1791 MB(11%)00:01:02                Iter   1   96.63%  Align node\n1793 MB(11%)00:01:02                Iter   1   97.75%  Align node\n1796 MB(11%)00:01:03                Iter   1   98.88%  Align node\n1798 MB(11%)00:01:04                Iter   1  100.00%  Align node\n1800 MB(11%)00:01:05                Iter   1  100.00%  Align node\n1800 MB(11%)00:01:05                Iter   1    1.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1    2.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1    3.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1    4.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1    5.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1    6.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1    7.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1    8.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   10.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   11.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   12.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   13.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   14.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   15.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   16.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   17.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   18.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   20.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   21.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   22.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   23.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   24.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   25.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   26.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   27.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   28.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   30.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   31.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   32.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   33.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   34.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   35.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   36.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   37.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   38.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   40.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   41.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   42.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   43.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   44.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   45.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   46.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   47.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   48.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   50.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   51.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   52.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   53.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   54.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   55.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   56.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   57.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   58.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   60.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   61.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   62.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   63.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   64.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   65.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   66.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   67.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   68.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   70.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   71.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   72.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   73.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   74.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   75.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   76.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   77.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   78.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   80.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   81.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   82.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   83.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   84.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   85.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   86.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   87.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   88.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   90.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   91.11%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   92.22%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   93.33%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   94.44%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   95.56%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   96.67%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   97.78%  Root alignment\n1801 MB(11%)00:01:05                Iter   1   98.89%  Root alignment\n1801 MB(11%)00:01:05                Iter   1  100.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   1  100.00%  Root alignment\n1801 MB(11%)00:01:05                Iter   2    1.14%  Refine tree   \n1803 MB(11%)00:01:06                Iter   2    2.27%  Refine tree\n1803 MB(11%)00:01:06                Iter   2    3.41%  Refine tree\n1803 MB(11%)00:01:07                Iter   2    4.55%  Refine tree\n1803 MB(11%)00:01:08                Iter   2    5.68%  Refine tree\n1803 MB(11%)00:01:08                Iter   2    6.82%  Refine tree\n1803 MB(11%)00:01:09                Iter   2    7.95%  Refine tree\n1803 MB(11%)00:01:10                Iter   2    9.09%  Refine tree\n1803 MB(11%)00:01:11                Iter   2   10.23%  Refine tree\n1803 MB(11%)00:01:11                Iter   2   11.36%  Refine tree\n1803 MB(11%)00:01:12                Iter   2   12.50%  Refine tree\n1803 MB(11%)00:01:13                Iter   2   13.64%  Refine tree\n1803 MB(11%)00:01:13                Iter   2   14.77%  Refine tree\n1803 MB(11%)00:01:14                Iter   2   15.91%  Refine tree\n1803 MB(11%)00:01:15                Iter   2   17.05%  Refine tree\n1803 MB(11%)00:01:16                Iter   2   18.18%  Refine tree\n1803 MB(11%)00:01:16                Iter   2   19.32%  Refine tree\n1803 MB(11%)00:01:17                Iter   2   20.45%  Refine tree\n1803 MB(11%)00:01:18                Iter   2   21.59%  Refine tree\n1803 MB(11%)00:01:19                Iter   2   22.73%  Refine tree\n1803 MB(11%)00:01:19                Iter   2   23.86%  Refine tree\n1803 MB(11%)00:01:20                Iter   2   25.00%  Refine tree\n1803 MB(11%)00:01:21                Iter   2   26.14%  Refine tree\n1803 MB(11%)00:01:21                Iter   2   27.27%  Refine tree\n1803 MB(11%)00:01:22                Iter   2   28.41%  Refine tree\n1803 MB(11%)00:01:23                Iter   2   29.55%  Refine tree\n1803 MB(11%)00:01:24                Iter   2   30.68%  Refine tree\n1803 MB(11%)00:01:24                Iter   2   31.82%  Refine tree\n1803 MB(11%)00:01:25                Iter   2   32.95%  Refine tree\n1803 MB(11%)00:01:26                Iter   2   34.09%  Refine tree\n1803 MB(11%)00:01:26                Iter   2   35.23%  Refine tree\n1803 MB(11%)00:01:27                Iter   2   36.36%  Refine tree\n1803 MB(11%)00:01:28                Iter   2   37.50%  Refine tree\n1803 MB(11%)00:01:29                Iter   2   38.64%  Refine tree\n1803 MB(11%)00:01:29                Iter   2   39.77%  Refine tree\n1803 MB(11%)00:01:30                Iter   2   40.91%  Refine tree\n1803 MB(11%)00:01:31                Iter   2   42.05%  Refine tree\n1803 MB(11%)00:01:32                Iter   2   43.18%  Refine tree\n1803 MB(11%)00:01:32                Iter   2   44.32%  Refine tree\n1803 MB(11%)00:01:33                Iter   2   45.45%  Refine tree\n1803 MB(11%)00:01:34                Iter   2   46.59%  Refine tree\n1803 MB(11%)00:01:34                Iter   2   47.73%  Refine tree\n1803 MB(11%)00:01:35                Iter   2   48.86%  Refine tree\n1803 MB(11%)00:01:36                Iter   2   50.00%  Refine tree\n1803 MB(11%)00:01:37                Iter   2   51.14%  Refine tree\n1803 MB(11%)00:01:37                Iter   2   52.27%  Refine tree\n1803 MB(11%)00:01:38                Iter   2   53.41%  Refine tree\n1803 MB(11%)00:01:39                Iter   2   54.55%  Refine tree\n1803 MB(11%)00:01:40                Iter   2  100.00%  Refine tree\n1803 MB(11%)00:01:40                Iter   2    1.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2    2.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2    3.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2    4.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2    5.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2    6.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2    7.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2    8.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   10.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   11.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   12.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   13.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   14.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   15.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   16.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   17.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   18.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   20.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   21.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   22.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   23.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   24.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   25.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   26.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   27.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   28.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   30.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   31.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   32.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   33.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   34.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   35.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   36.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   37.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   38.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   40.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   41.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   42.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   43.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   44.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   45.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   46.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   47.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   48.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   50.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   51.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   52.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   53.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   54.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   55.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   56.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   57.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   58.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   60.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   61.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   62.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   63.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   64.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   65.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   66.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   67.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   68.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   70.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   71.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   72.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   73.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   74.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   75.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   76.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   77.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   78.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   80.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   81.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   82.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   83.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   84.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   85.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   86.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   87.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   88.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   90.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   91.11%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   92.22%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   93.33%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   94.44%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   95.56%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   96.67%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   97.78%  Root alignment\n1803 MB(11%)00:01:40                Iter   2   98.89%  Root alignment\n1803 MB(11%)00:01:40                Iter   2  100.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2  100.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   2  100.00%  Root alignment\n1803 MB(11%)00:01:40                Iter   3    1.13%  Refine biparts\n1803 MB(11%)00:01:41                Iter   3    1.69%  Refine biparts\n1803 MB(11%)00:01:42                Iter   3    2.26%  Refine biparts\n1803 MB(11%)00:01:43                Iter   3    2.82%  Refine biparts\n1803 MB(11%)00:01:43                Iter   3    3.39%  Refine biparts\n1803 MB(11%)00:01:44                Iter   3    3.95%  Refine biparts\n1803 MB(11%)00:01:45                Iter   3    4.52%  Refine biparts\n1803 MB(11%)00:01:46                Iter   3    5.08%  Refine biparts\n1803 MB(11%)00:01:46                Iter   3    5.65%  Refine biparts\n1803 MB(11%)00:01:47                Iter   3    6.21%  Refine biparts\n1803 MB(11%)00:01:48                Iter   3    6.78%  Refine biparts\n1803 MB(11%)00:01:49                Iter   3    7.34%  Refine biparts\n1803 MB(11%)00:01:49                Iter   3    7.91%  Refine biparts\n1803 MB(11%)00:01:50                Iter   3    8.47%  Refine biparts\n1803 MB(11%)00:01:51                Iter   3    9.04%  Refine biparts\n1803 MB(11%)00:01:52                Iter   3    9.60%  Refine biparts\n1803 MB(11%)00:01:52                Iter   3   10.17%  Refine biparts\n1803 MB(11%)00:01:53                Iter   3   10.73%  Refine biparts\n1803 MB(11%)00:01:54                Iter   3   11.30%  Refine biparts\n1803 MB(11%)00:01:55                Iter   3   11.86%  Refine biparts\n1803 MB(11%)00:01:56                Iter   3   12.43%  Refine biparts\n1803 MB(11%)00:01:56                Iter   3   12.99%  Refine biparts\n1803 MB(11%)00:01:57                Iter   3   13.56%  Refine biparts\n1803 MB(11%)00:01:58                Iter   3   14.12%  Refine biparts\n1803 MB(11%)00:01:59                Iter   3   14.69%  Refine biparts\n1803 MB(11%)00:01:59                Iter   3   15.25%  Refine biparts\n1803 MB(11%)00:02:00                Iter   3   15.82%  Refine biparts\n1803 MB(11%)00:02:01                Iter   3   16.38%  Refine biparts\n1803 MB(11%)00:02:02                Iter   3   16.95%  Refine biparts\n1803 MB(11%)00:02:02                Iter   3   17.51%  Refine biparts\n1803 MB(11%)00:02:03                Iter   3   18.08%  Refine biparts\n1803 MB(11%)00:02:04                Iter   3   18.64%  Refine biparts\n1803 MB(11%)00:02:05                Iter   3   19.21%  Refine biparts\n1803 MB(11%)00:02:05                Iter   3   19.77%  Refine biparts\n1803 MB(11%)00:02:06                Iter   3   20.34%  Refine biparts\n1803 MB(11%)00:02:07                Iter   3   20.90%  Refine biparts\n1803 MB(11%)00:02:08                Iter   3   21.47%  Refine biparts\n1803 MB(11%)00:02:08                Iter   3   22.03%  Refine biparts\n1803 MB(11%)00:02:09                Iter   3   22.60%  Refine biparts\n1803 MB(11%)00:02:10                Iter   3   23.16%  Refine biparts\n1803 MB(11%)00:02:11                Iter   3   23.73%  Refine biparts\n1803 MB(11%)00:02:12                Iter   3   24.29%  Refine biparts\n1803 MB(11%)00:02:12                Iter   3   24.86%  Refine biparts\n1803 MB(11%)00:02:13                Iter   3   25.42%  Refine biparts\n1803 MB(11%)00:02:14                Iter   3   25.99%  Refine biparts\n1803 MB(11%)00:02:15                Iter   3   26.55%  Refine biparts\n1803 MB(11%)00:02:15                Iter   3   27.12%  Refine biparts\n1803 MB(11%)00:02:16                Iter   3   27.68%  Refine biparts\n1803 MB(11%)00:02:17                Iter   3   28.25%  Refine biparts\n1803 MB(11%)00:02:18                Iter   3   28.81%  Refine biparts\n1803 MB(11%)00:02:18                Iter   3   29.38%  Refine biparts\n1803 MB(11%)00:02:19                Iter   3   29.94%  Refine biparts\n1803 MB(11%)00:02:20                Iter   3   30.51%  Refine biparts\n1803 MB(11%)00:02:21                Iter   3   31.07%  Refine biparts\n1803 MB(11%)00:02:21                Iter   3   31.64%  Refine biparts\n1803 MB(11%)00:02:22                Iter   3   32.20%  Refine biparts\n1803 MB(11%)00:02:23                Iter   3   32.77%  Refine biparts\n1803 MB(11%)00:02:24                Iter   3   33.33%  Refine biparts\n1803 MB(11%)00:02:24                Iter   3   33.90%  Refine biparts\n1803 MB(11%)00:02:25                Iter   3   34.46%  Refine biparts\n1803 MB(11%)00:02:26                Iter   3   35.03%  Refine biparts\n1803 MB(11%)00:02:27                Iter   3   35.59%  Refine biparts\n1803 MB(11%)00:02:27                Iter   3   36.16%  Refine biparts\n1803 MB(11%)00:02:28                Iter   3   36.72%  Refine biparts\n1803 MB(11%)00:02:29                Iter   3   37.29%  Refine biparts\n1803 MB(11%)00:02:30                Iter   3   37.85%  Refine biparts\n1803 MB(11%)00:02:31                Iter   3   38.42%  Refine biparts\n1803 MB(11%)00:02:31                Iter   3   38.98%  Refine biparts\n1803 MB(11%)00:02:32                Iter   3   39.55%  Refine biparts\n1803 MB(11%)00:02:33                Iter   3   40.11%  Refine biparts\n1803 MB(11%)00:02:34                Iter   3   40.68%  Refine biparts\n1803 MB(11%)00:02:34                Iter   3   41.24%  Refine biparts\n1803 MB(11%)00:02:35                Iter   3   41.81%  Refine biparts\n1803 MB(11%)00:02:36                Iter   3   42.37%  Refine biparts\n1803 MB(11%)00:02:37                Iter   3   42.94%  Refine biparts\n1803 MB(11%)00:02:37                Iter   3   43.50%  Refine biparts\n1803 MB(11%)00:02:38                Iter   3   44.07%  Refine biparts\n1803 MB(11%)00:02:39                Iter   3   44.63%  Refine biparts\n1803 MB(11%)00:02:40                Iter   3   45.20%  Refine biparts\n1803 MB(11%)00:02:41                Iter   3   45.76%  Refine biparts\n1803 MB(11%)00:02:41                Iter   3   46.33%  Refine biparts\n1803 MB(11%)00:02:42                Iter   3   46.89%  Refine biparts\n1803 MB(11%)00:02:43                Iter   3   47.46%  Refine biparts\n1803 MB(11%)00:02:44                Iter   3   48.02%  Refine biparts\n1803 MB(11%)00:02:44                Iter   3   48.59%  Refine biparts\n1803 MB(11%)00:02:45                Iter   3   49.15%  Refine biparts\n1803 MB(11%)00:02:46                Iter   3   49.72%  Refine biparts\n1803 MB(11%)00:02:47                Iter   3   50.28%  Refine biparts\n1803 MB(11%)00:02:47                Iter   3   50.85%  Refine biparts\n1803 MB(11%)00:02:48                Iter   3   51.41%  Refine biparts\n1803 MB(11%)00:02:49                Iter   3   51.98%  Refine biparts\n1803 MB(11%)00:02:50                Iter   3   52.54%  Refine biparts\n1803 MB(11%)00:02:51                Iter   3   53.11%  Refine biparts\n1803 MB(11%)00:02:51                Iter   3   53.67%  Refine biparts\n1803 MB(11%)00:02:52                Iter   3   54.24%  Refine biparts\n1803 MB(11%)00:02:53                Iter   3   54.80%  Refine biparts\n1803 MB(11%)00:02:54                Iter   3   55.37%  Refine biparts\n1803 MB(11%)00:02:54                Iter   3   55.93%  Refine biparts\n1803 MB(11%)00:02:55                Iter   3   56.50%  Refine biparts\n1803 MB(11%)00:02:56                Iter   3   57.06%  Refine biparts\n1803 MB(11%)00:02:57                Iter   3   57.63%  Refine biparts\n1803 MB(11%)00:02:57                Iter   3   58.19%  Refine biparts\n1803 MB(11%)00:02:58                Iter   3   58.76%  Refine biparts\n1803 MB(11%)00:02:59                Iter   3   59.32%  Refine biparts\n1803 MB(11%)00:03:00                Iter   3   59.89%  Refine biparts\n1803 MB(11%)00:03:00                Iter   3   60.45%  Refine biparts\n1803 MB(11%)00:03:01                Iter   3   61.02%  Refine biparts\n1803 MB(11%)00:03:02                Iter   3   61.58%  Refine biparts\n1803 MB(11%)00:03:03                Iter   3   62.15%  Refine biparts\n1803 MB(11%)00:03:03                Iter   3   62.71%  Refine biparts\n1803 MB(11%)00:03:04                Iter   3   63.28%  Refine biparts\n1803 MB(11%)00:03:05                Iter   3   63.84%  Refine biparts\n1803 MB(11%)00:03:06                Iter   3   64.41%  Refine biparts\n1803 MB(11%)00:03:06                Iter   3   64.97%  Refine biparts\n1803 MB(11%)00:03:07                Iter   3   65.54%  Refine biparts\n1803 MB(11%)00:03:08                Iter   3   66.10%  Refine biparts\n1803 MB(11%)00:03:09                Iter   3   66.67%  Refine biparts\n1803 MB(11%)00:03:10                Iter   3   67.23%  Refine biparts\n1803 MB(11%)00:03:10                Iter   3   67.80%  Refine biparts\n1803 MB(11%)00:03:11                Iter   3   68.36%  Refine biparts\n1803 MB(11%)00:03:12                Iter   3   68.93%  Refine biparts\n1803 MB(11%)00:03:13                Iter   3   69.49%  Refine biparts\n1803 MB(11%)00:03:13                Iter   3   70.06%  Refine biparts\n1803 MB(11%)00:03:14                Iter   3   70.62%  Refine biparts\n1803 MB(11%)00:03:15                Iter   3   71.19%  Refine biparts\n1803 MB(11%)00:03:16                Iter   3   71.75%  Refine biparts\n1803 MB(11%)00:03:16                Iter   3   72.32%  Refine biparts\n1803 MB(11%)00:03:17                Iter   3   72.88%  Refine biparts\n1803 MB(11%)00:03:18                Iter   3   73.45%  Refine biparts\n1803 MB(11%)00:03:19                Iter   3   74.01%  Refine biparts\n1803 MB(11%)00:03:19                Iter   3   74.58%  Refine biparts\n1803 MB(11%)00:03:20                Iter   3   75.14%  Refine biparts\n1803 MB(11%)00:03:21                Iter   3   75.71%  Refine biparts\n1803 MB(11%)00:03:22                Iter   3   76.27%  Refine biparts\n1803 MB(11%)00:03:22                Iter   3   76.84%  Refine biparts\n1803 MB(11%)00:03:23                Iter   3   77.40%  Refine biparts\n1803 MB(11%)00:03:24                Iter   3   77.97%  Refine biparts\n1803 MB(11%)00:03:25                Iter   3   78.53%  Refine biparts\n1803 MB(11%)00:03:25                Iter   3   79.10%  Refine biparts\n1803 MB(11%)00:03:26                Iter   3   79.66%  Refine biparts\n1803 MB(11%)00:03:27                Iter   3   80.23%  Refine biparts\n1803 MB(11%)00:03:28                Iter   3   80.79%  Refine biparts\n1803 MB(11%)00:03:29                Iter   3   81.36%  Refine biparts\n1803 MB(11%)00:03:29                Iter   3   81.92%  Refine biparts\n1803 MB(11%)00:03:30                Iter   3   82.49%  Refine biparts\n1803 MB(11%)00:03:31                Iter   3   83.05%  Refine biparts\n1803 MB(11%)00:03:32                Iter   3   83.62%  Refine biparts\n1803 MB(11%)00:03:32                Iter   3   84.18%  Refine biparts\n1803 MB(11%)00:03:33                Iter   3   84.75%  Refine biparts\n1803 MB(11%)00:03:34                Iter   3   85.31%  Refine biparts\n1803 MB(11%)00:03:35                Iter   3   85.88%  Refine biparts\n1803 MB(11%)00:03:35                Iter   3   86.44%  Refine biparts\n1803 MB(11%)00:03:36                Iter   3   87.01%  Refine biparts\n1803 MB(11%)00:03:37                Iter   3   87.57%  Refine biparts\n1803 MB(11%)00:03:38                Iter   3   88.14%  Refine biparts\n1803 MB(11%)00:03:38                Iter   3   88.70%  Refine biparts\n1803 MB(11%)00:03:39                Iter   3   89.27%  Refine biparts\n1803 MB(11%)00:03:40                Iter   3   89.83%  Refine biparts\n1803 MB(11%)00:03:41                Iter   3   90.40%  Refine biparts\n1803 MB(11%)00:03:42                Iter   3   90.96%  Refine biparts\n1803 MB(11%)00:03:42                Iter   3   91.53%  Refine biparts\n1803 MB(11%)00:03:43                Iter   3   92.09%  Refine biparts\n1803 MB(11%)00:03:44                Iter   3   92.66%  Refine biparts\n1803 MB(11%)00:03:45                Iter   3   93.22%  Refine biparts\n1803 MB(11%)00:03:45                Iter   3   93.79%  Refine biparts\n1803 MB(11%)00:03:46                Iter   3   94.35%  Refine biparts\n1803 MB(11%)00:03:47                Iter   3   94.92%  Refine biparts\n1803 MB(11%)00:03:48                Iter   3   95.48%  Refine biparts\n1803 MB(11%)00:03:48                Iter   3   96.05%  Refine biparts\n1803 MB(11%)00:03:49                Iter   3   96.61%  Refine biparts\n1803 MB(11%)00:03:50                Iter   3   97.18%  Refine biparts\n1803 MB(11%)00:03:51                Iter   3   97.74%  Refine biparts\n1803 MB(11%)00:03:51                Iter   3   98.31%  Refine biparts\n1803 MB(11%)00:03:52                Iter   3   98.87%  Refine biparts\n1803 MB(11%)00:03:53                Iter   3   99.44%  Refine biparts\n1803 MB(11%)00:03:54                Iter   3  100.00%  Refine biparts\n1803 MB(11%)00:03:55                Iter   3  100.56%  Refine biparts\n1803 MB(11%)00:03:55                Iter   3  100.00%  Refine biparts\n1803 MB(11%)00:03:55                Iter   4    1.13%  Refine biparts\n1803 MB(11%)00:03:56                Iter   4    1.69%  Refine biparts\n1803 MB(11%)00:03:57                Iter   4    2.26%  Refine biparts\n1803 MB(11%)00:03:58                Iter   4    2.82%  Refine biparts\n1803 MB(11%)00:03:58                Iter   4    3.39%  Refine biparts\n1803 MB(11%)00:03:59                Iter   4    3.95%  Refine biparts\n1803 MB(11%)00:04:00                Iter   4    4.52%  Refine biparts\n1803 MB(11%)00:04:01                Iter   4    5.08%  Refine biparts\n1803 MB(11%)00:04:01                Iter   4    5.65%  Refine biparts\n1803 MB(11%)00:04:02                Iter   4    6.21%  Refine biparts\n1803 MB(11%)00:04:03                Iter   4    6.78%  Refine biparts\n1803 MB(11%)00:04:04                Iter   4    7.34%  Refine biparts\n1803 MB(11%)00:04:05                Iter   4    7.91%  Refine biparts\n1803 MB(11%)00:04:05                Iter   4    8.47%  Refine biparts\n1803 MB(11%)00:04:06                Iter   4    9.04%  Refine biparts\n1803 MB(11%)00:04:07                Iter   4    9.60%  Refine biparts\n1803 MB(11%)00:04:08                Iter   4   10.17%  Refine biparts\n1803 MB(11%)00:04:08                Iter   4   10.73%  Refine biparts\n1803 MB(11%)00:04:09                Iter   4   11.30%  Refine biparts\n1803 MB(11%)00:04:10                Iter   4   11.86%  Refine biparts\n1803 MB(11%)00:04:11                Iter   4   12.43%  Refine biparts\n1803 MB(11%)00:04:11                Iter   4   12.99%  Refine biparts\n1803 MB(11%)00:04:12                Iter   4   13.56%  Refine biparts\n1803 MB(11%)00:04:13                Iter   4   14.12%  Refine biparts\n1803 MB(11%)00:04:14                Iter   4   14.69%  Refine biparts\n1803 MB(11%)00:04:14                Iter   4   15.25%  Refine biparts\n1803 MB(11%)00:04:15                Iter   4   15.82%  Refine biparts\n1803 MB(11%)00:04:16                Iter   4   16.38%  Refine biparts\n1803 MB(11%)00:04:17                Iter   4   16.95%  Refine biparts\n1803 MB(11%)00:04:17                Iter   4   17.51%  Refine biparts\n1803 MB(11%)00:04:18                Iter   4   18.08%  Refine biparts\n1803 MB(11%)00:04:19                Iter   4   18.64%  Refine biparts\n1803 MB(11%)00:04:20                Iter   4   19.21%  Refine biparts\n1803 MB(11%)00:04:21                Iter   4   19.77%  Refine biparts\n1803 MB(11%)00:04:21                Iter   4   20.34%  Refine biparts\n1803 MB(11%)00:04:22                Iter   4   20.90%  Refine biparts\n1803 MB(11%)00:04:23                Iter   4   21.47%  Refine biparts\n1803 MB(11%)00:04:24                Iter   4   22.03%  Refine biparts\n1803 MB(11%)00:04:24                Iter   4   22.60%  Refine biparts\n1803 MB(11%)00:04:25                Iter   4   23.16%  Refine biparts\n1803 MB(11%)00:04:26                Iter   4   23.73%  Refine biparts\n1803 MB(11%)00:04:27                Iter   4   24.29%  Refine biparts\n1803 MB(11%)00:04:27                Iter   4   24.86%  Refine biparts\n1803 MB(11%)00:04:28                Iter   4   25.42%  Refine biparts\n1803 MB(11%)00:04:29                Iter   4   25.99%  Refine biparts\n1803 MB(11%)00:04:30                Iter   4   26.55%  Refine biparts\n1803 MB(11%)00:04:30                Iter   4   27.12%  Refine biparts\n1803 MB(11%)00:04:31                Iter   4   27.68%  Refine biparts\n1803 MB(11%)00:04:32                Iter   4   28.25%  Refine biparts\n1803 MB(11%)00:04:33                Iter   4   28.81%  Refine biparts\n1803 MB(11%)00:04:33                Iter   4   29.38%  Refine biparts\n1803 MB(11%)00:04:34                Iter   4   29.94%  Refine biparts\n1803 MB(11%)00:04:35                Iter   4   30.51%  Refine biparts\n1803 MB(11%)00:04:36                Iter   4   31.07%  Refine biparts\n1803 MB(11%)00:04:37                Iter   4   31.64%  Refine biparts\n1803 MB(11%)00:04:37                Iter   4   32.20%  Refine biparts\n1803 MB(11%)00:04:38                Iter   4   32.77%  Refine biparts\n1803 MB(11%)00:04:39                Iter   4   33.33%  Refine biparts\n1803 MB(11%)00:04:40                Iter   4   33.90%  Refine biparts\n1803 MB(11%)00:04:40                Iter   4   34.46%  Refine biparts\n1803 MB(11%)00:04:41                Iter   4   35.03%  Refine biparts\n1803 MB(11%)00:04:42                Iter   4   35.59%  Refine biparts\n1803 MB(11%)00:04:43                Iter   4   36.16%  Refine biparts\n1803 MB(11%)00:04:43                Iter   4   36.72%  Refine biparts\n1803 MB(11%)00:04:44                Iter   4   37.29%  Refine biparts\n1803 MB(11%)00:04:45                Iter   4   37.85%  Refine biparts\n1803 MB(11%)00:04:46                Iter   4   38.42%  Refine biparts\n1803 MB(11%)00:04:46                Iter   4   38.98%  Refine biparts\n1803 MB(11%)00:04:47                Iter   4   39.55%  Refine biparts\n1803 MB(11%)00:04:48                Iter   4   40.11%  Refine biparts\n1803 MB(11%)00:04:49                Iter   4   40.68%  Refine biparts\n1803 MB(11%)00:04:49                Iter   4   41.24%  Refine biparts\n1803 MB(11%)00:04:50                Iter   4   41.81%  Refine biparts\n1803 MB(11%)00:04:51                Iter   4   42.37%  Refine biparts\n1803 MB(11%)00:04:52                Iter   4   42.94%  Refine biparts\n1803 MB(11%)00:04:53                Iter   4   43.50%  Refine biparts\n1803 MB(11%)00:04:53                Iter   4   44.07%  Refine biparts\n1803 MB(11%)00:04:54                Iter   4   44.63%  Refine biparts\n1803 MB(11%)00:04:55                Iter   4   45.20%  Refine biparts\n1803 MB(11%)00:04:56                Iter   4   45.76%  Refine biparts\n1803 MB(11%)00:04:56                Iter   4   46.33%  Refine biparts\n1803 MB(11%)00:04:57                Iter   4   46.89%  Refine biparts\n1803 MB(11%)00:04:58                Iter   4   47.46%  Refine biparts\n1803 MB(11%)00:04:59                Iter   4   48.02%  Refine biparts\n1803 MB(11%)00:04:59                Iter   4   48.59%  Refine biparts\n1803 MB(11%)00:05:00                Iter   4   49.15%  Refine biparts\n1803 MB(11%)00:05:01                Iter   4   49.72%  Refine biparts\n1803 MB(11%)00:05:02                Iter   4   50.28%  Refine biparts\n1803 MB(11%)00:05:02                Iter   4   50.85%  Refine biparts\n1803 MB(11%)00:05:03                Iter   4   51.41%  Refine biparts\n1803 MB(11%)00:05:04                Iter   4   51.98%  Refine biparts\n1803 MB(11%)00:05:05                Iter   4   52.54%  Refine biparts\n1803 MB(11%)00:05:05                Iter   4   53.11%  Refine biparts\n1803 MB(11%)00:05:06                Iter   4   53.67%  Refine biparts\n1803 MB(11%)00:05:07                Iter   4   54.24%  Refine biparts\n1803 MB(11%)00:05:08                Iter   4   54.80%  Refine biparts\n1803 MB(11%)00:05:09                Iter   4   55.37%  Refine biparts\n1803 MB(11%)00:05:09                Iter   4   55.93%  Refine biparts\n1803 MB(11%)00:05:10                Iter   4   56.50%  Refine biparts\n1803 MB(11%)00:05:11                Iter   4   57.06%  Refine biparts\n1803 MB(11%)00:05:12                Iter   4   57.63%  Refine biparts\n1803 MB(11%)00:05:12                Iter   4   58.19%  Refine biparts\n1803 MB(11%)00:05:13                Iter   4   58.76%  Refine biparts\n1803 MB(11%)00:05:14                Iter   4   59.32%  Refine biparts\n1803 MB(11%)00:05:15                Iter   4   59.89%  Refine biparts\n1803 MB(11%)00:05:15                Iter   4   60.45%  Refine biparts\n1803 MB(11%)00:05:16                Iter   4   61.02%  Refine biparts\n1803 MB(11%)00:05:17                Iter   4   61.58%  Refine biparts\n1803 MB(11%)00:05:18                Iter   4   62.15%  Refine biparts\n1803 MB(11%)00:05:18                Iter   4   62.71%  Refine biparts\n1803 MB(11%)00:05:19                Iter   4   63.28%  Refine biparts\n1803 MB(11%)00:05:20                Iter   4   63.84%  Refine biparts\n1803 MB(11%)00:05:21                Iter   4   64.41%  Refine biparts\n1803 MB(11%)00:05:21                Iter   4   64.97%  Refine biparts\n1803 MB(11%)00:05:22                Iter   4   65.54%  Refine biparts\n1803 MB(11%)00:05:23                Iter   4   66.10%  Refine biparts\n1803 MB(11%)00:05:24                Iter   4   66.67%  Refine biparts\n1803 MB(11%)00:05:24                Iter   4   67.23%  Refine biparts\n1803 MB(11%)00:05:25                Iter   4   67.80%  Refine biparts\n1803 MB(11%)00:05:26                Iter   4   68.36%  Refine biparts\n1803 MB(11%)00:05:27                Iter   4   68.93%  Refine biparts\n1803 MB(11%)00:05:28                Iter   4   69.49%  Refine biparts\n1803 MB(11%)00:05:28                Iter   4   70.06%  Refine biparts\n1803 MB(11%)00:05:29                Iter   4   70.62%  Refine biparts\n1803 MB(11%)00:05:30                Iter   4   71.19%  Refine biparts\n1803 MB(11%)00:05:31                Iter   4   71.75%  Refine biparts\n1803 MB(11%)00:05:31                Iter   4   72.32%  Refine biparts\n1803 MB(11%)00:05:32                Iter   4   72.88%  Refine biparts\n1803 MB(11%)00:05:33                Iter   4   73.45%  Refine biparts\n1803 MB(11%)00:05:34                Iter   4   74.01%  Refine biparts\n1803 MB(11%)00:05:34                Iter   4   74.58%  Refine biparts\n1803 MB(11%)00:05:35                Iter   4   75.14%  Refine biparts\n1803 MB(11%)00:05:36                Iter   4   75.71%  Refine biparts\n1803 MB(11%)00:05:37                Iter   4   76.27%  Refine biparts\n1803 MB(11%)00:05:37                Iter   4   76.84%  Refine biparts\n1803 MB(11%)00:05:38                Iter   4   77.40%  Refine biparts\n1803 MB(11%)00:05:39                Iter   4   77.97%  Refine biparts\n1803 MB(11%)00:05:40                Iter   4   78.53%  Refine biparts\n1803 MB(11%)00:05:40                Iter   4   79.10%  Refine biparts\n1803 MB(11%)00:05:41                Iter   4   79.66%  Refine biparts\n1803 MB(11%)00:05:42                Iter   4   80.23%  Refine biparts\n1803 MB(11%)00:05:43                Iter   4   80.79%  Refine biparts\n1803 MB(11%)00:05:43                Iter   4   81.36%  Refine biparts\n1803 MB(11%)00:05:44                Iter   4   81.92%  Refine biparts\n1803 MB(11%)00:05:45                Iter   4   82.49%  Refine biparts\n1803 MB(11%)00:05:46                Iter   4   83.05%  Refine biparts\n1803 MB(11%)00:05:46                Iter   4   83.62%  Refine biparts\n1803 MB(11%)00:05:47                Iter   4   84.18%  Refine biparts\n1803 MB(11%)00:05:48                Iter   4   84.75%  Refine biparts\n1803 MB(11%)00:05:49                Iter   4   85.31%  Refine biparts\n1803 MB(11%)00:05:49                Iter   4   85.88%  Refine biparts\n1803 MB(11%)00:05:50                Iter   4   86.44%  Refine biparts\n1803 MB(11%)00:05:51                Iter   4   87.01%  Refine biparts\n1803 MB(11%)00:05:52                Iter   4   87.57%  Refine biparts\n1803 MB(11%)00:05:52                Iter   4   88.14%  Refine biparts\n1803 MB(11%)00:05:53                Iter   4   88.70%  Refine biparts\n1803 MB(11%)00:05:54                Iter   4   89.27%  Refine biparts\n1803 MB(11%)00:05:55                Iter   4   89.83%  Refine biparts\n1803 MB(11%)00:05:56                Iter   4   90.40%  Refine biparts\n1803 MB(11%)00:05:56                Iter   4   90.96%  Refine biparts\n1803 MB(11%)00:05:57                Iter   4   91.53%  Refine biparts\n1803 MB(11%)00:05:58                Iter   4   92.09%  Refine biparts\n1803 MB(11%)00:05:59                Iter   4   92.66%  Refine biparts\n1803 MB(11%)00:05:59                Iter   4   93.22%  Refine biparts\n1803 MB(11%)00:06:00                Iter   4   93.79%  Refine biparts\n1803 MB(11%)00:06:01                Iter   4   94.35%  Refine biparts\n1803 MB(11%)00:06:02                Iter   4   94.92%  Refine biparts\n1803 MB(11%)00:06:02                Iter   4   95.48%  Refine biparts\n1803 MB(11%)00:06:03                Iter   4   96.05%  Refine biparts\n1803 MB(11%)00:06:04                Iter   4   96.61%  Refine biparts\n1803 MB(11%)00:06:05                Iter   4   97.18%  Refine biparts\n1803 MB(11%)00:06:05                Iter   4   97.74%  Refine biparts\n1803 MB(11%)00:06:06                Iter   4   98.31%  Refine biparts\n1803 MB(11%)00:06:07                Iter   4   98.87%  Refine biparts\n1803 MB(11%)00:06:08                Iter   4   99.44%  Refine biparts\n1803 MB(11%)00:06:08                Iter   4  100.00%  Refine biparts\n1803 MB(11%)00:06:09                Iter   4  100.56%  Refine biparts\n1803 MB(11%)00:06:09                Iter   4  100.00%  Refine biparts\n\ntipseq_aln &lt;- DNAStringSet(tipseq_aln)\n## extract accession numbers from tip labels\ntl &lt;- tree$tip.label\nacc &lt;- sub(\"\\\\w+\\\\|\", \"\", tl)\nnames(tl) &lt;- acc\n\n## writeXStringSet(tipseq_aln, file = \"data/HPV58_aln.fas\")\n#tipseq_aln &lt;- readDNAStringSet(\"data/HPV58_aln.fas\")\ntipseq_aln &lt;- TDbook::dna_HPV58_aln %&gt;% \n              as.character %&gt;%\n              lapply(., paste0, collapse = \"\") %&gt;%\n              unlist() %&gt;%\n              Biostrings::DNAStringSet()\n## calculate pairwise hamming distances among sequences\ntipseq_dist &lt;- pwalign::stringDist(tipseq_aln, method = \"hamming\")\n\n## calculate the percentage of differences\ntipseq_d &lt;- as.matrix(tipseq_dist) / width(tipseq_aln[1]) * 100\n\n## convert the matrix to a tidy data frame for facet_plot\ndd &lt;- as_tibble(tipseq_d)\ndd$seq1 &lt;- rownames(tipseq_d)\ntd &lt;- gather(dd,seq2, dist, -seq1)\ntd$seq1 &lt;- tl[td$seq1]\ntd$seq2 &lt;- tl[td$seq2]\n\ng &lt;- p$data$group\nnames(g) &lt;- p$data$label\ntd$clade &lt;- g[td$seq2] \n\n## visualize the sequence differences using dot plot and line plot\n## and align the sequence difference plot to the tree using facet_plot\np2 &lt;- p + geom_facet(panel = \"Sequence Distance\", \n            data = td, geom = geom_point, alpha = .6, \n            mapping = aes(x = dist, color = clade, shape = clade)) +\n    geom_facet(panel = \"Sequence Distance\", \n            data = td, geom = geom_path, alpha = .6, \n            mapping=aes(x = dist, group = seq2, color = clade)) + \n    scale_shape_manual(values = 1:8, guide = FALSE) \n\nprint(p2)\n\n\n\n\nPhylogeny of HPV58 complete genomes with dot and line plots of pairwise nucleotide sequence distances.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Gallery of Reproducible Examples</span>"
    ]
  },
  {
    "objectID": "13_ggtree_gallery.html#sec-symbolic-bootstrap",
    "href": "13_ggtree_gallery.html#sec-symbolic-bootstrap",
    "title": "10  Gallery of Reproducible Examples",
    "section": "10.2 Displaying Different Symbolic Points for Bootstrap Values.",
    "text": "10.2 Displaying Different Symbolic Points for Bootstrap Values.\nWe can cut the bootstrap values into several intervals, e.g., to indicate whether the clade is of high, moderate, or low support. Then we can use these intervals as categorical variables to set different colors or shapes of symbolic points to indicate the bootstrap values belong to which category (Figure ?fig-bpinterval).\n\n## phytools also have a read.newick function\nread.newick &lt;- treeio::read.newick\n\n\nlibrary(treeio)\nlibrary(ggplot2)\nlibrary(ggtree)\nlibrary(TDbook)\n\ntree &lt;- read.newick(text=text_RMI_tree, node.label = \"support\")\nroot &lt;- rootnode(tree)  \nggtree(tree, color=\"black\", size=1.5, linetype=1,  right=TRUE) + \n    geom_tiplab(size=4.5, hjust = -0.060, fontface=\"bold\") +  xlim(0, 0.09) + \n    geom_point2(aes(subset=!isTip & node != root, \n                    fill=cut(support, c(0, 700, 900, 1000))), \n                    shape=21, size=4) + \n    theme_tree(legend.position=c(0.2, 0.2)) + \n    scale_fill_manual(values=c(\"white\", \"grey\", \"black\"), guide='legend', \n                    name='Bootstrap Percentage(BP)', \n                    breaks=c('(900,1e+03]', '(700,900]', '(0,700]'), \n                    labels=expression(BP&gt;=90,70 &lt;= BP * \" &lt; 90\", BP &lt; 70))\n\n\n\n\nPartitioning bootstrap values. Bootstrap values were divided into three categories and this information was used to color circle points.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Gallery of Reproducible Examples</span>"
    ]
  },
  {
    "objectID": "13_ggtree_gallery.html#sec-phylo-grouping",
    "href": "13_ggtree_gallery.html#sec-phylo-grouping",
    "title": "10  Gallery of Reproducible Examples",
    "section": "10.3 Highlighting Different Groups",
    "text": "10.3 Highlighting Different Groups\nThis example reproduces Figure 1 of (Larsen et al., 2019). It used groupOTU() to add grouping information of chicken CTLDcps. The branch line type and color are defined based on this grouping information. Two groups of CTLDcps are highlighted in different background colors using geom_hilight (red for Group II and green for Group V). The avian-specific expansion of Group V with the subgroups of A and B- are labeled using geom_cladelab (Figure ?fig-treeLarsen).\n\nlibrary(TDbook)\nmytree &lt;- tree_treenwk_30.4.19\n\n# Define nodes for coloring later on\ntiplab &lt;- mytree$tip.label\ncls &lt;- tiplab[grep(\"^ch\", tiplab)] \nlabeltree &lt;- groupOTU(mytree, cls)\n\np &lt;- ggtree(labeltree, aes(color=group, linetype=group), layout=\"circular\") +\n    scale_color_manual(values = c(\"#efad29\", \"#63bbd4\")) +\n    geom_nodepoint(color=\"black\", size=0.1) +\n    geom_tiplab(size=2, color=\"black\")\n\np2 &lt;- flip(p, 136, 110) %&gt;% \n    flip(141, 145) %&gt;% \n    rotate(141) %&gt;% \n    rotate(142) %&gt;% \n    rotate(160) %&gt;% \n    rotate(164) %&gt;% \n    rotate(131)\n\n### Group V and II coloring \ndat &lt;- data.frame(\n           node = c(110, 88, 156,136),\n           fill = c(\"#229f8a\", \"#229f8a\", \"#229f8a\", \"#f9311f\")\n       )\np3 &lt;- p2 +\n      geom_hilight(\n          data = dat,\n          mapping = aes(\n              node = node,\n              fill = I(fill)\n          ),\n          alpha = 0.2,\n          extendto = 1.4\n      )\n\n### Putting on a label on the avian specific expansion \np4 &lt;- p3 +\n      geom_cladelab(\n          node = 113,\n          label = \"Avian-specific expansion\",\n          align = TRUE,\n          angle = -35,\n          offset.text = 0.05,\n          hjust = \"center\",\n          fontsize = 2,\n          offset = .2,\n          barsize = .2\n      )\n    \n### Adding the bootstrap values with subset used to remove all bootstraps &lt; 50  \np5 &lt;- p4 +\n      geom_nodelab(\n          mapping = aes(\n              x = branch,\n              label = label,\n              subset = !is.na(as.numeric(label)) & as.numeric(label) &gt; 50\n          ),\n          size = 2,\n          color = \"black\",\n          nudge_y = 0.6\n      )\n\n### Putting labels on the subgroups \np6 &lt;- p5 +\n      geom_cladelab(\n          data = data.frame(\n              node = c(114, 121),\n              name = c(\"Subgroup A\", \"Subgroup B\")\n          ),\n          mapping = aes(\n              node = node,\n              label = name\n          ),\n          align = TRUE,\n          offset = .05,\n          offset.text = .03,\n          hjust = \"center\",\n          barsize = .2,\n          fontsize = 2,\n          angle = \"auto\",\n          horizontal = FALSE\n      ) +\n      theme(\n          legend.position = \"none\",\n          plot.margin = grid::unit(c(-15, -15, -15, -15), \"mm\")\n      )\nprint(p6)\n\nWarning in FUN(X[[i]], ...): NAs introduced by coercion\nWarning in FUN(X[[i]], ...): NAs introduced by coercion\nWarning in FUN(X[[i]], ...): NAs introduced by coercion\nWarning in FUN(X[[i]], ...): NAs introduced by coercion\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nPhylogenetic tree of CTLDcps. Using different background colors, line types and colors, and clade labels to distinguish groups.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Gallery of Reproducible Examples</span>"
    ]
  },
  {
    "objectID": "13_ggtree_gallery.html#sec-genome-locus",
    "href": "13_ggtree_gallery.html#sec-genome-locus",
    "title": "10  Gallery of Reproducible Examples",
    "section": "10.4 Phylogenetic Tree with Genome Locus Structure",
    "text": "10.4 Phylogenetic Tree with Genome Locus Structure\nThe geom_motif() is defined in ggtree and it is a wrapper layer of the gggenes::geom_gene_arrow(). The geom_motif() can automatically adjust genomic alignment by selective gene (via the on parameter) and can label genes via the label parameter. In the following example, we use example_genes dataset provided by gggenes. As the dataset only provides genomic coordination of a set of genes, a phylogeny for the genomes needs to be constructed first. We calculate Jaccard similarity based on the ratio of overlapping genes among genomes and correspondingly determine genome distance. The BioNJ algorithm was applied to construct the tree. Then we can use geom_facet() to visualize the tree with the genomic structures (Figure ?fig-gggenes).\n\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:Biostrings':\n\n    collapse, intersect, setdiff, setequal, union\n\n\nThe following object is masked from 'package:GenomeInfoDb':\n\n    intersect\n\n\nThe following object is masked from 'package:XVector':\n\n    slice\n\n\nThe following objects are masked from 'package:IRanges':\n\n    collapse, desc, intersect, setdiff, slice, union\n\n\nThe following objects are masked from 'package:S4Vectors':\n\n    first, intersect, rename, setdiff, setequal, union\n\n\nThe following objects are masked from 'package:BiocGenerics':\n\n    combine, intersect, setdiff, union\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(ggplot2)\nlibrary(gggenes)\nlibrary(ggtree)\n\nget_genes &lt;- function(data, genome) {\n    filter(data, molecule == genome) %&gt;% pull(gene)\n}\n\ng &lt;- unique(example_genes[,1])\nn &lt;- length(g)\nd &lt;- matrix(nrow = n, ncol = n)\nrownames(d) &lt;- colnames(d) &lt;- g\ngenes &lt;- lapply(g, get_genes, data = example_genes)\n\nfor (i in 1:n) {\n    for (j in 1:i) {\n        jaccard_sim &lt;- length(intersect(genes[[i]], genes[[j]])) / \n                       length(union(genes[[i]], genes[[j]]))\n        d[j, i] &lt;- d[i, j] &lt;- 1 - jaccard_sim\n    }\n}\n\ntree &lt;- ape::bionj(d) \n\np &lt;- ggtree(tree, branch.length='none') + \n    geom_tiplab() + xlim_tree(5.5) + \n    geom_facet(mapping = aes(xmin = start, xmax = end, fill = gene),\n               data = example_genes, geom = geom_motif, panel = 'Alignment',\n               on = 'genE', label = 'gene', align = 'left') +\n    scale_fill_brewer(palette = \"Set3\") + \n    scale_x_continuous(expand=c(0,0)) +\n    theme(strip.text=element_blank(),\n        panel.spacing=unit(0, 'cm'))\n\nfacet_widths(p, widths=c(1,2))\n\nWarning in x[i] &lt;- value: number of items to replace is not a multiple of\nreplacement length\n\n\n\n\n\nGenomic features with a phylogenetic tree.\n\n\n\n\n\n\n\n\nChen, Z., Ho, W. C. S., Boon, S. S., Law, P. T. Y., Chan, M. C. W., DeSalle, R., Burk, R. D., & Chan, P. K. S. (2017). Ancient evolution and dispersion of human papillomavirus 58 variants. Journal of Virology, 91(21), e01285–17. https://doi.org/10.1128/JVI.01285-17\n\n\nLarsen, F. T., Bed’Hom, B., Guldbrandtsen, B., & Dalgaard, T. S. (2019). Identification and tissue-expression profiling of novel chicken c-type lectin-like domain containing proteins as potential targets for carbohydrate-based vaccine strategies. Molecular Immunology, 114, 216–225. https://doi.org/10.1016/j.molimm.2019.07.022\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Gallery of Reproducible Examples</span>"
    ]
  },
  {
    "objectID": "A-app-faq.html",
    "href": "A-app-faq.html",
    "title": "(APPENDIX) Appendix",
    "section": "",
    "text": "Frequently Asked Questions\nlibrary(\"yulab.utils\")\nlibrary(treeio)\n\ntreeio v1.35.0 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nLG Wang, TTY Lam, S Xu, Z Dai, L Zhou, T Feng, P Guo, CW Dunn, BR\nJones, T Bradley, H Zhu, Y Guan, Y Jiang, G Yu. treeio: an R package\nfor phylogenetic tree input and output with richly annotated and\nassociated data. Molecular Biology and Evolution. 2020, 37(2):599-603.\ndoi: 10.1093/molbev/msz240\n\nsource(\"software-link.R\")\nThe ggtree mailing-list1 is a great place to get help, once you have created a reproducible example that illustrates your problem.",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-installation",
    "href": "A-app-faq.html#sec-installation",
    "title": "(APPENDIX) Appendix",
    "section": "Installation",
    "text": "Installation\nThe ggtree is released within the Bioconductor project; you need to use BiocManager to install it.\n## you need to install BiocManager before using it\n## install.packages(\"BiocManager\")\nlibrary(BiocManager)\ninstall(\"ggtree\")\nBioconductor release is adhered to a specific R version. Please make sure you are using the latest version of R if you want to install the latest release of Bioconductor packages, including ggtree. Beware that bugs will only be fixed in the current release and develop branches. If you find a bug, please follow the guide2 to report it.\nTo make it easy to install and load multiple core packages in a single step, we created a meta-package, treedataverse. Users can install the package via the following command:\nBiocManager::install(\"YuLab-SMU/treedataverse\")\nOnce it is installed, loading the package will also load the core treedataverse packages, including tidytree, treeio, ggtree, and ggtreeExtra.",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-faq-r",
    "href": "A-app-faq.html#sec-faq-r",
    "title": "(APPENDIX) Appendix",
    "section": "Basic R Related",
    "text": "Basic R Related\n\nUse your local file\nIf you are new to R and want to use ggtree for tree visualization, please do learn some basic R and ggplot2.\nA very common issue is that users copy and paste commands without looking at the function’s behavior. The system.file() function was used in some of our examples to find files packed in the packages.\nsystem.file                package:base                R Documentation\n\nFind Names of R System Files\n\nDescription:\n\n     Finds the full file names of files in packages etc.\n\nUsage:\n\n     system.file(..., package = \"base\", lib.loc = NULL,\n                 mustWork = FALSE)\nFor users who want to use their files, please just use relative or absolute file path (e.g., file = \"your/folder/filename\").",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-faq-aes-mapping",
    "href": "A-app-faq.html#sec-faq-aes-mapping",
    "title": "(APPENDIX) Appendix",
    "section": "Aesthetic mapping",
    "text": "Aesthetic mapping\n\nInherit aesthetic mapping\nggtree(rtree(30)) + geom_point()\nFor example, we can add symbolic points to nodes with geom_point() directly. The magic here is we don’t need to map the x and y position of the points by providing aes(x, y) to geom_point() since it was already mapped by the ggtree() function and it serves as a global mapping for all layers.\nBut what if we provide a dataset in a layer and the dataset doesn’t contain columns of x and/or y, the layer function also tries to map x and y and also others if you map them in the ggtree() function. As these variables are not available in your dataset, you will get the following error:\nError in eval(expr, envir, enclos) : object 'x' not found\nThis can be fixed by using the parameter inherit.aes=FALSE which will disable inheriting mapping from the ggtree() function.\n\n\nNever use $ in aesthetic mapping\nNever do this3 and please refer to the explanation in the ggplot2 book 2ed (Wickham, 2016):\n\nNever refer to a variable with $ (e.g., diamonds$carat) in aes(). This breaks containment so that the plot no longer contains everything it needs and causes problems if ggplot2 changes the order of the rows, as it does when facetting.",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-faq-text",
    "href": "A-app-faq.html#sec-faq-text",
    "title": "(APPENDIX) Appendix",
    "section": "Text and Label",
    "text": "Text and Label\n\nTip label truncated\nThe reason for this issue is that ggplot2 can’t auto-adjust xlim based on added text4.\nlibrary(ggtree)\n## example tree from https://support.bioconductor.org/p/72398/\ntree &lt;- read.tree(text= paste(\"(Organism1.006G249400.1:0.03977,\", \n    \"(Organism2.022118m:0.01337,(Organism3.J34265.1:0.00284,\",\n    \"Organism4.G02633.1:0.00468)0.51:0.0104):0.02469);\"))\np &lt;- ggtree(tree) + geom_tiplab()  \nIn this example, the tip labels displayed in Figure ?fig-truncatedTipA are truncated. This is because the units are in two different spaces (data and pixel). Users can use xlim to allocate more spaces for tip labels (Figure ?fig-truncatedTipB).\np + xlim(0, 0.08)\nAnother solution is to set clip = \"off\" to allow drawing outside of the plot panel. We may also need to set plot.margin to allocate more spaces for margin (Figure ?fig-truncatedTipC).\np + coord_cartesian(clip = 'off') + \n  theme_tree2(plot.margin=margin(6, 120, 6, 6))\n\n\nggtree v4.1.1.003 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nShuangbin Xu, Lin Li, Xiao Luo, Meijun Chen, Wenli Tang, Li Zhan, Zehan\nDai, Tommy T. Lam, Yi Guan, Guangchuang Yu. Ggtree: A serialized data\nobject for visualization of a phylogenetic tree and annotation data.\niMeta 2022, 1(4):e56. doi:10.1002/imt2.56\n\n\n\n\n\nAllocating more spaces for truncated tip labels. Long tip labels may be truncated (A). One solution is to allocate more spaces for plot panel (B), and another solution is to allow plotting labels outside the plot panel (C).\n\n\n\n\nThe third solution is to use hexpand() as demonstrated in session 12.4.\nFor rectangular/dendrogram layout trees, users can display tip labels as y-axis labels. In this case, no matter how long the labels are, they will not be truncated (see Figure ?fig-tiplabC).\n\n\nModify (tip) labels\nIf you want to modify tip labels of the tree, you can use treeio::rename_taxa() to rename a phylo or treedata object.\n\ntree &lt;- read.tree(text = \"((A, B), (C, D));\")\nd &lt;- data.frame(label = LETTERS[1:4], \n                label2 = c(\"sunflower\", \"tree\", \"snail\", \"mushroom\"))\n\n## rename_taxa use 1st column as key and 2nd column as value by default                \n## rename_taxa(tree, d)\nrename_taxa(tree, d, label, label2) %&gt;% write.tree\n\n[1] \"((sunflower,tree),(snail,mushroom));\"\n\n\nIf the input tree object is a treedata instance, you can use write.beast() to export the tree with associated data to a BEAST compatible NEXUS file (see Chapter 3).\nRenaming phylogeny tip labels seems not to be a good idea, since it may introduce problems when mapping the original sequence alignment to the tree. Personally, I recommend storing the new labels as a tip annotation in treedata object.\n\ntree2 &lt;- full_join(tree, d, by = \"label\")\ntree2\n\n'treedata' S4 object'.\n\n...@ phylo:\n\nPhylogenetic tree with 4 tips and 3 internal nodes.\n\nTip labels:\n  A, B, C, D\n\nRooted; no branch length.\n\nwith the following features available:\n  '', 'label2'.\n\n# The associated data tibble abstraction: 7 × 4\n# The 'node', 'label' and 'isTip' are from the phylo tree.\n   node label isTip label2   \n  &lt;int&gt; &lt;chr&gt; &lt;lgl&gt; &lt;chr&gt;    \n1     1 A     TRUE  sunflower\n2     2 B     TRUE  tree     \n3     3 C     TRUE  snail    \n4     4 D     TRUE  mushroom \n5     5 &lt;NA&gt;  FALSE &lt;NA&gt;     \n6     6 &lt;NA&gt;  FALSE &lt;NA&gt;     \n7     7 &lt;NA&gt;  FALSE &lt;NA&gt;     \n\n\nIf you just want to show different or additional information when plotting the tree, you don’t need to modify tip labels. This could be easily done via the %&lt;+% operator to attach the modified version of the labels and then use the geom_tiplab() layer to display the modified version (Figure ?fig-renameTip).\n\np &lt;- ggtree(tree) + xlim(NA, 3)\np1 &lt;- p + geom_tiplab()\n\n## the following command will produce an identical figure of p2\n## ggtree(tree2) + geom_tiplab(aes(label = label2))\np2 &lt;- p %&lt;+% d + geom_tiplab(aes(label=label2))\nplot_list(p1, p2, ncol=2, tag_levels = \"A\")\n\n\n\n\nAlternative tip labels. Original tip labels (A) and a modified version (B).\n\n\n\n\n\n\nFormatting (tip) labels\nIf you want to format labels, you need to set parse=TRUE in the geom_text()/geom_tiplab()/geom_nodelab() and the label should be a string that can be parsed into expression and displayed as described in ?plotmath. Users can use the latex2exp package to convert LaTeX math formulas to R’s plotmath expressions, or use the ggtext package to render Markdown or HTML.\nFor example, the tip labels contain several parts (e.g., genus, species, and geo), we can differentiate these pieces of information with different formats (Figure ?fig-formatTipA).\n\ntree &lt;- read.tree(text = \"((a,(b,c)),d);\")\ngenus &lt;- c(\"Gorilla\", \"Pan\", \"Homo\", \"Pongo\")\nspecies &lt;- c(\"gorilla\", \"spp.\", \"sapiens\", \"pygmaeus\")\ngeo &lt;- c(\"Africa\", \"Africa\", \"World\", \"Asia\")\nd &lt;- data.frame(label = tree$tip.label, genus = genus,\n                species = species, geo = geo)\n\nlibrary(glue)\nd2 &lt;- dplyr::mutate(d, \n  lab = glue(\"italic({genus})~bolditalic({species})~({geo})\"),\n  color = c(\"#E495A5\", \"#ABB065\", \"#39BEB1\", \"#ACA4E2\"),\n  name = glue(\"&lt;i style='color:{color}'&gt;{genus} **{species}**&lt;/i&gt; ({geo})\")\n) \n\np1 &lt;- ggtree(tree) %&lt;+% d2 + xlim(NA, 6) +\n    geom_tiplab(aes(label=lab), parse=T)\n\nUsing Markdown or HTML to format text may be easier, and this is supported via the ggtext package (Figure ?fig-formatTipB).\n\nlibrary(ggtext)\n\np2 &lt;- ggtree(tree) %&lt;+% d2 + \n  geom_richtext(data=td_filter(isTip), \n                aes(label=name), label.color=NA) + \n  hexpand(.3)\n\nplot_list(p1, p2, ncol=2, tag_levels = 'A') \n\n\n\nAvoid overlapping text labels\nUsers can use the ggrepel package to repel overlapping text labels (Figure ?fig-repelTip).\n\nlibrary(ggrepel)\nlibrary(ggtree)\nraxml_file &lt;- system.file(\"extdata/RAxML\", \n                    \"RAxML_bipartitionsBranchLabels.H3\", package=\"treeio\")\nraxml &lt;- read.raxml(raxml_file)\nggtree(raxml) + geom_label_repel(aes(label=bootstrap, fill=bootstrap)) + \n  theme(legend.position = c(.1, .8)) + scale_fill_viridis_c()\n\nWarning: Removed 65 rows containing missing values or values outside the scale range\n(`geom_label_repel()`).\n\n\n\n\n\nRepel labels. Repel labels to avoid overlapping.\n\n\n\n\n\n\nBootstrap values from Newick format\nIt is quite common to store bootstrap value as node label in the Newick format as in Figure ?fig-nwkbs. Visualizing node label is easy using geom_text2(aes(subset = !isTip, label=label)).\nIf you want to only display a subset of bootstrap (e.g., bootstrap &gt; 80), you can’t simply use geom_text2(subset= (label &gt; 80), label=label) (or geom_label2) since label is a character vector, which contains node label (bootstrap value) and tip label (taxa name). geom_text2(subset=(as.numeric(label) &gt; 80), label=label) won’t work either, since NAs were introduced by coercion. We need to convert NAs to logical FALSE. This can be done by the following code:\n\nnwk &lt;- system.file(\"extdata/RAxML\",\"RAxML_bipartitions.H3\", package='treeio')\ntr &lt;- read.tree(nwk)\nggtree(tr) + geom_label2(aes(label=label, \n      subset = !is.na(as.numeric(label)) & as.numeric(label) &gt; 80))\n\nWarning in geom_label2(aes(label = label, subset = !is.na(as.numeric(label)) &\n: Ignoring unknown parameters: `label.size`\n\n\nWarning in FUN(X[[i]], ...): NAs introduced by coercion\nWarning in FUN(X[[i]], ...): NAs introduced by coercion\n\n\n\n\n\nBootstrap value stored in node label.\n\n\n\n\nAs this is a very common issue, we implemented a read.newick() function in the treeio package to allow parsing internal node labels as supported values. As a result, it can be easier to display bootstrap values using the following code:\ntr &lt;- read.newick(nwk, node.label='support')\nggtree(tr) + geom_nodelab(geom='label', aes(label=support, subset=support &gt; 80))",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#branch-setting",
    "href": "A-app-faq.html#branch-setting",
    "title": "(APPENDIX) Appendix",
    "section": "Branch Setting",
    "text": "Branch Setting\n\nPlot the same tree as in plot.phylo()\nBy default, ggtree() ladderizes the input tree so that the tree will appear less cluttered. This is the reason why the tree visualized by ggtree() is different from the one using plot.phylo() which displays a non-ladderized tree. To disable the ladderize effect, users can pass the parameter ladderize = FALSE to the ggtree() function as demonstrated in Figure ?fig-ggtreeladderize.\n\nlibrary(ape)\n\n\nAttaching package: 'ape'\n\n\nThe following object is masked from 'package:ggtree':\n\n    rotate\n\n\nThe following object is masked from 'package:treeio':\n\n    drop.tip\n\nlibrary(ggtree)\nset.seed(42)\nx &lt;- rtree(5)\nplot(x)\n\n\n\n\n\n\n\nggtree(x, ladderize = FALSE) + geom_tiplab()\n\n\n\n\n\n\n\nggtree(x) + geom_tiplab()\n\n\n\n\n\n\n\n\n\nlibrary(ape)\nlibrary(ggtree)\nlibrary(ggplotify)\n\nset.seed(2020)\nx &lt;- rtree(5)\n\n#p1 &lt;- as.ggplot(~plot(x))\n#p2 &lt;- ggtree(x, ladderize = FALSE) + geom_tiplab()\n#p3 &lt;- ggtree(x) + geom_tiplab()\n\n## don't know why throw error when combine them in bookdown\n## it is OK in interactive R terminal\n\n# plot_list(p1, p2, p3, ncol=3, tag_levels = 'A') \n\n\n\n\n\n\nLadderized and non-ladderized tree. plot.phylo() displays non-ladderized tree (A), use ladderize = FALSE to display non-ladderized tree in ggtree() (B), ggtree() displays ladderized tree by default (C).\n\n\n\n\n\n\nSpecifying the order of the tips\nThe rotateConstr() function provided in the ape package rotates internal branches based on the specified order of the tips, and the order should be followed when plotting the tree (from bottom to top). As ggtree() by default ladderizes the input tree, users need to disable by passing ladderize = FALSE. Then the order of the tree will be displayed as expected (Figure ?fig-rotateConstr). Users can also extract tip order displayed by ggtree() using the get_taxa_name() function as demonstrated in session 12.6.\n\ny &lt;- ape::rotateConstr(x, c('t4', 't2', 't5', 't1', 't3'))\nggtree(y, ladderize = FALSE) + geom_tiplab()\n\n\n\n\nSpecifying tree order. The order of the input tree will be maintained in ggtree() when ladderize = FALSE.\n\n\n\n\n\n\nShrink outlier long branch\nWhen outgroups are on a very long branch length (Figure ?fig-outgroupEdgeA), we would like to keep the outgroups in the tree but ignore their branch lengths (Figure ?fig-outgroupEdgeB)5. This can be easily done by modifying the coordinates of the outgroups (Figure ?fig-outgroupEdgeB). Another approach is to truncate the plot using the ggbreak package (Figure ?fig-outgroupEdgeC) (Xu et al., 2021).\n\nlibrary(TDbook)\nlibrary(ggtree)\n\nx &lt;- tree_long_branch_example\nm &lt;- MRCA(x, 75, 76)\ny &lt;- groupClade(x, m)\n\n## A\np &lt;- p1 &lt;- ggtree(y, aes(linetype = group)) + \n  geom_tiplab(size = 2) + \n  theme(legend.position = 'none') \n\n## B\np$data[p$data$node %in% c(75, 76), \"x\"] &lt;- mean(p$data$x)\n\n## C\nlibrary(ggbreak)\n\nggbreak v0.1.6 Learn more at https://yulab-smu.top/\n\n\nIf you use ggbreak in published research, please cite the following\npaper:\n\nS Xu, M Chen, T Feng, L Zhan, L Zhou, G Yu. Use ggbreak to effectively\nutilize plotting space to deal with large datasets and outliers.\nFrontiers in Genetics. 2021, 12:774846. doi: 10.3389/fgene.2021.774846\n\np2 &lt;- p1 + scale_x_break(c(0.03, 0.09)) + hexpand(.05)\n\n## align plot\nplot_list(p1, p, p2, ncol=3, tag_levels=\"A\")\n\n\n\n\nShrink outlier long branch. Original tree (A); reduced outgroup branch length (B); truncated tree plot (C).\n\n\n\n\n\n\nAttach a new tip to a tree\nSometimes there are known branches that are not in the tree, but we would like to have them on the tree. Another common scenario is when we have a new sequence species and would like to update the reference tree with this species by inferring its evolutionary position.\nUsers can use phytools::bind.tip() (Revell, 2012) to attach a new tip to a tree. With tidytree, it is easy to add an annotation to differentiate newly introduced and original branches and to reflect the uncertainty of the added branch splits off, as demonstrated in Figure ?fig-bindTip.\n\nlibrary(phytools)\n\nLoading required package: maps\n\n\n\nAttaching package: 'phytools'\n\n\nThe following object is masked from 'package:treeio':\n\n    read.newick\n\nlibrary(tidytree)\n\ntidytree v0.4.7 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nGuangchuang Yu.  Data Integration, Manipulation and Visualization of\nPhylogenetic Trees (1st edition). Chapman and Hall/CRC. 2022,\ndoi:10.1201/9781003279242, ISBN: 9781032233574\n\n\n\nAttaching package: 'tidytree'\n\n\nThe following objects are masked from 'package:ape':\n\n    drop.tip, keep.tip\n\n\nThe following object is masked from 'package:treeio':\n\n    getNodeNum\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\nlibrary(ggplot2)\nlibrary(ggtree)\n\nset.seed(2019-11-18)\ntr &lt;- rtree(5)\n\ntr2 &lt;- bind.tip(tr, 'U', edge.length = 0.1, where = 7, position=0.15)\nd &lt;- as_tibble(tr2)\nd$type &lt;- \"original\"\nd$type[d$label == 'U'] &lt;- 'newly introduced'\nd$sd &lt;- NA\nd$sd[parent(d, 'U')$node] &lt;- 0.05\n\ntr3 &lt;- as.treedata(d)\nggtree(tr3, aes(linetype=type)) +  geom_tiplab() +\n  geom_errorbarh(aes(xmin=x-sd, xmax=x+sd, y = y - 0.3), \n                linetype='dashed', height=0.1) +\n  scale_linetype_manual(values = c(\"newly introduced\" = \"dashed\", \n                                   \"original\" = \"solid\")) + \n  theme(legend.position=c(.8, .2)) \n\nWarning: `geom_errorbarh()` was deprecated in ggplot2 4.0.0.\nℹ Please use the `orientation` argument of `geom_errorbar()` instead.\n\n\n`height` was translated to `width`.\n\n\n\n\n\nAttaching a new tip to a tree. Different line types were employed to distinguish the newly introduced tip and an error bar was added to indicate the uncertainty of the added branch position.\n\n\n\n\n\n\nChange colors or line types of arbitrarily selected branches\nIf you want to color or change line types of specific branches, you only need to prepare a data frame with variables of branch setting (e.g., selected and unselected). Applying the Method 1 described in (Yu et al., 2018) to map the data onto the tree will make it easy to set colors and line types (Figure ?fig-btype).\n\nset.seed(123)\nx &lt;- rtree(10)\n## binary choices of colors\nd &lt;- data.frame(node=1:Nnode2(x), colour = 'black')\nd[c(2,3,14,15), 2] &lt;- \"red\"\n\n## multiple choices of line types\nd2 &lt;- data.frame(node=1:Nnode2(x), lty = 1)\nd2[c(2,5,13, 14), 2] &lt;- c(2, 3, 2,4)\n\np &lt;- ggtree(x) + geom_label(aes(label=node))\np %&lt;+% d %&lt;+% d2 + aes(colour=I(colour), linetype=I(lty))\n\n\n\n\nChange colors and line types of specific branches.\n\n\n\n\nUsers can use the gginnards package to manipulate plot elements for more complicated scenarios.\n\n\nAdd an arbitrary point to a branch\nIf you want to add an arbitrary point to a branch6, you can use geom_nodepoint(), geom_tippoint(), or geom_point2() (works for both external and internal nodes) to filter selected node (the endpoint of the branch) via the subset aesthetic mapping and specify horizontal position by x = x - offset aesthetic mapping, where the offset can be an absolute value (Figure ?fig-pointOnBranchA) or in proportion to the branch length (Figure ?fig-pointOnBranchB).\n\nset.seed(2020-05-20)\nx &lt;- rtree(10)\np &lt;- ggtree(x)\n\np1 &lt;- p + geom_nodepoint(aes(subset = node == 13, x = x - .1),\n                        size = 5, colour = 'firebrick', shape = 21)\n\np2 &lt;- p + geom_nodepoint(aes(subset = node == 13, x = x - branch.length * 0.2),\n                        size = 3, colour = 'firebrick') + \n       geom_nodepoint(aes(subset = node == 13, x = x - branch.length * 0.8),\n                        size = 5, colour = 'steelblue')\nplot_list(p1, p2, ncol=2, tag_levels=\"A\")\n\n\n\n\nAdd an arbitrary point on a branch. The position of the symbolic point can be adjusted by an absolute value (A) or in proportion to the branch length (B).",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#different-x-axis-labels-for-different-facet-panels",
    "href": "A-app-faq.html#different-x-axis-labels-for-different-facet-panels",
    "title": "(APPENDIX) Appendix",
    "section": "Different X-axis Labels for Different Facet Panels",
    "text": "Different X-axis Labels for Different Facet Panels\nThis is not supported by ggplot2 in general. However, we can just draw text labels for each panel and put the labels beyond the plot panels as demonstrated in Figure ?fig-xlabFacets.\n\nlibrary(ggtree)\nlibrary(ggplot2)\nset.seed(2019-05-02)\nx &lt;- rtree(30)\np &lt;- ggtree(x) + geom_tiplab()\nd &lt;- data.frame(label = x$tip.label, \n                value = rnorm(30))\np2 &lt;- p + geom_facet(panel = \"Dot\", data = d, \n            geom = geom_point, mapping = aes(x = value)) \n            \np2 &lt;- p2 + theme_bw() + \n    xlim_tree(5) + xlim_expand(c(-5, 5), 'Dot') \n\n# .panel is the internal variable used in `geom_facet` for faceting.\nd &lt;- data.frame(.panel = c('Tree', 'Dot'), \n                lab = c(\"Distance\", \"Dot Units\"), \n                x=c(2.5,0), y=-2)\n\np2 + scale_y_continuous(limits=c(0, 31), \n                        expand=c(0,0), \n                        oob=function(x, ...) x) +\n    geom_text(aes(label=lab), data=d) + \n    coord_cartesian(clip='off')  + \n    theme(plot.margin=margin(6, 6, 40, 6))\n\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\n\n\n\n\nX-axis titles for different facet panels.",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-faq-under-the-tree",
    "href": "A-app-faq.html#sec-faq-under-the-tree",
    "title": "(APPENDIX) Appendix",
    "section": "Plot Something behind the Phylogeny",
    "text": "Plot Something behind the Phylogeny\nThe ggtree() function plots the tree structure, and normally we add layers on top of the tree.\n\nset.seed(1982)\nx &lt;- rtree(5)\np &lt;- ggtree(x) + geom_hilight(node=7, alpha=1)\n\nIf we want the layers behind the tree layer, we can reverse the order of all the layers.\np$layers &lt;- rev(p$layers)\nAnother solution is to use ggplot() instead of ggtree() and + geom_tree() to add the layer of tree structure at the correct position of the layer stack (Figure ?fig-treeLayerOrder).\nggplot(x) + geom_hilight(node=7, alpha=1) + geom_tree() + theme_tree()     \n\n\n\n\n\nAdd layers behind the tree structure. A layer on top of the tree structure (A). Reverse layer order of A (B). Add layer behind the tree layer (C).",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-faq-enlarge-center-space",
    "href": "A-app-faq.html#sec-faq-enlarge-center-space",
    "title": "(APPENDIX) Appendix",
    "section": "Enlarge Center Space in Circular/Fan Layout Tree",
    "text": "Enlarge Center Space in Circular/Fan Layout Tree\nThis question for enlarging center space in circular/fan layout tree was asked several times7, and a published example can be found in (Barton et al., 2016). Increasing the percentage of center white space in a circular tree is useful to avoid overlapping tip labels and to increase the readability of the tree by moving all nodes and branches further out. This can be done simply by using xlim() or hexpand() to allocate more space (Figure ?fig-circular-spaceA), just like in Figure ?fig-layout2G, or assigning a long root branch that is similar to the “Root Length” parameter in FigTree (Figure ?fig-circular-spaceB).\n\nset.seed(1982)\ntree &lt;- rtree(30)\nplot_list(\n  ggtree(tree, layout='circular') + xlim(-10, NA),\n  ggtree(tree, layout='circular') + geom_rootedge(rootedge=5),\n  tag_levels = \"A\", ncol=2\n)\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nEnlarge center space in circular tree. Allocate more space by xlim (A) or long root branch (B).",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#use-the-most-distant-tip-from-the-root-as-the-origin-of-the-timescale",
    "href": "A-app-faq.html#use-the-most-distant-tip-from-the-root-as-the-origin-of-the-timescale",
    "title": "(APPENDIX) Appendix",
    "section": "Use the Most Distant Tip from the Root as the Origin of the Timescale",
    "text": "Use the Most Distant Tip from the Root as the Origin of the Timescale\nThe revts() will reverse the x-axis by setting the most recent tip to 0. We can use scale_x_continuous(labels=abs) to label x-axis using absolute values (Figure ?fig-distantTip).\n\ntr &lt;- rtree(10)\np &lt;- ggtree(tr) + theme_tree2()\np2 &lt;- revts(p) + scale_x_continuous(labels=abs)\nplot_list(p, p2, ncol=2, tag_levels=\"A\")\n\n\n\n\nOrigin of the time scale. Forward: from the root to the tips (A). Backward: from the most distant tip to the root (B).",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-circular-blank",
    "href": "A-app-faq.html#sec-circular-blank",
    "title": "(APPENDIX) Appendix",
    "section": "Remove Blank Margins for Circular Layout Tree",
    "text": "Remove Blank Margins for Circular Layout Tree\nFor plots in polar coordinates, such as a circular layout tree, it is very common that extra spaces will be generated.\nIf you are using Rmarkdown, you can set the following options for knitr to remove extra white space automatically.\nlibrary(knitr)\nknit_hooks$set(crop = hook_pdfcrop)\nopts_chunk$set(crop = TRUE)\nOtherwise, we can use command-line tools to remove extra white space:\n## for pdf\npdfcrop x.pdf\n\n## for png\nconvert -trim x.png x-crop.png\nIf you want to do it in R, you can use the magick package:\nlibrary(magick)\n\nx &lt;- image_read(\"x.png\")\n## x &lt;- image_read_pdf(\"x.pdf\") # for PDF\n\nimage_trim(x)\nHere is an example (Figure ?fig-trimSpace):\n\nlibrary(ggplot2)\nlibrary(ggtree)\nlibrary(patchwork)\nlibrary(magick)\n\nLinking to ImageMagick 6.9.12.98\nEnabled features: fontconfig, freetype, fftw, heic, lcms, pango, raw, webp, x11\nDisabled features: cairo, ghostscript, rsvg\n\n\nUsing 4 threads\n\nset.seed(2021)\ntr &lt;- rtree(30)\np &lt;- ggtree(tr, size=1, colour=\"purple\", layout='circular')\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the ggtree package.\n  Please report the issue at &lt;https://github.com/YuLab-SMU/ggtree/issues&gt;.\n\nf &lt;- tempfile(fileext=\".png\")\nggsave(filename = f, plot = p, width=7, height=7)\n\nWarning: Unknown or uninitialised column: `subgroup`.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\nx &lt;- image_read(f, density=300)\ny &lt;- image_trim(x)\n\npanel_border &lt;- theme(panel.border=element_rect(colour='black', \n                                            fill=NA, size=2))\n\nWarning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.\nℹ Please use the `linewidth` argument instead.\n\nxx &lt;- image_ggplot(x) + panel_border\n\nWarning: `aes_string()` was deprecated in ggplot2 3.0.0.\nℹ Please use tidy evaluation idioms with `aes()`.\nℹ See also `vignette(\"ggplot2-in-packages\")` for more information.\nℹ The deprecated feature was likely used in the magick package.\n  Please report the issue at &lt;https://github.com/ropensci/magick/issues&gt;.\n\nyy &lt;- image_ggplot(y) + panel_border\n\nplot_list(xx, yy, tag_levels = \"A\", ncol=2)\n\n\n\n\nTrim extra white space for polar coordinates. Original plot (A). Trimmed version (B).",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#sec-export-edit",
    "href": "A-app-faq.html#sec-export-edit",
    "title": "(APPENDIX) Appendix",
    "section": "Edit Tree Graphic Details",
    "text": "Edit Tree Graphic Details\nIt can be hard to modify plot details for ordinary users using ggplot2/ggtree. We recommend using the eoffice package to export ggtree output to a Microsoft Office Document and edit the tree graphic in PowerPoint.\n\n\n\n\nBarton, K., Hiener, B., Winckelmann, A., Rasmussen, T. A., Shao, W., Byth, K., Lanfear, R., Solomon, A., McMahon, J., Harrington, S., Buzon, M., Lichterfeld, M., Denton, P. W., Olesen, R., Østergaard, L., Tolstrup, M., Lewin, S. R., Søgaard, O. S., & Palmer, S. (2016). Broad activation of latent HIV-1 in vivo. Nature Communications, 7, 12731. https://doi.org/10.1038/ncomms12731\n\n\nRevell, L. J. (2012). Phytools: An R package for phylogenetic comparative biology (and other things). Methods in Ecology and Evolution, 3(2), 217–223. https://doi.org/10.1111/j.2041-210X.2011.00169.x\n\n\nWickham, H. (2016). ggplot2: Elegant graphics for data analysis. Springer. http://ggplot2.org\n\n\nXu, S., Chen, M., Feng, T., Li, Z., Lang, Z., & Yu, G. (2021). Use ggbreak to effectively utilize plotting space to deal with large datasets and outliers. Frontiers in Genetics, 12, 774846. https://doi.org/10.3389/fgene.2021.774846\n\n\nYu, G., Lam, T. T.-Y., Zhu, H., & Guan, Y. (2018). Two methods for mapping and visualizing associated data on phylogeny using ggtree. Molecular Biology and Evolution, 35(12), 3041–3043. https://doi.org/10.1093/molbev/msy194",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-faq.html#footnotes",
    "href": "A-app-faq.html#footnotes",
    "title": "(APPENDIX) Appendix",
    "section": "",
    "text": "https://groups.google.com/forum/?#!forum/bioc-ggtree↩︎\nhttps://guangchuangyu.github.io/2016/07/how-to-bug-author/↩︎\nhttps://groups.google.com/d/msg/bioc-ggtree/hViM6vRZF94/MsZT8qRgBwAJ and https://github.com/GuangchuangYu/ggtree/issues/106↩︎\nhttps://twitter.com/hadleywickham/status/600280284869697538↩︎\nExample from: https://groups.google.com/d/msg/bioc-ggtree/T2ySvqv351g/mHsyljvBCwAJ↩︎\nhttps://twitter.com/melanoidin/status/1262703932993871874↩︎\nhttps://groups.google.com/d/msg/bioc-ggtree/gruC4FztU8I/mwavqWCXAQAJ, https://groups.google.com/d/msg/bioc-ggtree/UoGQekWHIvw/ZswUUZKSGwAJ and https://github.com/GuangchuangYu/ggtree/issues/95↩︎",
    "crumbs": [
      "Appendix",
      "(APPENDIX) Appendix"
    ]
  },
  {
    "objectID": "A-app-tools.html",
    "href": "A-app-tools.html",
    "title": "11  Related Tools",
    "section": "",
    "text": "11.1 MicrobiotaProcess: Convert Taxonomy Table to a treedata Object\nTaxonomy (genus, family, …) data are widely used in microbiome or ecology. Hierarchical taxonomies are the tree-like structure that organizes items into subcategories and can be converted to a tree object (see also the phylog object). The MicrobiotaProcess supports converting a taxonomyTable object, defined in the phyloseq package, to a treedata object, and the taxonomic hierarchical relationship can be visualized using ggtree (Figure ?fig-TaxaTree). When there are taxonomy names that are confused and missing, the as.treedata() method for taxonomyTable objects will complete their upper-level taxonomic information automatically.\nlibrary(MicrobiotaProcess)\n\nMicrobiotaProcess v1.18.0 For help:\nhttps://github.com/YuLab-SMU/MicrobiotaProcess/issues\n\nIf you use MicrobiotaProcess in published research, please cite the\npaper:\n\nShuangbin Xu, Li Zhan, Wenli Tang, Qianwen Wang, Zehan Dai, Lang Zhou,\nTingze Feng, Meijun Chen, Tianzhi Wu, Erqiang Hu, Guangchuang Yu.\nMicrobiotaProcess: A comprehensive R package for deep mining\nmicrobiome. The Innovation. 2023, 4(2):100388. doi:\n10.1016/j.xinn.2023.100388\n\nExport the citation to BibTex by citation('MicrobiotaProcess')\n\nThis message can be suppressed by:\nsuppressPackageStartupMessages(library(MicrobiotaProcess))\n\n\n\nAttaching package: 'MicrobiotaProcess'\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\nlibrary(ggtree)\n\nggtree v4.1.1.003 Learn more at https://yulab-smu.top/contribution-tree-data/\n\nPlease cite:\n\nGuangchuang Yu, Tommy Tsan-Yuk Lam, Huachen Zhu, Yi Guan. Two methods\nfor mapping and visualizing associated data on phylogeny using ggtree.\nMolecular Biology and Evolution. 2018, 35(12):3041-3043.\ndoi:10.1093/molbev/msy194\n\n# The original kostic2012crc is a MPSE object\ndata(kostic2012crc)\n\ntaxa &lt;- tax_table(kostic2012crc)\n#The rownames (usually is OTUs or other features ) of the taxa will be \n# served as the tip labels if include.rownames = TRUE\ntree &lt;- as.treedata(taxa, include.rownames=TRUE)\n# Or extract the taxa tree (treedata) with mp_extract_tree, because the \n# taxonomy information is stored as treedata in the MPSE class (kostic2012crc).\n# tree &lt;- kostic2012crc %&gt;% mp_extract_tree()\n\nggtree(tree, layout=\"circular\", size=0.2) +\n     geom_tiplab(size=1)\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\nℹ The deprecated feature was likely used in the ggtree package.\n  Please report the issue at &lt;https://github.com/YuLab-SMU/ggtree/issues&gt;.\n\n\nWarning: Unknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\nUnknown or uninitialised column: `subgroup`.\n\n\n\n\n\nConvert a taxonomyTable object to a treedata object.",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-tools.html#sec-rtol",
    "href": "A-app-tools.html#sec-rtol",
    "title": "11  Related Tools",
    "section": "11.2 rtol: An R Interface to Open Tree API",
    "text": "11.2 rtol: An R Interface to Open Tree API\nThe rtol (Michonneau et al., 2016) is an R package to interact with the Open Tree of Life data APIs. Users can use it to query phylogenetic trees and visualize the trees with ggtree to explore species relationships (Figure ?fig-rotlSubtree).\n\n## example from: https://github.com/ropensci/rotl\nlibrary(rotl)\napes &lt;- c(\"Pongo\", \"Pan\", \"Gorilla\", \"Hoolock\", \"Homo\")\n(resolved_names &lt;- tnrs_match_names(apes))\n\n  search_string unique_name approximate_match score ott_id is_synonym\n1         pongo       Pongo             FALSE     1 417949      FALSE\n2           pan         Pan             FALSE     1 417957      FALSE\n3       gorilla     Gorilla             FALSE     1 417969      FALSE\n4       hoolock     Hoolock             FALSE     1 712902      FALSE\n5          homo        Homo             FALSE     1 770309      FALSE\n                              flags number_matches\n1                                                2\n2                    sibling_higher              2\n3                    sibling_higher              1\n4                                                1\n5 extinct_inherited, sibling_higher              1\n\ntr &lt;- tol_induced_subtree(ott_ids = ott_id(resolved_names))\n\nWarning in collapse_singles(tr, show_progress): Dropping singleton nodes with\nlabels: mrcaott83926ott6145147, mrcaott83926ott3607728, mrcaott83926ott3607876,\nmrcaott83926ott3607873, mrcaott83926ott3607687, mrcaott83926ott3607716,\nmrcaott83926ott3607689, mrcaott83926ott3607732, mrcaott770295ott3607719,\nmrcaott770295ott3607692, Ponginae ott1082538, Hylobatidae ott166544\n\nggtree(tr) + geom_tiplab() + xlim(NA, 5)\n\n\n\n\n(ref:rotlSubtreecap)",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-tools.html#sec-plotly",
    "href": "A-app-tools.html#sec-plotly",
    "title": "11  Related Tools",
    "section": "11.3 Convert a ggtree object to a plotly object",
    "text": "11.3 Convert a ggtree object to a plotly object\n\nlibrary(\"yulab.utils\")\n\nOne way to make a quick interactive phylogenetic tree is using ggtree with the plotly package. The ggplotly() is able to convert ggtree object to a plotly object. Note that the ggtree package also supports interactive manipulation of the phylogenetic tree via the identify() method.\n# example from https://twitter.com/drandersgs/status/965996335882059776\n\n# LOAD LIBS ---------------------------------------------------------------\nlibrary(ape)\nlibrary(ggtree)\nlibrary(plotly)\n# CREATE A TREE -------------------------------------------------------------\nn_samples &lt;- 20\nn_grp &lt;- 4\ntree &lt;- ape::rtree(n = n_samples)\n# CREATE SOME METADATA ----------------------------------------------------\nid &lt;- tree$tip.label\nset.seed(42)\ngrp &lt;- sample(LETTERS[1:n_grp], size = n_samples, replace = T)\ndat &lt;- tibble::tibble(id = id,\n                      grp = grp)\n# PLOT THE TREE -----------------------------------------------------------\np1 &lt;- ggtree(tree)\nmetat &lt;- p1$data %&gt;%\n  dplyr::inner_join(dat, c('label' = 'id'))\np2 &lt;- p1 +\n  geom_point(data = metat,\n             aes(x = x,\n                 y = y,\n                 colour = grp,\n                 label = id))\nplotly::ggplotly(p2)\n\n\n\n\n\n(ref:ggtreeplotlycap)",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-tools.html#sec-commicR",
    "href": "A-app-tools.html#sec-commicR",
    "title": "11  Related Tools",
    "section": "11.4 Comic (xkcd-like) phylogenetic tree",
    "text": "11.4 Comic (xkcd-like) phylogenetic tree\n\nlibrary(htmltools)    \nlibrary(XML)    \nlibrary(gridSVG)    \nlibrary(ggplot2)    \nlibrary(ggtree)\nlibrary(comicR)    \n\np &lt;- ggtree(rtree(30), layout=\"circular\")  +\n    geom_tiplab(aes(label=label), color=\"purple\")\nprint(p)\nsvg &lt;- grid.export(name=\"\", res=100)$svg\n\n\n## need to convert it to png or pdf for pdfbook\ntagList(\n    tags$div(\n             id = \"ggtree_comic\",\n             tags$style(\"#ggtree_comic text {font-family:Chalkduster;}\"),\n             HTML(saveXML(svg)),\n             comicR(\"#ggtree_comic\", ff=5)\n         )\n) # %&gt;% html_print()",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-tools.html#sec-ascii-tree",
    "href": "A-app-tools.html#sec-ascii-tree",
    "title": "11  Related Tools",
    "section": "11.5 Print ASCII-art Rooted Tree",
    "text": "11.5 Print ASCII-art Rooted Tree\n\nlibrary(data.tree)\ntree &lt;- rtree(10)\nd &lt;- as.data.frame(as.Node(tree))\nnames(d) &lt;- NULL\nprint(d, row.names=FALSE)\n\nNA                            \nNA  11                        \nNA   ¦--12                    \nNA   ¦   ¦--t1                \nNA   ¦   °--13                \nNA   ¦       ¦--14            \nNA   ¦       ¦   ¦--t4        \nNA   ¦       ¦   °--t10       \nNA   ¦       °--15            \nNA   ¦           ¦--16        \nNA   ¦           ¦   ¦--17    \nNA   ¦           ¦   ¦   ¦--t5\nNA   ¦           ¦   ¦   °--t2\nNA   ¦           ¦   °--t6    \nNA   ¦           °--t7        \nNA   °--18                    \nNA       ¦--19                \nNA       ¦   ¦--t9            \nNA       ¦   °--t3            \nNA       °--t8\n\n\nIt is neat to print ASCII-art of the phylogeny. Sometimes, we don’t want to plot the tree, but just take a glance at the tree structure without leaving the focus from the R console. However, it is not a good idea to print the whole tree as ASCII text if the tree is large. Sometimes, we just want to look at a specific portion of the tree and its immediate relatives. In this scenario, we can use treeio::tree_subset() function (see session 2.4) to extract selected portion of a tree. Then we can print ASCII-art of the tree subset to explore the evolutionary relationship of the species of our interest in the R console.\nThe ggtree supports parsing tip labels as emoji to create phylomoji. With the data.tree and emojifont packages, we can also print phylomoji as ASCII text (Figure ?fig-emojidatatree).\n\nlibrary(data.tree)\nlibrary(emojifont)\n\ntt &lt;- '((snail,mushroom),(((sunflower,evergreen_tree),leaves),green_salad));'\ntree &lt;- read.tree(text = tt)\ntree$tip.label &lt;- emoji(tree$tip.label)\nd &lt;- as.data.frame(as.Node(tree))\nnames(d) &lt;- NULL\nprint(d, row.names=FALSE)\n\n\n\n\n\n\n(ref:emojidatatreecap)\n\n\n\n\nAnother way to print ASCII-art of phylogeny is to use the ascii() device defined in the devout package. Here is an example:\n\nlibrary(devout)\nascii(width=80)\nggtree(rtree(5))\ninvisible(dev.off())\n\nNA                                                                                 \nNA                                    #####################                        \nNA                                    #                                            \nNA                   ##################                                            \nNA                   #                #                                            \nNA                   #                ###############################              \nNA                   #                                                             \nNA    ################                                                             \nNA    #              #                                                             \nNA    #              #                          ##########                         \nNA    #              #                          #                                  \nNA    #              ############################                                  \nNA    #                                         #                                  \nNA    #                                         ###############################    \nNA    #                                                                            \nNA    #                                                                            \nNA    #                                                                            \nNA    ###############                                                              \nNA                                                                                 \nNA",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-tools.html#sec-facet-zoom",
    "href": "A-app-tools.html#sec-facet-zoom",
    "title": "11  Related Tools",
    "section": "11.6 Zoom in on the Selected Portion",
    "text": "11.6 Zoom in on the Selected Portion\nIn addition to using viewClade() function, users can use the ggforce package to zoom in on a selected clade (Figure ?fig-facetZoom).\n\nset.seed(2019-08-05)\nx &lt;- rtree(30)\nnn &lt;- tidytree::offspring(x, 43, self_include=TRUE)\nggtree(x) + ggforce::facet_zoom(xy = node %in% nn)\n\n\n\n\nZoom in on a selected clade.",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-tools.html#sec-ggimage-tips",
    "href": "A-app-tools.html#sec-ggimage-tips",
    "title": "11  Related Tools",
    "section": "11.7 Tips for Using ggtree with ggimage",
    "text": "11.7 Tips for Using ggtree with ggimage\nThe ggtree supports annotating a tree with silhouette images via the ggimage package. The ggimage provides the grammar of graphic syntax to work with image files. It allows processing images on the fly via the image_fun parameter, which accepts a function to process magick-image objects (Figure ?fig-ggimagebg). The magick package provides several functions, and these functions can be combined to perform a particular task.\n\n11.7.1 Example 1: Remove background of images\n\nlibrary(ggimage)\n\nLoading required package: ggplot2\n\nimgdir &lt;- system.file(\"extdata/frogs\", package = \"TDbook\")\n\nset.seed(1982)\nx &lt;- rtree(5)\np &lt;- ggtree(x) + theme_grey()\np1 &lt;- p + geom_nodelab(image=paste0(imgdir, \"/frog.jpg\"), \n                        geom=\"image\", size=.12) + \n      ggtitle(\"original image\")\np2 &lt;- p + geom_nodelab(image=paste0(imgdir, \"/frog.jpg\"), \n            geom=\"image\", size=.12,\n            image_fun= function(.) magick::image_transparent(., \"white\")) + \n      ggtitle(\"image with background removed\")\naplot::plot_list(p1, p2, ncol=2)\n\n\n\n\n(ref:ggimagebgcap)\n\n\n\n\n\n\n11.7.2 Example 2: Plot tree on a background image\nThe geom_bgimage() adds a layer of the image and puts the layer to the bottom of the layer stack. It is a normal layer and doesn’t change the structure of the output ggtree object. Users can add annotation layers without the background image layer (Figure ?fig-bgimage).\n\nggtree(rtree(20), size=1.5, color=\"white\") + \n  geom_bgimage('img/blackboard.jpg') + \n  geom_tiplab(color=\"white\", size=5, family='xkcd')\n\n\n\n\n(ref:bgimagecap)",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-tools.html#run-ggtree-in-jupyter-notebook",
    "href": "A-app-tools.html#run-ggtree-in-jupyter-notebook",
    "title": "11  Related Tools",
    "section": "11.8 Run ggtree in Jupyter Notebook",
    "text": "11.8 Run ggtree in Jupyter Notebook\nIf you have Jupyter notebook installed on your system, you can install IRkernel with the following command in R:\ninstall.packages(\"IRkernel\")\nIRkernel::installspec()\nThen you can use ggtree and other R packages in the Jupyter notebook (Figure ?fig-jupyter). Here is a screenshot of recreating Figure ?fig-phylomoji1 in the Jupyter notebook.\n\n\n\n\n\nggtree in Jupyter notebook. Running ggtree in Jupyter notebook via R kernel.\n\n\n\n\n\n\n\n\nMichonneau, F., Brown, J. W., & Winter, D. J. (2016). Rotl: An r package to interact with the open tree of life data. Methods in Ecology and Evolution, 7(12), 1476–1481. https://doi.org/10.1111/2041-210X.12593",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Related Tools</span>"
    ]
  },
  {
    "objectID": "A-app-fig-tab.html",
    "href": "A-app-fig-tab.html",
    "title": "12  Figures and Tables",
    "section": "",
    "text": "Loading required package: kableExtra\n\nGeometric layers that supported by `geom_facet()'\n\n\nPackage\nGeom Layer\nDescription\n\n\n\n\nggalt\ngeom_dumbbell\ncreates dumbbell charts\n\n\nggbio\ngeom_alignment\nshows interval data as alignment\n\n\nggfittext\ngeom_fit_text\nshrinks, grows, or wraps text to fit inside a defined rectangular area\n\n\ngggenes\ngeom_gene_arrow\ndraws genes as arrows\n\n\nggimage\ngeom_image\nvisualizes image files\n\n\ngeom_phylopic\nqueries image files from the PhyloPic database and visualizes them\n\n\nggplot2\ngeom_hline\nadds horizontal lines\n\n\ngeom_jitter\nadds a small amount of random variation to the location of each point\n\n\ngeom_label\ndraws a rectangle behind the text\n\n\ngeom_point\ncreates scatterplots\n\n\ngeom_raster\na high-performance special case for all the tiles that are the same size\n\n\ngeom_rect\ndraws rectangle by using the locations of the four corners\n\n\ngeom_segment\ndraws a straight line between points\n\n\ngeom_spoke\na polar parameterization of 'geom_segment()'\n\n\ngeom_text\nadds text to the plot\n\n\ngeom_tile\ndraws rectangle by using the center of the tile and its size\n\n\ngeom_vline\nadds vertical lines\n\n\nggrepel\ngeom_text_repel\nadds text to the plot. The text labels repel away from each other and away from the data points\n\n\ngeom_label_repel\ndraws a rectangle underneath the text. The text labels repel away from each other and away from the data points\n\n\nggridges\ngeom_density_ridges\narranges multiple density plots in a staggered fashion\n\n\ngeom_density_ridges_gradient\nworks just like 'geom_density_ridges' except that the 'fill' aesthetic can vary along the *x*-axis\n\n\ngeom_ridgeline\nplots the sum of the 'y' and 'height' aesthetics vs. 'x', filling the area between 'y' and 'y + height' with a color\n\n\ngeom_ridgeline_gradient\nworks just like 'geom_ridgeline' except that the 'fill' aesthetic can vary along the *x*-axis\n\n\nggstance\ngeom_barh\nhorizontal version of 'geom_bar()'\n\n\ngeom_boxploth\nhorizontal version of 'geom_boxplot()'\n\n\ngeom_crossbarh\nhorizontal version of 'geom_crossbar()'\n\n\ngeom_errorbarh\nhorizontal version of 'geom_errorbarh()'\n\n\ngeom_histogramh\nhorizontal version of 'geom_histogram()'\n\n\ngeom_linerangeh\nhorizontal version of 'geom_linerange()'\n\n\ngeom_pointrangeh\nhorizontal version of 'geom_pointrange()'\n\n\ngeom_violinh\nhorizontal version of 'geom_violin()'\n\n\nggtree\ngeom_motif\ndraws aligned motifs\n\n\n\n\n\n\n\nTree-like objects supported by ggtree\n\n\nPackage\nObject\nDescription\n\n\n\n\nape\nphylo\nbasic phylogenetic tree structure\n\n\nmultiPhylo\nlist of phylo objects\n\n\nade4\nphylog\ntree structure for ecological data\n\n\nphylobase\nphylo4\nS4 version of phylo object\n\n\nphylo4d\nextend phylo4 with trait data\n\n\nphyloseq\nphyloseq\nphylogenetic tree with microbiome data\n\n\ntidytree\ntbl_tree\nphylogenetic tree as a tidy data frame\n\n\ntreeio\ntreedata\nphylogenetic tree with heterogeneous associated data\n\n\njplace\ntreedata object with placement information\n\n\nstats\nhclust\nhierarchical cluster result\n\n\ndendrogram\nhierarchical clustering or classification/regression tree\n\n\ncluster\nagnes\nagglomerative hierarchical clustering\n\n\ndiana\ndivisive hierarchical clustering\n\n\ntwins\nagglomerative or divisive (polythetic) hierarchical clustering\n\n\npvclust\npvclust\nhierarchical clustering with p-values calculated by multiscale bootstrap resampling\n\n\nigraph\nigraph\nnetwork (currently only tree graph supported)\n\n\n\n\n\n13 Session Info\n\nlibrary(\"yulab.utils\")\n\nThe book was written using R Markdown and was compiled by bookdown package. Here is the session information on the system on which this thesis was compiled:\n\n\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.4.1 (2024-06-14)\n os       Ubuntu 24.04.3 LTS\n system   x86_64, linux-gnu\n ui       X11\n language (EN)\n collate  C.UTF-8\n ctype    C.UTF-8\n tz       UTC\n date     2026-01-10\n pandoc   3.1.3 @ /usr/bin/ (via rmarkdown)\n quarto   1.8.26 @ /usr/local/bin/quarto\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package      * version date (UTC) lib source\n cachem         1.1.0   2024-05-16 [1] CRAN (R 4.4.1)\n cli            3.6.5   2025-04-23 [1] CRAN (R 4.4.1)\n devtools       2.4.6   2025-10-03 [1] any (@2.4.6)\n digest         0.6.39  2025-11-19 [1] CRAN (R 4.4.1)\n ellipsis       0.3.2   2021-04-29 [1] CRAN (R 4.4.1)\n evaluate       1.0.5   2025-08-27 [1] CRAN (R 4.4.1)\n farver         2.1.2   2024-05-13 [1] CRAN (R 4.4.1)\n fastmap        1.2.0   2024-05-15 [1] CRAN (R 4.4.1)\n fs             1.6.6   2025-04-12 [1] CRAN (R 4.4.1)\n glue           1.8.0   2024-09-30 [1] CRAN (R 4.4.1)\n htmltools      0.5.9   2025-12-04 [1] CRAN (R 4.4.1)\n htmlwidgets    1.6.4   2023-12-06 [1] CRAN (R 4.4.1)\n jsonlite       2.0.0   2025-03-27 [1] CRAN (R 4.4.1)\n kableExtra   * 1.4.0   2024-01-24 [1] any (@1.4.0)\n knitr          1.51    2025-12-20 [1] any (@1.51)\n lifecycle      1.0.5   2026-01-08 [1] CRAN (R 4.4.1)\n magrittr       2.0.4   2025-09-12 [1] CRAN (R 4.4.1)\n memoise        2.0.1   2021-11-26 [1] CRAN (R 4.4.1)\n otel           0.2.0   2025-08-29 [1] CRAN (R 4.4.1)\n pillar         1.11.1  2025-09-17 [1] CRAN (R 4.4.1)\n pkgbuild       1.4.8   2025-05-26 [1] CRAN (R 4.4.1)\n pkgconfig      2.0.3   2019-09-22 [1] CRAN (R 4.4.1)\n pkgload        1.4.1   2025-09-23 [1] CRAN (R 4.4.1)\n purrr          1.2.1   2026-01-09 [1] CRAN (R 4.4.1)\n R6             2.6.1   2025-02-15 [1] CRAN (R 4.4.1)\n rappdirs       0.3.3   2021-01-31 [1] CRAN (R 4.4.1)\n RColorBrewer   1.1-3   2022-04-03 [1] CRAN (R 4.4.1)\n remotes        2.5.0   2024-03-17 [1] CRAN (R 4.4.1)\n rlang          1.1.7   2026-01-09 [1] CRAN (R 4.4.1)\n rmarkdown      2.30    2025-09-28 [1] CRAN (R 4.4.1)\n rstudioapi     0.17.1  2024-10-22 [1] CRAN (R 4.4.1)\n scales         1.4.0   2025-04-24 [1] any (@1.4.0)\n sessioninfo    1.2.3   2025-02-05 [1] CRAN (R 4.4.1)\n stringi        1.8.7   2025-03-27 [1] CRAN (R 4.4.1)\n stringr        1.6.0   2025-11-04 [1] CRAN (R 4.4.1)\n svglite        2.2.2   2025-10-21 [1] CRAN (R 4.4.1)\n systemfonts    1.3.1   2025-10-01 [1] CRAN (R 4.4.1)\n textshaping    1.0.4   2025-10-10 [1] CRAN (R 4.4.1)\n tibble         3.3.0   2025-06-08 [1] CRAN (R 4.4.1)\n usethis        3.2.1   2025-09-06 [1] CRAN (R 4.4.1)\n vctrs          0.6.5   2023-12-01 [1] CRAN (R 4.4.1)\n viridisLite    0.4.2   2023-05-02 [1] CRAN (R 4.4.1)\n xfun           0.55    2025-12-16 [1] CRAN (R 4.4.1)\n xml2           1.5.1   2025-12-01 [1] CRAN (R 4.4.1)\n yaml           2.3.12  2025-12-10 [1] CRAN (R 4.4.1)\n yulab.utils  * 0.2.3   2025-12-15 [1] CRAN (R 4.4.1)\n\n [1] /home/runner/work/_temp/Library\n [2] /opt/R/4.4.1/lib/R/site-library\n [3] /opt/R/4.4.1/lib/R/library\n * ── Packages attached to the search path.\n\n──────────────────────────────────────────────────────────────────────────────",
    "crumbs": [
      "Appendix",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>Figures and Tables</span>"
    ]
  }
]